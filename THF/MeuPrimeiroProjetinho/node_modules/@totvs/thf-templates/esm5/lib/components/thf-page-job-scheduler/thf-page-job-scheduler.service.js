/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { map } from 'rxjs/operators';
import { addZero, convertDateToISOExtended } from '../../utils/util';
var ThfPageJobSchedulerService = /** @class */ (function () {
    function ThfPageJobSchedulerService(http) {
        this.http = http;
        this.endpoint = '/';
        this.headers = new HttpHeaders({
            'X-TOTVS-SCREEN-LOCK': 'true'
        });
    }
    /**
     * @param {?=} config
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.configServiceApi = /**
     * @param {?=} config
     * @return {?}
     */
    function (config) {
        if (config === void 0) { config = {}; }
        this.endpoint = config.endpoint;
    };
    // Cria um recurso
    // Cria um recurso
    /**
     * @param {?} resource
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.createResource = 
    // Cria um recurso
    /**
     * @param {?} resource
     * @return {?}
     */
    function (resource) {
        /** @type {?} */
        var jobScheduler = this.convertToJobScheduler(resource);
        return this.http.post("" + this.endpoint, jobScheduler, { headers: this.headers });
    };
    /**
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getHeadProcesses = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var headers = { 'X-Totvs-No-Error': 'true' };
        return this.http.head(this.endpoint + "/processes", { headers: headers });
    };
    // Busca parametros pelo processo id
    // Busca parametros pelo processo id
    /**
     * @param {?} processId
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getParametersByProcess = 
    // Busca parametros pelo processo id
    /**
     * @param {?} processId
     * @return {?}
     */
    function (processId) {
        return this.http.get(this.endpoint + "/processes/" + processId + "/parameters", { headers: this.headers })
            .pipe(map((/**
         * @param {?} resource
         * @return {?}
         */
        function (resource) { return resource.items; })));
    };
    // Busca um único recurso
    // Busca um único recurso
    /**
     * @param {?} id
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getProcess = 
    // Busca um único recurso
    /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.http.get(this.endpoint + "/processes/" + id, { headers: this.headers });
    };
    // Busca uma lista de processos
    // Busca uma lista de processos
    /**
     * @param {?=} params
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getProcesses = 
    // Busca uma lista de processos
    /**
     * @param {?=} params
     * @return {?}
     */
    function (params) {
        if (params === void 0) { params = {}; }
        return this.http.get(this.endpoint + "/processes", { params: params });
    };
    // Busca um único recurso
    // Busca um único recurso
    /**
     * @param {?} id
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getResource = 
    // Busca um único recurso
    /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        return this.http.get(this.endpoint + "/" + id, { headers: this.headers })
            .pipe(map((/**
         * @param {?} resource
         * @return {?}
         */
        function (resource) { return _this.convertToJobSchedulerInternal(resource); })));
    };
    // Atualiza um recurso
    // Atualiza um recurso
    /**
     * @param {?} id
     * @param {?} resource
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.updateResource = 
    // Atualiza um recurso
    /**
     * @param {?} id
     * @param {?} resource
     * @return {?}
     */
    function (id, resource) {
        /** @type {?} */
        var jobScheduler = this.convertToJobScheduler(resource);
        return this.http.put(this.endpoint + "/" + id, jobScheduler, { headers: this.headers });
    };
    /**
     * @private
     * @param {?} jobSchedulerInternal
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.convertToJobScheduler = /**
     * @private
     * @param {?} jobSchedulerInternal
     * @return {?}
     */
    function (jobSchedulerInternal) {
        /** @type {?} */
        var jobScheduler = tslib_1.__assign({}, jobSchedulerInternal);
        if (jobSchedulerInternal.periodicity) {
            if (jobSchedulerInternal.periodicity === 'single') {
                jobScheduler.recurrent = false;
            }
            else {
                Object.assign(jobScheduler, this.convertToPeriodicity(jobSchedulerInternal));
            }
        }
        if (jobSchedulerInternal.firstExecutionHour) {
            jobScheduler.firstExecution =
                this.replaceHourFirstExecution(jobSchedulerInternal.firstExecution, jobSchedulerInternal.firstExecutionHour);
        }
        if (!Object.keys(this.returnValidExecutionParameter(jobScheduler.executionParameter)).length) {
            delete jobScheduler.executionParameter;
        }
        this.removeInvalidKeys(jobScheduler);
        return jobScheduler;
    };
    /**
     * @private
     * @param {?=} jobScheduler
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.convertToJobSchedulerInternal = /**
     * @private
     * @param {?=} jobScheduler
     * @return {?}
     */
    function (jobScheduler) {
        if (jobScheduler === void 0) { jobScheduler = (/** @type {?} */ ({})); }
        /** @type {?} */
        var jobSchedulerInternal = tslib_1.__assign({}, jobScheduler);
        if (jobScheduler.firstExecution) {
            jobSchedulerInternal.firstExecutionHour = this.getHourFirstExecution(jobScheduler.firstExecution);
        }
        Object.assign(jobSchedulerInternal, this.convertToPeriodicityInternal(jobScheduler));
        this.removeInvalidKeys(jobSchedulerInternal, ['weekly', 'monthly', 'daily']);
        return jobSchedulerInternal;
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.convertToPeriodicity = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var newValue = {};
        /** @type {?} */
        var valuePeriodicity = value.periodicity;
        if (valuePeriodicity) {
            newValue[valuePeriodicity] = {};
            if (valuePeriodicity === 'monthly') {
                newValue[valuePeriodicity].day = value.dayOfMonth ? parseInt(value.dayOfMonth, 10) : 0;
            }
            else if (valuePeriodicity === 'weekly') {
                newValue[valuePeriodicity].daysOfWeek = value.daysOfWeek;
            }
            newValue[valuePeriodicity].hour = value.hour ? parseInt(value.hour.split(':')[0], 10) : 0;
            newValue[valuePeriodicity].minute = value.hour ? parseInt(value.hour.split(':')[1], 10) : 0;
        }
        return newValue;
    };
    /**
     * @private
     * @param {?=} value
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.convertToPeriodicityInternal = /**
     * @private
     * @param {?=} value
     * @return {?}
     */
    function (value) {
        if (value === void 0) { value = (/** @type {?} */ ({})); }
        if (value.monthly) {
            return {
                periodicity: 'monthly',
                hour: addZero(value.monthly.hour) + ":" + addZero(value.monthly.minute),
                dayOfMonth: value.monthly.day
            };
        }
        else if (value.daily) {
            return {
                periodicity: 'daily',
                hour: addZero(value.daily.hour) + ":" + addZero(value.daily.minute)
            };
        }
        else if (value.weekly) {
            return {
                periodicity: 'weekly',
                hour: addZero(value.weekly.hour) + ":" + addZero(value.weekly.minute),
                daysOfWeek: tslib_1.__spread(value.weekly.daysOfWeek)
            };
        }
        else {
            return {
                periodicity: 'single'
            };
        }
    };
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getCurrentHour = /**
     * @private
     * @param {?} date
     * @return {?}
     */
    function (date) {
        /** @type {?} */
        var hours = addZero(date.getHours());
        /** @type {?} */
        var minutes = addZero(date.getMinutes());
        return hours + ":" + minutes;
    };
    /**
     * @private
     * @param {?} firstExecutionDate
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.getHourFirstExecution = /**
     * @private
     * @param {?} firstExecutionDate
     * @return {?}
     */
    function (firstExecutionDate) {
        return this.getCurrentHour(new Date(firstExecutionDate));
    };
    /**
     * @private
     * @param {?} value
     * @param {?=} keys
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.removeInvalidKeys = /**
     * @private
     * @param {?} value
     * @param {?=} keys
     * @return {?}
     */
    function (value, keys) {
        /** @type {?} */
        var invalidKeys = keys || ['periodicity', 'hour', 'minute', 'day', 'daysOfWeek', 'dayOfMonth', 'firstExecutionHour'];
        Object.keys(value).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            if (invalidKeys.includes(key)) {
                delete value[key];
            }
        }));
    };
    /**
     * @private
     * @param {?} date
     * @param {?} time
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.replaceHourFirstExecution = /**
     * @private
     * @param {?} date
     * @param {?} time
     * @return {?}
     */
    function (date, time) {
        /** @type {?} */
        var firstExecutionDate = new Date(date);
        /** @type {?} */
        var timeSplited = time.split(':');
        /** @type {?} */
        var hours = parseInt(timeSplited[0], 10);
        /** @type {?} */
        var minutes = parseInt(timeSplited[1], 10);
        firstExecutionDate.setHours(hours, minutes);
        return convertDateToISOExtended(firstExecutionDate);
    };
    /**
     * @private
     * @param {?} parameter
     * @return {?}
     */
    ThfPageJobSchedulerService.prototype.returnValidExecutionParameter = /**
     * @private
     * @param {?} parameter
     * @return {?}
     */
    function (parameter) {
        /** @type {?} */
        var newParameter = tslib_1.__assign({}, parameter);
        for (var key in newParameter) {
            if (newParameter.hasOwnProperty(key) && newParameter[key] === undefined) {
                delete newParameter[key];
            }
        }
        return newParameter;
    };
    ThfPageJobSchedulerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ThfPageJobSchedulerService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return ThfPageJobSchedulerService;
}());
export { ThfPageJobSchedulerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerService.prototype.endpoint;
    /** @type {?} */
    ThfPageJobSchedulerService.prototype.headers;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2Utam9iLXNjaGVkdWxlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi10ZW1wbGF0ZXMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtcGFnZS1qb2Itc2NoZWR1bGVyL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUczQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckMsT0FBTyxFQUFFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBTXJFO0lBU0Usb0NBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUFONUIsYUFBUSxHQUFHLEdBQUcsQ0FBQztRQUVkLFlBQU8sR0FBZ0IsSUFBSSxXQUFXLENBQUM7WUFDOUMscUJBQXFCLEVBQUUsTUFBTTtTQUM5QixDQUFDLENBQUM7SUFFcUMsQ0FBQzs7Ozs7SUFFekMscURBQWdCOzs7O0lBQWhCLFVBQWlCLE1BQWtDO1FBQWxDLHVCQUFBLEVBQUEsV0FBa0M7UUFDakQsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxrQkFBa0I7Ozs7OztJQUNsQixtREFBYzs7Ozs7O0lBQWQsVUFBZSxRQUFROztZQUNmLFlBQVksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDO1FBRXpELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBRyxJQUFJLENBQUMsUUFBVSxFQUFFLFlBQVksRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNy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ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IGFkZFplcm8sIGNvbnZlcnREYXRlVG9JU09FeHRlbmRlZCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgVGhmRHluYW1pY0Zvcm1GaWVsZCB9IGZyb20gJ0B0b3R2cy90aGYtdWknO1xuXG5pbXBvcnQgeyBUaGZKb2JTY2hlZHVsZXIgfSBmcm9tICcuL2ludGVyZmFjZXMvdGhmLWpvYi1zY2hlZHVsZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IFRoZkpvYlNjaGVkdWxlckludGVybmFsIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3RoZi1qb2Itc2NoZWR1bGVyLWludGVybmFsLmludGVyZmFjZSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBUaGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZSB7XG5cbiAgcHJpdmF0ZSBlbmRwb2ludCA9ICcvJztcblxuICByZWFkb25seSBoZWFkZXJzOiBIdHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgJ1gtVE9UVlMtU0NSRUVOLUxPQ0snOiAndHJ1ZSdcbiAgfSk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7IH1cblxuICBjb25maWdTZXJ2aWNlQXBpKGNvbmZpZzogeyBlbmRwb2ludD86IHN0cmluZyB9ID0ge30pIHtcbiAgICB0aGlzLmVuZHBvaW50ID0gY29uZmlnLmVuZHBvaW50O1xuICB9XG5cbiAgLy8gQ3JpYSB1bSByZWN1cnNvXG4gIGNyZWF0ZVJlc291cmNlKHJlc291cmNlKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCBqb2JTY2hlZHVsZXIgPSB0aGlzLmNvbnZlcnRUb0pvYlNjaGVkdWxlcihyZXNvdXJjZSk7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoYCR7dGhpcy5lbmRwb2ludH1gLCBqb2JTY2hlZHVsZXIsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgZ2V0SGVhZFByb2Nlc3NlcygpIHtcbiAgICBjb25zdCBoZWFkZXJzID0geyAnWC1Ub3R2cy1Oby1FcnJvcic6ICd0cnVlJyB9O1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5oZWFkKGAke3RoaXMuZW5kcG9pbnR9L3Byb2Nlc3Nlc2AsIHsgaGVhZGVycyB9KTtcbiAgfVxuXG4gIC8vIEJ1c2NhIHBhcmFtZXRyb3MgcGVsbyBwcm9jZXNzbyBpZFxuICBnZXRQYXJhbWV0ZXJzQnlQcm9jZXNzKHByb2Nlc3NJZDogc3RyaW5nIHwgbnVtYmVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLmVuZHBvaW50fS9wcm9jZXNzZXMvJHtwcm9jZXNzSWR9L3BhcmFtZXRlcnNgLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KVxuICAgIC5waXBlKG1hcCgocmVzb3VyY2U6IHsgaXRlbXM6IEFycmF5PFRoZkR5bmFtaWNGb3JtRmllbGQ+IH0pID0+IHJlc291cmNlLml0ZW1zKSk7XG4gIH1cblxuICAvLyBCdXNjYSB1bSDDum5pY28gcmVjdXJzb1xuICBnZXRQcm9jZXNzKGlkOiBzdHJpbmcgfCBudW1iZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZW5kcG9pbnR9L3Byb2Nlc3Nlcy8ke2lkfWAsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgLy8gQnVzY2EgdW1hIGxpc3RhIGRlIHByb2Nlc3Nvc1xuICBnZXRQcm9jZXNzZXMocGFyYW1zOiB7fSA9IHt9KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLmVuZHBvaW50fS9wcm9jZXNzZXNgLCB7IHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vIEJ1c2NhIHVtIMO6bmljbyByZWN1cnNvXG4gIGdldFJlc291cmNlKGlkOiBzdHJpbmcgfCBudW1iZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZW5kcG9pbnR9LyR7aWR9YCwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSlcbiAgICAgIC5waXBlKG1hcChyZXNvdXJjZSA9PiB0aGlzLmNvbnZlcnRUb0pvYlNjaGVkdWxlckludGVybmFsKHJlc291cmNlKSkpO1xuICB9XG5cbiAgLy8gQXR1YWxpemEgdW0gcmVjdXJzb1xuICB1cGRhdGVSZXNvdXJjZShpZCwgcmVzb3VyY2UpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IGpvYlNjaGVkdWxlciA9IHRoaXMuY29udmVydFRvSm9iU2NoZWR1bGVyKHJlc291cmNlKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0KGAke3RoaXMuZW5kcG9pbnR9LyR7aWR9YCwgam9iU2NoZWR1bGVyLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydFRvSm9iU2NoZWR1bGVyKGpvYlNjaGVkdWxlckludGVybmFsKTogVGhmSm9iU2NoZWR1bGVyIHtcbiAgICBjb25zdCBqb2JTY2hlZHVsZXIgPSB7IC4uLmpvYlNjaGVkdWxlckludGVybmFsIH07XG5cbiAgICBpZiAoam9iU2NoZWR1bGVySW50ZXJuYWwucGVyaW9kaWNpdHkpIHtcblxuICAgICAgaWYgKGpvYlNjaGVkdWxlckludGVybmFsLnBlcmlvZGljaXR5ID09PSAnc2luZ2xlJykge1xuICAgICAgICBqb2JTY2hlZHVsZXIucmVjdXJyZW50ID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBPYmplY3QuYXNzaWduKGpvYlNjaGVkdWxlciwgdGhpcy5jb252ZXJ0VG9QZXJpb2RpY2l0eShqb2JTY2hlZHVsZXJJbnRlcm5hbCkpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgaWYgKGpvYlNjaGVkdWxlckludGVybmFsLmZpcnN0RXhlY3V0aW9uSG91cikge1xuICAgICAgam9iU2NoZWR1bGVyLmZpcnN0RXhlY3V0aW9uID1cbiAgICAgICAgdGhpcy5yZXBsYWNlSG91ckZpcnN0RXhlY3V0aW9uKGpvYlNjaGVkdWxlckludGVybmFsLmZpcnN0RXhlY3V0aW9uLCBqb2JTY2hlZHVsZXJJbnRlcm5hbC5maXJzdEV4ZWN1dGlvbkhvdXIpO1xuICAgIH1cblxuICAgIGlmICghT2JqZWN0LmtleXModGhpcy5yZXR1cm5WYWxpZEV4ZWN1dGlvblBhcmFtZXRlcihqb2JTY2hlZHVsZXIuZXhlY3V0aW9uUGFyYW1ldGVyKSkubGVuZ3RoKSB7XG4gICAgICBkZWxldGUgam9iU2NoZWR1bGVyLmV4ZWN1dGlvblBhcmFtZXRlcjtcbiAgICB9XG5cbiAgICB0aGlzLnJlbW92ZUludmFsaWRLZXlzKGpvYlNjaGVkdWxlcik7XG5cbiAgICByZXR1cm4gam9iU2NoZWR1bGVyO1xuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0VG9Kb2JTY2hlZHVsZXJJbnRlcm5hbChqb2JTY2hlZHVsZXIgPSA8YW55PiB7fSk6IFRoZkpvYlNjaGVkdWxlckludGVybmFsIHtcbiAgICBjb25zdCBqb2JTY2hlZHVsZXJJbnRlcm5hbCA9IHsgLi4uam9iU2NoZWR1bGVyIH07XG5cbiAgICBpZiAoam9iU2NoZWR1bGVyLmZpcnN0RXhlY3V0aW9uKSB7XG4gICAgICBqb2JTY2hlZHVsZXJJbnRlcm5hbC5maXJzdEV4ZWN1dGlvbkhvdXIgPSB0aGlzLmdldEhvdXJGaXJzdEV4ZWN1dGlvbihqb2JTY2hlZHVsZXIuZmlyc3RFeGVjdXRpb24pO1xuICAgIH1cblxuICAgIE9iamVjdC5hc3NpZ24oam9iU2NoZWR1bGVySW50ZXJuYWwsIHRoaXMuY29udmVydFRvUGVyaW9kaWNpdHlJbnRlcm5hbChqb2JTY2hlZHVsZXIpKTtcblxuICAgIHRoaXMucmVtb3ZlSW52YWxpZEtleXMoam9iU2NoZWR1bGVySW50ZXJuYWwsIFsnd2Vla2x5JywgJ21vbnRobHknLCAnZGFpbHknXSk7XG5cbiAgICByZXR1cm4gam9iU2NoZWR1bGVySW50ZXJuYWw7XG4gIH1cblxuICBwcml2YXRlIGNvbnZlcnRUb1BlcmlvZGljaXR5KHZhbHVlOiB7IHBlcmlvZGljaXR5OiBzdHJpbmcgLCBkYXlPZk1vbnRoPzogc3RyaW5nLCBkYXlzT2ZXZWVrPzogbnVtYmVyLCBob3VyPzogc3RyaW5nIH0pIHtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHt9O1xuICAgIGNvbnN0IHZhbHVlUGVyaW9kaWNpdHkgPSB2YWx1ZS5wZXJpb2RpY2l0eTtcblxuICAgIGlmICh2YWx1ZVBlcmlvZGljaXR5KSB7XG4gICAgICBuZXdWYWx1ZVt2YWx1ZVBlcmlvZGljaXR5XSA9IHt9O1xuXG4gICAgICBpZiAodmFsdWVQZXJpb2RpY2l0eSA9PT0gJ21vbnRobHknKSB7XG4gICAgICAgIG5ld1ZhbHVlW3ZhbHVlUGVyaW9kaWNpdHldLmRheSA9IHZhbHVlLmRheU9mTW9udGggPyBwYXJzZUludCh2YWx1ZS5kYXlPZk1vbnRoLCAxMCkgOiAwO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZVBlcmlvZGljaXR5ID09PSAnd2Vla2x5Jykge1xuICAgICAgICBuZXdWYWx1ZVt2YWx1ZVBlcmlvZGljaXR5XS5kYXlzT2ZXZWVrID0gdmFsdWUuZGF5c09mV2VlaztcbiAgICAgIH1cblxuICAgICAgbmV3VmFsdWVbdmFsdWVQZXJpb2RpY2l0eV0uaG91ciA9IHZhbHVlLmhvdXIgPyBwYXJzZUludCh2YWx1ZS5ob3VyLnNwbGl0KCc6JylbMF0sIDEwKSA6IDA7XG4gICAgICBuZXdWYWx1ZVt2YWx1ZVBlcmlvZGljaXR5XS5taW51dGUgPSB2YWx1ZS5ob3VyID8gcGFyc2VJbnQodmFsdWUuaG91ci5zcGxpdCgnOicpWzFdLCAxMCkgOiAwO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydFRvUGVyaW9kaWNpdHlJbnRlcm5hbCh2YWx1ZSA9IDxhbnk+IHt9KSB7XG4gICAgaWYgKHZhbHVlLm1vbnRobHkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBlcmlvZGljaXR5OiAnbW9udGhseScsXG4gICAgICAgIGhvdXI6IGAke2FkZFplcm8odmFsdWUubW9udGhseS5ob3VyKX06JHthZGRaZXJvKHZhbHVlLm1vbnRobHkubWludXRlKX1gLFxuICAgICAgICBkYXlPZk1vbnRoOiB2YWx1ZS5tb250aGx5LmRheVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlLmRhaWx5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwZXJpb2RpY2l0eTogJ2RhaWx5JyxcbiAgICAgICAgaG91cjogYCR7YWRkWmVybyh2YWx1ZS5kYWlseS5ob3VyKX06JHthZGRaZXJvKHZhbHVlLmRhaWx5Lm1pbnV0ZSl9YFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlLndlZWtseSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGVyaW9kaWNpdHk6ICd3ZWVrbHknLFxuICAgICAgICBob3VyOiBgJHthZGRaZXJvKHZhbHVlLndlZWtseS5ob3VyKX06JHthZGRaZXJvKHZhbHVlLndlZWtseS5taW51dGUpfWAsXG4gICAgICAgIGRheXNPZldlZWs6IFsuLi52YWx1ZS53ZWVrbHkuZGF5c09mV2Vla11cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBlcmlvZGljaXR5OiAnc2luZ2xlJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEN1cnJlbnRIb3VyKGRhdGU6IERhdGUpOiBzdHJpbmcge1xuICAgIGNvbnN0IGhvdXJzID0gYWRkWmVybyhkYXRlLmdldEhvdXJzKCkpO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBhZGRaZXJvKGRhdGUuZ2V0TWludXRlcygpKTtcblxuICAgIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfWA7XG4gIH1cblxuICBwcml2YXRlIGdldEhvdXJGaXJzdEV4ZWN1dGlvbihmaXJzdEV4ZWN1dGlvbkRhdGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudEhvdXIobmV3IERhdGUoZmlyc3RFeGVjdXRpb25EYXRlKSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUludmFsaWRLZXlzKHZhbHVlOiBvYmplY3QsIGtleXM/OiBBcnJheTxzdHJpbmc+KSB7XG4gICAgY29uc3QgaW52YWxpZEtleXMgPSBrZXlzIHx8IFsncGVyaW9kaWNpdHknLCAnaG91cicsICdtaW51dGUnLCAnZGF5JywgJ2RheXNPZldlZWsnLCAnZGF5T2ZNb250aCcsICdmaXJzdEV4ZWN1dGlvbkhvdXInXTtcblxuICAgIE9iamVjdC5rZXlzKHZhbHVlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAoaW52YWxpZEtleXMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICBkZWxldGUgdmFsdWVba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVwbGFjZUhvdXJGaXJzdEV4ZWN1dGlvbihkYXRlOiBzdHJpbmcsIHRpbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgZmlyc3RFeGVjdXRpb25EYXRlID0gbmV3IERhdGUoZGF0ZSk7XG5cbiAgICBjb25zdCB0aW1lU3BsaXRlZCA9IHRpbWUuc3BsaXQoJzonKTtcblxuICAgIGNvbnN0IGhvdXJzID0gcGFyc2VJbnQodGltZVNwbGl0ZWRbMF0sIDEwKTtcbiAgICBjb25zdCBtaW51dGVzID0gcGFyc2VJbnQodGltZVNwbGl0ZWRbMV0sIDEwKTtcblxuICAgIGZpcnN0RXhlY3V0aW9uRGF0ZS5zZXRIb3Vycyhob3VycywgbWludXRlcyk7XG5cbiAgICByZXR1cm4gY29udmVydERhdGVUb0lTT0V4dGVuZGVkKGZpcnN0RXhlY3V0aW9uRGF0ZSk7XG4gIH1cblxuICBwcml2YXRlIHJldHVyblZhbGlkRXhlY3V0aW9uUGFyYW1ldGVyKHBhcmFtZXRlcjogb2JqZWN0KSB7XG4gICAgY29uc3QgbmV3UGFyYW1ldGVyID0geyAuLi5wYXJhbWV0ZXIgfTtcblxuICAgIGZvciAoY29uc3Qga2V5IGluIG5ld1BhcmFtZXRlcikge1xuICAgICAgaWYgKG5ld1BhcmFtZXRlci5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIG5ld1BhcmFtZXRlcltrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZGVsZXRlIG5ld1BhcmFtZXRlcltrZXldO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdQYXJhbWV0ZXI7XG4gIH1cblxufVxuIl19