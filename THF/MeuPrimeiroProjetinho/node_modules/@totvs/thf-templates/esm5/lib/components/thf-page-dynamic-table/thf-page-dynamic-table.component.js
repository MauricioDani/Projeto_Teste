/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { ThfDialogService, ThfNotificationService } from '@totvs/thf-ui';
import * as util from '../../utils/util';
import { ThfPageDynamicDetailComponent } from '../thf-page-dynamic-detail/thf-page-dynamic-detail.component';
// import { ThfPageDynamicEditComponent } from '../thf-page-dynamic-edit/thf-page-dynamic-edit.component';
import { ThfPageDynamicListBaseComponent } from './thf-page-dynamic-list-base.component';
import { ThfPageDynamicService } from './thf-page-dynamic.service';
/** @type {?} */
export var thfPageDynamicTableLiteralsDefault = {
    en: {
        pageAction: 'New',
        pageActionRemoveAll: 'Delete',
        tableActionView: 'View',
        tableActionEdit: 'Edit',
        tableActionDuplicate: 'Duplicate',
        tableActionDelete: 'Delete',
        confirmRemoveTitle: 'Confirm delete',
        confirmRemoveMessage: 'Are you sure you want to delete this record? You can not undo this action.',
        confirmRemoveAllTitle: 'Confirm batch deletion',
        confirmRemoveAllMessage: 'Are you sure you want to delete all these records? You can not undo this action.',
        loadDataErrorNotification: 'Service not found',
        removeSuccessNotification: 'Item deleted successfully',
        removeAllSuccessNotification: 'Items deleted successfully'
    },
    es: {
        pageAction: 'Nuevo',
        pageActionRemoveAll: 'Borrar',
        tableActionView: 'Visualizar',
        tableActionEdit: 'Editar',
        tableActionDuplicate: 'Duplicar',
        tableActionDelete: 'Borrar',
        confirmRemoveTitle: 'Confirmar la exclusión',
        confirmRemoveMessage: '¿Está seguro de que desea eliminar este registro? No puede deshacer esta acción.',
        confirmRemoveAllTitle: 'Confirmar la exclusión por lotes',
        confirmRemoveAllMessage: '¿Está seguro de que desea eliminar todos estos registros? No puede deshacer esta acción.',
        loadDataErrorNotification: 'Servicio no informado.',
        removeSuccessNotification: 'Elemento eliminado con éxito',
        removeAllSuccessNotification: 'Elementos eliminados con éxito'
    },
    pt: {
        pageAction: 'Novo',
        pageActionRemoveAll: 'Excluir',
        tableActionView: 'Visualizar',
        tableActionEdit: 'Editar',
        tableActionDuplicate: 'Duplicar',
        tableActionDelete: 'Excluir',
        confirmRemoveTitle: 'Confirmar exclusão',
        confirmRemoveMessage: 'Tem certeza de que deseja excluir esse registro? Você não poderá desfazer essa ação.',
        confirmRemoveAllTitle: 'Confirmar exclusão em lote',
        confirmRemoveAllMessage: 'Tem certeza de que deseja excluir todos esses registros? Você não poderá desfazer essa ação.',
        loadDataErrorNotification: 'Serviço não informado.',
        removeSuccessNotification: 'Item excluido com sucesso',
        removeAllSuccessNotification: 'Items excluidos com sucesso'
    }
};
/**
 * \@docsExtends ThfPageDynamicListBaseComponent
 *
 * \@description
 *
 * O `thf-page-dynamic-table` é uma página que exibe uma lista de registros em uma tabela baseado em uma lista de fields,
 * o mesmo também suporta metadados conforme especificado na documentação.
 *
 * \@example
 *
 * <example name="thf-page-dynamic-table-basic" title="Totvs Page Dynamic Table Basic">
 *  <file name="sample-thf-page-dynamic-table-basic/sample-thf-page-dynamic-table-basic.component.html"> </file>
 *  <file name="sample-thf-page-dynamic-table-basic/sample-thf-page-dynamic-table-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-page-dynamic-table-users" title="Totvs Page Dynamic Table - Users">
 *  <file name="sample-thf-page-dynamic-table-users/sample-thf-page-dynamic-table-users.component.html"> </file>
 *  <file name="sample-thf-page-dynamic-table-users/sample-thf-page-dynamic-table-users.component.ts"> </file>
 * </example>
 */
var ThfPageDynamicTableComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfPageDynamicTableComponent, _super);
    function ThfPageDynamicTableComponent(router, activatedRoute, thfDialogService, thfNotification, thfPageDynamicService) {
        var _this = _super.call(this) || this;
        _this.router = router;
        _this.activatedRoute = activatedRoute;
        _this.thfDialogService = thfDialogService;
        _this.thfNotification = thfNotification;
        _this.thfPageDynamicService = thfPageDynamicService;
        _this._actions = {};
        _this._pageActions = [];
        _this._tableActions = [];
        _this.page = 1;
        _this.params = {};
        _this.hasNext = false;
        _this.items = [];
        _this.literals = tslib_1.__assign({}, thfPageDynamicTableLiteralsDefault[util.thfLocaleDefault], thfPageDynamicTableLiteralsDefault[util.browserLanguage()]);
        return _this;
    }
    Object.defineProperty(ThfPageDynamicTableComponent.prototype, "actions", {
        get: /**
         * @return {?}
         */
        function () {
            return this._actions;
        },
        /**
         * @optional
         *
         * @description
         *
         * Ações da página e da tabela.
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Ações da página e da tabela.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._actions = value && typeof value === 'object' && Object.keys(value).length > 0 ? value : {};
            this.setPageActions(this.actions);
            this.setRemoveAllAction();
            this.setTableActions(this.actions);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.activatedRoute.snapshot.data.serviceApi) {
            this.serviceApi = this.activatedRoute.snapshot.data.serviceApi;
            this.thfPageDynamicService.configServiceApi({ endpoint: this.serviceApi });
            this.loadMetadata();
        }
        else {
            this.thfPageDynamicService.configServiceApi({ endpoint: this.serviceApi });
            this.loadData();
        }
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.onAdvancedSearch = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        this.loadData(tslib_1.__assign({ page: 1 }, filter));
        this.params = filter;
    };
    /**
     * @param {?} disclaimers
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.onChangeDisclaimers = /**
     * @param {?} disclaimers
     * @return {?}
     */
    function (disclaimers) {
        /** @type {?} */
        var filter = {};
        disclaimers.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        function (disclaimer) {
            filter[disclaimer.property] = disclaimer.value;
        }));
        this.onAdvancedSearch(filter);
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.onQuickSearch = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        this.loadData(filter ? { page: 1, search: filter } : undefined);
        this.params = filter ? { search: filter } : {};
    };
    /**
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.showMore = /**
     * @return {?}
     */
    function () {
        this.loadData(tslib_1.__assign({ page: ++this.page }, this.params));
    };
    Object.defineProperty(ThfPageDynamicTableComponent.prototype, "hasActionRemoveAll", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.actions.removeAll;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfPageDynamicTableComponent.prototype, "pageActions", {
        get: /**
         * @return {?}
         */
        function () {
            return tslib_1.__spread(this._pageActions);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfPageDynamicTableComponent.prototype, "tableActions", {
        get: /**
         * @return {?}
         */
        function () {
            return this._tableActions;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.confirmRemove = /**
     * @private
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var confirmOptions = {
            title: this.literals.confirmRemoveTitle,
            message: this.literals.confirmRemoveMessage,
            confirm: this.remove.bind(this, item)
        };
        this.thfDialogService.confirm(confirmOptions);
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.confirmRemoveAll = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var confirmOptions = {
            title: this.literals.confirmRemoveAllTitle,
            message: this.literals.confirmRemoveAllMessage,
            confirm: this.removeAll.bind(this)
        };
        this.thfDialogService.confirm(confirmOptions);
    };
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.formatUniqueKey = /**
     * @private
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var keys = util.mapObjectByProperties(item, this.keys);
        return util.valuesFromObject(keys).join('|');
    };
    /**
     * @private
     * @param {?=} params
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.loadData = /**
     * @private
     * @param {?=} params
     * @return {?}
     */
    function (params) {
        var _this = this;
        if (params === void 0) { params = {}; }
        if (!this.serviceApi) {
            this.thfNotification.error(this.literals.loadDataErrorNotification);
            return;
        }
        /** @type {?} */
        var defaultParams = { page: 1, pageSize: 10 };
        /** @type {?} */
        var fullParams = tslib_1.__assign({}, defaultParams, params);
        this.thfPageDynamicService.getResources(fullParams).toPromise().then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            _this.items = fullParams.page === 1 ? response.items : tslib_1.__spread(_this.items, response.items);
            _this.page = fullParams.page;
            _this.hasNext = response.hasNext;
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.loadMetadata = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.thfPageDynamicService.getMetadata().toPromise().then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            _this.autoRouter = response.autoRouter;
            _this.actions = response.actions || {};
            _this.breadcrumb = response.breadcrumb || { items: [] };
            _this.fields = response.fields || [];
            _this.title = response.title;
            _this.loadData();
        }));
    };
    // @todo Validar rotas na mão pois se existir uma rota '**' o catch do navigation não funciona.
    // @todo Validar rotas na mão pois se existir uma rota '**' o catch do navigation não funciona.
    /**
     * @private
     * @param {?} route
     * @param {?=} forceStopAutoRouter
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.navigateTo = 
    // @todo Validar rotas na mão pois se existir uma rota '**' o catch do navigation não funciona.
    /**
     * @private
     * @param {?} route
     * @param {?=} forceStopAutoRouter
     * @return {?}
     */
    function (route, forceStopAutoRouter) {
        var _this = this;
        if (forceStopAutoRouter === void 0) { forceStopAutoRouter = false; }
        this.router.navigate([route.url || route.path], { queryParams: route.params })
            .catch((/**
         * @return {?}
         */
        function () {
            if (forceStopAutoRouter || !_this.autoRouter) {
                return;
            }
            _this.router.config.unshift((/** @type {?} */ ({
                path: route.path, component: route.component, data: { serviceApi: _this.serviceApi, autoRouter: true }
            })));
            _this.navigateTo(route, true);
        }));
    };
    /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.openDetail = /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    function (path, item) {
        /** @type {?} */
        var url = this.resolveUrl(item, path);
        this.navigateTo({ path: path, url: url, component: ThfPageDynamicDetailComponent });
    };
    /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.openDuplicate = /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    function (path, item) {
        /** @type {?} */
        var duplicates = util.mapObjectByProperties(item, this.duplicates);
        this.navigateTo({ path: path, params: { duplicate: JSON.stringify(duplicates) } });
        // this.navigateTo({ path, params: { duplicate: JSON.stringify(duplicates) } , component: ThfPageDynamicEditComponent });
    };
    /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.openEdit = /**
     * @private
     * @param {?} path
     * @param {?} item
     * @return {?}
     */
    function (path, item) {
        /** @type {?} */
        var url = this.resolveUrl(item, path);
        this.navigateTo({ path: path, url: url });
        // this.navigateTo({ path, url, component: ThfPageDynamicEditComponent });
    };
    /**
     * @private
     * @param {?} path
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.openNew = /**
     * @private
     * @param {?} path
     * @return {?}
     */
    function (path) {
        this.navigateTo({ path: path });
        // this.navigateTo({ path, component: ThfPageDynamicEditComponent });
    };
    /**
     * Caso exista mais de um identificador, será concatenado com '|'.
     *
     * Ex: { id: 1, company: 'totvs' }
     *
     * Para o endpoint /resources/:id será executada a url /resources/1|totvs
     */
    /**
     * Caso exista mais de um identificador, será concatenado com '|'.
     *
     * Ex: { id: 1, company: 'totvs' }
     *
     * Para o endpoint /resources/:id será executada a url /resources/1|totvs
     * @private
     * @param {?} item
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.remove = /**
     * Caso exista mais de um identificador, será concatenado com '|'.
     *
     * Ex: { id: 1, company: 'totvs' }
     *
     * Para o endpoint /resources/:id será executada a url /resources/1|totvs
     * @private
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        /** @type {?} */
        var uniqueKey = this.formatUniqueKey(item);
        this.thfPageDynamicService.deleteResource(uniqueKey).toPromise().then((/**
         * @return {?}
         */
        function () {
            _this.removeLocalItems([item]);
            _this.thfNotification.success(_this.literals.removeSuccessNotification);
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.removeAll = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // TODO: usar propriedade nova pra validar os itens selecionados
        /** @type {?} */
        var selectedItems = this.items.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.$selected; }));
        if (selectedItems.length === 0) {
            // TODO: usar propriedade nova pra validar os itens selecionados
            return;
        }
        /** @type {?} */
        var keysSelectedItems = util.mapArrayByProperties(selectedItems, this.keys);
        this.thfPageDynamicService.deleteResources(keysSelectedItems).toPromise().then((/**
         * @return {?}
         */
        function () {
            _this.removeLocalItems(selectedItems);
            _this.thfNotification.success(_this.literals.removeAllSuccessNotification);
        }));
    };
    /**
     * @private
     * @param {?=} items
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.removeLocalItems = /**
     * @private
     * @param {?=} items
     * @return {?}
     */
    function (items) {
        var _this = this;
        if (items === void 0) { items = []; }
        items.forEach((/**
         * @param {?} itemRemoved
         * @return {?}
         */
        function (itemRemoved) {
            /** @type {?} */
            var indexItemRemoved = _this.items.indexOf(itemRemoved);
            _this.items.splice(indexItemRemoved, 1);
        }));
    };
    /**
     * @private
     * @param {?} item
     * @param {?} path
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.resolveUrl = /**
     * @private
     * @param {?} item
     * @param {?} path
     * @return {?}
     */
    function (item, path) {
        /** @type {?} */
        var uniqueKey = this.formatUniqueKey(item);
        return path.replace(/:id/g, uniqueKey);
    };
    /**
     * @private
     * @param {?} actions
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.setPageActions = /**
     * @private
     * @param {?} actions
     * @return {?}
     */
    function (actions) {
        if (actions) {
            this._pageActions = [
                { label: this.literals.pageAction, action: this.openNew.bind(this, actions.new), disabled: !this._actions.new },
            ];
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.setRemoveAllAction = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._actions.removeAll) {
            this._pageActions.push({
                label: this.literals.pageActionRemoveAll, action: this.confirmRemoveAll.bind(this),
                disabled: !this._actions.removeAll
            });
        }
    };
    /**
     * @private
     * @param {?} actions
     * @return {?}
     */
    ThfPageDynamicTableComponent.prototype.setTableActions = /**
     * @private
     * @param {?} actions
     * @return {?}
     */
    function (actions) {
        if (actions) {
            this._tableActions = [
                { action: this.openDetail.bind(this, actions.detail), label: this.literals.tableActionView, visible: !!this._actions.detail },
                { action: this.openEdit.bind(this, actions.edit), label: this.literals.tableActionEdit, visible: !!this._actions.edit },
                { action: this.openDuplicate.bind(this, actions.duplicate), label: this.literals.tableActionDuplicate,
                    visible: !!this._actions.duplicate
                },
                { action: this.confirmRemove.bind(this), label: this.literals.tableActionDelete, separator: true, type: 'danger',
                    visible: !!this._actions.remove
                }
            ];
        }
    };
    ThfPageDynamicTableComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-page-dynamic-table',
                    template: "<thf-page-dynamic-search\n  [t-actions]=\"pageActions\"\n  [t-breadcrumb]=\"breadcrumb\"\n  [t-filters]=\"filters\"\n  [t-title]=\"title\"\n  (t-advanced-search)=\"onAdvancedSearch($event)\"\n  (t-change-disclaimers)=\"onChangeDisclaimers($event)\"\n  (t-quick-search)=\"onQuickSearch($event)\">\n\n  <thf-table\n    t-sort=\"true\"\n    [t-actions]=\"tableActions\"\n    [t-checkbox]=\"hasActionRemoveAll\"\n    [t-columns]=\"columns\"\n    [t-items]=\"items\"\n    [t-show-more-disabled]=\"!hasNext\"\n    (t-show-more)=\"showMore()\">\n  </thf-table>\n\n</thf-page-dynamic-search>\n",
                    providers: [ThfPageDynamicService]
                }] }
    ];
    /** @nocollapse */
    ThfPageDynamicTableComponent.ctorParameters = function () { return [
        { type: Router },
        { type: ActivatedRoute },
        { type: ThfDialogService },
        { type: ThfNotificationService },
        { type: ThfPageDynamicService }
    ]; };
    ThfPageDynamicTableComponent.propDecorators = {
        actions: [{ type: Input, args: ['t-actions',] }]
    };
    return ThfPageDynamicTableComponent;
}(ThfPageDynamicListBaseComponent));
export { ThfPageDynamicTableComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype._actions;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype._pageActions;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype._tableActions;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.page;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.params;
    /** @type {?} */
    ThfPageDynamicTableComponent.prototype.hasNext;
    /** @type {?} */
    ThfPageDynamicTableComponent.prototype.items;
    /** @type {?} */
    ThfPageDynamicTableComponent.prototype.literals;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.thfDialogService;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.thfNotification;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicTableComponent.prototype.thfPageDynamicService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2UtZHluYW1pYy10YWJsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXRlbXBsYXRlcy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1wYWdlLWR5bmFtaWMtdGFibGUvdGhmLXBhZ2UtZHluYW1pYy10YWJsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsY0FBYyxFQUFTLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWhFLE9BQU8sRUFBMkIsZ0JBQWdCLEVBQUUsc0JBQXNCLEVBQWlDLE1BQU0sZUFBZSxDQUFDO0FBRWpJLE9BQU8sS0FBSyxJQUFJLE1BQU0sa0JBQWtCLENBQUM7QUFFekMsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sOERBQThELENBQUM7O0FBRzdHLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ3pGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDOztBQUduRSxNQUFNLEtBQU8sa0NBQWtDLEdBQUc7SUFDaEQsRUFBRSxFQUFFO1FBQ0YsVUFBVSxFQUFFLEtBQUs7UUFDakIsbUJBQW1CLEVBQUUsUUFBUTtRQUM3QixlQUFlLEVBQUUsTUFBTTtRQUN2QixlQUFlLEVBQUUsTUFBTTtRQUN2QixvQkFBb0IsRUFBRSxXQUFXO1FBQ2pDLGlCQUFpQixFQUFFLFFBQVE7UUFDM0Isa0JBQWtCLEVBQUUsZ0JBQWdCO1FBQ3BDLG9CQUFvQixFQUFFLDRFQUE0RTtRQUNsRyxxQkFBcUIsRUFBRSx3QkFBd0I7UUFDL0MsdUJBQXVCLEVBQUUsa0ZBQWtGO1FBQzNHLHlCQUF5QixFQUFFLG1CQUFtQjtRQUM5Qyx5QkFBeUIsRUFBRSwyQkFBMkI7UUFDdEQsNEJBQTRCLEVBQUUsNEJBQTRC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QUFDO29CQUNULFFBQVEsRUFBRSx3QkFBd0I7b0JBQ2xDLHFsQkFBc0Q7b0JBQ3RELFNBQVMsRUFBRSxDQUFFLHFCQUFxQixDQUFFO2lCQUNyQzs7OztnQkFyRitCLE1BQU07Z0JBQTdCLGNBQWM7Z0JBRVcsZ0JBQWdCO2dCQUFFLHNCQUFzQjtnQkFRakUscUJBQXFCOzs7MEJBbUczQixLQUFLLFNBQUMsV0FBVzs7SUF3UHBCLG1DQUFDO0NBQUEsQUFwUkQsQ0FLa0QsK0JBQStCLEdBK1FoRjtTQS9RWSw0QkFBNEI7Ozs7OztJQUV2QyxnREFBa0Q7Ozs7O0lBQ2xELG9EQUFnRDs7Ozs7SUFDaEQscURBQWtEOzs7OztJQUVsRCw0Q0FBeUI7Ozs7O0lBQ3pCLDhDQUFvQjs7SUFFcEIsK0NBQWdCOztJQUNoQiw2Q0FBVzs7SUFDWCxnREFHRTs7Ozs7SUFzQkEsOENBQXNCOzs7OztJQUN0QixzREFBc0M7Ozs7O0lBQ3RDLHdEQUEwQzs7Ozs7SUFDMUMsdURBQStDOzs7OztJQUMvQyw2REFBb0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZSwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgVGhmRGlhbG9nQ29uZmlybU9wdGlvbnMsIFRoZkRpYWxvZ1NlcnZpY2UsIFRoZk5vdGlmaWNhdGlvblNlcnZpY2UsIFRoZlBhZ2VBY3Rpb24sIFRoZlRhYmxlQWN0aW9uIH0gZnJvbSAnQHRvdHZzL3RoZi11aSc7XG5cbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFRoZlBhZ2VEeW5hbWljRGV0YWlsQ29tcG9uZW50IH0gZnJvbSAnLi4vdGhmLXBhZ2UtZHluYW1pYy1kZXRhaWwvdGhmLXBhZ2UtZHluYW1pYy1kZXRhaWwuY29tcG9uZW50Jztcbi8vIGltcG9ydCB7IFRoZlBhZ2VEeW5hbWljRWRpdENvbXBvbmVudCB9IGZyb20gJy4uL3RoZi1wYWdlLWR5bmFtaWMtZWRpdC90aGYtcGFnZS1keW5hbWljLWVkaXQuY29tcG9uZW50JztcblxuaW1wb3J0IHsgVGhmUGFnZUR5bmFtaWNMaXN0QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXBhZ2UtZHluYW1pYy1saXN0LWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZlBhZ2VEeW5hbWljU2VydmljZSB9IGZyb20gJy4vdGhmLXBhZ2UtZHluYW1pYy5zZXJ2aWNlJztcbmltcG9ydCB7IFRoZlBhZ2VEeW5hbWljVGFibGVBY3Rpb25zIH0gZnJvbSAnLi90aGYtcGFnZS1keW5hbWljLXRhYmxlLWFjdGlvbnMuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHRoZlBhZ2VEeW5hbWljVGFibGVMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiB7XG4gICAgcGFnZUFjdGlvbjogJ05ldycsXG4gICAgcGFnZUFjdGlvblJlbW92ZUFsbDogJ0RlbGV0ZScsXG4gICAgdGFibGVBY3Rpb25WaWV3OiAnVmlldycsXG4gICAgdGFibGVBY3Rpb25FZGl0OiAnRWRpdCcsXG4gICAgdGFibGVBY3Rpb25EdXBsaWNhdGU6ICdEdXBsaWNhdGUnLFxuICAgIHRhYmxlQWN0aW9uRGVsZXRlOiAnRGVsZXRlJyxcbiAgICBjb25maXJtUmVtb3ZlVGl0bGU6ICdDb25maXJtIGRlbGV0ZScsXG4gICAgY29uZmlybVJlbW92ZU1lc3NhZ2U6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgcmVjb3JkPyBZb3UgY2FuIG5vdCB1bmRvIHRoaXMgYWN0aW9uLicsXG4gICAgY29uZmlybVJlbW92ZUFsbFRpdGxlOiAnQ29uZmlybSBiYXRjaCBkZWxldGlvbicsXG4gICAgY29uZmlybVJlbW92ZUFsbE1lc3NhZ2U6ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIGFsbCB0aGVzZSByZWNvcmRzPyBZb3UgY2FuIG5vdCB1bmRvIHRoaXMgYWN0aW9uLicsXG4gICAgbG9hZERhdGFFcnJvck5vdGlmaWNhdGlvbjogJ1NlcnZpY2Ugbm90IGZvdW5kJyxcbiAgICByZW1vdmVTdWNjZXNzTm90aWZpY2F0aW9uOiAnSXRlbSBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgcmVtb3ZlQWxsU3VjY2Vzc05vdGlmaWNhdGlvbjogJ0l0ZW1zIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5J1xuICB9LFxuICBlczoge1xuICAgIHBhZ2VBY3Rpb246ICdOdWV2bycsXG4gICAgcGFnZUFjdGlvblJlbW92ZUFsbDogJ0JvcnJhcicsXG4gICAgdGFibGVBY3Rpb25WaWV3OiAnVmlzdWFsaXphcicsXG4gICAgdGFibGVBY3Rpb25FZGl0OiAnRWRpdGFyJyxcbiAgICB0YWJsZUFjdGlvbkR1cGxpY2F0ZTogJ0R1cGxpY2FyJyxcbiAgICB0YWJsZUFjdGlvbkRlbGV0ZTogJ0JvcnJhcicsXG4gICAgY29uZmlybVJlbW92ZVRpdGxlOiAnQ29uZmlybWFyIGxhIGV4Y2x1c2nDs24nLFxuICAgIGNvbmZpcm1SZW1vdmVNZXNzYWdlOiAnwr9Fc3TDoSBzZWd1cm8gZGUgcXVlIGRlc2VhIGVsaW1pbmFyIGVzdGUgcmVnaXN0cm8/IE5vIHB1ZWRlIGRlc2hhY2VyIGVzdGEgYWNjacOzbi4nLFxuICAgIGNvbmZpcm1SZW1vdmVBbGxUaXRsZTogJ0NvbmZpcm1hciBsYSBleGNsdXNpw7NuIHBvciBsb3RlcycsXG4gICAgY29uZmlybVJlbW92ZUFsbE1lc3NhZ2U6ICfCv0VzdMOhIHNlZ3VybyBkZSBxdWUgZGVzZWEgZWxpbWluYXIgdG9kb3MgZXN0b3MgcmVnaXN0cm9zPyBObyBwdWVkZSBkZXNoYWNlciBlc3RhIGFjY2nDs24uJyxcbiAgICBsb2FkRGF0YUVycm9yTm90aWZpY2F0aW9uOiAnU2VydmljaW8gbm8gaW5mb3JtYWRvLicsXG4gICAgcmVtb3ZlU3VjY2Vzc05vdGlmaWNhdGlvbjogJ0VsZW1lbnRvIGVsaW1pbmFkbyBjb24gw6l4aXRvJyxcbiAgICByZW1vdmVBbGxTdWNjZXNzTm90aWZpY2F0aW9uOiAnRWxlbWVudG9zIGVsaW1pbmFkb3MgY29uIMOpeGl0bydcbiAgfSxcbiAgcHQ6IHtcbiAgICBwYWdlQWN0aW9uOiAnTm92bycsXG4gICAgcGFnZUFjdGlvblJlbW92ZUFsbDogJ0V4Y2x1aXInLFxuICAgIHRhYmxlQWN0aW9uVmlldzogJ1Zpc3VhbGl6YXInLFxuICAgIHRhYmxlQWN0aW9uRWRpdDogJ0VkaXRhcicsXG4gICAgdGFibGVBY3Rpb25EdXBsaWNhdGU6ICdEdXBsaWNhcicsXG4gICAgdGFibGVBY3Rpb25EZWxldGU6ICdFeGNsdWlyJyxcbiAgICBjb25maXJtUmVtb3ZlVGl0bGU6ICdDb25maXJtYXIgZXhjbHVzw6NvJyxcbiAgICBjb25maXJtUmVtb3ZlTWVzc2FnZTogJ1RlbSBjZXJ0ZXphIGRlIHF1ZSBkZXNlamEgZXhjbHVpciBlc3NlIHJlZ2lzdHJvPyBWb2PDqiBuw6NvIHBvZGVyw6EgZGVzZmF6ZXIgZXNzYSBhw6fDo28uJyxcbiAgICBjb25maXJtUmVtb3ZlQWxsVGl0bGU6ICdDb25maXJtYXIgZXhjbHVzw6NvIGVtIGxvdGUnLFxuICAgIGNvbmZpcm1SZW1vdmVBbGxNZXNzYWdlOiAnVGVtIGNlcnRlemEgZGUgcXVlIGRlc2VqYSBleGNsdWlyIHRvZG9zIGVzc2VzIHJlZ2lzdHJvcz8gVm9jw6ogbsOjbyBwb2RlcsOhIGRlc2ZhemVyIGVzc2EgYcOnw6NvLicsXG4gICAgbG9hZERhdGFFcnJvck5vdGlmaWNhdGlvbjogJ1NlcnZpw6dvIG7Do28gaW5mb3JtYWRvLicsXG4gICAgcmVtb3ZlU3VjY2Vzc05vdGlmaWNhdGlvbjogJ0l0ZW0gZXhjbHVpZG8gY29tIHN1Y2Vzc28nLFxuICAgIHJlbW92ZUFsbFN1Y2Nlc3NOb3RpZmljYXRpb246ICdJdGVtcyBleGNsdWlkb3MgY29tIHN1Y2Vzc28nXG4gIH1cbn07XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFRoZlBhZ2VEeW5hbWljTGlzdEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGB0aGYtcGFnZS1keW5hbWljLXRhYmxlYCDDqSB1bWEgcMOhZ2luYSBxdWUgZXhpYmUgdW1hIGxpc3RhIGRlIHJlZ2lzdHJvcyBlbSB1bWEgdGFiZWxhIGJhc2VhZG8gZW0gdW1hIGxpc3RhIGRlIGZpZWxkcyxcbiAqIG8gbWVzbW8gdGFtYsOpbSBzdXBvcnRhIG1ldGFkYWRvcyBjb25mb3JtZSBlc3BlY2lmaWNhZG8gbmEgZG9jdW1lbnRhw6fDo28uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLXBhZ2UtZHluYW1pYy10YWJsZS1iYXNpY1wiIHRpdGxlPVwiVG90dnMgUGFnZSBEeW5hbWljIFRhYmxlIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1keW5hbWljLXRhYmxlLWJhc2ljL3NhbXBsZS10aGYtcGFnZS1keW5hbWljLXRhYmxlLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtdGFibGUtYmFzaWMvc2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtdGFibGUtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLXBhZ2UtZHluYW1pYy10YWJsZS11c2Vyc1wiIHRpdGxlPVwiVG90dnMgUGFnZSBEeW5hbWljIFRhYmxlIC0gVXNlcnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtdGFibGUtdXNlcnMvc2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtdGFibGUtdXNlcnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtZHluYW1pYy10YWJsZS11c2Vycy9zYW1wbGUtdGhmLXBhZ2UtZHluYW1pYy10YWJsZS11c2Vycy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtcGFnZS1keW5hbWljLXRhYmxlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RoZi1wYWdlLWR5bmFtaWMtdGFibGUuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFsgVGhmUGFnZUR5bmFtaWNTZXJ2aWNlIF1cbn0pXG5leHBvcnQgY2xhc3MgVGhmUGFnZUR5bmFtaWNUYWJsZUNvbXBvbmVudCBleHRlbmRzIFRoZlBhZ2VEeW5hbWljTGlzdEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIHByaXZhdGUgX2FjdGlvbnM6IFRoZlBhZ2VEeW5hbWljVGFibGVBY3Rpb25zID0ge307XG4gIHByaXZhdGUgX3BhZ2VBY3Rpb25zOiBBcnJheTxUaGZQYWdlQWN0aW9uPiA9IFtdO1xuICBwcml2YXRlIF90YWJsZUFjdGlvbnM6IEFycmF5PFRoZlRhYmxlQWN0aW9uPiA9IFtdO1xuXG4gIHByaXZhdGUgcGFnZTogbnVtYmVyID0gMTtcbiAgcHJpdmF0ZSBwYXJhbXMgPSB7fTtcblxuICBoYXNOZXh0ID0gZmFsc2U7XG4gIGl0ZW1zID0gW107XG4gIGxpdGVyYWxzID0ge1xuICAgIC4uLnRoZlBhZ2VEeW5hbWljVGFibGVMaXRlcmFsc0RlZmF1bHRbdXRpbC50aGZMb2NhbGVEZWZhdWx0XSxcbiAgICAuLi50aGZQYWdlRHluYW1pY1RhYmxlTGl0ZXJhbHNEZWZhdWx0W3V0aWwuYnJvd3Nlckxhbmd1YWdlKCldXG4gIH07XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQcOnw7VlcyBkYSBww6FnaW5hIGUgZGEgdGFiZWxhLlxuICAgKi9cbiAgQElucHV0KCd0LWFjdGlvbnMnKSBzZXQgYWN0aW9ucyh2YWx1ZTogVGhmUGFnZUR5bmFtaWNUYWJsZUFjdGlvbnMpIHtcbiAgICB0aGlzLl9hY3Rpb25zID0gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyh2YWx1ZSkubGVuZ3RoID4gMCA/IHZhbHVlIDoge307XG5cbiAgICB0aGlzLnNldFBhZ2VBY3Rpb25zKHRoaXMuYWN0aW9ucyk7XG4gICAgdGhpcy5zZXRSZW1vdmVBbGxBY3Rpb24oKTtcbiAgICB0aGlzLnNldFRhYmxlQWN0aW9ucyh0aGlzLmFjdGlvbnMpO1xuICB9XG5cbiAgZ2V0IGFjdGlvbnMoKTogVGhmUGFnZUR5bmFtaWNUYWJsZUFjdGlvbnMge1xuICAgIHJldHVybiB0aGlzLl9hY3Rpb25zO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICBwcml2YXRlIHRoZkRpYWxvZ1NlcnZpY2U6IFRoZkRpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSB0aGZOb3RpZmljYXRpb246IFRoZk5vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0aGZQYWdlRHluYW1pY1NlcnZpY2U6IFRoZlBhZ2VEeW5hbWljU2VydmljZVxuICAgICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5kYXRhLnNlcnZpY2VBcGkpIHtcbiAgICAgIHRoaXMuc2VydmljZUFwaSA9IHRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QuZGF0YS5zZXJ2aWNlQXBpO1xuXG4gICAgICB0aGlzLnRoZlBhZ2VEeW5hbWljU2VydmljZS5jb25maWdTZXJ2aWNlQXBpKHsgZW5kcG9pbnQ6IHRoaXMuc2VydmljZUFwaSB9KTtcblxuICAgICAgdGhpcy5sb2FkTWV0YWRhdGEoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50aGZQYWdlRHluYW1pY1NlcnZpY2UuY29uZmlnU2VydmljZUFwaSh7IGVuZHBvaW50OiB0aGlzLnNlcnZpY2VBcGkgfSk7XG5cbiAgICAgIHRoaXMubG9hZERhdGEoKTtcbiAgICB9XG4gIH1cblxuICBvbkFkdmFuY2VkU2VhcmNoKGZpbHRlcikge1xuICAgIHRoaXMubG9hZERhdGEoeyBwYWdlOiAxLCAuLi5maWx0ZXIgfSk7XG4gICAgdGhpcy5wYXJhbXMgPSBmaWx0ZXI7XG4gIH1cblxuICBvbkNoYW5nZURpc2NsYWltZXJzKGRpc2NsYWltZXJzKSB7XG4gICAgY29uc3QgZmlsdGVyID0ge307XG5cbiAgICBkaXNjbGFpbWVycy5mb3JFYWNoKGRpc2NsYWltZXIgPT4ge1xuICAgICAgZmlsdGVyW2Rpc2NsYWltZXIucHJvcGVydHldID0gZGlzY2xhaW1lci52YWx1ZTtcbiAgICB9KTtcblxuICAgIHRoaXMub25BZHZhbmNlZFNlYXJjaChmaWx0ZXIpO1xuICB9XG5cbiAgb25RdWlja1NlYXJjaChmaWx0ZXIpIHtcbiAgICB0aGlzLmxvYWREYXRhKGZpbHRlciA/IHsgcGFnZTogMSwgc2VhcmNoOiBmaWx0ZXIgfSA6IHVuZGVmaW5lZCk7XG4gICAgdGhpcy5wYXJhbXMgPSBmaWx0ZXIgPyB7IHNlYXJjaDogZmlsdGVyIH0gOiB7fTtcbiAgfVxuXG4gIHNob3dNb3JlKCkge1xuICAgIHRoaXMubG9hZERhdGEoeyBwYWdlOiArK3RoaXMucGFnZSwgLi4udGhpcy5wYXJhbXMgfSk7XG4gIH1cblxuICBnZXQgaGFzQWN0aW9uUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiAhIXRoaXMuYWN0aW9ucy5yZW1vdmVBbGw7XG4gIH1cblxuICBnZXQgcGFnZUFjdGlvbnMoKSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLl9wYWdlQWN0aW9uc107XG4gIH1cblxuICBnZXQgdGFibGVBY3Rpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl90YWJsZUFjdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGNvbmZpcm1SZW1vdmUoaXRlbSkge1xuICAgIGNvbnN0IGNvbmZpcm1PcHRpb25zOiBUaGZEaWFsb2dDb25maXJtT3B0aW9ucyA9IHtcbiAgICAgIHRpdGxlOiB0aGlzLmxpdGVyYWxzLmNvbmZpcm1SZW1vdmVUaXRsZSxcbiAgICAgIG1lc3NhZ2U6IHRoaXMubGl0ZXJhbHMuY29uZmlybVJlbW92ZU1lc3NhZ2UsXG4gICAgICBjb25maXJtOiB0aGlzLnJlbW92ZS5iaW5kKHRoaXMsIGl0ZW0pXG4gICAgfTtcblxuICAgIHRoaXMudGhmRGlhbG9nU2VydmljZS5jb25maXJtKGNvbmZpcm1PcHRpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgY29uZmlybVJlbW92ZUFsbCgpIHtcbiAgICBjb25zdCBjb25maXJtT3B0aW9uczogVGhmRGlhbG9nQ29uZmlybU9wdGlvbnMgPSB7XG4gICAgICB0aXRsZTogdGhpcy5saXRlcmFscy5jb25maXJtUmVtb3ZlQWxsVGl0bGUsXG4gICAgICBtZXNzYWdlOiB0aGlzLmxpdGVyYWxzLmNvbmZpcm1SZW1vdmVBbGxNZXNzYWdlLFxuICAgICAgY29uZmlybTogdGhpcy5yZW1vdmVBbGwuYmluZCh0aGlzKVxuICAgIH07XG5cbiAgICB0aGlzLnRoZkRpYWxvZ1NlcnZpY2UuY29uZmlybShjb25maXJtT3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdFVuaXF1ZUtleShpdGVtKSB7XG4gICAgY29uc3Qga2V5cyA9IHV0aWwubWFwT2JqZWN0QnlQcm9wZXJ0aWVzKGl0ZW0sIHRoaXMua2V5cyk7XG5cbiAgICByZXR1cm4gdXRpbC52YWx1ZXNGcm9tT2JqZWN0KGtleXMpLmpvaW4oJ3wnKTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZERhdGEocGFyYW1zOiB7IHBhZ2U/OiBudW1iZXIsIHNlYXJjaD86IHN0cmluZyB9ID0ge30pIHtcbiAgICBpZiAoIXRoaXMuc2VydmljZUFwaSkge1xuICAgICAgdGhpcy50aGZOb3RpZmljYXRpb24uZXJyb3IodGhpcy5saXRlcmFscy5sb2FkRGF0YUVycm9yTm90aWZpY2F0aW9uKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBkZWZhdWx0UGFyYW1zOiBhbnkgPSB7IHBhZ2U6IDEsIHBhZ2VTaXplOiAxMCB9O1xuICAgIGNvbnN0IGZ1bGxQYXJhbXM6IGFueSA9IHsgLi4uZGVmYXVsdFBhcmFtcywgLi4ucGFyYW1zIH07XG5cbiAgICB0aGlzLnRoZlBhZ2VEeW5hbWljU2VydmljZS5nZXRSZXNvdXJjZXMoZnVsbFBhcmFtcykudG9Qcm9taXNlKCkudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgdGhpcy5pdGVtcyA9IGZ1bGxQYXJhbXMucGFnZSA9PT0gMSA/IHJlc3BvbnNlLml0ZW1zIDogWy4uLnRoaXMuaXRlbXMsIC4uLnJlc3BvbnNlLml0ZW1zXTtcbiAgICAgIHRoaXMucGFnZSA9IGZ1bGxQYXJhbXMucGFnZTtcbiAgICAgIHRoaXMuaGFzTmV4dCA9IHJlc3BvbnNlLmhhc05leHQ7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxvYWRNZXRhZGF0YSgpIHtcbiAgICB0aGlzLnRoZlBhZ2VEeW5hbWljU2VydmljZS5nZXRNZXRhZGF0YSgpLnRvUHJvbWlzZSgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgdGhpcy5hdXRvUm91dGVyID0gcmVzcG9uc2UuYXV0b1JvdXRlcjtcbiAgICAgIHRoaXMuYWN0aW9ucyA9IHJlc3BvbnNlLmFjdGlvbnMgfHwge307XG4gICAgICB0aGlzLmJyZWFkY3J1bWIgPSByZXNwb25zZS5icmVhZGNydW1iIHx8IHsgaXRlbXMgOiBbXSB9O1xuICAgICAgdGhpcy5maWVsZHMgPSByZXNwb25zZS5maWVsZHMgfHwgW107XG4gICAgICB0aGlzLnRpdGxlID0gcmVzcG9uc2UudGl0bGU7XG5cbiAgICAgIHRoaXMubG9hZERhdGEoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEB0b2RvIFZhbGlkYXIgcm90YXMgbmEgbcOjbyBwb2lzIHNlIGV4aXN0aXIgdW1hIHJvdGEgJyoqJyBvIGNhdGNoIGRvIG5hdmlnYXRpb24gbsOjbyBmdW5jaW9uYS5cbiAgcHJpdmF0ZSBuYXZpZ2F0ZVRvKHJvdXRlOiB7cGF0aDogc3RyaW5nLCBjb21wb25lbnQ/LCB1cmw/OiBzdHJpbmcsIHBhcmFtcz86IGFueX0sIGZvcmNlU3RvcEF1dG9Sb3V0ZXI6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtyb3V0ZS51cmwgfHwgcm91dGUucGF0aF0sIHsgcXVlcnlQYXJhbXM6IHJvdXRlLnBhcmFtcyB9KVxuICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgaWYgKGZvcmNlU3RvcEF1dG9Sb3V0ZXIgfHwgIXRoaXMuYXV0b1JvdXRlcikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucm91dGVyLmNvbmZpZy51bnNoaWZ0KDxSb3V0ZT57XG4gICAgICAgICAgcGF0aDogcm91dGUucGF0aCwgY29tcG9uZW50OiByb3V0ZS5jb21wb25lbnQsICBkYXRhOiB7IHNlcnZpY2VBcGk6IHRoaXMuc2VydmljZUFwaSwgYXV0b1JvdXRlcjogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubmF2aWdhdGVUbyhyb3V0ZSwgdHJ1ZSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbkRldGFpbChwYXRoOiBzdHJpbmcsIGl0ZW0pIHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLnJlc29sdmVVcmwoaXRlbSwgcGF0aCk7XG5cbiAgICB0aGlzLm5hdmlnYXRlVG8oeyBwYXRoLCB1cmwsIGNvbXBvbmVudDogVGhmUGFnZUR5bmFtaWNEZXRhaWxDb21wb25lbnQgfSk7XG4gIH1cblxuICBwcml2YXRlIG9wZW5EdXBsaWNhdGUocGF0aDogc3RyaW5nLCBpdGVtKSB7XG4gICAgY29uc3QgZHVwbGljYXRlcyA9IHV0aWwubWFwT2JqZWN0QnlQcm9wZXJ0aWVzKGl0ZW0sIHRoaXMuZHVwbGljYXRlcyk7XG5cbiAgICB0aGlzLm5hdmlnYXRlVG8oeyBwYXRoLCBwYXJhbXM6IHsgZHVwbGljYXRlOiBKU09OLnN0cmluZ2lmeShkdXBsaWNhdGVzKSB9IH0pO1xuICAgIC8vIHRoaXMubmF2aWdhdGVUbyh7IHBhdGgsIHBhcmFtczogeyBkdXBsaWNhdGU6IEpTT04uc3RyaW5naWZ5KGR1cGxpY2F0ZXMpIH0gLCBjb21wb25lbnQ6IFRoZlBhZ2VEeW5hbWljRWRpdENvbXBvbmVudCB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbkVkaXQocGF0aDogc3RyaW5nLCBpdGVtKSB7XG4gICAgY29uc3QgdXJsID0gdGhpcy5yZXNvbHZlVXJsKGl0ZW0sIHBhdGgpO1xuXG4gICAgdGhpcy5uYXZpZ2F0ZVRvKHsgcGF0aCwgdXJsIH0pO1xuICAgIC8vIHRoaXMubmF2aWdhdGVUbyh7IHBhdGgsIHVybCwgY29tcG9uZW50OiBUaGZQYWdlRHluYW1pY0VkaXRDb21wb25lbnQgfSk7XG4gIH1cblxuICBwcml2YXRlIG9wZW5OZXcocGF0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5uYXZpZ2F0ZVRvKHsgcGF0aCB9KTtcbiAgICAvLyB0aGlzLm5hdmlnYXRlVG8oeyBwYXRoLCBjb21wb25lbnQ6IFRoZlBhZ2VEeW5hbWljRWRpdENvbXBvbmVudCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYXNvIGV4aXN0YSBtYWlzIGRlIHVtIGlkZW50aWZpY2Fkb3IsIHNlcsOhIGNvbmNhdGVuYWRvIGNvbSAnfCcuXG4gICAqXG4gICAqIEV4OiB7IGlkOiAxLCBjb21wYW55OiAndG90dnMnIH1cbiAgICpcbiAgICogUGFyYSBvIGVuZHBvaW50IC9yZXNvdXJjZXMvOmlkIHNlcsOhIGV4ZWN1dGFkYSBhIHVybCAvcmVzb3VyY2VzLzF8dG90dnNcbiAgICovXG4gIHByaXZhdGUgcmVtb3ZlKGl0ZW0pIHtcbiAgICBjb25zdCB1bmlxdWVLZXkgPSB0aGlzLmZvcm1hdFVuaXF1ZUtleShpdGVtKTtcblxuICAgIHRoaXMudGhmUGFnZUR5bmFtaWNTZXJ2aWNlLmRlbGV0ZVJlc291cmNlKHVuaXF1ZUtleSkudG9Qcm9taXNlKCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUxvY2FsSXRlbXMoW2l0ZW1dKTtcblxuICAgICAgdGhpcy50aGZOb3RpZmljYXRpb24uc3VjY2Vzcyh0aGlzLmxpdGVyYWxzLnJlbW92ZVN1Y2Nlc3NOb3RpZmljYXRpb24pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVBbGwoKSB7XG4gICAgLy8gVE9ETzogdXNhciBwcm9wcmllZGFkZSBub3ZhIHByYSB2YWxpZGFyIG9zIGl0ZW5zIHNlbGVjaW9uYWRvc1xuICAgIGNvbnN0IHNlbGVjdGVkSXRlbXMgPSB0aGlzLml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0uJHNlbGVjdGVkKTtcblxuICAgIGlmIChzZWxlY3RlZEl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gVE9ETzogdXNhciBwcm9wcmllZGFkZSBub3ZhIHByYSB2YWxpZGFyIG9zIGl0ZW5zIHNlbGVjaW9uYWRvc1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGtleXNTZWxlY3RlZEl0ZW1zID0gdXRpbC5tYXBBcnJheUJ5UHJvcGVydGllcyhzZWxlY3RlZEl0ZW1zLCB0aGlzLmtleXMpO1xuXG4gICAgdGhpcy50aGZQYWdlRHluYW1pY1NlcnZpY2UuZGVsZXRlUmVzb3VyY2VzKGtleXNTZWxlY3RlZEl0ZW1zKS50b1Byb21pc2UoKS50aGVuKCgpID0+IHtcbiAgICAgIHRoaXMucmVtb3ZlTG9jYWxJdGVtcyhzZWxlY3RlZEl0ZW1zKTtcblxuICAgICAgdGhpcy50aGZOb3RpZmljYXRpb24uc3VjY2Vzcyh0aGlzLmxpdGVyYWxzLnJlbW92ZUFsbFN1Y2Nlc3NOb3RpZmljYXRpb24pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVMb2NhbEl0ZW1zKGl0ZW1zID0gW10pIHtcbiAgICBpdGVtcy5mb3JFYWNoKGl0ZW1SZW1vdmVkID0+IHtcbiAgICAgIGNvbnN0IGluZGV4SXRlbVJlbW92ZWQgPSB0aGlzLml0ZW1zLmluZGV4T2YoaXRlbVJlbW92ZWQpO1xuXG4gICAgICB0aGlzLml0ZW1zLnNwbGljZShpbmRleEl0ZW1SZW1vdmVkLCAxKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZVVybChpdGVtOiBhbnksIHBhdGg6IHN0cmluZykge1xuICAgIGNvbnN0IHVuaXF1ZUtleSA9IHRoaXMuZm9ybWF0VW5pcXVlS2V5KGl0ZW0pO1xuXG4gICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvOmlkL2csIHVuaXF1ZUtleSk7XG4gIH1cblxuICBwcml2YXRlIHNldFBhZ2VBY3Rpb25zKGFjdGlvbnM6IFRoZlBhZ2VEeW5hbWljVGFibGVBY3Rpb25zKSB7XG4gICAgaWYgKGFjdGlvbnMpIHtcbiAgICAgIHRoaXMuX3BhZ2VBY3Rpb25zID0gW1xuICAgICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLnBhZ2VBY3Rpb24sIGFjdGlvbjogdGhpcy5vcGVuTmV3LmJpbmQodGhpcywgYWN0aW9ucy5uZXcpLCBkaXNhYmxlZDogIXRoaXMuX2FjdGlvbnMubmV3IH0sXG4gICAgICBdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0UmVtb3ZlQWxsQWN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9hY3Rpb25zLnJlbW92ZUFsbCkge1xuICAgICAgdGhpcy5fcGFnZUFjdGlvbnMucHVzaCh7XG4gICAgICBsYWJlbDogdGhpcy5saXRlcmFscy5wYWdlQWN0aW9uUmVtb3ZlQWxsLCBhY3Rpb246IHRoaXMuY29uZmlybVJlbW92ZUFsbC5iaW5kKHRoaXMpLFxuICAgICAgICBkaXNhYmxlZDogIXRoaXMuX2FjdGlvbnMucmVtb3ZlQWxsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFRhYmxlQWN0aW9ucyhhY3Rpb25zOiBUaGZQYWdlRHluYW1pY1RhYmxlQWN0aW9ucykge1xuICAgIGlmIChhY3Rpb25zKSB7XG4gICAgICB0aGlzLl90YWJsZUFjdGlvbnMgPSBbXG4gICAgICAgIHsgYWN0aW9uOiB0aGlzLm9wZW5EZXRhaWwuYmluZCh0aGlzLCBhY3Rpb25zLmRldGFpbCksIGxhYmVsOiB0aGlzLmxpdGVyYWxzLnRhYmxlQWN0aW9uVmlldywgdmlzaWJsZTogISF0aGlzLl9hY3Rpb25zLmRldGFpbCB9LFxuICAgICAgICB7IGFjdGlvbjogdGhpcy5vcGVuRWRpdC5iaW5kKHRoaXMsIGFjdGlvbnMuZWRpdCksIGxhYmVsOiB0aGlzLmxpdGVyYWxzLnRhYmxlQWN0aW9uRWRpdCwgdmlzaWJsZTogISF0aGlzLl9hY3Rpb25zLmVkaXQgfSxcbiAgICAgICAgeyBhY3Rpb246IHRoaXMub3BlbkR1cGxpY2F0ZS5iaW5kKHRoaXMsIGFjdGlvbnMuZHVwbGljYXRlKSwgbGFiZWw6IHRoaXMubGl0ZXJhbHMudGFibGVBY3Rpb25EdXBsaWNhdGUsXG4gICAgICAgICAgdmlzaWJsZTogISF0aGlzLl9hY3Rpb25zLmR1cGxpY2F0ZVxuICAgICAgICB9LFxuICAgICAgICB7IGFjdGlvbjogdGhpcy5jb25maXJtUmVtb3ZlLmJpbmQodGhpcyksIGxhYmVsOiB0aGlzLmxpdGVyYWxzLnRhYmxlQWN0aW9uRGVsZXRlLCBzZXBhcmF0b3I6IHRydWUsIHR5cGU6ICdkYW5nZXInLFxuICAgICAgICAgIHZpc2libGU6ICEhdGhpcy5fYWN0aW9ucy5yZW1vdmVcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gIH1cblxufVxuIl19