/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ActivatedRoute, Router } from '@angular/router';
import { Component, ViewChild, ViewEncapsulation } from '@angular/core';
import { ThfDialogService, ThfNotificationService, ThfStepperStatus } from '@totvs/thf-ui';
import * as util from './../../utils/util';
import { ThfPageJobSchedulerInternal } from './thf-page-job-scheduler-internal';
import { ThfPageJobSchedulerBaseComponent } from './thf-page-job-scheduler-base.component';
import { thfPageJobSchedulerLiteralsDefault } from './thf-page-job-scheduler-literals';
import { ThfPageJobSchedulerLookupService } from './thf-page-job-scheduler-lookup.service';
import { ThfPageJobSchedulerService } from './thf-page-job-scheduler.service';
/**
 * \@docsExtends ThfPageJobSchedulerBaseComponent
 *
 * \@example
 *
 * <example name="thf-page-job-scheduler-basic" title="Totvs Page Job Scheduler Basic">
 *  <file name="sample-thf-page-job-scheduler-basic/sample-thf-page-job-scheduler-basic.component.html"> </file>
 *  <file name="sample-thf-page-job-scheduler-basic/sample-thf-page-job-scheduler-basic.component.ts"> </file>
 * </example>
 *
 */
var ThfPageJobSchedulerComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfPageJobSchedulerComponent, _super);
    function ThfPageJobSchedulerComponent(thfPageDynamicLookupService, activatedRoute, thfDialogService, thfNotification, router, thfPageJobSchedulerService) {
        var _this = _super.call(this, thfPageJobSchedulerService) || this;
        _this.thfPageDynamicLookupService = thfPageDynamicLookupService;
        _this.activatedRoute = activatedRoute;
        _this.thfDialogService = thfDialogService;
        _this.thfNotification = thfNotification;
        _this.router = router;
        _this.isEdit = false;
        _this.literals = tslib_1.__assign({}, thfPageJobSchedulerLiteralsDefault[util.thfLocaleDefault], thfPageJobSchedulerLiteralsDefault[util.browserLanguage()]);
        _this.parameters = [];
        _this.step = 1;
        _this.backPageAction = {
            label: _this.literals.back,
            action: _this.nextStepOperation.bind(_this, 'back'),
            disabled: _this.isDisabledBack.bind(_this)
        };
        _this.concludePageActions = [
            {
                label: _this.literals.conclude,
                action: _this.confirmJobScheduler.bind(_this)
            },
            tslib_1.__assign({}, _this.backPageAction)
        ];
        _this.nextPageActions = [
            {
                label: _this.literals.next,
                action: _this.nextStepOperation.bind(_this, 'next'),
                disabled: _this.isDisabledAdvance.bind(_this)
            },
            tslib_1.__assign({}, _this.backPageAction)
        ];
        _this.jobSchedulerActions = tslib_1.__spread(_this.nextPageActions);
        _this.steps = [
            { label: _this.literals.scheduling },
            { label: _this.literals.parameterization },
            { label: _this.literals.conclude }
        ];
        return _this;
    }
    Object.defineProperty(ThfPageJobSchedulerComponent.prototype, "stepperOrientation", {
        get: /**
         * @return {?}
         */
        function () {
            return window.innerWidth > 481 && window.innerWidth < 960 ? 'horizontal' : 'vertical';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paramId = this.activatedRoute.snapshot.params['id'];
        this.isEdit = !!paramId;
        this.thfPageJobSchedulerService.configServiceApi({ endpoint: this.serviceApi });
        this.loadData(paramId);
    };
    /**
     * @param {?} currentStep
     * @param {?} nextStep
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.changePageActionsBySteps = /**
     * @param {?} currentStep
     * @param {?} nextStep
     * @return {?}
     */
    function (currentStep, nextStep) {
        /** @type {?} */
        var stepsLength = this.steps.length;
        if (nextStep === stepsLength) {
            this.jobSchedulerActions = tslib_1.__spread(this.concludePageActions);
        }
        else if (currentStep === stepsLength && nextStep < currentStep) {
            this.jobSchedulerActions = tslib_1.__spread(this.nextPageActions);
        }
    };
    /**
     * @param {?} stepNumber
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.nextStep = /**
     * @param {?} stepNumber
     * @return {?}
     */
    function (stepNumber) {
        if (stepNumber > 1 && this.schedulerExecution.form.invalid) {
            this.markAsDirtyInvalidControls(this.schedulerExecution.form.controls);
            return;
        }
        if (stepNumber > 2 && (this.schedulerParameters && this.schedulerParameters.form && this.schedulerParameters.form.invalid)) {
            this.markAsDirtyInvalidControls(this.schedulerParameters.form.controls);
            return;
        }
        this.changePageActionsBySteps(this.step, stepNumber);
        /** @type {?} */
        var steps = this.steps[this.step - 1];
        this.step = stepNumber;
        if (steps) {
            steps.status = ThfStepperStatus.Done;
        }
    };
    /**
     * @param {?} process
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.onChangeProcess = /**
     * @param {?} process
     * @return {?}
     */
    function (process) {
        if (process.existAPI && process.processId) {
            this.getParametersByProcess(process.processId);
            if (!this.isEdit) {
                this.model.executionParameter = {};
            }
            return;
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.confirmJobScheduler = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var paramId = this.activatedRoute.snapshot.params['id'];
        /** @type {?} */
        var confirmMessage = paramId ? this.literals.confirmUpdateMessage : this.literals.confirmSaveMessage;
        this.thfDialogService.confirm({
            title: this.literals.confirmation,
            message: confirmMessage,
            confirm: (/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var model = Object.assign({}, _this.model);
                _this.save(model, paramId);
            })
        });
    };
    /**
     * @private
     * @param {?} msgSuccess
     * @param {?} saveOperation
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.emitSuccessMessage = /**
     * @private
     * @param {?} msgSuccess
     * @param {?} saveOperation
     * @return {?}
     */
    function (msgSuccess, saveOperation) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, saveOperation.toPromise()];
                    case 1:
                        _a.sent();
                        this.thfNotification.success(msgSuccess);
                        this.resetJobSchedulerForm();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} process
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.getParametersByProcess = /**
     * @private
     * @param {?} process
     * @return {?}
     */
    function (process) {
        var _this = this;
        this.thfPageJobSchedulerService.getParametersByProcess(process).subscribe((/**
         * @param {?} parameters
         * @return {?}
         */
        function (parameters) {
            _this.parameters = parameters;
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.isDisabledAdvance = /**
     * @private
     * @return {?}
     */
    function () {
        return this.schedulerExecution ? this.schedulerExecution.form.invalid : false;
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.isDisabledBack = /**
     * @private
     * @return {?}
     */
    function () {
        return this.step === 1;
    };
    /**
     * @private
     * @param {?=} operation
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.nextStepOperation = /**
     * @private
     * @param {?=} operation
     * @return {?}
     */
    function (operation) {
        /** @type {?} */
        var stepNumber = operation === 'back' ? this.step - 1 : this.step + 1;
        this.nextStep(stepNumber);
    };
    /**
     * @private
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.resetJobSchedulerForm = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.schedulerExecution.form.reset();
        // radiogroup n√£o estava atribuindo novo valor, fica vermelho sem o timetout.
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.model = new ThfPageJobSchedulerInternal();
            _this.step = 1;
            _this.steps.forEach((/**
             * @param {?} step
             * @return {?}
             */
            function (step) {
                step.status = ThfStepperStatus.Default;
            }));
            _this.jobSchedulerActions = tslib_1.__spread(_this.nextPageActions);
        }));
    };
    /**
     * @private
     * @param {?} model
     * @param {?} paramId
     * @return {?}
     */
    ThfPageJobSchedulerComponent.prototype.save = /**
     * @private
     * @param {?} model
     * @param {?} paramId
     * @return {?}
     */
    function (model, paramId) {
        /** @type {?} */
        var saveOperation = paramId
            ? this.thfPageJobSchedulerService.updateResource(paramId, model)
            : this.thfPageJobSchedulerService.createResource(model);
        /** @type {?} */
        var msgSuccess = paramId ? this.literals.saveNotificationSuccessUpdate : this.literals.saveNotificationSuccessSave;
        this.emitSuccessMessage(msgSuccess, saveOperation);
    };
    ThfPageJobSchedulerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-page-job-scheduler',
                    template: "<thf-page-default\n  [t-actions]=\"jobSchedulerActions\"\n  [t-breadcrumb]=\"breadcrumb\"\n  [t-title]=\"title\">\n\n  <div class=\"thf-row\">\n\n    <thf-stepper\n      class=\"thf-lg-3 thf-xl-2\"\n      t-sequential=\"true\"\n      [t-orientation]=\"stepperOrientation\"\n      [t-step]=\"step\"\n      [t-steps]=\"steps\"\n      (t-change-step)=\"nextStep($event)\">\n    </thf-stepper>\n\n    <thf-container class=\"thf-lg-8 thf-xl-6\">\n      <form #formScheduler=\"ngForm\">\n\n        <thf-page-job-scheduler-execution [hidden]=\"step !== 1\"\n          #schedulerExecution\n          class=\"thf-md-12\"\n          [t-is-edit]=\"isEdit\"\n          [t-literals]=\"literals\"\n          [t-value]=\"model\"\n          (t-change-process)=\"onChangeProcess($event)\">\n        </thf-page-job-scheduler-execution>\n\n        <thf-page-job-scheduler-parameters *ngIf=\"step === 2\"\n          #schedulerParameters\n          class=\"thf-md-12\"\n          [t-literals]=\"literals\"\n          [t-parameters]=\"parameters || []\"\n          [(t-value)]=\"model.executionParameter\">\n        </thf-page-job-scheduler-parameters>\n\n        <thf-page-job-scheduler-summary *ngIf=\"step === 3\"\n          class=\"thf-md-12\"\n          [t-literals]=\"literals\"\n          [t-parameters]=\"parameters\"\n          [t-value]=\"model\">\n        </thf-page-job-scheduler-summary>\n      </form>\n    </thf-container>\n  </div>\n\n</thf-page-default>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: ["\n    thf-container .thf-container {\n      overflow-y: unset;\n    }\n  "]
                }] }
    ];
    /** @nocollapse */
    ThfPageJobSchedulerComponent.ctorParameters = function () { return [
        { type: ThfPageJobSchedulerLookupService },
        { type: ActivatedRoute },
        { type: ThfDialogService },
        { type: ThfNotificationService },
        { type: Router },
        { type: ThfPageJobSchedulerService }
    ]; };
    ThfPageJobSchedulerComponent.propDecorators = {
        schedulerExecution: [{ type: ViewChild, args: ['schedulerExecution', { static: true },] }],
        schedulerParameters: [{ type: ViewChild, args: ['schedulerParameters', { static: true },] }]
    };
    return ThfPageJobSchedulerComponent;
}(ThfPageJobSchedulerBaseComponent));
export { ThfPageJobSchedulerComponent };
if (false) {
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.isEdit;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.literals;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.parameters;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.saveOperation;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.step;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.backPageAction;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.concludePageActions;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.nextPageActions;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.jobSchedulerActions;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.steps;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.schedulerExecution;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.schedulerParameters;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.thfPageDynamicLookupService;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.thfDialogService;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.thfNotification;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2Utam9iLXNjaGVkdWxlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXRlbXBsYXRlcy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXIvdGhmLXBhZ2Utam9iLXNjaGVkdWxlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBS2hGLE9BQU8sRUFDTCxnQkFBZ0IsRUFFaEIsc0JBQXNCLEVBR3RCLGdCQUFnQixFQUNqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEtBQUssSUFBSSxNQUFNLG9CQUFvQixDQUFDO0FBRzNDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzNGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7Ozs7Ozs7Ozs7QUFhOUU7SUFVa0Qsd0RBQWdDO0lBK0NoRixzQ0FDUywyQkFBNkQsRUFDNUQsY0FBOEIsRUFDOUIsZ0JBQWtDLEVBQ2xDLGVBQXVDLEVBQ3ZDLE1BQWMsRUFDdEIsMEJBQXNEO1FBTnhELFlBT0ksa0JBQU0sMEJBQTBCLENBQUMsU0FDbEM7UUFQTSxpQ0FBMkIsR0FBM0IsMkJBQTJCLENBQWtDO1FBQzVELG9CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixzQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtC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ZXNDb250ZW50IjpbImltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQge1xuICBUaGZEaWFsb2dTZXJ2aWNlLFxuICBUaGZEeW5hbWljRm9ybUZpZWxkLFxuICBUaGZOb3RpZmljYXRpb25TZXJ2aWNlLFxuICBUaGZQYWdlQWN0aW9uLFxuICBUaGZTdGVwcGVySXRlbSxcbiAgVGhmU3RlcHBlclN0YXR1c1xufSBmcm9tICdAdG90dnMvdGhmLXVpJztcblxuaW1wb3J0ICogYXMgdXRpbCBmcm9tICcuLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBUaGZKb2JTY2hlZHVsZXJJbnRlcm5hbCB9IGZyb20gJy4vaW50ZXJmYWNlcy90aGYtam9iLXNjaGVkdWxlci1pbnRlcm5hbC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmUGFnZUpvYlNjaGVkdWxlckludGVybmFsIH0gZnJvbSAnLi90aGYtcGFnZS1qb2Itc2NoZWR1bGVyLWludGVybmFsJztcbmltcG9ydCB7IFRoZlBhZ2VKb2JTY2hlZHVsZXJCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IHRoZlBhZ2VKb2JTY2hlZHVsZXJMaXRlcmFsc0RlZmF1bHQgfSBmcm9tICcuL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXItbGl0ZXJhbHMnO1xuaW1wb3J0IHsgVGhmUGFnZUpvYlNjaGVkdWxlckxvb2t1cFNlcnZpY2UgfSBmcm9tICcuL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXItbG9va3VwLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UgfSBmcm9tICcuL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXIuc2VydmljZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFRoZlBhZ2VKb2JTY2hlZHVsZXJCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpY1wiIHRpdGxlPVwiVG90dnMgUGFnZSBKb2IgU2NoZWR1bGVyIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2ljL3NhbXBsZS10aGYtcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWpvYi1zY2hlZHVsZXItYmFzaWMvc2FtcGxlLXRoZi1wYWdlLWpvYi1zY2hlZHVsZXItYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1wYWdlLWpvYi1zY2hlZHVsZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLXBhZ2Utam9iLXNjaGVkdWxlci5jb21wb25lbnQuaHRtbCcsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gIHN0eWxlczogW2BcbiAgICB0aGYtY29udGFpbmVyIC50aGYtY29udGFpbmVyIHtcbiAgICAgIG92ZXJmbG93LXk6IHVuc2V0O1xuICAgIH1cbiAgYF1cbn0pXG5leHBvcnQgY2xhc3MgVGhmUGFnZUpvYlNjaGVkdWxlckNvbXBvbmVudCBleHRlbmRzIFRoZlBhZ2VKb2JTY2hlZHVsZXJCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBpc0VkaXQgPSBmYWxzZTtcbiAgbGl0ZXJhbHMgPSB7XG4gICAgLi4udGhmUGFnZUpvYlNjaGVkdWxlckxpdGVyYWxzRGVmYXVsdFt1dGlsLnRoZkxvY2FsZURlZmF1bHRdLFxuICAgIC4uLnRoZlBhZ2VKb2JTY2hlZHVsZXJMaXRlcmFsc0RlZmF1bHRbdXRpbC5icm93c2VyTGFuZ3VhZ2UoKV1cbiAgfTtcbiAgcGFyYW1ldGVyczogQXJyYXk8VGhmRHluYW1pY0Zvcm1GaWVsZD4gPSBbXTtcbiAgc2F2ZU9wZXJhdGlvbjogT2JzZXJ2YWJsZTxhbnk+O1xuICBzdGVwOiBudW1iZXIgPSAxO1xuXG4gIHByaXZhdGUgYmFja1BhZ2VBY3Rpb246IFRoZlBhZ2VBY3Rpb24gPSB7XG4gICAgbGFiZWw6IHRoaXMubGl0ZXJhbHMuYmFjayxcbiAgICBhY3Rpb246IHRoaXMubmV4dFN0ZXBPcGVyYXRpb24uYmluZCh0aGlzLCAnYmFjaycpLFxuICAgIGRpc2FibGVkOiB0aGlzLmlzRGlzYWJsZWRCYWNrLmJpbmQodGhpcylcbiAgfTtcblxuICBwcml2YXRlIGNvbmNsdWRlUGFnZUFjdGlvbnM6IEFycmF5PFRoZlBhZ2VBY3Rpb24+ID0gW1xuICAgIHtcbiAgICAgIGxhYmVsOiB0aGlzLmxpdGVyYWxzLmNvbmNsdWRlLFxuICAgICAgYWN0aW9uOiB0aGlzLmNvbmZpcm1Kb2JTY2hlZHVsZXIuYmluZCh0aGlzKVxuICAgIH0sXG4gICAgeyAuLi50aGlzLmJhY2tQYWdlQWN0aW9uIH1cbiAgXTtcblxuICBwcml2YXRlIG5leHRQYWdlQWN0aW9uczogQXJyYXk8VGhmUGFnZUFjdGlvbj4gPSBbXG4gICAge1xuICAgICAgbGFiZWw6IHRoaXMubGl0ZXJhbHMubmV4dCxcbiAgICAgIGFjdGlvbjogdGhpcy5uZXh0U3RlcE9wZXJhdGlvbi5iaW5kKHRoaXMsICduZXh0JyksXG4gICAgICBkaXNhYmxlZDogdGhpcy5pc0Rpc2FibGVkQWR2YW5jZS5iaW5kKHRoaXMpXG4gICAgfSxcbiAgICB7IC4uLnRoaXMuYmFja1BhZ2VBY3Rpb24gfVxuICBdO1xuXG4gIGpvYlNjaGVkdWxlckFjdGlvbnM6IEFycmF5PFRoZlBhZ2VBY3Rpb24+ID0gW1xuICAgIC4uLnRoaXMubmV4dFBhZ2VBY3Rpb25zXG4gIF07XG5cbiAgcmVhZG9ubHkgc3RlcHM6IEFycmF5PFRoZlN0ZXBwZXJJdGVtPiA9IFtcbiAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLnNjaGVkdWxpbmcgfSxcbiAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLnBhcmFtZXRlcml6YXRpb24gfSxcbiAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLmNvbmNsdWRlIH1cbiAgXTtcblxuICBAVmlld0NoaWxkKCdzY2hlZHVsZXJFeGVjdXRpb24nLCB7IHN0YXRpYzogdHJ1ZSB9KSBzY2hlZHVsZXJFeGVjdXRpb246IHsgZm9ybTogTmdGb3JtIH07XG4gIEBWaWV3Q2hpbGQoJ3NjaGVkdWxlclBhcmFtZXRlcnMnLCB7IHN0YXRpYzogdHJ1ZSB9KSBzY2hlZHVsZXJQYXJhbWV0ZXJzOiB7IGZvcm06IE5nRm9ybSB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyB0aGZQYWdlRHluYW1pY0xvb2t1cFNlcnZpY2U6IFRoZlBhZ2VKb2JTY2hlZHVsZXJMb29rdXBTZXJ2aWNlLFxuICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgdGhmRGlhbG9nU2VydmljZTogVGhmRGlhbG9nU2VydmljZSxcbiAgICBwcml2YXRlIHRoZk5vdGlmaWNhdGlvbjogVGhmTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHRoZlBhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlOiBUaGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZSkge1xuICAgICAgc3VwZXIodGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UpO1xuICAgIH1cblxuICBnZXQgc3RlcHBlck9yaWVudGF0aW9uKCk6ICdob3Jpem9udGFsJyB8ICd2ZXJ0aWNhbCcge1xuICAgIHJldHVybiB3aW5kb3cuaW5uZXJXaWR0aCA+IDQ4MSAmJiB3aW5kb3cuaW5uZXJXaWR0aCA8IDk2MCA/ICdob3Jpem9udGFsJyA6ICd2ZXJ0aWNhbCc7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBwYXJhbUlkID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbXNbJ2lkJ107XG5cbiAgICB0aGlzLmlzRWRpdCA9ICEhcGFyYW1JZDtcblxuICAgIHRoaXMudGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UuY29uZmlnU2VydmljZUFwaSh7IGVuZHBvaW50OiB0aGlzLnNlcnZpY2VBcGkgfSk7XG5cbiAgICB0aGlzLmxvYWREYXRhKHBhcmFtSWQpO1xuICB9XG5cbiAgY2hhbmdlUGFnZUFjdGlvbnNCeVN0ZXBzKGN1cnJlbnRTdGVwOiBudW1iZXIsIG5leHRTdGVwOiBudW1iZXIpIHtcbiAgICBjb25zdCBzdGVwc0xlbmd0aCA9IHRoaXMuc3RlcHMubGVuZ3RoO1xuXG4gICAgaWYgKG5leHRTdGVwID09PSBzdGVwc0xlbmd0aCkge1xuICAgIHRoaXMuam9iU2NoZWR1bGVyQWN0aW9ucyA9IFsgLi4udGhpcy5jb25jbHVkZVBhZ2VBY3Rpb25zIF07XG5cbiAgICB9IGVsc2UgaWYgKGN1cnJlbnRTdGVwID09PSBzdGVwc0xlbmd0aCAmJiBuZXh0U3RlcCA8IGN1cnJlbnRTdGVwKSB7XG5cbiAgICB0aGlzLmpvYlNjaGVkdWxlckFjdGlvbnMgPSBbIC4uLnRoaXMubmV4dFBhZ2VBY3Rpb25zIF07XG4gICAgfVxuICB9XG5cbiAgbmV4dFN0ZXAoc3RlcE51bWJlcjogbnVtYmVyKSB7XG5cbiAgICBpZiAoc3RlcE51bWJlciA+IDEgJiYgdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5pbnZhbGlkKSB7XG4gICAgICB0aGlzLm1hcmtBc0RpcnR5SW52YWxpZENvbnRyb2xzKHRoaXMuc2NoZWR1bGVyRXhlY3V0aW9uLmZvcm0uY29udHJvbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChzdGVwTnVtYmVyID4gMiAmJiAodGhpcy5zY2hlZHVsZXJQYXJhbWV0ZXJzICYmIHRoaXMuc2NoZWR1bGVyUGFyYW1ldGVycy5mb3JtICYmIHRoaXMuc2NoZWR1bGVyUGFyYW1ldGVycy5mb3JtLmludmFsaWQpKSB7XG4gICAgICB0aGlzLm1hcmtBc0RpcnR5SW52YWxpZENvbnRyb2xzKHRoaXMuc2NoZWR1bGVyUGFyYW1ldGVycy5mb3JtLmNvbnRyb2xzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZVBhZ2VBY3Rpb25zQnlTdGVwcyh0aGlzLnN0ZXAsIHN0ZXBOdW1iZXIpO1xuXG4gICAgY29uc3Qgc3RlcHMgPSB0aGlzLnN0ZXBzW3RoaXMuc3RlcCAtIDFdO1xuICAgIHRoaXMuc3RlcCA9IHN0ZXBOdW1iZXI7XG5cbiAgICBpZiAoc3RlcHMpIHtcbiAgICAgIHN0ZXBzLnN0YXR1cyA9IFRoZlN0ZXBwZXJTdGF0dXMuRG9uZTtcbiAgICB9XG4gIH1cblxuICBvbkNoYW5nZVByb2Nlc3MocHJvY2VzczogeyBwcm9jZXNzSWQ6IHN0cmluZywgZXhpc3RBUEk6IGJvb2xlYW4gfSkge1xuICAgIGlmIChwcm9jZXNzLmV4aXN0QVBJICYmIHByb2Nlc3MucHJvY2Vzc0lkKSB7XG4gICAgICB0aGlzLmdldFBhcmFtZXRlcnNCeVByb2Nlc3MocHJvY2Vzcy5wcm9jZXNzSWQpO1xuXG4gICAgICBpZiAoIXRoaXMuaXNFZGl0KSB7XG4gICAgICAgIHRoaXMubW9kZWwuZXhlY3V0aW9uUGFyYW1ldGVyID0ge307XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgfVxuXG4gIHByaXZhdGUgY29uZmlybUpvYlNjaGVkdWxlcigpIHtcbiAgICBjb25zdCBwYXJhbUlkID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbXNbJ2lkJ107XG5cbiAgICBjb25zdCBjb25maXJtTWVzc2FnZSA9IHBhcmFtSWQgPyB0aGlzLmxpdGVyYWxzLmNvbmZpcm1VcGRhdGVNZXNzYWdlIDogdGhpcy5saXRlcmFscy5jb25maXJtU2F2ZU1lc3NhZ2U7XG5cbiAgICB0aGlzLnRoZkRpYWxvZ1NlcnZpY2UuY29uZmlybSh7XG4gICAgICB0aXRsZTogdGhpcy5saXRlcmFscy5jb25maXJtYXRpb24sXG4gICAgICBtZXNzYWdlOiBjb25maXJtTWVzc2FnZSxcbiAgICAgIGNvbmZpcm06ICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm1vZGVsKTtcblxuICAgICAgICB0aGlzLnNhdmUobW9kZWwsIHBhcmFtSWQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVtaXRTdWNjZXNzTWVzc2FnZShtc2dTdWNjZXNzOiBhbnksIHNhdmVPcGVyYXRpb246IE9ic2VydmFibGU8YW55Pikge1xuICAgIGF3YWl0IHNhdmVPcGVyYXRpb24udG9Qcm9taXNlKCk7XG4gICAgdGhpcy50aGZOb3RpZmljYXRpb24uc3VjY2Vzcyhtc2dTdWNjZXNzKTtcbiAgICB0aGlzLnJlc2V0Sm9iU2NoZWR1bGVyRm9ybSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQYXJhbWV0ZXJzQnlQcm9jZXNzKHByb2Nlc3M6IGFueSkge1xuXG4gICAgdGhpcy50aGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZS5nZXRQYXJhbWV0ZXJzQnlQcm9jZXNzKHByb2Nlc3MpLnN1YnNjcmliZShwYXJhbWV0ZXJzID0+IHtcbiAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7XG4gICAgfSk7XG5cbiAgfVxuXG4gIHByaXZhdGUgaXNEaXNhYmxlZEFkdmFuY2UoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVyRXhlY3V0aW9uID8gdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5pbnZhbGlkIDogZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGlzRGlzYWJsZWRCYWNrKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0ZXAgPT09IDE7XG4gIH1cblxuICBwcml2YXRlIG5leHRTdGVwT3BlcmF0aW9uKG9wZXJhdGlvbj86ICdiYWNrJyB8ICduZXh0Jykge1xuICAgIGNvbnN0IHN0ZXBOdW1iZXIgPSBvcGVyYXRpb24gPT09ICdiYWNrJyA/IHRoaXMuc3RlcCAtIDEgOiB0aGlzLnN0ZXAgKyAxO1xuXG4gICAgdGhpcy5uZXh0U3RlcChzdGVwTnVtYmVyKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRKb2JTY2hlZHVsZXJGb3JtKCkge1xuICAgIHRoaXMuc2NoZWR1bGVyRXhlY3V0aW9uLmZvcm0ucmVzZXQoKTtcblxuICAgIC8vIHJhZGlvZ3JvdXAgbsOjbyBlc3RhdmEgYXRyaWJ1aW5kbyBub3ZvIHZhbG9yLCBmaWNhIHZlcm1lbGhvIHNlbSBvIHRpbWV0b3V0LlxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5tb2RlbCA9IG5ldyBUaGZQYWdlSm9iU2NoZWR1bGVySW50ZXJuYWwoKTtcblxuICAgICAgdGhpcy5zdGVwID0gMTtcbiAgICAgIHRoaXMuc3RlcHMuZm9yRWFjaChzdGVwID0+IHtcbiAgICAgICAgc3RlcC5zdGF0dXMgPSBUaGZTdGVwcGVyU3RhdHVzLkRlZmF1bHQ7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5qb2JTY2hlZHVsZXJBY3Rpb25zID0gWy4uLnRoaXMubmV4dFBhZ2VBY3Rpb25zXTtcbiAgICB9KTtcblxuICB9XG5cbiAgcHJpdmF0ZSBzYXZlKG1vZGVsOiBUaGZKb2JTY2hlZHVsZXJJbnRlcm5hbCwgcGFyYW1JZCkge1xuICAgIGNvbnN0IHNhdmVPcGVyYXRpb24gPSBwYXJhbUlkXG4gICAgICA/IHRoaXMudGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UudXBkYXRlUmVzb3VyY2UocGFyYW1JZCwgbW9kZWwpXG4gICAgICA6IHRoaXMudGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UuY3JlYXRlUmVzb3VyY2UobW9kZWwpO1xuXG4gICAgY29uc3QgbXNnU3VjY2VzcyA9IHBhcmFtSWQgPyB0aGlzLmxpdGVyYWxzLnNhdmVOb3RpZmljYXRpb25TdWNjZXNzVXBkYXRlIDogdGhpcy5saXRlcmFscy5zYXZlTm90aWZpY2F0aW9uU3VjY2Vzc1NhdmU7XG5cbiAgICB0aGlzLmVtaXRTdWNjZXNzTWVzc2FnZShtc2dTdWNjZXNzLCBzYXZlT3BlcmF0aW9uKTtcbiAgfVxuXG59XG4iXX0=