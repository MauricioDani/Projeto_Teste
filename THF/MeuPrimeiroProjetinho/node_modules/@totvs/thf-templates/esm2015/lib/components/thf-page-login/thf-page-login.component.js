/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NgForm } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { ChangeDetectorRef, Component, IterableDiffers, ViewChild, ViewContainerRef } from '@angular/core';
import { isExternalLink } from '../../utils/util';
import { ThfComponentInjectorService } from '@totvs/thf-ui';
import { ThfModalPasswordRecoveryComponent } from '../thf-modal-password-recovery/thf-modal-password-recovery.component';
import { ThfModalPasswordRecoveryType } from '../thf-modal-password-recovery/enums/thf-modal-password-recovery-type.enum';
import { ThfPageLoginBaseComponent } from './thf-page-login-base.component';
import { ThfPageLoginService } from './thf-page-login.service';
/**
 * \@docsExtends ThfPageLoginBaseComponent
 *
 * \@example
 *
 * <example name="thf-page-login-basic" title="Totvs Page Login Basic">
 *  <file name="sample-thf-page-login-basic/sample-thf-page-login-basic.component.html"> </file>
 *  <file name="sample-thf-page-login-basic/sample-thf-page-login-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-page-login-labs" title="Totvs Page Login Labs">
 *  <file name="sample-thf-page-login-labs/sample-thf-page-login-labs.component.html"> </file>
 *  <file name="sample-thf-page-login-labs/sample-thf-page-login-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-page-login-human-resources" title="Totvs Page Login - Human Resources">
 *  <file name="sample-thf-page-login-human-resources/sample-thf-page-login-human-resources.component.html"> </file>
 *  <file name="sample-thf-page-login-human-resources/sample-thf-page-login-human-resources.component.ts"> </file>
 *  <file name="sample-thf-page-login-human-resources/sample-thf-page-login-human-resources.module.ts"> </file>
 * </example>
 *
 * <example name="thf-page-login-automatic-service" title="Totvs Page Login - Automatic Service">
 *  <file name="sample-thf-page-login-automatic-service/sample-thf-page-login-automatic-service.component.html"> </file>
 *  <file name="sample-thf-page-login-automatic-service/sample-thf-page-login-automatic-service.component.ts"> </file>
 * </example>
 */
export class ThfPageLoginComponent extends ThfPageLoginBaseComponent {
    /**
     * @param {?} changeDetector
     * @param {?} activatedRoute
     * @param {?} thfComponentInjector
     * @param {?} differs
     * @param {?} loginService
     * @param {?} router
     */
    constructor(changeDetector, activatedRoute, thfComponentInjector, differs, loginService, router) {
        super(loginService, router);
        this.changeDetector = changeDetector;
        this.activatedRoute = activatedRoute;
        this.thfComponentInjector = thfComponentInjector;
        this.componentRef = null;
        this.customPasswordError = { custom: false };
        this.differ = differs.find([]).create(null);
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        if (this.differ) {
            this.validateArrayChanges(this.differ, [
                { array: this.loginErrors, callback: this.generateLoginError.bind(this) },
                { array: this.passwordErrors, callback: this.generatePasswordError.bind(this) }
            ]);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.checkingForRouteMetadata(this.activatedRoute.snapshot.data);
    }
    /**
     * @return {?}
     */
    changeLoginModel() {
        if (this.authenticationUrl) {
            this.loginErrors = [];
        }
        else {
            this.setLoginErrors(this.loginErrors);
            this.loginChange.emit(this.login);
        }
    }
    /**
     * @return {?}
     */
    changePasswordModel() {
        if (this.authenticationUrl) {
            this.passwordErrors = [];
        }
        else {
            this.setPasswordErrors(this.passwordErrors);
            this.passwordChange.emit(this.password);
        }
    }
    /**
     * @private
     * @param {?} object
     * @param {?} property
     * @return {?}
     */
    checkingForMetadataProperty(object, property) {
        if (Object.prototype.hasOwnProperty.call(object, property)) {
            return object[property];
        }
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    checkingForRouteMetadata(data) {
        if (Object.keys(data).length !== 0) {
            this.authenticationUrl = this.checkingForMetadataProperty(data, 'serviceApi') || this.authenticationUrl;
            this.authenticationType = this.checkingForMetadataProperty(data, 'authenticationType') || this.authenticationType;
            this.environment = this.checkingForMetadataProperty(data, 'environment') || this.environment;
            this.recovery = this.checkingForMetadataProperty(data, 'recovery') || this.recovery;
            this.registerUrl = this.checkingForMetadataProperty(data, 'registerUrl') || this.registerUrl;
        }
    }
    /**
     * @private
     * @param {?} thfPageLoginRecovery
     * @return {?}
     */
    createModalPasswordRecoveryComponent(thfPageLoginRecovery) {
        if (this.componentRef) {
            this.thfComponentInjector.destroyComponentInApplication(this.componentRef);
        }
        this.componentRef = this.thfComponentInjector.createComponentInApplication(ThfModalPasswordRecoveryComponent);
        this.componentRef.instance.urlRecovery = thfPageLoginRecovery.url;
        this.componentRef.instance.contactEmail = thfPageLoginRecovery.contactMail;
        this.componentRef.instance.phoneMask = thfPageLoginRecovery.phoneMask;
        this.componentRef.instance.type = thfPageLoginRecovery.type || ThfModalPasswordRecoveryType.Email;
        this.componentRef.changeDetectorRef.detectChanges();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.componentRef.instance.open();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    generateLoginError() {
        if (this.loginErrors && this.loginErrors.length) {
            this.setLoginErrors(this.loginErrors);
        }
        else {
            /** @type {?} */
            const control = this.loginForm.form.controls['login'];
            if (control) {
                this.resetControl(control);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    generatePasswordError() {
        if (this.passwordErrors && this.passwordErrors.length) {
            this.setPasswordErrors(this.passwordErrors);
        }
        else {
            /** @type {?} */
            const control = this.loginForm.form.controls['password'];
            if (control) {
                this.resetControl(control);
            }
        }
    }
    /**
     * @private
     * @param {?} control
     * @return {?}
     */
    resetControl(control) {
        control.markAsPristine();
        control.markAsUntouched();
        control.updateValueAndValidity();
    }
    /**
     * @private
     * @param {?} allErrors
     * @param {?} control
     * @param {?} errors
     * @param {?} patternError
     * @return {?}
     */
    setControlErrors(allErrors, control, errors, patternError) {
        if (control) {
            this[allErrors] = control.hasError('pattern') ? [...errors, ...[patternError]] : [...errors];
            if (errors && errors.length && (control.valid || control.pristine)) {
                control.markAsTouched();
                control.markAsDirty();
                control.setErrors(this.customPasswordError);
            }
        }
    }
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    setUrlRedirect(url) {
        isExternalLink(url) ? window.open(url, '_blank') : this.router.navigate([url]);
    }
    /**
     * @private
     * @param {?} differ
     * @param {?} array
     * @return {?}
     */
    validateArrayChanges(differ, array) {
        array.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            /** @type {?} */
            const changes = differ.diff(element.array);
            if (changes) {
                element.callback();
                this.changeDetector.detectChanges();
            }
        }));
    }
    /**
     * @protected
     * @param {?} recovery
     * @return {?}
     */
    openUrl(recovery) {
        switch (typeof recovery) {
            case 'string': {
                this.setUrlRedirect(recovery);
                break;
            }
            case 'function': {
                recovery();
                break;
            }
            case 'object': {
                this.createModalPasswordRecoveryComponent(recovery);
                break;
            }
        }
    }
    /**
     * @protected
     * @param {?} errors
     * @return {?}
     */
    setLoginErrors(errors) {
        /** @type {?} */
        const control = this.loginForm.form.controls['login'];
        this.setControlErrors('allLoginErrors', control, errors, this.literals.loginErrorPattern);
    }
    /**
     * @protected
     * @param {?} errors
     * @return {?}
     */
    setPasswordErrors(errors) {
        /** @type {?} */
        const control = this.loginForm.form.controls['password'];
        this.setControlErrors('allPasswordErrors', control, errors, this.literals.passwordErrorPattern);
    }
    /**
     * @param {?} language
     * @return {?}
     */
    onSelectedLanguage(language) {
        this.selectedLanguage = language;
        this.getLiterals(language, this.containsCustomLiterals ? this.customizedDefaultLiterals : undefined);
        this.setTitleLiteral(language, this.productName);
        this.setLoginHintLiteral(language, this.contactEmail);
    }
}
ThfPageLoginComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-page-login',
                template: "<thf-page-background #pageLogin\n  t-show-select-language\n  [t-background]=\"background\"\n  [t-highlight-info]=\"literals.highlightInfo\"\n  [t-logo]=\"logo\"\n  [t-secondary-logo]=\"secondaryLogo\"\n  (t-selected-language)=\"onSelectedLanguage($event)\">\n\n  <div class=\"thf-page-login-header thf-mb-2 thf-mb-sm-1 thf-pt-sm-1\">\n    <div class=\"thf-page-login-header-title thf-mb-sm-1\">{{ literals.title }}</div>\n    <thf-tag\n      *ngIf=\"environment\"\n      t-type=\"warning\"\n      [t-value]=\"environment\">\n    </thf-tag>\n  </div>\n\n  <form #loginForm=\"ngForm\" class=\"thf-page-login-form\">\n    <div class=\"thf-row\">\n      <div class=\"thf-lg-12\">\n        <div class=\"thf-page-login-hint thf-page-login-info-container\">\n          <thf-login\n            class=\"thf-page-login-info-field\"\n            name=\"login\"\n            [(ngModel)]=\"login\"\n            t-focus\n            t-required\n            [t-label]=\"literals.loginLabel\"\n            [t-pattern]=\"loginPattern\"\n            [t-placeholder]=\"literals.loginPlaceholder\"\n            (click)=\"closePopover()\"\n            (keyup.enter)=\"loginForm.valid && onLoginSubmit()\"\n            (t-change-model)=\"changeLoginModel()\">\n          </thf-login>\n\n          <div class=\"thf-page-login-info-icon-container\">\n            <span\n              class=\"thf-icon thf-field-icon thf-icon-info\"\n              t-tooltip-position=\"right\"\n              [t-tooltip]=\"literals.loginHint\">\n            </span>\n          </div>\n        </div>\n\n        <div class=\"thf-field-container-bottom thf-field-container-error-container\">\n          <div *ngFor=\"let error of allLoginErrors\u001C\" class=\"thf-field-container-bottom-text-error thf-field-container-error-item\">\n            <span class=\"thf-icon thf-icon-exclamation\"></span>\n            <span class=\"thf-field-container-error-text\">{{error}}</span>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"thf-lg-12\">\n        <div class=\"thf-page-login-password-container\">\n          <thf-password\n            class=\"thf-page-login-field-size thf-page-login-password-item\"\n            name=\"password\"\n            [(ngModel)]=\"password\"\n            t-required\n            [t-label]=\"literals.passwordLabel\"\n            [t-pattern]=\"passwordPattern\"\n            [t-placeholder]=\"literals.passwordPlaceholder\"\n            (click)=\"closePopover()\"\n            (keyup.enter)=\"loginForm.valid && onLoginSubmit()\"\n            (t-change-model)=\"changePasswordModel()\">\n          </thf-password>\n          <div class=\"thf-page-login-password-item thf-page-login-password-popover-container\">\n            <thf-page-login-popover *ngIf=\"showExceededAttemptsWarning && exceededAttemptsWarning\"\n              [t-recovery]=\"recovery\"\n              [t-remaining-attempts]=\"exceededAttemptsWarning\"\n              [t-selected-language]=\"selectedLanguage\"\n              (t-forgot-password) = \"openUrl($event)\">\n            </thf-page-login-popover>\n          </div>\n        </div>\n        <div class=\"thf-field-container-bottom thf-field-container-error-container\">\n          <div *ngFor=\"let error of allPasswordErrors\" class=\"thf-field-container-bottom-text-error thf-field-container-error-item\">\n            <span class=\"thf-icon thf-icon-exclamation\"></span>\n            <span class=\"thf-field-container-error-text\">{{error}}</span>\n          </div>\n        </div>\n      </div>\n\n      <thf-input *ngIf=\"customField && customFieldType === 'input'\"\n        class=\"thf-page-login-field-size thf-lg-12\"\n        name=\"customFieldInput\"\n        [(ngModel)]=\"customFieldObject.value\"\n        t-required\n        [t-error-pattern]=\"customFieldObject.errorPattern || literals.customFieldErrorPattern\"\n        [t-pattern]=\"customFieldObject.pattern\"\n        [t-placeholder]=\"customFieldObject.placeholder || literals.customFieldPlaceholder\"\n        (keyup.enter)=\"loginForm.valid && onLoginSubmit()\">\n      </thf-input>\n\n      <thf-combo *ngIf=\"customField && customFieldType === 'combo'\"\n        class=\"thf-page-login-field-size thf-lg-12\"\n        name=\"customFieldCombo\"\n        [(ngModel)]=\"customFieldObject.value\"\n        t-required\n        [t-field-value]=\"customFieldObject.fieldValue\"\n        [t-filter-service]=\"customFieldObject.url\"\n        [t-placeholder]=\"customFieldObject.placeholder || literals.customFieldPlaceholder\">\n      </thf-combo>\n\n      <thf-select *ngIf=\"customField && customFieldType === 'select'\"\n        class=\"thf-page-login-field-size thf-lg-12\"\n        name=\"customFieldSelect\"\n        [(ngModel)]=\"customFieldObject.value\"\n        t-required\n        [t-placeholder]=\"customFieldObject.placeholder || literals.customFieldPlaceholder\"\n        [t-options]=\"customFieldObject.options\">\n      </thf-select>\n\n      <div class=\"thf-lg-12\">\n        <div *ngIf=\"!hideRememberUser\" class=\"thf-page-login-hint thf-page-login-info-container\">\n          <thf-switch\n            class=\"thf-page-login-info-field thf-lg-7 thf-offset-lg-5 thf-offset-xl-5\"\n            name=\"rememberUser\"\n            [(ngModel)]=\"rememberUser\"\n            t-label-position=\"1\"\n            [t-label-off]=\"literals.rememberUser\"\n            [t-label-on]=\"literals.rememberUser\"\n            (keyup.enter)=\"loginForm.valid && onLoginSubmit()\">\n          </thf-switch>\n\n          <div class=\"thf-page-login-info-icon-container thf-page-login-info-icon-remember-user\">\n            <span\n              class=\"thf-icon thf-field-icon thf-icon-info\"\n              t-tooltip-position=\"right\"\n              [t-tooltip]=\"literals.rememberUserHint\">\n            </span>\n          </div>\n        </div>\n      </div>\n\n\n      <thf-button\n        class=\"thf-lg-12 thf-page-login-button thf-page-login-field-size\"\n        t-type=\"primary\"\n        [t-disabled]=\"loginForm.invalid\"\n        [t-label]=\"loading ? literals.submittedLabel : literals.submitLabel\"\n        [t-loading]=\"loading\"\n        (t-click)=\"onLoginSubmit()\">\n      </thf-button>\n\n      <div *ngIf=\"recovery\"\n        class=\"thf-page-login-recovery-link\">\n        <a class=\"thf-font-text-large-bold\" (click)=\"openUrl(recovery)\">{{ literals.forgotPassword }}</a>\n      </div>\n\n      <div *ngIf=\"registerUrl\"\n        class=\"thf-page-login-register-link\">\n        <a class=\"thf-font-text-large-bold\" (click)=\"openUrl(registerUrl)\">{{ literals.registerUrl }}</a>\n      </div>\n    </div>\n  </form>\n</thf-page-background>\n"
            }] }
];
/** @nocollapse */
ThfPageLoginComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ActivatedRoute },
    { type: ThfComponentInjectorService },
    { type: IterableDiffers },
    { type: ThfPageLoginService },
    { type: Router }
];
ThfPageLoginComponent.propDecorators = {
    loginForm: [{ type: ViewChild, args: ['loginForm', { read: NgForm, static: true },] }],
    pageLogin: [{ type: ViewChild, args: ['pageLogin', { read: ViewContainerRef, static: true },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfPageLoginComponent.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    ThfPageLoginComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfPageLoginComponent.prototype.customPasswordError;
    /** @type {?} */
    ThfPageLoginComponent.prototype.loginForm;
    /** @type {?} */
    ThfPageLoginComponent.prototype.pageLogin;
    /** @type {?} */
    ThfPageLoginComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    ThfPageLoginComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    ThfPageLoginComponent.prototype.thfComponentInjector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2UtbG9naW4uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi10ZW1wbGF0ZXMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtcGFnZS1sb2dpbi90aGYtcGFnZS1sb2dpbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBbUIsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQW9CLGlCQUFpQixFQUFFLFNBQVMsRUFBZ0IsZUFBZSxFQUFVLFNBQVMsRUFBRSxnQkFBZ0IsRUFDMUgsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU1RCxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxzRUFBc0UsQ0FBQztBQUN6SCxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSw0RUFBNEUsQ0FBQztBQUMxSCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUU1RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0MvRCxNQUFNLE9BQU8scUJBQXNCLFNBQVEseUJBQXlCOzs7Ozs7Ozs7SUFTbEUsWUFDUyxjQUFpQyxFQUNoQyxjQUE4QixFQUM5QixvQkFBaUQsRUFDekQsT0FBd0IsRUFDeEIsWUFBaUMsRUFDakMsTUFBYztRQUVkLEtBQUssQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFQckIsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBQ2hDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5Qix5QkFBb0IsR0FB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LElBQUksRUFBRTs7Ozs7OztJQUxoRSw2Q0FBK0M7Ozs7O0lBQy9DLHVDQUFvQjs7Ozs7SUFDcEIsb0RBQTBEOztJQUUxRCwwQ0FBMEU7O0lBQzFFLDBDQUE4Rjs7SUFHNUYsK0NBQXdDOzs7OztJQUN4QywrQ0FBc0M7Ozs7O0lBQ3RDLHFEQUF5RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBBZnRlclZpZXdDaGVja2VkLCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRSZWYsIEl0ZXJhYmxlRGlmZmVycywgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGlzRXh0ZXJuYWxMaW5rIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBUaGZDb21wb25lbnRJbmplY3RvclNlcnZpY2UgfSBmcm9tICdAdG90dnMvdGhmLXVpJztcblxuaW1wb3J0IHsgVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50IH0gZnJvbSAnLi4vdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5L3RoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZSB9IGZyb20gJy4uL3RoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS9lbnVtcy90aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktdHlwZS5lbnVtJztcbmltcG9ydCB7IFRoZlBhZ2VMb2dpbkJhc2VDb21wb25lbnQgfSBmcm9tICcuL3RoZi1wYWdlLWxvZ2luLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZlBhZ2VMb2dpblJlY292ZXJ5IH0gZnJvbSAnLi9pbnRlcmZhY2VzL3RoZi1wYWdlLWxvZ2luLXJlY292ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZQYWdlTG9naW5TZXJ2aWNlIH0gZnJvbSAnLi90aGYtcGFnZS1sb2dpbi5zZXJ2aWNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmUGFnZUxvZ2luQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1wYWdlLWxvZ2luLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBQYWdlIExvZ2luIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1sb2dpbi1iYXNpYy9zYW1wbGUtdGhmLXBhZ2UtbG9naW4tYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtbG9naW4tYmFzaWMvc2FtcGxlLXRoZi1wYWdlLWxvZ2luLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1wYWdlLWxvZ2luLWxhYnNcIiB0aXRsZT1cIlRvdHZzIFBhZ2UgTG9naW4gTGFic1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtbG9naW4tbGFicy9zYW1wbGUtdGhmLXBhZ2UtbG9naW4tbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1sb2dpbi1sYWJzL3NhbXBsZS10aGYtcGFnZS1sb2dpbi1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1wYWdlLWxvZ2luLWh1bWFuLXJlc291cmNlc1wiIHRpdGxlPVwiVG90dnMgUGFnZSBMb2dpbiAtIEh1bWFuIFJlc291cmNlc1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtbG9naW4taHVtYW4tcmVzb3VyY2VzL3NhbXBsZS10aGYtcGFnZS1sb2dpbi1odW1hbi1yZXNvdXJjZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtbG9naW4taHVtYW4tcmVzb3VyY2VzL3NhbXBsZS10aGYtcGFnZS1sb2dpbi1odW1hbi1yZXNvdXJjZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWxvZ2luLWh1bWFuLXJlc291cmNlcy9zYW1wbGUtdGhmLXBhZ2UtbG9naW4taHVtYW4tcmVzb3VyY2VzLm1vZHVsZS50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1wYWdlLWxvZ2luLWF1dG9tYXRpYy1zZXJ2aWNlXCIgdGl0bGU9XCJUb3R2cyBQYWdlIExvZ2luIC0gQXV0b21hdGljIFNlcnZpY2VcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWxvZ2luLWF1dG9tYXRpYy1zZXJ2aWNlL3NhbXBsZS10aGYtcGFnZS1sb2dpbi1hdXRvbWF0aWMtc2VydmljZS5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1sb2dpbi1hdXRvbWF0aWMtc2VydmljZS9zYW1wbGUtdGhmLXBhZ2UtbG9naW4tYXV0b21hdGljLXNlcnZpY2UuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtcGFnZS1sb2dpbicsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGYtcGFnZS1sb2dpbi5jb21wb25lbnQuaHRtbCdcbn0pXG5cbmV4cG9ydCBjbGFzcyBUaGZQYWdlTG9naW5Db21wb25lbnQgZXh0ZW5kcyBUaGZQYWdlTG9naW5CYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25Jbml0IHtcblxuICBwcml2YXRlIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPGFueT4gPSBudWxsO1xuICBwcml2YXRlIGRpZmZlcjogYW55O1xuICBwcml2YXRlIHJlYWRvbmx5IGN1c3RvbVBhc3N3b3JkRXJyb3IgPSB7IGN1c3RvbSA6IGZhbHNlIH07XG5cbiAgQFZpZXdDaGlsZCgnbG9naW5Gb3JtJywgeyByZWFkOiBOZ0Zvcm0sIHN0YXRpYzogdHJ1ZSB9KSBsb2dpbkZvcm06IE5nRm9ybTtcbiAgQFZpZXdDaGlsZCgncGFnZUxvZ2luJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSkgcGFnZUxvZ2luOiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSB0aGZDb21wb25lbnRJbmplY3RvcjogVGhmQ29tcG9uZW50SW5qZWN0b3JTZXJ2aWNlLFxuICAgIGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycyxcbiAgICBsb2dpblNlcnZpY2U6IFRoZlBhZ2VMb2dpblNlcnZpY2UsXG4gICAgcm91dGVyOiBSb3V0ZXIsXG4gICAgKSB7XG4gICAgc3VwZXIobG9naW5TZXJ2aWNlLCByb3V0ZXIpO1xuICAgIHRoaXMuZGlmZmVyID0gZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuZGlmZmVyKSB7XG4gICAgICB0aGlzLnZhbGlkYXRlQXJyYXlDaGFuZ2VzKHRoaXMuZGlmZmVyLCBbXG4gICAgICAgIHsgYXJyYXk6IHRoaXMubG9naW5FcnJvcnMsIGNhbGxiYWNrOiB0aGlzLmdlbmVyYXRlTG9naW5FcnJvci5iaW5kKHRoaXMpIH0sXG4gICAgICAgIHsgYXJyYXk6IHRoaXMucGFzc3dvcmRFcnJvcnMsIGNhbGxiYWNrOiB0aGlzLmdlbmVyYXRlUGFzc3dvcmRFcnJvci5iaW5kKHRoaXMpIH1cbiAgICAgIF0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2hlY2tpbmdGb3JSb3V0ZU1ldGFkYXRhKHRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QuZGF0YSk7XG4gIH1cblxuICBjaGFuZ2VMb2dpbk1vZGVsKCkge1xuICAgIGlmICh0aGlzLmF1dGhlbnRpY2F0aW9uVXJsKSB7XG4gICAgICB0aGlzLmxvZ2luRXJyb3JzID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0TG9naW5FcnJvcnModGhpcy5sb2dpbkVycm9ycyk7XG4gICAgICB0aGlzLmxvZ2luQ2hhbmdlLmVtaXQodGhpcy5sb2dpbik7XG4gICAgfVxuICB9XG5cbiAgY2hhbmdlUGFzc3dvcmRNb2RlbCgpIHtcbiAgICBpZiAodGhpcy5hdXRoZW50aWNhdGlvblVybCkge1xuICAgICAgdGhpcy5wYXNzd29yZEVycm9ycyA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFBhc3N3b3JkRXJyb3JzKHRoaXMucGFzc3dvcmRFcnJvcnMpO1xuICAgICAgdGhpcy5wYXNzd29yZENoYW5nZS5lbWl0KHRoaXMucGFzc3dvcmQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdGb3JNZXRhZGF0YVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpKSB7XG4gICAgICByZXR1cm4gb2JqZWN0W3Byb3BlcnR5XTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNraW5nRm9yUm91dGVNZXRhZGF0YShkYXRhKSB7XG4gICAgaWYgKE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblVybCA9IHRoaXMuY2hlY2tpbmdGb3JNZXRhZGF0YVByb3BlcnR5KGRhdGEsICdzZXJ2aWNlQXBpJykgfHwgdGhpcy5hdXRoZW50aWNhdGlvblVybDtcbiAgICAgIHRoaXMuYXV0aGVudGljYXRpb25UeXBlID0gdGhpcy5jaGVja2luZ0Zvck1ldGFkYXRhUHJvcGVydHkoZGF0YSwgJ2F1dGhlbnRpY2F0aW9uVHlwZScpIHx8IHRoaXMuYXV0aGVudGljYXRpb25UeXBlO1xuICAgICAgdGhpcy5lbnZpcm9ubWVudCA9IHRoaXMuY2hlY2tpbmdGb3JNZXRhZGF0YVByb3BlcnR5KGRhdGEsICdlbnZpcm9ubWVudCcpIHx8IHRoaXMuZW52aXJvbm1lbnQ7XG4gICAgICB0aGlzLnJlY292ZXJ5ID0gdGhpcy5jaGVja2luZ0Zvck1ldGFkYXRhUHJvcGVydHkoZGF0YSwgJ3JlY292ZXJ5JykgfHwgdGhpcy5yZWNvdmVyeTtcbiAgICAgIHRoaXMucmVnaXN0ZXJVcmwgPSB0aGlzLmNoZWNraW5nRm9yTWV0YWRhdGFQcm9wZXJ0eShkYXRhLCAncmVnaXN0ZXJVcmwnKSB8fCB0aGlzLnJlZ2lzdGVyVXJsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50KHRoZlBhZ2VMb2dpblJlY292ZXJ5OiBUaGZQYWdlTG9naW5SZWNvdmVyeSkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy50aGZDb21wb25lbnRJbmplY3Rvci5kZXN0cm95Q29tcG9uZW50SW5BcHBsaWNhdGlvbih0aGlzLmNvbXBvbmVudFJlZik7XG4gICAgfVxuXG4gICAgdGhpcy5jb21wb25lbnRSZWYgPSB0aGlzLnRoZkNvbXBvbmVudEluamVjdG9yLmNyZWF0ZUNvbXBvbmVudEluQXBwbGljYXRpb24oVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50KTtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS51cmxSZWNvdmVyeSA9IHRoZlBhZ2VMb2dpblJlY292ZXJ5LnVybDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5jb250YWN0RW1haWwgPSB0aGZQYWdlTG9naW5SZWNvdmVyeS5jb250YWN0TWFpbDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5waG9uZU1hc2sgPSB0aGZQYWdlTG9naW5SZWNvdmVyeS5waG9uZU1hc2s7XG4gICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UudHlwZSA9IHRoZlBhZ2VMb2dpblJlY292ZXJ5LnR5cGUgfHwgVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5FbWFpbDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5vcGVuKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTG9naW5FcnJvcigpIHtcbiAgICBpZiAodGhpcy5sb2dpbkVycm9ycyAmJiB0aGlzLmxvZ2luRXJyb3JzLmxlbmd0aCkge1xuICAgICAgdGhpcy5zZXRMb2dpbkVycm9ycyh0aGlzLmxvZ2luRXJyb3JzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29udHJvbCA9IHRoaXMubG9naW5Gb3JtLmZvcm0uY29udHJvbHNbJ2xvZ2luJ107XG4gICAgICBpZiAoY29udHJvbCkge1xuICAgICAgICB0aGlzLnJlc2V0Q29udHJvbChjb250cm9sKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUGFzc3dvcmRFcnJvcigpIHtcbiAgICBpZiAodGhpcy5wYXNzd29yZEVycm9ycyAmJiB0aGlzLnBhc3N3b3JkRXJyb3JzLmxlbmd0aCkge1xuICAgICAgdGhpcy5zZXRQYXNzd29yZEVycm9ycyh0aGlzLnBhc3N3b3JkRXJyb3JzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29udHJvbCA9IHRoaXMubG9naW5Gb3JtLmZvcm0uY29udHJvbHNbJ3Bhc3N3b3JkJ107XG5cbiAgICAgIGlmIChjb250cm9sKSB7XG4gICAgICAgIHRoaXMucmVzZXRDb250cm9sKGNvbnRyb2wpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRDb250cm9sKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCkge1xuICAgIGNvbnRyb2wubWFya0FzUHJpc3RpbmUoKTtcbiAgICBjb250cm9sLm1hcmtBc1VudG91Y2hlZCgpO1xuICAgIGNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb250cm9sRXJyb3JzKGFsbEVycm9yczogc3RyaW5nLCBjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIGVycm9yczogQXJyYXk8c3RyaW5nPiwgcGF0dGVybkVycm9yOiBzdHJpbmcpIHtcblxuICAgIGlmIChjb250cm9sKSB7XG5cbiAgICAgIHRoaXNbYWxsRXJyb3JzXSA9IGNvbnRyb2wuaGFzRXJyb3IoJ3BhdHRlcm4nKSA/IFsuLi5lcnJvcnMsIC4uLltwYXR0ZXJuRXJyb3JdXSA6IFsuLi5lcnJvcnNdO1xuXG4gICAgICBpZiAoZXJyb3JzICYmIGVycm9ycy5sZW5ndGggJiYgKGNvbnRyb2wudmFsaWQgfHwgY29udHJvbC5wcmlzdGluZSkpIHtcbiAgICAgICAgY29udHJvbC5tYXJrQXNUb3VjaGVkKCk7XG4gICAgICAgIGNvbnRyb2wubWFya0FzRGlydHkoKTtcbiAgICAgICAgY29udHJvbC5zZXRFcnJvcnModGhpcy5jdXN0b21QYXNzd29yZEVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIHByaXZhdGUgc2V0VXJsUmVkaXJlY3QodXJsKSB7XG4gICAgaXNFeHRlcm5hbExpbmsodXJsKSA/ICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKSA6IHRoaXMucm91dGVyLm5hdmlnYXRlKFt1cmxdKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVBcnJheUNoYW5nZXMoZGlmZmVyOiBhbnksIGFycmF5OiBBcnJheTx7IGFycmF5OiBBcnJheTxhbnk+LCBjYWxsYmFjazogYW55IH0+KSB7XG5cbiAgICBhcnJheS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgY29uc3QgY2hhbmdlcyA9IGRpZmZlci5kaWZmKGVsZW1lbnQuYXJyYXkpO1xuICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgZWxlbWVudC5jYWxsYmFjaygpO1xuICAgICAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvcGVuVXJsKHJlY292ZXJ5OiBhbnkpOiB2b2lkIHtcbiAgICBzd2l0Y2ggKHR5cGVvZiByZWNvdmVyeSkge1xuICAgICAgY2FzZSAnc3RyaW5nJzoge1xuICAgICAgICB0aGlzLnNldFVybFJlZGlyZWN0KHJlY292ZXJ5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdmdW5jdGlvbic6IHtcbiAgICAgICAgcmVjb3ZlcnkoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdvYmplY3QnOiB7XG4gICAgICAgIHRoaXMuY3JlYXRlTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50KHJlY292ZXJ5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHNldExvZ2luRXJyb3JzKGVycm9yczogQXJyYXk8c3RyaW5nPikge1xuICAgIGNvbnN0IGNvbnRyb2wgPSB0aGlzLmxvZ2luRm9ybS5mb3JtLmNvbnRyb2xzWydsb2dpbiddO1xuICAgIHRoaXMuc2V0Q29udHJvbEVycm9ycygnYWxsTG9naW5FcnJvcnMnLCBjb250cm9sLCBlcnJvcnMsIHRoaXMubGl0ZXJhbHMubG9naW5FcnJvclBhdHRlcm4pO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldFBhc3N3b3JkRXJyb3JzKGVycm9yczogQXJyYXk8c3RyaW5nPikge1xuICAgIGNvbnN0IGNvbnRyb2wgPSB0aGlzLmxvZ2luRm9ybS5mb3JtLmNvbnRyb2xzWydwYXNzd29yZCddO1xuICAgIHRoaXMuc2V0Q29udHJvbEVycm9ycygnYWxsUGFzc3dvcmRFcnJvcnMnLCBjb250cm9sLCBlcnJvcnMsIHRoaXMubGl0ZXJhbHMucGFzc3dvcmRFcnJvclBhdHRlcm4pO1xuICB9XG5cbiAgb25TZWxlY3RlZExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNlbGVjdGVkTGFuZ3VhZ2UgPSBsYW5ndWFnZTtcbiAgICB0aGlzLmdldExpdGVyYWxzKGxhbmd1YWdlLCB0aGlzLmNvbnRhaW5zQ3VzdG9tTGl0ZXJhbHMgPyB0aGlzLmN1c3RvbWl6ZWREZWZhdWx0TGl0ZXJhbHMgOiB1bmRlZmluZWQpO1xuICAgIHRoaXMuc2V0VGl0bGVMaXRlcmFsKGxhbmd1YWdlLCB0aGlzLnByb2R1Y3ROYW1lKTtcbiAgICB0aGlzLnNldExvZ2luSGludExpdGVyYWwobGFuZ3VhZ2UsIHRoaXMuY29udGFjdEVtYWlsKTtcbiAgfVxuXG59XG4iXX0=