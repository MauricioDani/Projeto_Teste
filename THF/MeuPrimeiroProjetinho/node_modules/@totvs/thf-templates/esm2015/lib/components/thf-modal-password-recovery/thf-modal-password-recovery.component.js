/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild } from '@angular/core';
import { NgForm } from '@angular/forms';
import { Router } from '@angular/router';
import { isExternalLink } from '../../utils/util';
import { ThfI18nPipe, ThfModalComponent } from '@totvs/thf-ui';
import { ThfModalPasswordRecoveryBaseComponent } from './thf-modal-password-recovery-base.component';
import { ThfModalPasswordRecoveryModalContent } from './enums/thf-modal-password-recovery-modal-content.enum';
import { ThfModalPasswordRecoveryService } from './thf-modal-password-recovery.service';
import { ThfModalPasswordRecoveryType } from './enums/thf-modal-password-recovery-type.enum';
/**
 * \@docsExtends ThfModalPasswordRecoveryBaseComponent
 *
 * \@example
 *
 * <example name="thf-modal-password-recovery-basic" title="Totvs Modal Password Recovery Basic">
 *  <file name="sample-thf-modal-password-recovery-basic/sample-thf-modal-password-recovery-basic.component.html"> </file>
 *  <file name="sample-thf-modal-password-recovery-basic/sample-thf-modal-password-recovery-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-modal-password-recovery-labs" title="Totvs Modal Password Recovery Labs">
 *  <file name="sample-thf-modal-password-recovery-labs/sample-thf-modal-password-recovery-labs.component.html"> </file>
 *  <file name="sample-thf-modal-password-recovery-labs/sample-thf-modal-password-recovery-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-modal-password-recovery-request" title="Totvs Modal Password Recovery Request">
 *  <file name="sample-thf-modal-password-recovery-request/sample-thf-modal-password-recovery-request.component.html"> </file>
 *  <file name="sample-thf-modal-password-recovery-request/sample-thf-modal-password-recovery-request.component.ts"> </file>
 * </example>
 */
export class ThfModalPasswordRecoveryComponent extends ThfModalPasswordRecoveryBaseComponent {
    /**
     * @param {?} router
     * @param {?} thfI18nPipe
     * @param {?} thfModalPasswordRecoveryService
     */
    constructor(router, thfI18nPipe, thfModalPasswordRecoveryService) {
        super();
        this.router = router;
        this.thfI18nPipe = thfI18nPipe;
        this.thfModalPasswordRecoveryService = thfModalPasswordRecoveryService;
        this.chosenTypeFormOption = ThfModalPasswordRecoveryType.Email;
        this.codeMask = '9 9 9 9 9 9';
        this.emailModal = true;
        this.emailModalPhrases = {};
        this.endpoint = '.';
        this.invalidCode = false;
        this.invalidEmail = false;
        this.modalType = ThfModalPasswordRecoveryModalContent.Email;
        this.submittedCodeValue = (/** @type {?} */ ({}));
        this.submittedContactValue = (/** @type {?} */ ({}));
        this.primaryAction = { label: undefined, action: (/**
             * @return {?}
             */
            () => { }) };
        this.secondaryAction = { label: undefined, action: (/**
             * @return {?}
             */
            () => { }) };
        this.typeFormOptions = [
            { label: 'e-mail', value: ThfModalPasswordRecoveryType.Email },
            { label: 'SMS', value: ThfModalPasswordRecoveryType.SMS }
        ];
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.passwordRecoverySubscription) {
            this.passwordRecoverySubscription.unsubscribe();
        }
        if (this.smsCodeSubscription) {
            this.smsCodeSubscription.unsubscribe();
        }
    }
    /**
     * @return {?}
     */
    completed() {
        this.cancelAction();
    }
    /**
     * @param {?} form
     * @return {?}
     */
    formModelChangesCheck(form) {
        /** @type {?} */
        const invalidForm = form.invalid;
        this.invalidEmail = invalidForm && form.dirty;
        this.primaryAction.disabled = invalidForm;
        if (this.modalType === ThfModalPasswordRecoveryModalContent.SMSCode) {
            /** @type {?} */
            const codeError = this.codeError !== undefined && this.codeError !== '';
            this.showCustomCodeError = codeError && form.pristine;
        }
    }
    /**
     * @param {?} type
     * @return {?}
     */
    getInputType(type) {
        this.type = type;
        this.pipeModalPhrases();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.control = this.emailForm.controls[type];
            this.formModelChangesCheck(this.emailForm);
            this.resetFormFields(this.control);
        }));
    }
    /**
     * @return {?}
     */
    open() {
        /** @type {?} */
        const control = this.checkFormType(this.type);
        this.control = this.emailForm.controls[control];
        this.setEmailModalPhrasesAndActions();
        this.formModelChangesCheck(this.emailForm);
        this.recoveryModalElement.open();
    }
    /**
     * @return {?}
     */
    openConfirmation() {
        this.modalTitle = this.literals.emailSentTitle;
        this.modalType = ThfModalPasswordRecoveryModalContent.Confirmation;
        this.setActions(this.cancelAction, this.literals.closeButton, this.submitAction, this.literals.resendEmailButton, false);
    }
    /**
     * @return {?}
     */
    openSmsCode() {
        this.modalTitle = this.literals.typeCodeTitle;
        this.modalType = ThfModalPasswordRecoveryModalContent.SMSCode;
        this.setActions(this.submitSmsCodeAction, this.literals.continueButton, this.cancelAction, this.literals.cancelButton, true);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.control = this.smsCodeForm.controls['sms'];
            this.formModelChangesCheck(this.smsCodeForm);
        }));
    }
    /**
     * @return {?}
     */
    resendSmsCode() {
        this.incrementRetryAttempts();
        if (this.urlRecovery) {
            this.submitActionRequest(this.submittedContactValue, this.type);
        }
        else {
            this.submit.emit(this.submittedContactValue);
        }
    }
    /**
     * @private
     * @param {?} responseObj
     * @return {?}
     */
    assignSmsResponse(responseObj) {
        this.smsBodyResponse = Object.assign({}, { hash: responseObj.hash });
        if (responseObj.urlValidationCode) {
            this.smsBodyResponse = Object.assign(this.smsBodyResponse, { urlValidationCode: responseObj.urlValidationCode });
        }
    }
    /**
     * @private
     * @return {?}
     */
    cancelAction() {
        this.resetFormFields(this.control);
        this.submittedContactValue = {};
        this.chosenTypeFormOption = ThfModalPasswordRecoveryType.Email;
        this.modalType = ThfModalPasswordRecoveryModalContent.Email;
        this.type = this.modalPasswordRecoveryTypeAll ? ThfModalPasswordRecoveryType.All : this.type;
        this.recoveryModalElement.close();
    }
    /**
     * @private
     * @param {?} type
     * @return {?}
     */
    checkFormType(type) {
        return type !== ThfModalPasswordRecoveryType.All ? type : ThfModalPasswordRecoveryType.Email;
    }
    /**
     * @private
     * @param {?} control
     * @return {?}
     */
    formReset(control) {
        control.markAsPristine();
        control.markAsUntouched();
        control.updateValueAndValidity();
    }
    /**
     * @private
     * @param {?} type
     * @return {?}
     */
    getEmitValue(type) {
        return type === ThfModalPasswordRecoveryType.SMS ? this.phone : this.email;
    }
    /**
     * @private
     * @return {?}
     */
    incrementRetryAttempts() {
        this.submittedContactValue.retry = (this.submittedContactValue.retry + 1 || 1);
    }
    /**
     * @private
     * @param {?} url
     * @param {?} queryParam
     * @return {?}
     */
    openExternalLink(url, queryParam) {
        window.open(`${url}?token=${queryParam}`, '_self');
    }
    /**
     * @private
     * @param {?} url
     * @param {?} endpoint
     * @param {?} queryParam
     * @return {?}
     */
    openInternalLink(url, endpoint, queryParam) {
        this.router.navigate([`${url}/${endpoint}`], { queryParams: { token: queryParam } });
    }
    /**
     * @private
     * @return {?}
     */
    pipeModalPhrases() {
        if (this.type === ThfModalPasswordRecoveryType.SMS) {
            this.emailModalPhrases['firstPhrase'] = this.setPipeArguments(this.literals.recoveryPasswordPhrase, this.literals.sms);
            this.emailModalPhrases['secondPhrase'] = this.setPipeArguments(this.literals.supportContact, this.literals.telephone);
        }
        else {
            this.emailModalPhrases['firstPhrase'] = this.setPipeArguments(this.literals.recoveryPasswordPhrase, this.literals.email);
            this.emailModalPhrases['secondPhrase'] = this.setPipeArguments(this.literals.supportContact, this.literals.email);
        }
    }
    /**
     * @private
     * @param {?} recoveryToken
     * @return {?}
     */
    redirectToChangePassword(recoveryToken) {
        /** @type {?} */
        const urlChangePassword = recoveryToken.urlChangePassword;
        if (urlChangePassword) {
            isExternalLink(urlChangePassword) ?
                this.openExternalLink(urlChangePassword, recoveryToken.token) :
                this.openInternalLink(this.urlRecovery, urlChangePassword, recoveryToken.token);
        }
        else {
            /** @type {?} */
            const changePasswordEndpoint = 'changePassword';
            this.openInternalLink(this.urlRecovery, changePasswordEndpoint, recoveryToken.token);
        }
    }
    /**
     * @private
     * @param {?} control
     * @return {?}
     */
    resetFormFields(control) {
        this.formReset(control);
        this.email = undefined;
        this.phone = undefined;
        this.smsCode = undefined;
    }
    /**
     * @private
     * @param {?} primaryAction
     * @param {?} primarylabel
     * @param {?} secondaryAction
     * @param {?} secondaryLabel
     * @param {?} disabled
     * @return {?}
     */
    setActions(primaryAction, primarylabel, secondaryAction, secondaryLabel, disabled) {
        this.primaryAction.action = (/**
         * @return {?}
         */
        () => primaryAction.call(this));
        this.primaryAction.label = primarylabel;
        this.secondaryAction.action = (/**
         * @return {?}
         */
        () => secondaryAction.call(this));
        this.secondaryAction.label = secondaryLabel;
        this.primaryAction.disabled = disabled;
    }
    /**
     * @private
     * @return {?}
     */
    setEmailModalPhrasesAndActions() {
        this.modalTitle = this.literals.forgotPasswordTitle;
        this.pipeModalPhrases();
        this.modalPasswordRecoveryTypeAll = this.type === ThfModalPasswordRecoveryType.All;
        this.setActions(this.submitAction, this.literals.sendButton, this.cancelAction, this.literals.cancelButton, true);
    }
    /**
     * @private
     * @param {?=} urlValidationCode
     * @return {?}
     */
    setRequestEndpoint(urlValidationCode) {
        /** @type {?} */
        const endpoint = urlValidationCode || 'validation';
        return `${this.urlRecovery}/${endpoint}`;
    }
    /**
     * @private
     * @param {?} literalAttr
     * @param {?} arg
     * @return {?}
     */
    setPipeArguments(literalAttr, arg) {
        return this.thfI18nPipe.transform(literalAttr, arg);
    }
    /**
     * @private
     * @return {?}
     */
    submitAction() {
        this.modalType === ThfModalPasswordRecoveryModalContent.Confirmation ? this.incrementRetryAttempts() : this.formReset(this.control);
        this.submittedContactValue[this.checkFormType(this.type)] = this.getEmitValue(this.type);
        if (this.urlRecovery) {
            this.submitActionRequest(this.submittedContactValue, this.type);
        }
        else {
            this.submit.emit(this.submittedContactValue);
        }
    }
    /**
     * @private
     * @param {?} data
     * @param {?} modalType
     * @return {?}
     */
    submitActionRequest(data, modalType) {
        /** @type {?} */
        const params = modalType === ThfModalPasswordRecoveryType.SMS ? { type: 'sms' } : undefined;
        this.passwordRecoverySubscription =
            this.thfModalPasswordRecoveryService.post(this.urlRecovery, data, params)
                .subscribe((/**
             * @param {?} response
             * @return {?}
             */
            response => {
                if ((modalType === ThfModalPasswordRecoveryType.Email || modalType === ThfModalPasswordRecoveryType.All) && response.status === 204) {
                    this.openConfirmation();
                }
                else if (modalType === ThfModalPasswordRecoveryType.SMS && response.status === 200) {
                    this.assignSmsResponse(response.body);
                    this.openSmsCode();
                }
            }));
    }
    /**
     * @private
     * @return {?}
     */
    submitSmsCodeAction() {
        this.submittedCodeValue.code = this.smsCode;
        if (this.urlRecovery) {
            this.submittedCodeValue = Object.assign(this.submittedCodeValue, { hash: this.smsBodyResponse.hash });
            this.submitSmsCodeRequest(this.submittedCodeValue);
        }
        else {
            this.codeSubmit.emit(this.submittedCodeValue);
        }
        this.resetFormFields(this.control);
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    submitSmsCodeRequest(data) {
        this.smsCodeSubscription = this.thfModalPasswordRecoveryService
            .post(this.setRequestEndpoint(this.smsBodyResponse.urlValidationCode), data)
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            /** @type {?} */
            const successStatus = response.status === 200;
            if (successStatus) {
                this.completed();
                this.redirectToChangePassword(response.body);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.codeError = error.error.message;
            this.openSmsCode();
        }));
    }
}
ThfModalPasswordRecoveryComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-modal-password-recovery',
                template: "<thf-modal #recoveryModal\n  t-hide-close\n  t-size=\"auto\"\n  [ngSwitch]=\"modalType\"\n  [t-primary-action]=\"primaryAction\"\n  [t-secondary-action]=\"secondaryAction\"\n  [t-title]=\"modalTitle\"> \n  <div class=\"thf-modal-password-recovery-wrapper\">\n    <div *ngSwitchCase=\"'email'\" class=\"thf-modal-password-recovery-content thf-row\">\n      <div class=\"thf-modal-password-recovery-text thf-md-12 thf-mb-1\">\n        {{ emailModalPhrases.firstPhrase }}\n      </div>\n      <div class=\"thf-mb-2 thf-md-12\">\n        <form #emailForm=\"ngForm\">\n\n          <div *ngIf=\"modalPasswordRecoveryTypeAll\">\n            <thf-radio-group \n              name=\"type\"\n              [(ngModel)]=\"chosenTypeFormOption\"\n              [t-options]=\"typeFormOptions\"\n              (t-change)=\"getInputType($event)\">\n            </thf-radio-group>\n          </div>\n\n          <div class=\"thf-mt-1\">\n            <thf-email *ngIf=\"type === 'email' || type === 'all'\"\n              name=\"email\"\n              [(ngModel)]=\"email\"\n              t-required\n              [t-label]=\"literals.insertEmail\"\n              (t-change-model)=\"formModelChangesCheck(emailForm)\">\n            </thf-email>\n    \n            <thf-input *ngIf=\"type === 'sms'\"\n              name=\"sms\"\n              [(ngModel)]=\"phone\"\n              t-icon=\"thf-icon-telephone\"\n              t-required\n              [t-label]=\"literals.insertPhone\"\n              [t-mask]=\"phoneMask\"\n              [t-maxlength]=\"maxLength\"\n              [t-minlength]=\"minLength\"\n              (t-change-model)=\"formModelChangesCheck(emailForm)\">\n            </thf-input>\n          </div>\n          \n          <div class=\"thf-field-container-bottom thf-field-container-error-container\">\n            <thf-modal-password-recovery-error-message *ngIf=\"invalidEmail && control.dirty\" \n              [t-text]=\"type === 'sms' ? literals.phoneErrorMessagePhrase : literals.emailErrorMessagePhrase\">\n            </thf-modal-password-recovery-error-message>\n          </div>\n        </form>\n      </div>\n      <div class=\"thf-modal-password-recovery-text thf-md-12\">{{ emailModalPhrases.secondPhrase }}<span *ngIf=\"contactEmail\">\n        {{ literals.prepositionIn }} \n          <a class=\"thf-modal-password-recovery-link\" href=\"mailto:{{ contactEmail }}\" target=\"_self\">{{ contactEmail }}</a>\n        </span>{{ endpoint }}\n      </div>\n    </div>\n\n    <div #smsCodeModal *ngSwitchCase=\"'smsCode'\" class=\"thf-modal-password-recovery-content thf-row\">\n      <div class=\"thf-modal-password-recovery-text thf-md-12 thf-mb-1\">{{ literals.sentSmsCodePhrase }}</div>\n      <div class=\"thf-mb-2 thf-md-12\">\n        <form #smsCodeForm=\"ngForm\">\n          <thf-input\n            name=\"sms\"\n            [(ngModel)]=\"smsCode\"\n            t-maxlength=\"11\"\n            t-minlength=\"11\"\n            t-required\n            [t-label]=\"literals.insertCode\"\n            [t-mask]=\"codeMask\"\n            (t-change-model)=\"formModelChangesCheck(smsCodeForm)\">\n          </thf-input>\n          <div class=\"thf-field-container-bottom thf-field-container-error-container\">\n            <thf-modal-password-recovery-error-message *ngIf=\"invalidEmail\"\n              [t-text]=\"smsCodeErrorMessage || this.literals.smsCodeErrorMessagePhrase\">\n            </thf-modal-password-recovery-error-message>\n            <thf-modal-password-recovery-error-message *ngIf=\"showCustomCodeError\"\n              [t-text]=\"codeError\">\n            </thf-modal-password-recovery-error-message>\n          </div>\n        </form>\n      </div>\n      <div class=\"thf-modal-password-recovery-text thf-md-12\">\n        {{ literals.sendAgainPhrase }} \n        <span class=\"thf-modal-password-recovery-link\" (click)=\"resendSmsCode()\">{{ literals.sendAgain }}</span>\n      </div>\n    </div>\n    \n    <div #confirmationModal *ngSwitchCase=\"'confirmation'\" class=\"thf-modal-password-recovery-content thf-row\">\n      <img \n        class=\"thf-modal-password-recovery-user-image thf-mb-2\" \n        src=\"./assets/images/email-sent.svg\"> \n      <div class=\"thf-modal-password-recovery-text\">\n        {{ literals.emailSentConfirmationPhrase }}\n      </div>\n    </div>\n  </div>\n</thf-modal>\n"
            }] }
];
/** @nocollapse */
ThfModalPasswordRecoveryComponent.ctorParameters = () => [
    { type: Router },
    { type: ThfI18nPipe },
    { type: ThfModalPasswordRecoveryService }
];
ThfModalPasswordRecoveryComponent.propDecorators = {
    emailForm: [{ type: ViewChild, args: ['emailForm', { static: false },] }],
    recoveryModalElement: [{ type: ViewChild, args: ['recoveryModal', { static: true },] }],
    smsCodeForm: [{ type: ViewChild, args: ['smsCodeForm', { static: false },] }]
};
if (false) {
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.chosenTypeFormOption;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.codeMask;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.control;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.emailModal;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.emailModalPhrases;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.endpoint;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.invalidCode;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.invalidEmail;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.modalTitle;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.modalType;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.showCustomCodeError;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.smsCodeErrorMessagePhrase;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.submittedCodeValue;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.submittedContactValue;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.passwordRecoverySubscription;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.smsBodyResponse;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.smsCodeSubscription;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.emailForm;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.recoveryModalElement;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.smsCodeForm;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.primaryAction;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.secondaryAction;
    /** @type {?} */
    ThfModalPasswordRecoveryComponent.prototype.typeFormOptions;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.thfI18nPipe;
    /**
     * @type {?}
     * @private
     */
    ThfModalPasswordRecoveryComponent.prototype.thfModalPasswordRecoveryService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0b3R2cy90aGYtdGVtcGxhdGVzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5L3RoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWEsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hFLE9BQU8sRUFBbUIsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBR3pDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFrQixpQkFBaUIsRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFHcEcsT0FBTyxFQUFFLHFDQUFxQyxFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDckcsT0FBTyxFQUFFLG9DQUFvQyxFQUFFLE1BQU0sd0RBQXdELENBQUM7QUFDOUcsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDeEYsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sK0NBQStDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCN0YsTUFBTSxPQUFPLGlDQUFrQyxTQUFRLHFDQUFxQzs7Ozs7O0lBb0MxRixZQUNVLE1BQWMsRUFDZCxXQUF3QixFQUN4QiwrQkFBZ0U7UUFFeEUsS0FBSyxFQUFFLENBQUM7UUFKQSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsb0NBQStCLEdBQS9CLCtCQUErQixDQUFpQztRQXJDMUUseUJBQW9CLEdBQVcsNEJBQTRCLENBQUMsS0FBSyxDQUFDO1FBQ2xFLGFB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QTBDOztJQUUxQyxzREFBNkQ7O0lBRTdELGlFQUFzRjs7SUFFdEYsd0RBQWlFOztJQUVqRSwwREFBd0U7O0lBRXhFLDREQUEwRTs7SUFFMUUsNERBR0U7Ozs7O0lBR0EsbURBQXNCOzs7OztJQUN0Qix3REFBZ0M7Ozs7O0lBQ2hDLDRFQUF3RSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBpc0V4dGVybmFsTGluayB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgVGhmSTE4blBpcGUsIFRoZk1vZGFsQWN0aW9uLCBUaGZNb2RhbENvbXBvbmVudCwgVGhmUmFkaW9Hcm91cE9wdGlvbiB9IGZyb20gJ0B0b3R2cy90aGYtdWknO1xuXG5pbXBvcnQgeyBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnkgfSBmcm9tICcuL2ludGVyZmFjZXMvdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50IH0gZnJvbSAnLi9lbnVtcy90aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktbW9kYWwtY29udGVudC5lbnVtJztcbmltcG9ydCB7IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVNlcnZpY2UgfSBmcm9tICcuL3RoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS5zZXJ2aWNlJztcbmltcG9ydCB7IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUgfSBmcm9tICcuL2VudW1zL3RoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS10eXBlLmVudW0nO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBNb2RhbCBQYXNzd29yZCBSZWNvdmVyeSBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljL3NhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljL3NhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWxhYnNcIiB0aXRsZT1cIlRvdHZzIE1vZGFsIFBhc3N3b3JkIFJlY292ZXJ5IExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1sYWJzL3NhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktbGFicy9zYW1wbGUtdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LXJlcXVlc3RcIiB0aXRsZT1cIlRvdHZzIE1vZGFsIFBhc3N3b3JkIFJlY292ZXJ5IFJlcXVlc3RcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1yZXF1ZXN0L3NhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktcmVxdWVzdC5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktcmVxdWVzdC9zYW1wbGUtdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LXJlcXVlc3QuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnknLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LmNvbXBvbmVudC5odG1sJ1xufSlcblxuZXhwb3J0IGNsYXNzIFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeUNvbXBvbmVudCBleHRlbmRzIFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIGNob3NlblR5cGVGb3JtT3B0aW9uOiBzdHJpbmcgPSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkVtYWlsO1xuICBjb2RlTWFzazogc3RyaW5nID0gJzkgOSA5IDkgOSA5JztcbiAgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xuICBlbWFpbE1vZGFsOiBib29sZWFuID0gdHJ1ZTtcbiAgZW1haWxNb2RhbFBocmFzZXMgPSB7fTtcbiAgZW5kcG9pbnQ6IHN0cmluZyA9ICcuJztcbiAgaW52YWxpZENvZGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgaW52YWxpZEVtYWlsOiBib29sZWFuID0gZmFsc2U7XG4gIG1vZGFsVGl0bGU6IHN0cmluZztcbiAgbW9kYWxUeXBlOiBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQgPSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQuRW1haWw7XG4gIHNob3dDdXN0b21Db2RlRXJyb3I6IGJvb2xlYW47XG4gIHNtc0NvZGVFcnJvck1lc3NhZ2VQaHJhc2U6IHN0cmluZztcbiAgc3VibWl0dGVkQ29kZVZhbHVlID0ge30gYXMgVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5O1xuICBzdWJtaXR0ZWRDb250YWN0VmFsdWUgPSB7fSBhcyBUaGZNb2RhbFBhc3N3b3JkUmVjb3Zlcnk7XG5cbiAgcHJpdmF0ZSBwYXNzd29yZFJlY292ZXJ5U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgc21zQm9keVJlc3BvbnNlO1xuICBwcml2YXRlIHNtc0NvZGVTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBAVmlld0NoaWxkKCdlbWFpbEZvcm0nLCB7IHN0YXRpYzogZmFsc2UgfSkgZW1haWxGb3JtOiBOZ0Zvcm07XG5cbiAgQFZpZXdDaGlsZCgncmVjb3ZlcnlNb2RhbCcsIHsgc3RhdGljOiB0cnVlIH0pIHJlY292ZXJ5TW9kYWxFbGVtZW50OiBUaGZNb2RhbENvbXBvbmVudDtcblxuICBAVmlld0NoaWxkKCdzbXNDb2RlRm9ybScsIHsgc3RhdGljOiBmYWxzZSB9KSBzbXNDb2RlRm9ybTogTmdGb3JtO1xuXG4gIHByaW1hcnlBY3Rpb246IFRoZk1vZGFsQWN0aW9uID0geyBsYWJlbDogdW5kZWZpbmVkLCBhY3Rpb246ICgpID0+IHsgfSB9O1xuXG4gIHNlY29uZGFyeUFjdGlvbjogVGhmTW9kYWxBY3Rpb24gPSB7IGxhYmVsOiB1bmRlZmluZWQsIGFjdGlvbjogKCkgPT4geyB9IH07XG5cbiAgdHlwZUZvcm1PcHRpb25zOiBBcnJheTxUaGZSYWRpb0dyb3VwT3B0aW9uPiA9IFtcbiAgICB7IGxhYmVsOiAnZS1tYWlsJywgdmFsdWU6IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuRW1haWwgfSxcbiAgICB7IGxhYmVsOiAnU01TJywgdmFsdWU6IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuU01TIH1cbiAgXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgdGhmSTE4blBpcGU6IFRoZkkxOG5QaXBlLFxuICAgIHByaXZhdGUgdGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5U2VydmljZTogVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5U2VydmljZVxuICAgICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5wYXNzd29yZFJlY292ZXJ5U3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnBhc3N3b3JkUmVjb3ZlcnlTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zbXNDb2RlU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnNtc0NvZGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBjb21wbGV0ZWQoKSB7XG4gICAgdGhpcy5jYW5jZWxBY3Rpb24oKTtcbiAgfVxuXG4gIGZvcm1Nb2RlbENoYW5nZXNDaGVjayhmb3JtOiBOZ0Zvcm0pIHtcbiAgICBjb25zdCBpbnZhbGlkRm9ybSA9IGZvcm0uaW52YWxpZDtcbiAgICB0aGlzLmludmFsaWRFbWFpbCA9IGludmFsaWRGb3JtICYmIGZvcm0uZGlydHk7XG4gICAgdGhpcy5wcmltYXJ5QWN0aW9uLmRpc2FibGVkID0gaW52YWxpZEZvcm07XG5cbiAgICBpZiAodGhpcy5tb2RhbFR5cGUgPT09IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeU1vZGFsQ29udGVudC5TTVNDb2RlKSB7XG4gICAgICBjb25zdCBjb2RlRXJyb3I6IGJvb2xlYW4gPSB0aGlzLmNvZGVFcnJvciAhPT0gdW5kZWZpbmVkICYmIHRoaXMuY29kZUVycm9yICE9PSAnJztcbiAgICAgIHRoaXMuc2hvd0N1c3RvbUNvZGVFcnJvciA9IGNvZGVFcnJvciAmJiBmb3JtLnByaXN0aW5lO1xuICAgIH1cbiAgfVxuXG4gIGdldElucHV0VHlwZSh0eXBlKSB7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLnBpcGVNb2RhbFBocmFzZXMoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuY29udHJvbCA9IHRoaXMuZW1haWxGb3JtLmNvbnRyb2xzW3R5cGVdO1xuICAgICAgdGhpcy5mb3JtTW9kZWxDaGFuZ2VzQ2hlY2sodGhpcy5lbWFpbEZvcm0pO1xuICAgICAgdGhpcy5yZXNldEZvcm1GaWVsZHModGhpcy5jb250cm9sKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgY29uc3QgY29udHJvbCA9IHRoaXMuY2hlY2tGb3JtVHlwZSh0aGlzLnR5cGUpO1xuICAgIHRoaXMuY29udHJvbCA9IHRoaXMuZW1haWxGb3JtLmNvbnRyb2xzW2NvbnRyb2xdO1xuICAgIHRoaXMuc2V0RW1haWxNb2RhbFBocmFzZXNBbmRBY3Rpb25zKCk7XG4gICAgdGhpcy5mb3JtTW9kZWxDaGFuZ2VzQ2hlY2sodGhpcy5lbWFpbEZvcm0pO1xuICAgIHRoaXMucmVjb3ZlcnlNb2RhbEVsZW1lbnQub3BlbigpO1xuICB9XG5cbiAgb3BlbkNvbmZpcm1hdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsVGl0bGUgPSB0aGlzLmxpdGVyYWxzLmVtYWlsU2VudFRpdGxlO1xuICAgIHRoaXMubW9kYWxUeXBlID0gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50LkNvbmZpcm1hdGlvbjtcbiAgICB0aGlzLnNldEFjdGlvbnModGhpcy5jYW5jZWxBY3Rpb24sIHRoaXMubGl0ZXJhbHMuY2xvc2VCdXR0b24sIHRoaXMuc3VibWl0QWN0aW9uLCB0aGlzLmxpdGVyYWxzLnJlc2VuZEVtYWlsQnV0dG9uLCBmYWxzZSk7XG4gIH1cblxuICBvcGVuU21zQ29kZSgpIHtcbiAgICB0aGlzLm1vZGFsVGl0bGUgPSB0aGlzLmxpdGVyYWxzLnR5cGVDb2RlVGl0bGU7XG4gICAgdGhpcy5tb2RhbFR5cGUgPSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQuU01TQ29kZTtcbiAgICB0aGlzLnNldEFjdGlvbnModGhpcy5zdWJtaXRTbXNDb2RlQWN0aW9uLCB0aGlzLmxpdGVyYWxzLmNvbnRpbnVlQnV0dG9uLCB0aGlzLmNhbmNlbEFjdGlvbiwgdGhpcy5saXRlcmFscy5jYW5jZWxCdXR0b24sIHRydWUpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRyb2wgPSB0aGlzLnNtc0NvZGVGb3JtLmNvbnRyb2xzWydzbXMnXTtcbiAgICAgIHRoaXMuZm9ybU1vZGVsQ2hhbmdlc0NoZWNrKHRoaXMuc21zQ29kZUZvcm0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZW5kU21zQ29kZSgpIHtcbiAgICB0aGlzLmluY3JlbWVudFJldHJ5QXR0ZW1wdHMoKTtcbiAgICBpZiAodGhpcy51cmxSZWNvdmVyeSkge1xuICAgICAgdGhpcy5zdWJtaXRBY3Rpb25SZXF1ZXN0KHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlLCB0aGlzLnR5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN1Ym1pdC5lbWl0KHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzc2lnblNtc1Jlc3BvbnNlKHJlc3BvbnNlT2JqKSB7XG4gICAgdGhpcy5zbXNCb2R5UmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHt9LCB7aGFzaDogcmVzcG9uc2VPYmouaGFzaH0pO1xuICAgIGlmIChyZXNwb25zZU9iai51cmxWYWxpZGF0aW9uQ29kZSkge1xuICAgICAgdGhpcy5zbXNCb2R5UmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHRoaXMuc21zQm9keVJlc3BvbnNlLCB7dXJsVmFsaWRhdGlvbkNvZGU6IHJlc3BvbnNlT2JqLnVybFZhbGlkYXRpb25Db2RlfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYW5jZWxBY3Rpb24oKSB7XG4gICAgdGhpcy5yZXNldEZvcm1GaWVsZHModGhpcy5jb250cm9sKTtcbiAgICB0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZSA9IHt9O1xuXG4gICAgdGhpcy5jaG9zZW5UeXBlRm9ybU9wdGlvbiA9IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuRW1haWw7XG4gICAgdGhpcy5tb2RhbFR5cGUgPSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQuRW1haWw7XG4gICAgdGhpcy50eXBlID0gdGhpcy5tb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlQWxsID8gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGwgOiB0aGlzLnR5cGU7XG4gICAgdGhpcy5yZWNvdmVyeU1vZGFsRWxlbWVudC5jbG9zZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0Zvcm1UeXBlKHR5cGU6IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSAhPT0gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGwgPyB0eXBlIDogVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5FbWFpbDtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybVJlc2V0KGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCkge1xuICAgIGNvbnRyb2wubWFya0FzUHJpc3RpbmUoKTtcbiAgICBjb250cm9sLm1hcmtBc1VudG91Y2hlZCgpO1xuICAgIGNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFbWl0VmFsdWUodHlwZTogVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLlNNUyA/IHRoaXMucGhvbmUgOiB0aGlzLmVtYWlsO1xuICB9XG5cbiAgcHJpdmF0ZSBpbmNyZW1lbnRSZXRyeUF0dGVtcHRzKCkge1xuICAgIHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlLnJldHJ5ID0gKHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlLnJldHJ5ICsgMSB8fCAxKTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbkV4dGVybmFsTGluayh1cmwsIHF1ZXJ5UGFyYW0pIHtcbiAgICB3aW5kb3cub3BlbihgJHt1cmx9P3Rva2VuPSR7cXVlcnlQYXJhbX1gLCAnX3NlbGYnKTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbkludGVybmFsTGluayh1cmwsIGVuZHBvaW50LCBxdWVyeVBhcmFtKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW2Ake3VybH0vJHtlbmRwb2ludH1gXSwgeyBxdWVyeVBhcmFtczogeyB0b2tlbjogcXVlcnlQYXJhbSB9IH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwaXBlTW9kYWxQaHJhc2VzKCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuU01TKSB7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzWydmaXJzdFBocmFzZSddID0gdGhpcy5zZXRQaXBlQXJndW1lbnRzKHRoaXMubGl0ZXJhbHMucmVjb3ZlcnlQYXNzd29yZFBocmFzZSwgdGhpcy5saXRlcmFscy5zbXMpO1xuICAgICAgdGhpcy5lbWFpbE1vZGFsUGhyYXNlc1snc2Vjb25kUGhyYXNlJ10gPSB0aGlzLnNldFBpcGVBcmd1bWVudHModGhpcy5saXRlcmFscy5zdXBwb3J0Q29udGFjdCwgdGhpcy5saXRlcmFscy50ZWxlcGhvbmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzWydmaXJzdFBocmFzZSddID0gdGhpcy5zZXRQaXBlQXJndW1lbnRzKHRoaXMubGl0ZXJhbHMucmVjb3ZlcnlQYXNzd29yZFBocmFzZSwgdGhpcy5saXRlcmFscy5lbWFpbCk7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzWydzZWNvbmRQaHJhc2UnXSA9IHRoaXMuc2V0UGlwZUFyZ3VtZW50cyh0aGlzLmxpdGVyYWxzLnN1cHBvcnRDb250YWN0LCB0aGlzLmxpdGVyYWxzLmVtYWlsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZGlyZWN0VG9DaGFuZ2VQYXNzd29yZChyZWNvdmVyeVRva2VuOiBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnkpIHtcbiAgICBjb25zdCB1cmxDaGFuZ2VQYXNzd29yZCA9IHJlY292ZXJ5VG9rZW4udXJsQ2hhbmdlUGFzc3dvcmQ7XG4gICAgaWYgKHVybENoYW5nZVBhc3N3b3JkKSB7XG4gICAgICBpc0V4dGVybmFsTGluayh1cmxDaGFuZ2VQYXNzd29yZCkgP1xuICAgICAgdGhpcy5vcGVuRXh0ZXJuYWxMaW5rKHVybENoYW5nZVBhc3N3b3JkLCByZWNvdmVyeVRva2VuLnRva2VuKSA6XG4gICAgICB0aGlzLm9wZW5JbnRlcm5hbExpbmsodGhpcy51cmxSZWNvdmVyeSwgdXJsQ2hhbmdlUGFzc3dvcmQsIHJlY292ZXJ5VG9rZW4udG9rZW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjaGFuZ2VQYXNzd29yZEVuZHBvaW50ID0gJ2NoYW5nZVBhc3N3b3JkJztcbiAgICAgIHRoaXMub3BlbkludGVybmFsTGluayh0aGlzLnVybFJlY292ZXJ5LCBjaGFuZ2VQYXNzd29yZEVuZHBvaW50LCByZWNvdmVyeVRva2VuLnRva2VuKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc2V0Rm9ybUZpZWxkcyhjb250cm9sKSB7XG4gICAgdGhpcy5mb3JtUmVzZXQoY29udHJvbCk7XG4gICAgdGhpcy5lbWFpbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBob25lID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc21zQ29kZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWN0aW9ucyhwcmltYXJ5QWN0aW9uLCBwcmltYXJ5bGFiZWwsIHNlY29uZGFyeUFjdGlvbiwgc2Vjb25kYXJ5TGFiZWwsIGRpc2FibGVkKSB7XG4gICAgdGhpcy5wcmltYXJ5QWN0aW9uLmFjdGlvbiA9ICgpID0+IHByaW1hcnlBY3Rpb24uY2FsbCh0aGlzKTtcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24ubGFiZWwgPSBwcmltYXJ5bGFiZWw7XG4gICAgdGhpcy5zZWNvbmRhcnlBY3Rpb24uYWN0aW9uID0gKCkgPT4gc2Vjb25kYXJ5QWN0aW9uLmNhbGwodGhpcyk7XG4gICAgdGhpcy5zZWNvbmRhcnlBY3Rpb24ubGFiZWwgPSBzZWNvbmRhcnlMYWJlbDtcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24uZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RW1haWxNb2RhbFBocmFzZXNBbmRBY3Rpb25zKCkge1xuICAgIHRoaXMubW9kYWxUaXRsZSA9IHRoaXMubGl0ZXJhbHMuZm9yZ290UGFzc3dvcmRUaXRsZTtcbiAgICB0aGlzLnBpcGVNb2RhbFBocmFzZXMoKTtcbiAgICB0aGlzLm1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGVBbGwgPSB0aGlzLnR5cGUgPT09IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuQWxsO1xuICAgIHRoaXMuc2V0QWN0aW9ucyh0aGlzLnN1Ym1pdEFjdGlvbiwgdGhpcy5saXRlcmFscy5zZW5kQnV0dG9uLCB0aGlzLmNhbmNlbEFjdGlvbiwgdGhpcy5saXRlcmFscy5jYW5jZWxCdXR0b24sIHRydWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXF1ZXN0RW5kcG9pbnQodXJsVmFsaWRhdGlvbkNvZGU/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBlbmRwb2ludCA9IHVybFZhbGlkYXRpb25Db2RlIHx8ICd2YWxpZGF0aW9uJztcblxuICAgIHJldHVybiBgJHt0aGlzLnVybFJlY292ZXJ5fS8ke2VuZHBvaW50fWA7XG4gIH1cblxuICBwcml2YXRlIHNldFBpcGVBcmd1bWVudHMobGl0ZXJhbEF0dHI6IHN0cmluZywgYXJnOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy50aGZJMThuUGlwZS50cmFuc2Zvcm0obGl0ZXJhbEF0dHIsIGFyZyk7XG4gIH1cblxuICBwcml2YXRlIHN1Ym1pdEFjdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsVHlwZSA9PT0gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50LkNvbmZpcm1hdGlvbiA/IHRoaXMuaW5jcmVtZW50UmV0cnlBdHRlbXB0cygpIDogdGhpcy5mb3JtUmVzZXQodGhpcy5jb250cm9sKTtcbiAgICB0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZVt0aGlzLmNoZWNrRm9ybVR5cGUodGhpcy50eXBlKV0gPSB0aGlzLmdldEVtaXRWYWx1ZSh0aGlzLnR5cGUpO1xuICAgIGlmICh0aGlzLnVybFJlY292ZXJ5KSB7XG4gICAgICB0aGlzLnN1Ym1pdEFjdGlvblJlcXVlc3QodGhpcy5zdWJtaXR0ZWRDb250YWN0VmFsdWUsIHRoaXMudHlwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3VibWl0LmVtaXQodGhpcy5zdWJtaXR0ZWRDb250YWN0VmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3VibWl0QWN0aW9uUmVxdWVzdChkYXRhOiBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnksIG1vZGFsVHlwZTogVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZSkge1xuICAgIGNvbnN0IHBhcmFtcyA9IG1vZGFsVHlwZSA9PT0gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5TTVMgPyB7IHR5cGU6ICdzbXMnIH0gOiB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLnBhc3N3b3JkUmVjb3ZlcnlTdWJzY3JpcHRpb24gPVxuICAgIHRoaXMudGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5U2VydmljZS5wb3N0KHRoaXMudXJsUmVjb3ZlcnksIGRhdGEsIHBhcmFtcylcbiAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgIGlmICgobW9kYWxUeXBlID09PSBUaGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkVtYWlsIHx8IG1vZGFsVHlwZSA9PT0gVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGwpICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA0KSB7XG4gICAgICAgIHRoaXMub3BlbkNvbmZpcm1hdGlvbigpO1xuICAgICAgfSBlbHNlIGlmIChtb2RhbFR5cGUgPT09IFRoZk1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuU01TICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIHRoaXMuYXNzaWduU21zUmVzcG9uc2UocmVzcG9uc2UuYm9keSk7XG4gICAgICAgIHRoaXMub3BlblNtc0NvZGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc3VibWl0U21zQ29kZUFjdGlvbigpIHtcbiAgICB0aGlzLnN1Ym1pdHRlZENvZGVWYWx1ZS5jb2RlID0gdGhpcy5zbXNDb2RlO1xuXG4gICAgaWYgKHRoaXMudXJsUmVjb3ZlcnkpIHtcbiAgICAgIHRoaXMuc3VibWl0dGVkQ29kZVZhbHVlID0gT2JqZWN0LmFzc2lnbih0aGlzLnN1Ym1pdHRlZENvZGVWYWx1ZSwge2hhc2g6IHRoaXMuc21zQm9keVJlc3BvbnNlLmhhc2h9KTtcbiAgICAgIHRoaXMuc3VibWl0U21zQ29kZVJlcXVlc3QodGhpcy5zdWJtaXR0ZWRDb2RlVmFsdWUpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY29kZVN1Ym1pdC5lbWl0KHRoaXMuc3VibWl0dGVkQ29kZVZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5yZXNldEZvcm1GaWVsZHModGhpcy5jb250cm9sKTtcbiAgfVxuXG4gIHByaXZhdGUgc3VibWl0U21zQ29kZVJlcXVlc3QoZGF0YTogVGhmTW9kYWxQYXNzd29yZFJlY292ZXJ5KSB7XG4gICAgdGhpcy5zbXNDb2RlU3Vic2NyaXB0aW9uID0gdGhpcy50aGZNb2RhbFBhc3N3b3JkUmVjb3ZlcnlTZXJ2aWNlXG4gICAgLnBvc3QodGhpcy5zZXRSZXF1ZXN0RW5kcG9pbnQodGhpcy5zbXNCb2R5UmVzcG9uc2UudXJsVmFsaWRhdGlvbkNvZGUpLCBkYXRhKVxuICAgIC5zdWJzY3JpYmUoXG4gICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NTdGF0dXMgPSByZXNwb25zZS5zdGF0dXMgPT09IDIwMDtcbiAgICAgICAgaWYgKHN1Y2Nlc3NTdGF0dXMpIHtcbiAgICAgICAgICB0aGlzLmNvbXBsZXRlZCgpO1xuICAgICAgICAgIHRoaXMucmVkaXJlY3RUb0NoYW5nZVBhc3N3b3JkKHJlc3BvbnNlLmJvZHkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXJyb3IgPT4ge1xuICAgICAgICB0aGlzLmNvZGVFcnJvciA9IGVycm9yLmVycm9yLm1lc3NhZ2U7XG4gICAgICAgIHRoaXMub3BlblNtc0NvZGUoKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbn1cbiJdfQ==