/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild } from '@angular/core';
import { ThfDynamicFieldType } from '@totvs/thf-ui';
import { getBrowserLanguage } from '../../utils/util';
import { ThfAdvancedFilterComponent } from './thf-advanced-filter/thf-advanced-filter.component';
import { ThfPageDynamicSearchBaseComponent } from './thf-page-dynamic-search-base.component';
/**
 * \@docsExtends ThfPageDynamicSearchBaseComponent
 *
 * \@example
 *
 * <example name="thf-page-dynamic-search-basic" title="Totvs Page Dynamic Search Basic">
 *  <file name="sample-thf-page-dynamic-search-basic/sample-thf-page-dynamic-search-basic.component.html"> </file>
 *  <file name="sample-thf-page-dynamic-search-basic/sample-thf-page-dynamic-search-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-page-dynamic-search-hiring-processes" title="Totvs Page Dynamic Search - Hiring processes">
 *  <file name="sample-thf-page-dynamic-search-hiring-processes/sample-thf-page-dynamic-search-hiring-processes.component.html"> </file>
 *  <file name="sample-thf-page-dynamic-search-hiring-processes/sample-thf-page-dynamic-search-hiring-processes.component.ts"> </file>
 *  <file name="sample-thf-page-dynamic-search-hiring-processes/sample-thf-page-dynamic-search-hiring-processes.service.ts"> </file>
 * </example>
 */
export class ThfPageDynamicSearchComponent extends ThfPageDynamicSearchBaseComponent {
    constructor() {
        super(...arguments);
        this._disclaimerGroup = {
            change: this.onChangeDisclaimerGroup.bind(this),
            disclaimers: [],
            title: this.literals.disclaimerGroupTitle
        };
        this._filterSettings = {
            action: 'onAction',
            advancedAction: 'onAdvancedAction',
            ngModel: 'quickFilter',
            placeholder: this.literals.filterSettingsPlaceholder
        };
        // Flag to control when changeDisclaimerGroup should be called
        this.changeDisclaimersEnabled = false;
    }
    /**
     * @return {?}
     */
    get disclaimerGroup() {
        return Object.assign({}, this._disclaimerGroup);
    }
    /**
     * @return {?}
     */
    get filterSettings() {
        this._filterSettings.advancedAction = this.filters.length === 0 ? undefined : 'onAdvancedAction';
        return Object.assign({}, this._filterSettings);
    }
    /**
     * @return {?}
     */
    onAction() {
        this.changeDisclaimersEnabled = false;
        this._disclaimerGroup.disclaimers = [
            { property: 'search', label: `${this.literals.quickSearchLabel} ${this.quickFilter}`, value: this.quickFilter }
        ];
        if (this.quickSearch.observers && this.quickSearch.observers.length > 0) {
            this.quickSearch.emit(this.quickFilter);
        }
        this.quickFilter = undefined;
    }
    /**
     * @return {?}
     */
    onAdvancedAction() {
        this.thfAdvancedFilter.open();
    }
    /**
     * @param {?} filters
     * @return {?}
     */
    onAdvancedSearch(filters) {
        this.changeDisclaimersEnabled = false;
        this._disclaimerGroup.disclaimers = this.setDisclaimers(filters);
        this.advancedSearch.emit(filters);
    }
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    formatDate(date) {
        /** @type {?} */
        const year = parseInt(date.substr(0, 4), 10);
        /** @type {?} */
        const month = parseInt(date.substr(5, 2), 10);
        /** @type {?} */
        const day = parseInt(date.substr(8, 2), 10);
        return new Date(year, month - 1, day).toLocaleDateString(getBrowserLanguage());
    }
    /**
     * @private
     * @param {?} fields
     * @param {?} fieldName
     * @return {?}
     */
    getFieldByProperty(fields, fieldName) {
        return fields.find((/**
         * @param {?} field
         * @return {?}
         */
        (field) => field.property === fieldName));
    }
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    onChangeDisclaimerGroup(disclaimers) {
        this.changeDisclaimersEnabled ? this.changeDisclaimers.emit(disclaimers) : this.changeDisclaimersEnabled = true;
    }
    /**
     * @private
     * @param {?} filters
     * @return {?}
     */
    setDisclaimers(filters) {
        /** @type {?} */
        const disclaimers = [];
        Object.keys(filters).forEach((/**
         * @param {?} filter
         * @return {?}
         */
        filter => {
            /** @type {?} */
            const field = this.getFieldByProperty(this.filters, filter);
            /** @type {?} */
            const value = field.type === ThfDynamicFieldType.Date ? this.formatDate(filters[filter]) : filters[filter];
            disclaimers.push({
                label: `${field.label}: ${value}`,
                property: filter,
                value: filters[filter]
            });
        }));
        return disclaimers;
    }
}
ThfPageDynamicSearchComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-page-dynamic-search',
                template: "<thf-page-list\n  [t-actions]=\"actions\"\n  [t-breadcrumb]=\"breadcrumb\"\n  [t-disclaimer-group]=\"disclaimerGroup\"\n  [t-filter]=\"filterSettings\"\n  [t-title]=\"title\">\n\n  <thf-advanced-filter\n    [t-filters]=\"filters\"\n    (t-search-event)=\"onAdvancedSearch($event)\">\n  </thf-advanced-filter>\n\n  <ng-content></ng-content>\n\n</thf-page-list>\n"
            }] }
];
ThfPageDynamicSearchComponent.propDecorators = {
    thfAdvancedFilter: [{ type: ViewChild, args: [ThfAdvancedFilterComponent, { static: true },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicSearchComponent.prototype._disclaimerGroup;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicSearchComponent.prototype._filterSettings;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicSearchComponent.prototype.changeDisclaimersEnabled;
    /**
     * @type {?}
     * @private
     */
    ThfPageDynamicSearchComponent.prototype.quickFilter;
    /** @type {?} */
    ThfPageDynamicSearchComponent.prototype.thfAdvancedFilter;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2UtZHluYW1pYy1zZWFyY2guY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi10ZW1wbGF0ZXMvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtcGFnZS1keW5hbWljLXNlYXJjaC90aGYtcGFnZS1keW5hbWljLXNlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXJELE9BQU8sRUFBc0IsbUJBQW1CLEVBQXNDLE1BQU0sZUFBZSxDQUFDO0FBRTVHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXRELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxNQUFNLDBDQUEwQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQXNCN0YsTUFBTSxPQUFPLDZCQUE4QixTQUFRLGlDQUFpQztJQUpwRjs7UUFNbUIscUJBQWdCLEdBQXVCO1lBQ3RELE1BQU0sRUFBRSxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMvQyxXQUFXLEVBQUUsRUFBRTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQjtTQUMxQyxDQUFDO1FBRWUsb0JBQWUsR0FBa0I7WUFDaEQsTUFBTSxFQUFFLFVBQVU7WUFDbEIsY0FBYyxFQUFFLGtCQUFrQjtZQUNsQyxPQUFPLEVBQUUsYUFBYTtZQUN0QixXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyx5QkFBeUI7U0FDckQsQ0FBQzs7UUFHTSw2QkFBd0IsR0FBWSxLQUFLLENBQUM7SUEwRXBELENBQUM7Ozs7SUFwRUMsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxD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LElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDOztrQkFFckQsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLEtBQUssbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBRTFHLFdBQVcsQ0FBQyxJQUFJLENBQUM7Z0JBQ2YsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUU7Z0JBQ2pDLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQzthQUN2QixDQUFDLENBQUM7UUFDTCxDQUFDLEVBQUMsQ0FBQztRQUVILE9BQU8sV0FBVyxDQUFDO0lBQ3JCLENBQUM7OztZQTVGRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHlCQUF5QjtnQkFDbkMscVhBQXVEO2FBQ3hEOzs7Z0NBcUJFLFNBQVMsU0FBQywwQkFBMEIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Ozs7Ozs7SUFsQnZELHlEQUlFOzs7OztJQUVGLHdEQUtFOzs7OztJQUdGLGlFQUFrRDs7Ozs7SUFFbEQsb0RBQW9COztJQUVwQiwwREFBdUciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBUaGZEaXNjbGFpbWVyR3JvdXAsIFRoZkR5bmFtaWNGaWVsZFR5cGUsIFRoZkR5bmFtaWNGb3JtRmllbGQsIFRoZlBhZ2VGaWx0ZXIgfSBmcm9tICdAdG90dnMvdGhmLXVpJztcblxuaW1wb3J0IHsgZ2V0QnJvd3Nlckxhbmd1YWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFRoZkFkdmFuY2VkRmlsdGVyQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtYWR2YW5jZWQtZmlsdGVyL3RoZi1hZHZhbmNlZC1maWx0ZXIuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZlBhZ2VEeW5hbWljU2VhcmNoQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXBhZ2UtZHluYW1pYy1zZWFyY2gtYmFzZS5jb21wb25lbnQnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZQYWdlRHluYW1pY1NlYXJjaEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtcGFnZS1keW5hbWljLXNlYXJjaC1iYXNpY1wiIHRpdGxlPVwiVG90dnMgUGFnZSBEeW5hbWljIFNlYXJjaCBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtZHluYW1pYy1zZWFyY2gtYmFzaWMvc2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtc2VhcmNoLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWR5bmFtaWMtc2VhcmNoLWJhc2ljL3NhbXBsZS10aGYtcGFnZS1keW5hbWljLXNlYXJjaC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtcGFnZS1keW5hbWljLXNlYXJjaC1oaXJpbmctcHJvY2Vzc2VzXCIgdGl0bGU9XCJUb3R2cyBQYWdlIER5bmFtaWMgU2VhcmNoIC0gSGlyaW5nIHByb2Nlc3Nlc1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2UtZHluYW1pYy1zZWFyY2gtaGlyaW5nLXByb2Nlc3Nlcy9zYW1wbGUtdGhmLXBhZ2UtZHluYW1pYy1zZWFyY2gtaGlyaW5nLXByb2Nlc3Nlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1keW5hbWljLXNlYXJjaC1oaXJpbmctcHJvY2Vzc2VzL3NhbXBsZS10aGYtcGFnZS1keW5hbWljLXNlYXJjaC1oaXJpbmctcHJvY2Vzc2VzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtcGFnZS1keW5hbWljLXNlYXJjaC1oaXJpbmctcHJvY2Vzc2VzL3NhbXBsZS10aGYtcGFnZS1keW5hbWljLXNlYXJjaC1oaXJpbmctcHJvY2Vzc2VzLnNlcnZpY2UudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtcGFnZS1keW5hbWljLXNlYXJjaCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGYtcGFnZS1keW5hbWljLXNlYXJjaC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgVGhmUGFnZUR5bmFtaWNTZWFyY2hDb21wb25lbnQgZXh0ZW5kcyBUaGZQYWdlRHluYW1pY1NlYXJjaEJhc2VDb21wb25lbnQge1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2Rpc2NsYWltZXJHcm91cDogVGhmRGlzY2xhaW1lckdyb3VwID0ge1xuICAgIGNoYW5nZTogdGhpcy5vbkNoYW5nZURpc2NsYWltZXJHcm91cC5iaW5kKHRoaXMpLFxuICAgIGRpc2NsYWltZXJzOiBbXSxcbiAgICB0aXRsZTogdGhpcy5saXRlcmFscy5kaXNjbGFpbWVyR3JvdXBUaXRsZVxuICB9O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2ZpbHRlclNldHRpbmdzOiBUaGZQYWdlRmlsdGVyID0ge1xuICAgIGFjdGlvbjogJ29uQWN0aW9uJyxcbiAgICBhZHZhbmNlZEFjdGlvbjogJ29uQWR2YW5jZWRBY3Rpb24nLFxuICAgIG5nTW9kZWw6ICdxdWlja0ZpbHRlcicsXG4gICAgcGxhY2Vob2xkZXI6IHRoaXMubGl0ZXJhbHMuZmlsdGVyU2V0dGluZ3NQbGFjZWhvbGRlclxuICB9O1xuXG4gIC8vIEZsYWcgdG8gY29udHJvbCB3aGVuIGNoYW5nZURpc2NsYWltZXJHcm91cCBzaG91bGQgYmUgY2FsbGVkXG4gIHByaXZhdGUgY2hhbmdlRGlzY2xhaW1lcnNFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBxdWlja0ZpbHRlcjtcblxuICBAVmlld0NoaWxkKFRoZkFkdmFuY2VkRmlsdGVyQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSB0aGZBZHZhbmNlZEZpbHRlcjogVGhmQWR2YW5jZWRGaWx0ZXJDb21wb25lbnQ7XG5cbiAgZ2V0IGRpc2NsYWltZXJHcm91cCgpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5fZGlzY2xhaW1lckdyb3VwKTtcbiAgfVxuXG4gIGdldCBmaWx0ZXJTZXR0aW5ncygpIHtcbiAgICB0aGlzLl9maWx0ZXJTZXR0aW5ncy5hZHZhbmNlZEFjdGlvbiA9IHRoaXMuZmlsdGVycy5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiAnb25BZHZhbmNlZEFjdGlvbic7XG5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5fZmlsdGVyU2V0dGluZ3MpO1xuICB9XG5cbiAgb25BY3Rpb24oKSB7XG4gICAgdGhpcy5jaGFuZ2VEaXNjbGFpbWVyc0VuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLl9kaXNjbGFpbWVyR3JvdXAuZGlzY2xhaW1lcnMgPSBbXG4gICAgICB7IHByb3BlcnR5OiAnc2VhcmNoJywgbGFiZWw6IGAke3RoaXMubGl0ZXJhbHMucXVpY2tTZWFyY2hMYWJlbH0gJHt0aGlzLnF1aWNrRmlsdGVyfWAsIHZhbHVlOiB0aGlzLnF1aWNrRmlsdGVyIH1cbiAgICBdO1xuXG4gICAgaWYgKHRoaXMucXVpY2tTZWFyY2gub2JzZXJ2ZXJzICYmIHRoaXMucXVpY2tTZWFyY2gub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMucXVpY2tTZWFyY2guZW1pdCh0aGlzLnF1aWNrRmlsdGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLnF1aWNrRmlsdGVyID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgb25BZHZhbmNlZEFjdGlvbigpIHtcbiAgICB0aGlzLnRoZkFkdmFuY2VkRmlsdGVyLm9wZW4oKTtcbiAgfVxuXG4gIG9uQWR2YW5jZWRTZWFyY2goZmlsdGVycykge1xuICAgIHRoaXMuY2hhbmdlRGlzY2xhaW1lcnNFbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5fZGlzY2xhaW1lckdyb3VwLmRpc2NsYWltZXJzID0gdGhpcy5zZXREaXNjbGFpbWVycyhmaWx0ZXJzKTtcblxuICAgIHRoaXMuYWR2YW5jZWRTZWFyY2guZW1pdChmaWx0ZXJzKTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RGF0ZShkYXRlOiBzdHJpbmcpIHtcbiAgICBjb25zdCB5ZWFyID0gcGFyc2VJbnQoZGF0ZS5zdWJzdHIoMCwgNCksIDEwKTtcbiAgICBjb25zdCBtb250aCA9IHBhcnNlSW50KGRhdGUuc3Vic3RyKDUsIDIpLCAxMCk7XG4gICAgY29uc3QgZGF5ID0gcGFyc2VJbnQoZGF0ZS5zdWJzdHIoOCwgMiksIDEwKTtcblxuICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSkudG9Mb2NhbGVEYXRlU3RyaW5nKGdldEJyb3dzZXJMYW5ndWFnZSgpKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RmllbGRCeVByb3BlcnR5KGZpZWxkczogQXJyYXk8VGhmRHluYW1pY0Zvcm1GaWVsZD4sIGZpZWxkTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5maW5kKChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCkgPT4gZmllbGQucHJvcGVydHkgPT09IGZpZWxkTmFtZSk7XG4gIH1cblxuICBwcml2YXRlIG9uQ2hhbmdlRGlzY2xhaW1lckdyb3VwKGRpc2NsYWltZXJzKSB7XG4gICAgdGhpcy5jaGFuZ2VEaXNjbGFpbWVyc0VuYWJsZWQgPyB0aGlzLmNoYW5nZURpc2NsYWltZXJzLmVtaXQoZGlzY2xhaW1lcnMpIDogdGhpcy5jaGFuZ2VEaXNjbGFpbWVyc0VuYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXREaXNjbGFpbWVycyhmaWx0ZXJzKSB7XG4gICAgY29uc3QgZGlzY2xhaW1lcnMgPSBbXTtcblxuICAgIE9iamVjdC5rZXlzKGZpbHRlcnMpLmZvckVhY2goZmlsdGVyID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5nZXRGaWVsZEJ5UHJvcGVydHkodGhpcy5maWx0ZXJzLCBmaWx0ZXIpO1xuXG4gICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLnR5cGUgPT09IFRoZkR5bmFtaWNGaWVsZFR5cGUuRGF0ZSA/IHRoaXMuZm9ybWF0RGF0ZShmaWx0ZXJzW2ZpbHRlcl0pIDogZmlsdGVyc1tmaWx0ZXJdO1xuXG4gICAgICBkaXNjbGFpbWVycy5wdXNoKHtcbiAgICAgICAgbGFiZWw6IGAke2ZpZWxkLmxhYmVsfTogJHt2YWx1ZX1gLFxuICAgICAgICBwcm9wZXJ0eTogZmlsdGVyLFxuICAgICAgICB2YWx1ZTogZmlsdGVyc1tmaWx0ZXJdXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBkaXNjbGFpbWVycztcbiAgfVxuXG59XG4iXX0=