/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ActivatedRoute, Router } from '@angular/router';
import { Component, ViewChild, ViewEncapsulation } from '@angular/core';
import { ThfDialogService, ThfNotificationService, ThfStepperStatus } from '@totvs/thf-ui';
import * as util from './../../utils/util';
import { ThfPageJobSchedulerInternal } from './thf-page-job-scheduler-internal';
import { ThfPageJobSchedulerBaseComponent } from './thf-page-job-scheduler-base.component';
import { thfPageJobSchedulerLiteralsDefault } from './thf-page-job-scheduler-literals';
import { ThfPageJobSchedulerLookupService } from './thf-page-job-scheduler-lookup.service';
import { ThfPageJobSchedulerService } from './thf-page-job-scheduler.service';
/**
 * \@docsExtends ThfPageJobSchedulerBaseComponent
 *
 * \@example
 *
 * <example name="thf-page-job-scheduler-basic" title="Totvs Page Job Scheduler Basic">
 *  <file name="sample-thf-page-job-scheduler-basic/sample-thf-page-job-scheduler-basic.component.html"> </file>
 *  <file name="sample-thf-page-job-scheduler-basic/sample-thf-page-job-scheduler-basic.component.ts"> </file>
 * </example>
 *
 */
export class ThfPageJobSchedulerComponent extends ThfPageJobSchedulerBaseComponent {
    /**
     * @param {?} thfPageDynamicLookupService
     * @param {?} activatedRoute
     * @param {?} thfDialogService
     * @param {?} thfNotification
     * @param {?} router
     * @param {?} thfPageJobSchedulerService
     */
    constructor(thfPageDynamicLookupService, activatedRoute, thfDialogService, thfNotification, router, thfPageJobSchedulerService) {
        super(thfPageJobSchedulerService);
        this.thfPageDynamicLookupService = thfPageDynamicLookupService;
        this.activatedRoute = activatedRoute;
        this.thfDialogService = thfDialogService;
        this.thfNotification = thfNotification;
        this.router = router;
        this.isEdit = false;
        this.literals = Object.assign({}, thfPageJobSchedulerLiteralsDefault[util.thfLocaleDefault], thfPageJobSchedulerLiteralsDefault[util.browserLanguage()]);
        this.parameters = [];
        this.step = 1;
        this.backPageAction = {
            label: this.literals.back,
            action: this.nextStepOperation.bind(this, 'back'),
            disabled: this.isDisabledBack.bind(this)
        };
        this.concludePageActions = [
            {
                label: this.literals.conclude,
                action: this.confirmJobScheduler.bind(this)
            },
            Object.assign({}, this.backPageAction)
        ];
        this.nextPageActions = [
            {
                label: this.literals.next,
                action: this.nextStepOperation.bind(this, 'next'),
                disabled: this.isDisabledAdvance.bind(this)
            },
            Object.assign({}, this.backPageAction)
        ];
        this.jobSchedulerActions = [
            ...this.nextPageActions
        ];
        this.steps = [
            { label: this.literals.scheduling },
            { label: this.literals.parameterization },
            { label: this.literals.conclude }
        ];
    }
    /**
     * @return {?}
     */
    get stepperOrientation() {
        return window.innerWidth > 481 && window.innerWidth < 960 ? 'horizontal' : 'vertical';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const paramId = this.activatedRoute.snapshot.params['id'];
        this.isEdit = !!paramId;
        this.thfPageJobSchedulerService.configServiceApi({ endpoint: this.serviceApi });
        this.loadData(paramId);
    }
    /**
     * @param {?} currentStep
     * @param {?} nextStep
     * @return {?}
     */
    changePageActionsBySteps(currentStep, nextStep) {
        /** @type {?} */
        const stepsLength = this.steps.length;
        if (nextStep === stepsLength) {
            this.jobSchedulerActions = [...this.concludePageActions];
        }
        else if (currentStep === stepsLength && nextStep < currentStep) {
            this.jobSchedulerActions = [...this.nextPageActions];
        }
    }
    /**
     * @param {?} stepNumber
     * @return {?}
     */
    nextStep(stepNumber) {
        if (stepNumber > 1 && this.schedulerExecution.form.invalid) {
            this.markAsDirtyInvalidControls(this.schedulerExecution.form.controls);
            return;
        }
        if (stepNumber > 2 && (this.schedulerParameters && this.schedulerParameters.form && this.schedulerParameters.form.invalid)) {
            this.markAsDirtyInvalidControls(this.schedulerParameters.form.controls);
            return;
        }
        this.changePageActionsBySteps(this.step, stepNumber);
        /** @type {?} */
        const steps = this.steps[this.step - 1];
        this.step = stepNumber;
        if (steps) {
            steps.status = ThfStepperStatus.Done;
        }
    }
    /**
     * @param {?} process
     * @return {?}
     */
    onChangeProcess(process) {
        if (process.existAPI && process.processId) {
            this.getParametersByProcess(process.processId);
            if (!this.isEdit) {
                this.model.executionParameter = {};
            }
            return;
        }
    }
    /**
     * @private
     * @return {?}
     */
    confirmJobScheduler() {
        /** @type {?} */
        const paramId = this.activatedRoute.snapshot.params['id'];
        /** @type {?} */
        const confirmMessage = paramId ? this.literals.confirmUpdateMessage : this.literals.confirmSaveMessage;
        this.thfDialogService.confirm({
            title: this.literals.confirmation,
            message: confirmMessage,
            confirm: (/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const model = Object.assign({}, this.model);
                this.save(model, paramId);
            })
        });
    }
    /**
     * @private
     * @param {?} msgSuccess
     * @param {?} saveOperation
     * @return {?}
     */
    emitSuccessMessage(msgSuccess, saveOperation) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield saveOperation.toPromise();
            this.thfNotification.success(msgSuccess);
            this.resetJobSchedulerForm();
        });
    }
    /**
     * @private
     * @param {?} process
     * @return {?}
     */
    getParametersByProcess(process) {
        this.thfPageJobSchedulerService.getParametersByProcess(process).subscribe((/**
         * @param {?} parameters
         * @return {?}
         */
        parameters => {
            this.parameters = parameters;
        }));
    }
    /**
     * @private
     * @return {?}
     */
    isDisabledAdvance() {
        return this.schedulerExecution ? this.schedulerExecution.form.invalid : false;
    }
    /**
     * @private
     * @return {?}
     */
    isDisabledBack() {
        return this.step === 1;
    }
    /**
     * @private
     * @param {?=} operation
     * @return {?}
     */
    nextStepOperation(operation) {
        /** @type {?} */
        const stepNumber = operation === 'back' ? this.step - 1 : this.step + 1;
        this.nextStep(stepNumber);
    }
    /**
     * @private
     * @return {?}
     */
    resetJobSchedulerForm() {
        this.schedulerExecution.form.reset();
        // radiogroup nÃ£o estava atribuindo novo valor, fica vermelho sem o timetout.
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.model = new ThfPageJobSchedulerInternal();
            this.step = 1;
            this.steps.forEach((/**
             * @param {?} step
             * @return {?}
             */
            step => {
                step.status = ThfStepperStatus.Default;
            }));
            this.jobSchedulerActions = [...this.nextPageActions];
        }));
    }
    /**
     * @private
     * @param {?} model
     * @param {?} paramId
     * @return {?}
     */
    save(model, paramId) {
        /** @type {?} */
        const saveOperation = paramId
            ? this.thfPageJobSchedulerService.updateResource(paramId, model)
            : this.thfPageJobSchedulerService.createResource(model);
        /** @type {?} */
        const msgSuccess = paramId ? this.literals.saveNotificationSuccessUpdate : this.literals.saveNotificationSuccessSave;
        this.emitSuccessMessage(msgSuccess, saveOperation);
    }
}
ThfPageJobSchedulerComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-page-job-scheduler',
                template: "<thf-page-default\n  [t-actions]=\"jobSchedulerActions\"\n  [t-breadcrumb]=\"breadcrumb\"\n  [t-title]=\"title\">\n\n  <div class=\"thf-row\">\n\n    <thf-stepper\n      class=\"thf-lg-3 thf-xl-2\"\n      t-sequential=\"true\"\n      [t-orientation]=\"stepperOrientation\"\n      [t-step]=\"step\"\n      [t-steps]=\"steps\"\n      (t-change-step)=\"nextStep($event)\">\n    </thf-stepper>\n\n    <thf-container class=\"thf-lg-8 thf-xl-6\">\n      <form #formScheduler=\"ngForm\">\n\n        <thf-page-job-scheduler-execution [hidden]=\"step !== 1\"\n          #schedulerExecution\n          class=\"thf-md-12\"\n          [t-is-edit]=\"isEdit\"\n          [t-literals]=\"literals\"\n          [t-value]=\"model\"\n          (t-change-process)=\"onChangeProcess($event)\">\n        </thf-page-job-scheduler-execution>\n\n        <thf-page-job-scheduler-parameters *ngIf=\"step === 2\"\n          #schedulerParameters\n          class=\"thf-md-12\"\n          [t-literals]=\"literals\"\n          [t-parameters]=\"parameters || []\"\n          [(t-value)]=\"model.executionParameter\">\n        </thf-page-job-scheduler-parameters>\n\n        <thf-page-job-scheduler-summary *ngIf=\"step === 3\"\n          class=\"thf-md-12\"\n          [t-literals]=\"literals\"\n          [t-parameters]=\"parameters\"\n          [t-value]=\"model\">\n        </thf-page-job-scheduler-summary>\n      </form>\n    </thf-container>\n  </div>\n\n</thf-page-default>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [`
    thf-container .thf-container {
      overflow-y: unset;
    }
  `]
            }] }
];
/** @nocollapse */
ThfPageJobSchedulerComponent.ctorParameters = () => [
    { type: ThfPageJobSchedulerLookupService },
    { type: ActivatedRoute },
    { type: ThfDialogService },
    { type: ThfNotificationService },
    { type: Router },
    { type: ThfPageJobSchedulerService }
];
ThfPageJobSchedulerComponent.propDecorators = {
    schedulerExecution: [{ type: ViewChild, args: ['schedulerExecution', { static: true },] }],
    schedulerParameters: [{ type: ViewChild, args: ['schedulerParameters', { static: true },] }]
};
if (false) {
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.isEdit;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.literals;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.parameters;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.saveOperation;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.step;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.backPageAction;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.concludePageActions;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.nextPageActions;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.jobSchedulerActions;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.steps;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.schedulerExecution;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.schedulerParameters;
    /** @type {?} */
    ThfPageJobSchedulerComponent.prototype.thfPageDynamicLookupService;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.thfDialogService;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.thfNotification;
    /**
     * @type {?}
     * @private
     */
    ThfPageJobSchedulerComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXBhZ2Utam9iLXNjaGVkdWxlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXRlbXBsYXRlcy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXIvdGhmLXBhZ2Utam9iLXNjaGVkdWxlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBS2hGLE9BQU8sRUFDTCxnQkFBZ0IsRUFFaEIsc0JBQXNCLEVBR3RCLGdCQUFnQixFQUNqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEtBQUssSUFBSSxNQUFNLG9CQUFvQixDQUFDO0FBRzNDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzNGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7Ozs7Ozs7Ozs7QUF1QjlFLE1BQU0sT0FBTyw0QkFBNkIsU0FBUSxnQ0FBZ0M7Ozs7Ozs7OztJQStDaEYsWUFDUywyQkFBNkQsRUFDNUQsY0FBOEIsRUFDOUIsZ0JBQWtDLEVBQ2xDLGVBQXVDLEVBQ3ZDLE1BQWMsRUFDdEIsMEJBQXNEO1FBQ3BELEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBTjdCLGdDQUEyQixHQUEzQiwyQkFBMkIsQ0FBa0M7UUFDNUQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLHFC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MEIsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDOztjQUVuRCxVQUFVLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLDJCQUEyQjtRQUVwSCxJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3JELENBQUM7OztZQXRNRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHdCQUF3QjtnQkFDbEMsczdDQUFzRDtnQkFDdEQsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7eUJBQzVCOzs7O0dBSVI7YUFDRjs7OztZQXZCUSxnQ0FBZ0M7WUFyQmhDLGNBQWM7WUFPckIsZ0JBQWdCO1lBRWhCLHNCQUFzQjtZQVRDLE1BQU07WUFzQnRCLDBCQUEwQjs7O2lDQW1FaEMsU0FBUyxTQUFDLG9CQUFvQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtrQ0FDaEQsU0FBUyxTQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7OztJQTNDbEQsOENBQWU7O0lBQ2YsZ0RBR0U7O0lBQ0Ysa0RBQTRDOztJQUM1QyxxREFBK0I7O0lBQy9CLDRDQUFpQjs7Ozs7SUFFakIsc0RBSUU7Ozs7O0lBRUYsMkRBTUU7Ozs7O0lBRUYsdURBT0U7O0lBRUYsMkRBRUU7O0lBRUYsNkNBSUU7O0lBRUYsMERBQXdGOztJQUN4RiwyREFBMEY7O0lBR3hGLG1FQUFvRTs7Ozs7SUFDcEUsc0RBQXNDOzs7OztJQUN0Qyx3REFBMEM7Ozs7O0lBQzFDLHVEQUErQzs7Ozs7SUFDL0MsOENBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7XG4gIFRoZkRpYWxvZ1NlcnZpY2UsXG4gIFRoZkR5bmFtaWNGb3JtRmllbGQsXG4gIFRoZk5vdGlmaWNhdGlvblNlcnZpY2UsXG4gIFRoZlBhZ2VBY3Rpb24sXG4gIFRoZlN0ZXBwZXJJdGVtLFxuICBUaGZTdGVwcGVyU3RhdHVzXG59IGZyb20gJ0B0b3R2cy90aGYtdWknO1xuXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFRoZkpvYlNjaGVkdWxlckludGVybmFsIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3RoZi1qb2Itc2NoZWR1bGVyLWludGVybmFsLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZQYWdlSm9iU2NoZWR1bGVySW50ZXJuYWwgfSBmcm9tICcuL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXItaW50ZXJuYWwnO1xuaW1wb3J0IHsgVGhmUGFnZUpvYlNjaGVkdWxlckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3RoZi1wYWdlLWpvYi1zY2hlZHVsZXItYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgdGhmUGFnZUpvYlNjaGVkdWxlckxpdGVyYWxzRGVmYXVsdCB9IGZyb20gJy4vdGhmLXBhZ2Utam9iLXNjaGVkdWxlci1saXRlcmFscyc7XG5pbXBvcnQgeyBUaGZQYWdlSm9iU2NoZWR1bGVyTG9va3VwU2VydmljZSB9IGZyb20gJy4vdGhmLXBhZ2Utam9iLXNjaGVkdWxlci1sb29rdXAuc2VydmljZSc7XG5pbXBvcnQgeyBUaGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZSB9IGZyb20gJy4vdGhmLXBhZ2Utam9iLXNjaGVkdWxlci5zZXJ2aWNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmUGFnZUpvYlNjaGVkdWxlckJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtcGFnZS1qb2Itc2NoZWR1bGVyLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBQYWdlIEpvYiBTY2hlZHVsZXIgQmFzaWNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1wYWdlLWpvYi1zY2hlZHVsZXItYmFzaWMvc2FtcGxlLXRoZi1wYWdlLWpvYi1zY2hlZHVsZXItYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpYy9zYW1wbGUtdGhmLXBhZ2Utam9iLXNjaGVkdWxlci1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGhmLXBhZ2Utam9iLXNjaGVkdWxlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGYtcGFnZS1qb2Itc2NoZWR1bGVyLmNvbXBvbmVudC5odG1sJyxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgc3R5bGVzOiBbYFxuICAgIHRoZi1jb250YWluZXIgLnRoZi1jb250YWluZXIge1xuICAgICAgb3ZlcmZsb3cteTogdW5zZXQ7XG4gICAgfVxuICBgXVxufSlcbmV4cG9ydCBjbGFzcyBUaGZQYWdlSm9iU2NoZWR1bGVyQ29tcG9uZW50IGV4dGVuZHMgVGhmUGFnZUpvYlNjaGVkdWxlckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIGlzRWRpdCA9IGZhbHNlO1xuICBsaXRlcmFscyA9IHtcbiAgICAuLi50aGZQYWdlSm9iU2NoZWR1bGVyTGl0ZXJhbHNEZWZhdWx0W3V0aWwudGhmTG9jYWxlRGVmYXVsdF0sXG4gICAgLi4udGhmUGFnZUpvYlNjaGVkdWxlckxpdGVyYWxzRGVmYXVsdFt1dGlsLmJyb3dzZXJMYW5ndWFnZSgpXVxuICB9O1xuICBwYXJhbWV0ZXJzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkPiA9IFtdO1xuICBzYXZlT3BlcmF0aW9uOiBPYnNlcnZhYmxlPGFueT47XG4gIHN0ZXA6IG51bWJlciA9IDE7XG5cbiAgcHJpdmF0ZSBiYWNrUGFnZUFjdGlvbjogVGhmUGFnZUFjdGlvbiA9IHtcbiAgICBsYWJlbDogdGhpcy5saXRlcmFscy5iYWNrLFxuICAgIGFjdGlvbjogdGhpcy5uZXh0U3RlcE9wZXJhdGlvbi5iaW5kKHRoaXMsICdiYWNrJyksXG4gICAgZGlzYWJsZWQ6IHRoaXMuaXNEaXNhYmxlZEJhY2suYmluZCh0aGlzKVxuICB9O1xuXG4gIHByaXZhdGUgY29uY2x1ZGVQYWdlQWN0aW9uczogQXJyYXk8VGhmUGFnZUFjdGlvbj4gPSBbXG4gICAge1xuICAgICAgbGFiZWw6IHRoaXMubGl0ZXJhbHMuY29uY2x1ZGUsXG4gICAgICBhY3Rpb246IHRoaXMuY29uZmlybUpvYlNjaGVkdWxlci5iaW5kKHRoaXMpXG4gICAgfSxcbiAgICB7IC4uLnRoaXMuYmFja1BhZ2VBY3Rpb24gfVxuICBdO1xuXG4gIHByaXZhdGUgbmV4dFBhZ2VBY3Rpb25zOiBBcnJheTxUaGZQYWdlQWN0aW9uPiA9IFtcbiAgICB7XG4gICAgICBsYWJlbDogdGhpcy5saXRlcmFscy5uZXh0LFxuICAgICAgYWN0aW9uOiB0aGlzLm5leHRTdGVwT3BlcmF0aW9uLmJpbmQodGhpcywgJ25leHQnKSxcbiAgICAgIGRpc2FibGVkOiB0aGlzLmlzRGlzYWJsZWRBZHZhbmNlLmJpbmQodGhpcylcbiAgICB9LFxuICAgIHsgLi4udGhpcy5iYWNrUGFnZUFjdGlvbiB9XG4gIF07XG5cbiAgam9iU2NoZWR1bGVyQWN0aW9uczogQXJyYXk8VGhmUGFnZUFjdGlvbj4gPSBbXG4gICAgLi4udGhpcy5uZXh0UGFnZUFjdGlvbnNcbiAgXTtcblxuICByZWFkb25seSBzdGVwczogQXJyYXk8VGhmU3RlcHBlckl0ZW0+ID0gW1xuICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuc2NoZWR1bGluZyB9LFxuICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMucGFyYW1ldGVyaXphdGlvbiB9LFxuICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuY29uY2x1ZGUgfVxuICBdO1xuXG4gIEBWaWV3Q2hpbGQoJ3NjaGVkdWxlckV4ZWN1dGlvbicsIHsgc3RhdGljOiB0cnVlIH0pIHNjaGVkdWxlckV4ZWN1dGlvbjogeyBmb3JtOiBOZ0Zvcm0gfTtcbiAgQFZpZXdDaGlsZCgnc2NoZWR1bGVyUGFyYW1ldGVycycsIHsgc3RhdGljOiB0cnVlIH0pIHNjaGVkdWxlclBhcmFtZXRlcnM6IHsgZm9ybTogTmdGb3JtIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHRoZlBhZ2VEeW5hbWljTG9va3VwU2VydmljZTogVGhmUGFnZUpvYlNjaGVkdWxlckxvb2t1cFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSB0aGZEaWFsb2dTZXJ2aWNlOiBUaGZEaWFsb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgdGhmTm90aWZpY2F0aW9uOiBUaGZOb3RpZmljYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgdGhmUGFnZUpvYlNjaGVkdWxlclNlcnZpY2U6IFRoZlBhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlKSB7XG4gICAgICBzdXBlcih0aGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZSk7XG4gICAgfVxuXG4gIGdldCBzdGVwcGVyT3JpZW50YXRpb24oKTogJ2hvcml6b250YWwnIHwgJ3ZlcnRpY2FsJyB7XG4gICAgcmV0dXJuIHdpbmRvdy5pbm5lcldpZHRoID4gNDgxICYmIHdpbmRvdy5pbm5lcldpZHRoIDwgOTYwID8gJ2hvcml6b250YWwnIDogJ3ZlcnRpY2FsJztcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IHBhcmFtSWQgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtc1snaWQnXTtcblxuICAgIHRoaXMuaXNFZGl0ID0gISFwYXJhbUlkO1xuXG4gICAgdGhpcy50aGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZS5jb25maWdTZXJ2aWNlQXBpKHsgZW5kcG9pbnQ6IHRoaXMuc2VydmljZUFwaSB9KTtcblxuICAgIHRoaXMubG9hZERhdGEocGFyYW1JZCk7XG4gIH1cblxuICBjaGFuZ2VQYWdlQWN0aW9uc0J5U3RlcHMoY3VycmVudFN0ZXA6IG51bWJlciwgbmV4dFN0ZXA6IG51bWJlcikge1xuICAgIGNvbnN0IHN0ZXBzTGVuZ3RoID0gdGhpcy5zdGVwcy5sZW5ndGg7XG5cbiAgICBpZiAobmV4dFN0ZXAgPT09IHN0ZXBzTGVuZ3RoKSB7XG4gICAgdGhpcy5qb2JTY2hlZHVsZXJBY3Rpb25zID0gWyAuLi50aGlzLmNvbmNsdWRlUGFnZUFjdGlvbnMgXTtcblxuICAgIH0gZWxzZSBpZiAoY3VycmVudFN0ZXAgPT09IHN0ZXBzTGVuZ3RoICYmIG5leHRTdGVwIDwgY3VycmVudFN0ZXApIHtcblxuICAgIHRoaXMuam9iU2NoZWR1bGVyQWN0aW9ucyA9IFsgLi4udGhpcy5uZXh0UGFnZUFjdGlvbnMgXTtcbiAgICB9XG4gIH1cblxuICBuZXh0U3RlcChzdGVwTnVtYmVyOiBudW1iZXIpIHtcblxuICAgIGlmIChzdGVwTnVtYmVyID4gMSAmJiB0aGlzLnNjaGVkdWxlckV4ZWN1dGlvbi5mb3JtLmludmFsaWQpIHtcbiAgICAgIHRoaXMubWFya0FzRGlydHlJbnZhbGlkQ29udHJvbHModGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5jb250cm9scyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHN0ZXBOdW1iZXIgPiAyICYmICh0aGlzLnNjaGVkdWxlclBhcmFtZXRlcnMgJiYgdGhpcy5zY2hlZHVsZXJQYXJhbWV0ZXJzLmZvcm0gJiYgdGhpcy5zY2hlZHVsZXJQYXJhbWV0ZXJzLmZvcm0uaW52YWxpZCkpIHtcbiAgICAgIHRoaXMubWFya0FzRGlydHlJbnZhbGlkQ29udHJvbHModGhpcy5zY2hlZHVsZXJQYXJhbWV0ZXJzLmZvcm0uY29udHJvbHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlUGFnZUFjdGlvbnNCeVN0ZXBzKHRoaXMuc3RlcCwgc3RlcE51bWJlcik7XG5cbiAgICBjb25zdCBzdGVwcyA9IHRoaXMuc3RlcHNbdGhpcy5zdGVwIC0gMV07XG4gICAgdGhpcy5zdGVwID0gc3RlcE51bWJlcjtcblxuICAgIGlmIChzdGVwcykge1xuICAgICAgc3RlcHMuc3RhdHVzID0gVGhmU3RlcHBlclN0YXR1cy5Eb25lO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2hhbmdlUHJvY2Vzcyhwcm9jZXNzOiB7IHByb2Nlc3NJZDogc3RyaW5nLCBleGlzdEFQSTogYm9vbGVhbiB9KSB7XG4gICAgaWYgKHByb2Nlc3MuZXhpc3RBUEkgJiYgcHJvY2Vzcy5wcm9jZXNzSWQpIHtcbiAgICAgIHRoaXMuZ2V0UGFyYW1ldGVyc0J5UHJvY2Vzcyhwcm9jZXNzLnByb2Nlc3NJZCk7XG5cbiAgICAgIGlmICghdGhpcy5pc0VkaXQpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5leGVjdXRpb25QYXJhbWV0ZXIgPSB7fTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICB9XG5cbiAgcHJpdmF0ZSBjb25maXJtSm9iU2NoZWR1bGVyKCkge1xuICAgIGNvbnN0IHBhcmFtSWQgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtc1snaWQnXTtcblxuICAgIGNvbnN0IGNvbmZpcm1NZXNzYWdlID0gcGFyYW1JZCA/IHRoaXMubGl0ZXJhbHMuY29uZmlybVVwZGF0ZU1lc3NhZ2UgOiB0aGlzLmxpdGVyYWxzLmNvbmZpcm1TYXZlTWVzc2FnZTtcblxuICAgIHRoaXMudGhmRGlhbG9nU2VydmljZS5jb25maXJtKHtcbiAgICAgIHRpdGxlOiB0aGlzLmxpdGVyYWxzLmNvbmZpcm1hdGlvbixcbiAgICAgIG1lc3NhZ2U6IGNvbmZpcm1NZXNzYWdlLFxuICAgICAgY29uZmlybTogKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2RlbCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMubW9kZWwpO1xuXG4gICAgICAgIHRoaXMuc2F2ZShtb2RlbCwgcGFyYW1JZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW1pdFN1Y2Nlc3NNZXNzYWdlKG1zZ1N1Y2Nlc3M6IGFueSwgc2F2ZU9wZXJhdGlvbjogT2JzZXJ2YWJsZTxhbnk+KSB7XG4gICAgYXdhaXQgc2F2ZU9wZXJhdGlvbi50b1Byb21pc2UoKTtcbiAgICB0aGlzLnRoZk5vdGlmaWNhdGlvbi5zdWNjZXNzKG1zZ1N1Y2Nlc3MpO1xuICAgIHRoaXMucmVzZXRKb2JTY2hlZHVsZXJGb3JtKCk7XG4gIH1cblxuICBwcml2YXRlIGdldFBhcmFtZXRlcnNCeVByb2Nlc3MocHJvY2VzczogYW55KSB7XG5cbiAgICB0aGlzLnRoZlBhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlLmdldFBhcmFtZXRlcnNCeVByb2Nlc3MocHJvY2Vzcykuc3Vic2NyaWJlKHBhcmFtZXRlcnMgPT4ge1xuICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gcGFyYW1ldGVycztcbiAgICB9KTtcblxuICB9XG5cbiAgcHJpdmF0ZSBpc0Rpc2FibGVkQWR2YW5jZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24gPyB0aGlzLnNjaGVkdWxlckV4ZWN1dGlvbi5mb3JtLmludmFsaWQgOiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgaXNEaXNhYmxlZEJhY2soKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RlcCA9PT0gMTtcbiAgfVxuXG4gIHByaXZhdGUgbmV4dFN0ZXBPcGVyYXRpb24ob3BlcmF0aW9uPzogJ2JhY2snIHwgJ25leHQnKSB7XG4gICAgY29uc3Qgc3RlcE51bWJlciA9IG9wZXJhdGlvbiA9PT0gJ2JhY2snID8gdGhpcy5zdGVwIC0gMSA6IHRoaXMuc3RlcCArIDE7XG5cbiAgICB0aGlzLm5leHRTdGVwKHN0ZXBOdW1iZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNldEpvYlNjaGVkdWxlckZvcm0oKSB7XG4gICAgdGhpcy5zY2hlZHVsZXJFeGVjdXRpb24uZm9ybS5yZXNldCgpO1xuXG4gICAgLy8gcmFkaW9ncm91cCBuw6NvIGVzdGF2YSBhdHJpYnVpbmRvIG5vdm8gdmFsb3IsIGZpY2EgdmVybWVsaG8gc2VtIG8gdGltZXRvdXQuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLm1vZGVsID0gbmV3IFRoZlBhZ2VKb2JTY2hlZHVsZXJJbnRlcm5hbCgpO1xuXG4gICAgICB0aGlzLnN0ZXAgPSAxO1xuICAgICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgICBzdGVwLnN0YXR1cyA9IFRoZlN0ZXBwZXJTdGF0dXMuRGVmYXVsdDtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpvYlNjaGVkdWxlckFjdGlvbnMgPSBbLi4udGhpcy5uZXh0UGFnZUFjdGlvbnNdO1xuICAgIH0pO1xuXG4gIH1cblxuICBwcml2YXRlIHNhdmUobW9kZWw6IFRoZkpvYlNjaGVkdWxlckludGVybmFsLCBwYXJhbUlkKSB7XG4gICAgY29uc3Qgc2F2ZU9wZXJhdGlvbiA9IHBhcmFtSWRcbiAgICAgID8gdGhpcy50aGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZS51cGRhdGVSZXNvdXJjZShwYXJhbUlkLCBtb2RlbClcbiAgICAgIDogdGhpcy50aGZQYWdlSm9iU2NoZWR1bGVyU2VydmljZS5jcmVhdGVSZXNvdXJjZShtb2RlbCk7XG5cbiAgICBjb25zdCBtc2dTdWNjZXNzID0gcGFyYW1JZCA/IHRoaXMubGl0ZXJhbHMuc2F2ZU5vdGlmaWNhdGlvblN1Y2Nlc3NVcGRhdGUgOiB0aGlzLmxpdGVyYWxzLnNhdmVOb3RpZmljYXRpb25TdWNjZXNzU2F2ZTtcblxuICAgIHRoaXMuZW1pdFN1Y2Nlc3NNZXNzYWdlKG1zZ1N1Y2Nlc3MsIHNhdmVPcGVyYXRpb24pO1xuICB9XG5cbn1cbiJdfQ==