/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpResponse } from '@angular/common/http';
import { tap } from 'rxjs/operators';
/** @type {?} */
var NO_ERROR_HEADER_PARAM = 'X-Totvs-No-Error';
/**
 * \@description
 *
 * O serviço Totvs Http Interceptor realiza o tratamento de requisições HTTP conforme o padrão do
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) para adaptá-lo
 * ao modelo do THF.
 *
 * Ao analisar o objeto `_messages` retornado pela requisição, o serviço exibirá notificações com mensagens na tela.
 * Os retornos de erros com códigos 4xx e 5xx são tratados automaticamente, sem a necessidade de incluir o `_messages`.
 *
 * Também existe a possibilidade de não apresentar a notificação quando houver algum erro com códigos 4xx e 5xx,
 * utilizando o parâmetro `X-Totvs-No-Error` que foi definido conforme o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) (em Cabeçalhos Customizados).
 * O parâmetro `X-Totvs-No-Error` deve ser informado no cabeçalho da requisição com o valor `'true'` para funcionar corretamente,
 * por exemplo:
 *
 * ```
 * ...
 *  const headers = { 'X-Totvs-No-Error': 'true' };
 *
 *  this.http.get(`/customers/1`, { headers: headers });
 * ...
 *
 * ```
 * > Após a validação no interceptor, o parâmetro será removido do cabeçalho da requisição.
 *
 * O `Content-Type` deve ser `application/json` e a estrutura de mensagem recebida pelo serviço deve seguir o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395)
 * (em Mensagens de sucesso para coleções), exemplo:
 *  - _messages: lista de mensagens de erro ou informativo resultante do serviço.
 *    - type: success, warning, error, e information;
 *    - code: título ou código da mensagem;
 *    - message: texto da mensagem;
 *    - detailedMessage: detalhamento do erro ou informativo;
 *
 * Ao importar o módulo `ThfModule` na aplicação, o `thf-http-interceptor` é automaticamente configurado sem a necessidade
 * de qualquer configuração extra.
 *
 * Ao realizar requisições utilize o `HttpClient`, conforme exemplo abaixo:
 *
 * ```
 * import { HttpClient } from '\@angular/common/http';
 *
 * ...
 *
 * \@Injectable()
 * export class UserService {
 *
 *   constructor(private http: HttpClient) { }
 *
 *   getUsers() {
 *     return this.http.get('/api/users');
 *   }
 *
 *   ...
 *
 * }
 * ```
 *
 * @abstract
 */
var /**
 * \@description
 *
 * O serviço Totvs Http Interceptor realiza o tratamento de requisições HTTP conforme o padrão do
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) para adaptá-lo
 * ao modelo do THF.
 *
 * Ao analisar o objeto `_messages` retornado pela requisição, o serviço exibirá notificações com mensagens na tela.
 * Os retornos de erros com códigos 4xx e 5xx são tratados automaticamente, sem a necessidade de incluir o `_messages`.
 *
 * Também existe a possibilidade de não apresentar a notificação quando houver algum erro com códigos 4xx e 5xx,
 * utilizando o parâmetro `X-Totvs-No-Error` que foi definido conforme o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) (em Cabeçalhos Customizados).
 * O parâmetro `X-Totvs-No-Error` deve ser informado no cabeçalho da requisição com o valor `'true'` para funcionar corretamente,
 * por exemplo:
 *
 * ```
 * ...
 *  const headers = { 'X-Totvs-No-Error': 'true' };
 *
 *  this.http.get(`/customers/1`, { headers: headers });
 * ...
 *
 * ```
 * > Após a validação no interceptor, o parâmetro será removido do cabeçalho da requisição.
 *
 * O `Content-Type` deve ser `application/json` e a estrutura de mensagem recebida pelo serviço deve seguir o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395)
 * (em Mensagens de sucesso para coleções), exemplo:
 *  - _messages: lista de mensagens de erro ou informativo resultante do serviço.
 *    - type: success, warning, error, e information;
 *    - code: título ou código da mensagem;
 *    - message: texto da mensagem;
 *    - detailedMessage: detalhamento do erro ou informativo;
 *
 * Ao importar o módulo `ThfModule` na aplicação, o `thf-http-interceptor` é automaticamente configurado sem a necessidade
 * de qualquer configuração extra.
 *
 * Ao realizar requisições utilize o `HttpClient`, conforme exemplo abaixo:
 *
 * ```
 * import { HttpClient } from '\@angular/common/http';
 *
 * ...
 *
 * \@Injectable()
 * export class UserService {
 *
 *   constructor(private http: HttpClient) { }
 *
 *   getUsers() {
 *     return this.http.get('/api/users');
 *   }
 *
 *   ...
 *
 * }
 * ```
 *
 * @abstract
 */
ThfHttpInterceptorBaseService = /** @class */ (function () {
    function ThfHttpInterceptorBaseService(notification, dialog) {
        this.notification = notification;
        this.dialog = dialog;
        this.notificationTypes = ['success', 'warning', 'error', 'information'];
    }
    /**
     * @param {?} request
     * @param {?} next
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.intercept = /**
     * @param {?} request
     * @param {?} next
     * @return {?}
     */
    function (request, next) {
        var _this = this;
        /** @type {?} */
        var cloneRequest = request.clone();
        request = request.headers.has(NO_ERROR_HEADER_PARAM) ? this.cloneRequestWithoutNoErrorHeaderParam(request) : request;
        return next.handle(request).pipe(tap((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response instanceof HttpResponse) {
                _this.processResponse(response);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.processErrorResponse(error, cloneRequest);
        })));
    };
    /**
     * @param {?} response
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.processResponse = /**
     * @param {?} response
     * @return {?}
     */
    function (response) {
        var _this = this;
        if (response.body && response.body._messages) {
            /** @type {?} */
            var messages = response.body._messages;
            if (messages instanceof Array) {
                messages.forEach((/**
                 * @param {?} message
                 * @return {?}
                 */
                function (message) {
                    _this.showNotification(message);
                }));
            }
            else {
                this.showNotification(messages);
            }
        }
    };
    /**
     * @param {?} response
     * @param {?} request
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.processErrorResponse = /**
     * @param {?} response
     * @param {?} request
     * @return {?}
     */
    function (response, request) {
        /** @type {?} */
        var errorResponse = response.status !== 0
            ? response.error
            : { code: 0, message: 'Servidor não está respondendo.', detailedMessage: response.message };
        /** @type {?} */
        var hasNoErrorParam = this.hasNoErrorParam(request);
        // not show the notification when has NoError parameter on header of request.
        if (errorResponse && errorResponse.message && !hasNoErrorParam) {
            this.showNotification(tslib_1.__assign({}, errorResponse, { type: 'error' }));
        }
    };
    /**
     * @private
     * @param {?} request
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.cloneRequestWithoutNoErrorHeaderParam = /**
     * @private
     * @param {?} request
     * @return {?}
     */
    function (request) {
        return request && request.clone({ headers: request.headers.delete(NO_ERROR_HEADER_PARAM) });
    };
    /**
     * @private
     * @param {?} request
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.hasNoErrorParam = /**
     * @private
     * @param {?} request
     * @return {?}
     */
    function (request) {
        /** @type {?} */
        var noErrorParam = request && request.headers.get(NO_ERROR_HEADER_PARAM);
        return noErrorParam && noErrorParam.toString().toLocaleLowerCase() === 'true';
    };
    /**
     * @private
     * @param {?} response
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.showNotification = /**
     * @private
     * @param {?} response
     * @return {?}
     */
    function (response) {
        /** @type {?} */
        var typeNotification = this.notificationTypes.includes(response.type) ? response.type : 'information';
        /** @type {?} */
        var notificationAction = this.generateNotificationAction(response);
        this.notification[typeNotification]({
            message: response.message,
            actionLabel: notificationAction.label,
            action: notificationAction.action
        });
    };
    /**
     * @private
     * @param {?} errorResponse
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.generateNotificationAction = /**
     * @private
     * @param {?} errorResponse
     * @return {?}
     */
    function (errorResponse) {
        /** @type {?} */
        var notificationAction;
        /** @type {?} */
        var notificationLabel;
        /** @type {?} */
        var notificationMessage = errorResponse.message.concat(" " + errorResponse.detailedMessage);
        if (errorResponse.details && errorResponse.details instanceof Array) {
            errorResponse.details.forEach((/**
             * @param {?} detailError
             * @return {?}
             */
            function (detailError) {
                notificationMessage += "\n" + detailError.message;
            }));
        }
        if (errorResponse.helpUrl && !(errorResponse.detailedMessage || errorResponse.details)) {
            notificationLabel = 'Ajuda';
            notificationAction = this.generateUrlHelpFunction(errorResponse.helpUrl);
        }
        else if (errorResponse.detailedMessage || errorResponse.details) {
            notificationLabel = 'Detalhes';
            notificationAction = this.generateDialogDetailFunction(errorResponse, notificationMessage);
        }
        return { label: notificationLabel, action: notificationAction };
    };
    /**
     * @private
     * @param {?} helpUrl
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.generateUrlHelpFunction = /**
     * @private
     * @param {?} helpUrl
     * @return {?}
     */
    function (helpUrl) {
        return (/**
         * @return {?}
         */
        function () { window.open(helpUrl, '_blank'); });
    };
    /**
     * @private
     * @param {?} errorResponse
     * @param {?} notificationMessage
     * @return {?}
     */
    ThfHttpInterceptorBaseService.prototype.generateDialogDetailFunction = /**
     * @private
     * @param {?} errorResponse
     * @param {?} notificationMessage
     * @return {?}
     */
    function (errorResponse, notificationMessage) {
        var _this = this;
        return (/**
         * @return {?}
         */
        function () {
            _this.dialog.alert({
                title: errorResponse.code,
                message: notificationMessage,
                ok: errorResponse.helpUrl ? _this.generateUrlHelpFunction(errorResponse.helpUrl) : undefined
            });
        });
    };
    return ThfHttpInterceptorBaseService;
}());
/**
 * \@description
 *
 * O serviço Totvs Http Interceptor realiza o tratamento de requisições HTTP conforme o padrão do
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) para adaptá-lo
 * ao modelo do THF.
 *
 * Ao analisar o objeto `_messages` retornado pela requisição, o serviço exibirá notificações com mensagens na tela.
 * Os retornos de erros com códigos 4xx e 5xx são tratados automaticamente, sem a necessidade de incluir o `_messages`.
 *
 * Também existe a possibilidade de não apresentar a notificação quando houver algum erro com códigos 4xx e 5xx,
 * utilizando o parâmetro `X-Totvs-No-Error` que foi definido conforme o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395) (em Cabeçalhos Customizados).
 * O parâmetro `X-Totvs-No-Error` deve ser informado no cabeçalho da requisição com o valor `'true'` para funcionar corretamente,
 * por exemplo:
 *
 * ```
 * ...
 *  const headers = { 'X-Totvs-No-Error': 'true' };
 *
 *  this.http.get(`/customers/1`, { headers: headers });
 * ...
 *
 * ```
 * > Após a validação no interceptor, o parâmetro será removido do cabeçalho da requisição.
 *
 * O `Content-Type` deve ser `application/json` e a estrutura de mensagem recebida pelo serviço deve seguir o
 * [**Guia de implementação das APIs TOTVS**](http://tdn.totvs.com/pages/viewpage.action?pageId=484701395)
 * (em Mensagens de sucesso para coleções), exemplo:
 *  - _messages: lista de mensagens de erro ou informativo resultante do serviço.
 *    - type: success, warning, error, e information;
 *    - code: título ou código da mensagem;
 *    - message: texto da mensagem;
 *    - detailedMessage: detalhamento do erro ou informativo;
 *
 * Ao importar o módulo `ThfModule` na aplicação, o `thf-http-interceptor` é automaticamente configurado sem a necessidade
 * de qualquer configuração extra.
 *
 * Ao realizar requisições utilize o `HttpClient`, conforme exemplo abaixo:
 *
 * ```
 * import { HttpClient } from '\@angular/common/http';
 *
 * ...
 *
 * \@Injectable()
 * export class UserService {
 *
 *   constructor(private http: HttpClient) { }
 *
 *   getUsers() {
 *     return this.http.get('/api/users');
 *   }
 *
 *   ...
 *
 * }
 * ```
 *
 * @abstract
 */
export { ThfHttpInterceptorBaseService };
if (false) {
    /** @type {?} */
    ThfHttpInterceptorBaseService.prototype.notificationTypes;
    /**
     * @type {?}
     * @private
     */
    ThfHttpInterceptorBaseService.prototype.notification;
    /**
     * @type {?}
     * @private
     */
    ThfHttpInterceptorBaseService.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWh0dHAtaW50ZXJjZXB0b3ItYmFzZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9pbnRlcmNlcHRvcnMvdGhmLWh0dHAtaW50ZXJjZXB0b3IvdGhmLWh0dHAtaW50ZXJjZXB0b3ItYmFzZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUE2QyxZQUFZLEVBQWdDLE1BQU0sc0JBQXNCLENBQUM7QUFHN0gsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztJQUUvQixxQkFBcUIsR0FBRyxrQkFBa0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOERoRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFJRSx1Q0FBb0IsWUFBaUIsRUFBVSxNQUFXO1FBQXRDLGlCQUFZLEdBQVosWUFBWSxDQUFLO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBSztRQUYxRCxzQkFBaUIsR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBRUwsQ0FBQzs7Ozs7O0lBRS9ELGlEQUFTOzs7OztJQUFULFVBQVUsT0FBeUIsRUFBRSxJQUFpQjtRQUF0RCxpQkFpQkM7O1lBaEJPLFlBQVksR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFO1FBRXBDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUVySCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUc7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S0FBSyxFQUFFLGFBQWEsQ0FBQyxJQUFJO2dCQUN6QixPQUFPLEVBQUUsbUJBQW1CO2dCQUM1QixFQUFFLEVBQUUsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLHVCQUF1QixDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzthQUM1RixDQUFDLENBQUM7UUFDTCxDQUFDLEVBQUM7SUFDSixDQUFDO0lBQ0gsb0NBQUM7QUFBRCxDQUFDLEFBaEhELElBZ0hDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQTlHQywwREFBbUU7Ozs7O0lBRXZELHFEQUF5Qjs7Ozs7SUFBRSwrQ0FBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwSW50ZXJjZXB0b3IsIEh0dHBIYW5kbGVyLCBIdHRwUmVxdWVzdCwgSHR0cFJlc3BvbnNlLCBIdHRwRXZlbnQsIEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmNvbnN0IE5PX0VSUk9SX0hFQURFUl9QQVJBTSA9ICdYLVRvdHZzLU5vLUVycm9yJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIHNlcnZpw6dvIFRvdHZzIEh0dHAgSW50ZXJjZXB0b3IgcmVhbGl6YSBvIHRyYXRhbWVudG8gZGUgcmVxdWlzacOnw7VlcyBIVFRQIGNvbmZvcm1lIG8gcGFkcsOjbyBkb1xuICogWyoqR3VpYSBkZSBpbXBsZW1lbnRhw6fDo28gZGFzIEFQSXMgVE9UVlMqKl0oaHR0cDovL3Rkbi50b3R2cy5jb20vcGFnZXMvdmlld3BhZ2UuYWN0aW9uP3BhZ2VJZD00ODQ3MDEzOTUpIHBhcmEgYWRhcHTDoS1sb1xuICogYW8gbW9kZWxvIGRvIFRIRi5cbiAqXG4gKiBBbyBhbmFsaXNhciBvIG9iamV0byBgX21lc3NhZ2VzYCByZXRvcm5hZG8gcGVsYSByZXF1aXNpw6fDo28sIG8gc2VydmnDp28gZXhpYmlyw6Egbm90aWZpY2HDp8O1ZXMgY29tIG1lbnNhZ2VucyBuYSB0ZWxhLlxuICogT3MgcmV0b3Jub3MgZGUgZXJyb3MgY29tIGPDs2RpZ29zIDR4eCBlIDV4eCBzw6NvIHRyYXRhZG9zIGF1dG9tYXRpY2FtZW50ZSwgc2VtIGEgbmVjZXNzaWRhZGUgZGUgaW5jbHVpciBvIGBfbWVzc2FnZXNgLlxuICpcbiAqIFRhbWLDqW0gZXhpc3RlIGEgcG9zc2liaWxpZGFkZSBkZSBuw6NvIGFwcmVzZW50YXIgYSBub3RpZmljYcOnw6NvIHF1YW5kbyBob3V2ZXIgYWxndW0gZXJybyBjb20gY8OzZGlnb3MgNHh4IGUgNXh4LFxuICogdXRpbGl6YW5kbyBvIHBhcsOibWV0cm8gYFgtVG90dnMtTm8tRXJyb3JgIHF1ZSBmb2kgZGVmaW5pZG8gY29uZm9ybWUgb1xuICogWyoqR3VpYSBkZSBpbXBsZW1lbnRhw6fDo28gZGFzIEFQSXMgVE9UVlMqKl0oaHR0cDovL3Rkbi50b3R2cy5jb20vcGFnZXMvdmlld3BhZ2UuYWN0aW9uP3BhZ2VJZD00ODQ3MDEzOTUpIChlbSBDYWJlw6dhbGhvcyBDdXN0b21pemFkb3MpLlxuICogTyBwYXLDom1ldHJvIGBYLVRvdHZzLU5vLUVycm9yYCBkZXZlIHNlciBpbmZvcm1hZG8gbm8gY2FiZcOnYWxobyBkYSByZXF1aXNpw6fDo28gY29tIG8gdmFsb3IgYCd0cnVlJ2AgcGFyYSBmdW5jaW9uYXIgY29ycmV0YW1lbnRlLFxuICogcG9yIGV4ZW1wbG86XG4gKlxuICogYGBgXG4gKiAuLi5cbiAqICBjb25zdCBoZWFkZXJzID0geyAnWC1Ub3R2cy1Oby1FcnJvcic6ICd0cnVlJyB9O1xuICpcbiAqICB0aGlzLmh0dHAuZ2V0KGAvY3VzdG9tZXJzLzFgLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSk7XG4gKiAuLi5cbiAqXG4gKiBgYGBcbiAqID4gQXDDs3MgYSB2YWxpZGHDp8OjbyBubyBpbnRlcmNlcHRvciwgbyBwYXLDom1ldHJvIHNlcsOhIHJlbW92aWRvIGRvIGNhYmXDp2FsaG8gZGEgcmVxdWlzacOnw6NvLlxuICpcbiAqIE8gYENvbnRlbnQtVHlwZWAgZGV2ZSBzZXIgYGFwcGxpY2F0aW9uL2pzb25gIGUgYSBlc3RydXR1cmEgZGUgbWVuc2FnZW0gcmVjZWJpZGEgcGVsbyBzZXJ2acOnbyBkZXZlIHNlZ3VpciBvXG4gKiBbKipHdWlhIGRlIGltcGxlbWVudGHDp8OjbyBkYXMgQVBJcyBUT1RWUyoqXShodHRwOi8vdGRuLnRvdHZzLmNvbS9wYWdlcy92aWV3cGFnZS5hY3Rpb24/cGFnZUlkPTQ4NDcwMTM5NSlcbiAqIChlbSBNZW5zYWdlbnMgZGUgc3VjZXNzbyBwYXJhIGNvbGXDp8O1ZXMpLCBleGVtcGxvOlxuICogIC0gX21lc3NhZ2VzOiBsaXN0YSBkZSBtZW5zYWdlbnMgZGUgZXJybyBvdSBpbmZvcm1hdGl2byByZXN1bHRhbnRlIGRvIHNlcnZpw6dvLlxuICogICAgLSB0eXBlOiBzdWNjZXNzLCB3YXJuaW5nLCBlcnJvciwgZSBpbmZvcm1hdGlvbjtcbiAqICAgIC0gY29kZTogdMOtdHVsbyBvdSBjw7NkaWdvIGRhIG1lbnNhZ2VtO1xuICogICAgLSBtZXNzYWdlOiB0ZXh0byBkYSBtZW5zYWdlbTtcbiAqICAgIC0gZGV0YWlsZWRNZXNzYWdlOiBkZXRhbGhhbWVudG8gZG8gZXJybyBvdSBpbmZvcm1hdGl2bztcbiAqXG4gKiBBbyBpbXBvcnRhciBvIG3Ds2R1bG8gYFRoZk1vZHVsZWAgbmEgYXBsaWNhw6fDo28sIG8gYHRoZi1odHRwLWludGVyY2VwdG9yYCDDqSBhdXRvbWF0aWNhbWVudGUgY29uZmlndXJhZG8gc2VtIGEgbmVjZXNzaWRhZGVcbiAqIGRlIHF1YWxxdWVyIGNvbmZpZ3VyYcOnw6NvIGV4dHJhLlxuICpcbiAqIEFvIHJlYWxpemFyIHJlcXVpc2nDp8O1ZXMgdXRpbGl6ZSBvIGBIdHRwQ2xpZW50YCwgY29uZm9ybWUgZXhlbXBsbyBhYmFpeG86XG4gKlxuICogYGBgXG4gKiBpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuICpcbiAqIC4uLlxuICpcbiAqIEBJbmplY3RhYmxlKClcbiAqIGV4cG9ydCBjbGFzcyBVc2VyU2VydmljZSB7XG4gKlxuICogICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxuICpcbiAqICAgZ2V0VXNlcnMoKSB7XG4gKiAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoJy9hcGkvdXNlcnMnKTtcbiAqICAgfVxuICpcbiAqICAgLi4uXG4gKlxuICogfVxuICogYGBgXG4gKlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGhmSHR0cEludGVyY2VwdG9yQmFzZVNlcnZpY2UgaW1wbGVtZW50cyBIdHRwSW50ZXJjZXB0b3Ige1xuXG4gIG5vdGlmaWNhdGlvblR5cGVzID0gWydzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZXJyb3InLCAnaW5mb3JtYXRpb24nXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5vdGlmaWNhdGlvbjogYW55LCBwcml2YXRlIGRpYWxvZzogYW55KSB7IH1cblxuICBpbnRlcmNlcHQocmVxdWVzdDogSHR0cFJlcXVlc3Q8YW55PiwgbmV4dDogSHR0cEhhbmRsZXIpOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxhbnk+PiB7XG4gICAgY29uc3QgY2xvbmVSZXF1ZXN0ID0gcmVxdWVzdC5jbG9uZSgpO1xuXG4gICAgcmVxdWVzdCA9IHJlcXVlc3QuaGVhZGVycy5oYXMoTk9fRVJST1JfSEVBREVSX1BBUkFNKSA/IHRoaXMuY2xvbmVSZXF1ZXN0V2l0aG91dE5vRXJyb3JIZWFkZXJQYXJhbShyZXF1ZXN0KSA6IHJlcXVlc3Q7XG5cbiAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxdWVzdCkucGlwZSh0YXAoKHJlc3BvbnNlOiBIdHRwRXZlbnQ8YW55PikgPT4ge1xuXG4gICAgICBpZiAocmVzcG9uc2UgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UpIHtcblxuICAgICAgICB0aGlzLnByb2Nlc3NSZXNwb25zZShyZXNwb25zZSk7XG5cbiAgICAgIH1cbiAgICB9LCAoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG5cbiAgICAgIHRoaXMucHJvY2Vzc0Vycm9yUmVzcG9uc2UoZXJyb3IsIGNsb25lUmVxdWVzdCk7XG5cbiAgICB9KSk7XG4gIH1cblxuICBwcm9jZXNzUmVzcG9uc2UocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxhbnk+KSB7XG4gICAgaWYgKHJlc3BvbnNlLmJvZHkgJiYgcmVzcG9uc2UuYm9keS5fbWVzc2FnZXMpIHtcblxuICAgICAgY29uc3QgbWVzc2FnZXMgPSByZXNwb25zZS5ib2R5Ll9tZXNzYWdlcztcblxuICAgICAgaWYgKG1lc3NhZ2VzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgbWVzc2FnZXMuZm9yRWFjaCgobWVzc2FnZTogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5zaG93Tm90aWZpY2F0aW9uKG1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2hvd05vdGlmaWNhdGlvbihtZXNzYWdlcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvY2Vzc0Vycm9yUmVzcG9uc2UocmVzcG9uc2U6IEh0dHBFcnJvclJlc3BvbnNlLCByZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+KSB7XG4gICAgY29uc3QgZXJyb3JSZXNwb25zZSA9IHJlc3BvbnNlLnN0YXR1cyAhPT0gMFxuICAgICAgPyByZXNwb25zZS5lcnJvclxuICAgICAgOiB7IGNvZGU6IDAsIG1lc3NhZ2U6ICdTZXJ2aWRvciBuw6NvIGVzdMOhIHJlc3BvbmRlbmRvLicsIGRldGFpbGVkTWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSB9O1xuXG4gICAgY29uc3QgaGFzTm9FcnJvclBhcmFtID0gdGhpcy5oYXNOb0Vycm9yUGFyYW0ocmVxdWVzdCk7XG5cbiAgICAvLyBub3Qgc2hvdyB0aGUgbm90aWZpY2F0aW9uIHdoZW4gaGFzIE5vRXJyb3IgcGFyYW1ldGVyIG9uIGhlYWRlciBvZiByZXF1ZXN0LlxuICAgIGlmIChlcnJvclJlc3BvbnNlICYmIGVycm9yUmVzcG9uc2UubWVzc2FnZSAmJiAhaGFzTm9FcnJvclBhcmFtKSB7XG4gICAgICB0aGlzLnNob3dOb3RpZmljYXRpb24oeyAuLi5lcnJvclJlc3BvbnNlLCB0eXBlOiAnZXJyb3InIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xvbmVSZXF1ZXN0V2l0aG91dE5vRXJyb3JIZWFkZXJQYXJhbShyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+KTogSHR0cFJlcXVlc3Q8YW55PiB7XG4gICAgcmV0dXJuIHJlcXVlc3QgJiYgcmVxdWVzdC5jbG9uZSh7aGVhZGVyczogcmVxdWVzdC5oZWFkZXJzLmRlbGV0ZShOT19FUlJPUl9IRUFERVJfUEFSQU0pfSk7XG4gIH1cblxuICBwcml2YXRlIGhhc05vRXJyb3JQYXJhbShyZXF1ZXN0OiBIdHRwUmVxdWVzdDxhbnk+KTogYm9vbGVhbiB7XG4gICAgY29uc3Qgbm9FcnJvclBhcmFtID0gcmVxdWVzdCAmJiByZXF1ZXN0LmhlYWRlcnMuZ2V0KE5PX0VSUk9SX0hFQURFUl9QQVJBTSk7XG5cbiAgICByZXR1cm4gbm9FcnJvclBhcmFtICYmIG5vRXJyb3JQYXJhbS50b1N0cmluZygpLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICd0cnVlJztcbiAgfVxuXG4gIHByaXZhdGUgc2hvd05vdGlmaWNhdGlvbihyZXNwb25zZTogYW55KSB7XG4gICAgY29uc3QgdHlwZU5vdGlmaWNhdGlvbiA9IHRoaXMubm90aWZpY2F0aW9uVHlwZXMuaW5jbHVkZXMocmVzcG9uc2UudHlwZSkgPyByZXNwb25zZS50eXBlIDogJ2luZm9ybWF0aW9uJztcblxuICAgIGNvbnN0IG5vdGlmaWNhdGlvbkFjdGlvbiA9IHRoaXMuZ2VuZXJhdGVOb3RpZmljYXRpb25BY3Rpb24ocmVzcG9uc2UpO1xuXG4gICAgdGhpcy5ub3RpZmljYXRpb25bdHlwZU5vdGlmaWNhdGlvbl0oe1xuICAgICAgbWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSxcbiAgICAgIGFjdGlvbkxhYmVsOiBub3RpZmljYXRpb25BY3Rpb24ubGFiZWwsXG4gICAgICBhY3Rpb246IG5vdGlmaWNhdGlvbkFjdGlvbi5hY3Rpb25cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVOb3RpZmljYXRpb25BY3Rpb24oZXJyb3JSZXNwb25zZTogYW55KSB7XG5cbiAgICBsZXQgbm90aWZpY2F0aW9uQWN0aW9uO1xuICAgIGxldCBub3RpZmljYXRpb25MYWJlbDtcblxuICAgIGxldCBub3RpZmljYXRpb25NZXNzYWdlID0gZXJyb3JSZXNwb25zZS5tZXNzYWdlLmNvbmNhdChgICR7ZXJyb3JSZXNwb25zZS5kZXRhaWxlZE1lc3NhZ2V9YCk7XG5cbiAgICBpZiAoZXJyb3JSZXNwb25zZS5kZXRhaWxzICYmIGVycm9yUmVzcG9uc2UuZGV0YWlscyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICBlcnJvclJlc3BvbnNlLmRldGFpbHMuZm9yRWFjaCgoZGV0YWlsRXJyb3I6IGFueSkgPT4ge1xuICAgICAgICBub3RpZmljYXRpb25NZXNzYWdlICs9IGBcXG4ke2RldGFpbEVycm9yLm1lc3NhZ2V9YDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChlcnJvclJlc3BvbnNlLmhlbHBVcmwgJiYgIShlcnJvclJlc3BvbnNlLmRldGFpbGVkTWVzc2FnZSB8fCBlcnJvclJlc3BvbnNlLmRldGFpbHMpKSB7XG4gICAgICBub3RpZmljYXRpb25MYWJlbCA9ICdBanVkYSc7XG4gICAgICBub3RpZmljYXRpb25BY3Rpb24gPSB0aGlzLmdlbmVyYXRlVXJsSGVscEZ1bmN0aW9uKGVycm9yUmVzcG9uc2UuaGVscFVybCk7XG5cbiAgICB9IGVsc2UgaWYgKGVycm9yUmVzcG9uc2UuZGV0YWlsZWRNZXNzYWdlIHx8IGVycm9yUmVzcG9uc2UuZGV0YWlscykge1xuICAgICAgbm90aWZpY2F0aW9uTGFiZWwgPSAnRGV0YWxoZXMnO1xuICAgICAgbm90aWZpY2F0aW9uQWN0aW9uID0gdGhpcy5nZW5lcmF0ZURpYWxvZ0RldGFpbEZ1bmN0aW9uKGVycm9yUmVzcG9uc2UsIG5vdGlmaWNhdGlvbk1lc3NhZ2UpO1xuICAgIH1cbiAgICByZXR1cm4geyBsYWJlbDogbm90aWZpY2F0aW9uTGFiZWwsIGFjdGlvbjogbm90aWZpY2F0aW9uQWN0aW9uIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlVXJsSGVscEZ1bmN0aW9uKGhlbHBVcmw6IHN0cmluZykge1xuICAgIHJldHVybiAoKSA9PiB7IHdpbmRvdy5vcGVuKGhlbHBVcmwsICdfYmxhbmsnKTsgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVEaWFsb2dEZXRhaWxGdW5jdGlvbihlcnJvclJlc3BvbnNlOiBhbnksIG5vdGlmaWNhdGlvbk1lc3NhZ2U6IHN0cmluZykge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB0aGlzLmRpYWxvZy5hbGVydCh7XG4gICAgICAgIHRpdGxlOiBlcnJvclJlc3BvbnNlLmNvZGUsXG4gICAgICAgIG1lc3NhZ2U6IG5vdGlmaWNhdGlvbk1lc3NhZ2UsXG4gICAgICAgIG9rOiBlcnJvclJlc3BvbnNlLmhlbHBVcmwgPyB0aGlzLmdlbmVyYXRlVXJsSGVscEZ1bmN0aW9uKGVycm9yUmVzcG9uc2UuaGVscFVybCkgOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbn1cbiJdfQ==