/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ContentChildren, QueryList } from '@angular/core';
import { ThfStepComponent } from './thf-step/thf-step.component';
import { ThfStepperBaseComponent } from './thf-stepper-base.component';
import { ThfStepperStatus } from './enums/thf-stepper-status.enum';
/**
 * \@docsExtends ThfStepperBaseComponent
 *
 * \@example
 *
 * <example name="thf-stepper-basic" title="Totvs Stepper Basic">
 *  <file name="sample-thf-stepper-basic/sample-thf-stepper-basic.component.html"> </file>
 *  <file name="sample-thf-stepper-basic/sample-thf-stepper-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-stepper-labs" title="Totvs Stepper Labs">
 *  <file name="sample-thf-stepper-labs/sample-thf-stepper-labs.component.html"> </file>
 *  <file name="sample-thf-stepper-labs/sample-thf-stepper-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-stepper-sales" title="Totvs Stepper - Sales">
 *  <file name="sample-thf-stepper-sales/sample-thf-stepper-sales.component.html"> </file>
 *  <file name="sample-thf-stepper-sales/sample-thf-stepper-sales.component.ts"> </file>
 * </example>
 */
var ThfStepperComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfStepperComponent, _super);
    function ThfStepperComponent(changeDetector) {
        var _this = _super.call(this) || this;
        _this.changeDetector = changeDetector;
        return _this;
    }
    Object.defineProperty(ThfStepperComponent.prototype, "currentStepIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this.step - 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfStepperComponent.prototype, "stepList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.useThfSteps && this.thfSteps || this.steps;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfStepperComponent.prototype, "useThfSteps", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.thfSteps.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfStepperComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.activeFirstStep();
        this.thfSteps.changes.subscribe((/**
         * @return {?}
         */
        function () {
            _this.controlStepsStatus(0, _this.thfSteps.first);
        }));
    };
    /**
     * Altera o status do *step* para ativo.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     *
     * @param index {number} Índice do `thf-step` que se deseja ativar.
     */
    /**
     * Altera o status do *step* para ativo.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     *
     * @param {?} index {number} Índice do `thf-step` que se deseja ativar.
     * @return {?}
     */
    ThfStepperComponent.prototype.active = /**
     * Altera o status do *step* para ativo.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     *
     * @param {?} index {number} Índice do `thf-step` que se deseja ativar.
     * @return {?}
     */
    function (index) {
        if (!this.useThfSteps) {
            return;
        }
        /** @type {?} */
        var stepsArray = this.getThfSteps();
        /** @type {?} */
        var step = stepsArray[index];
        /** @type {?} */
        var isDisabledStep = step.status === ThfStepperStatus.Disabled;
        /** @type {?} */
        var isErrorStep = step.status === ThfStepperStatus.Error;
        if (!isDisabledStep || isErrorStep) {
            this.changeStep(index, step);
        }
    };
    /**
     * Ativa o primeiro *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     */
    /**
     * Ativa o primeiro *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    ThfStepperComponent.prototype.first = /**
     * Ativa o primeiro *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    function () {
        if (!this.useThfSteps) {
            return;
        }
        /** @type {?} */
        var firstStep = this.thfSteps.first;
        /** @type {?} */
        var firstStepIndex = 0;
        this.changeStep(firstStepIndex, firstStep);
    };
    /**
     * Ativa o próximo *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     */
    /**
     * Ativa o próximo *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    ThfStepperComponent.prototype.next = /**
     * Ativa o próximo *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    function () {
        if (!this.useThfSteps) {
            return;
        }
        var _a = this.getStepsAndIndex(this.currentActiveStep), steps = _a.steps, stepIndex = _a.stepIndex;
        /** @type {?} */
        var nextIndex = stepIndex + 1;
        /** @type {?} */
        var nextStep = steps[nextIndex];
        this.changeStep(nextIndex, nextStep);
    };
    /**
     * Ativa o *step* anterior.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     */
    /**
     * Ativa o *step* anterior.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    ThfStepperComponent.prototype.previous = /**
     * Ativa o *step* anterior.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    function () {
        if (!this.useThfSteps) {
            return;
        }
        var _a = this.getStepsAndIndex(this.currentActiveStep), steps = _a.steps, stepIndex = _a.stepIndex;
        /** @type {?} */
        var previousIndex = stepIndex - 1;
        /** @type {?} */
        var previousStep = steps[previousIndex];
        this.changeStep(previousIndex, previousStep);
    };
    /**
     * @param {?} stepIndex
     * @param {?=} step
     * @return {?}
     */
    ThfStepperComponent.prototype.changeStep = /**
     * @param {?} stepIndex
     * @param {?=} step
     * @return {?}
     */
    function (stepIndex, step) {
        /** @type {?} */
        var isDifferentStep = (!this.currentActiveStep || step.id !== this.currentActiveStep.id);
        if (this.useThfSteps && isDifferentStep && this.allowNextStep(stepIndex)) {
            this.controlStepsStatus(stepIndex, step);
            this.onChangeStep.emit(step);
        }
        else if (!this.useThfSteps && stepIndex !== this.currentStepIndex && this.allowNextStep(stepIndex)) {
            // if para tratamento do modelo antigo do thf-stepper
            this.onChangeStep.emit(stepIndex + 1);
        }
    };
    /**
     * @param {?} step
     * @return {?}
     */
    ThfStepperComponent.prototype.onStepActive = /**
     * @param {?} step
     * @return {?}
     */
    function (step) {
        this.currentActiveStep = step;
        this.previousActiveStep = this.thfSteps.find((/**
         * @param {?} stepChild
         * @return {?}
         */
        function (stepChild) { return stepChild.status === ThfStepperStatus.Active && stepChild.id !== step.id; }));
        this.setPreviousStepAsDone();
    };
    /**
     * @param {?} step
     * @return {?}
     */
    ThfStepperComponent.prototype.trackByFn = /**
     * @param {?} step
     * @return {?}
     */
    function (step) {
        return step.id;
    };
    /**
     * @private
     * @return {?}
     */
    ThfStepperComponent.prototype.activeFirstStep = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var hasStepActive = this.thfSteps.some((/**
         * @param {?} thfStep
         * @return {?}
         */
        function (thfStep) { return thfStep.status === ThfStepperStatus.Active; }));
        if (this.useThfSteps && !hasStepActive) {
            this.changeStep(0, this.thfSteps.first);
        }
    };
    /**
     * @private
     * @param {?} nextStepIndex
     * @return {?}
     */
    ThfStepperComponent.prototype.allowNextStep = /**
     * @private
     * @param {?} nextStepIndex
     * @return {?}
     */
    function (nextStepIndex) {
        if (!this.sequential) {
            return true;
        }
        if (this.useThfSteps) {
            return this.isBeforeStep(nextStepIndex) || this.canActiveNextStep(this.currentActiveStep);
        }
        return this.steps.slice(this.step, nextStepIndex).every((/**
         * @param {?} step
         * @return {?}
         */
        function (step) { return step.status === ThfStepperStatus.Done; }));
    };
    /**
     * @private
     * @param {?=} currentActiveStep
     * @return {?}
     */
    ThfStepperComponent.prototype.canActiveNextStep = /**
     * @private
     * @param {?=} currentActiveStep
     * @return {?}
     */
    function (currentActiveStep) {
        if (currentActiveStep === void 0) { currentActiveStep = (/** @type {?} */ ({})); }
        if (!currentActiveStep.canActiveNextStep) {
            return true;
        }
        /** @type {?} */
        var canActiveNextStep = currentActiveStep.canActiveNextStep(currentActiveStep);
        currentActiveStep.status = this.getStepperStatusByCanActive(canActiveNextStep);
        return canActiveNextStep;
    };
    /**
     * @private
     * @param {?} stepIndex
     * @param {?} step
     * @return {?}
     */
    ThfStepperComponent.prototype.controlStepsStatus = /**
     * @private
     * @param {?} stepIndex
     * @param {?} step
     * @return {?}
     */
    function (stepIndex, step) {
        if (this.useThfSteps) {
            this.setStepAsActive(step);
            this.setNextStepAsDefault(step);
            if (this.isBeforeStep(stepIndex)) {
                this.setFinalSteppersAsDisabled(stepIndex);
            }
            this.changeDetector.detectChanges();
        }
    };
    /**
     * @private
     * @param {?} canActiveNextStep
     * @return {?}
     */
    ThfStepperComponent.prototype.getStepperStatusByCanActive = /**
     * @private
     * @param {?} canActiveNextStep
     * @return {?}
     */
    function (canActiveNextStep) {
        return canActiveNextStep ? ThfStepperStatus.Done : ThfStepperStatus.Error;
    };
    /**
     * @private
     * @param {?=} step
     * @return {?}
     */
    ThfStepperComponent.prototype.getStepsAndIndex = /**
     * @private
     * @param {?=} step
     * @return {?}
     */
    function (step) {
        if (step === void 0) { step = (/** @type {?} */ ({})); }
        /** @type {?} */
        var steps = this.getThfSteps();
        /** @type {?} */
        var stepIndex = steps.findIndex((/**
         * @param {?} thfStep
         * @return {?}
         */
        function (thfStep) { return thfStep.id === step.id; }));
        return { steps: steps, stepIndex: stepIndex };
    };
    /**
     * @private
     * @return {?}
     */
    ThfStepperComponent.prototype.getThfSteps = /**
     * @private
     * @return {?}
     */
    function () {
        return this.thfSteps.toArray();
    };
    /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    ThfStepperComponent.prototype.isBeforeStep = /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    function (stepIndex) {
        var _this = this;
        /** @type {?} */
        var currentActiveStepIndex = (/**
         * @return {?}
         */
        function () { return _this.getThfSteps().findIndex((/**
         * @param {?} step
         * @return {?}
         */
        function (step) { return step.id === _this.currentActiveStep.id; })); });
        return !!this.currentActiveStep && currentActiveStepIndex() >= stepIndex;
    };
    /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    ThfStepperComponent.prototype.setFinalSteppersAsDisabled = /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    function (stepIndex) {
        this.getThfSteps()
            .filter((/**
         * @param {?} step
         * @param {?} index
         * @return {?}
         */
        function (step, index) { return step && index >= stepIndex + 2; }))
            .forEach((/**
         * @param {?} step
         * @return {?}
         */
        function (step) { return step.status = ThfStepperStatus.Disabled; }));
    };
    /**
     * @private
     * @param {?} step
     * @return {?}
     */
    ThfStepperComponent.prototype.setStepAsActive = /**
     * @private
     * @param {?} step
     * @return {?}
     */
    function (step) {
        step.status = ThfStepperStatus.Active;
    };
    /**
     * @private
     * @param {?} currentStep
     * @return {?}
     */
    ThfStepperComponent.prototype.setNextStepAsDefault = /**
     * @private
     * @param {?} currentStep
     * @return {?}
     */
    function (currentStep) {
        var _a = this.getStepsAndIndex(currentStep), steps = _a.steps, stepIndex = _a.stepIndex;
        /** @type {?} */
        var nextIndex = stepIndex + 1;
        if (nextIndex < this.thfSteps.length) {
            steps[nextIndex].status = ThfStepperStatus.Default;
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfStepperComponent.prototype.setPreviousStepAsDone = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.previousActiveStep) {
            this.previousActiveStep.status = ThfStepperStatus.Done;
        }
    };
    ThfStepperComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-stepper',
                    template: "<div class=\"thf-stepper thf-stepper-{{ orientation }}\">\n\n  <div class=\"thf-stepper-container\">\n    <thf-stepper-step *ngFor=\"let step of stepList; let index = index; trackBy: trackByFn\"\n      class=\"thf-stepper-step-position\"\n      [t-circle-content]=\"index+1\"\n      [t-label]=\"step.label\"\n      [t-orientation]=\"orientation\"\n      [t-status]=\"step.status\"\n      [t-step-icons]=\"stepIcons\"\n      [t-step-size]=\"stepSize\"\n      (t-activated)=\"onStepActive(step)\"\n      (t-click)=\"changeStep(index, step)\"\n      (t-enter)=\"changeStep(index, step)\">\n    </thf-stepper-step>\n  </div>\n\n  <div *ngIf=\"useThfSteps\" class=\"thf-stepper-content\">\n    <ng-content></ng-content>\n  </div>\n\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    ThfStepperComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    ThfStepperComponent.propDecorators = {
        thfSteps: [{ type: ContentChildren, args: [ThfStepComponent,] }]
    };
    return ThfStepperComponent;
}(ThfStepperBaseComponent));
export { ThfStepperComponent };
if (false) {
    /** @type {?} */
    ThfStepperComponent.prototype.thfSteps;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.currentActiveStep;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.previousActiveStep;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXN0ZXBwZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1zdGVwcGVyL3RoZi1zdGVwcGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBb0IsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0csT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDakUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFdkUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNCbkU7SUFJeUMsK0NBQXVCO0lBbUI5RCw2QkFBb0IsY0FBaUM7UUFBckQsWUFDRSxpQkFBTyxTQUNSO1FBRm1CLG9CQUFjLEdBQWQsY0FBYyxDQUFtQjs7SUFFckQsQ0FBQztJQWRELHNCQUFJLGlEQUFnQjs7OztRQUFwQjtZQUNFLE9BQU8sSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDdkIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx5Q0FBUTs7OztRQUFaO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN6RCxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRDQUFXOzs7O1FBQWY7WUFDRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUNoQyxDQUFDOzs7T0FBQTs7OztJQU1ELGdEQUFrQjs7O0lBQWxCO1FBQUEsaUJBTUM7UUFMQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FB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QXVDLEVBQUMsQ0FBQztJQUM5RCxDQUFDOzs7Ozs7SUFFTyw2Q0FBZTs7Ozs7SUFBdkIsVUFBd0IsSUFBc0I7UUFDNUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7SUFDeEMsQ0FBQzs7Ozs7O0lBRU8sa0RBQW9COzs7OztJQUE1QixVQUE2QixXQUE2QjtRQUNsRCxJQUFBLHVDQUF5RCxFQUF2RCxnQkFBSyxFQUFFLHdCQUFnRDs7WUFDekQsU0FBUyxHQUFHLFNBQVMsR0FBRyxDQUFDO1FBRS9CLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFO1lBQ3BDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO1NBQ3BEO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxtREFBcUI7Ozs7SUFBN0I7UUFDRSxJQUFJLElBQUksQ0FBQyxrQkFBa0IsRUFBRTtZQUMzQixJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQztTQUN4RDtJQUNILENBQUM7O2dCQS9ORixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGFBQWE7b0JBQ3ZCLDR1QkFBMkM7aUJBQzVDOzs7O2dCQTlCMEIsaUJBQWlCOzs7MkJBaUN6QyxlQUFlLFNBQUMsZ0JBQWdCOztJQTJObkMsMEJBQUM7Q0FBQSxBQWpPRCxDQUl5Qyx1QkFBdUIsR0E2Ti9EO1NBN05ZLG1CQUFtQjs7O0lBRTlCLHVDQUF5RTs7Ozs7SUFFekUsZ0RBQTRDOzs7OztJQUM1QyxpREFBNkM7Ozs7O0lBY2pDLDZDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyQ29udGVudEluaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFRoZlN0ZXBDb21wb25lbnQgfSBmcm9tICcuL3RoZi1zdGVwL3RoZi1zdGVwLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZTdGVwcGVyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXN0ZXBwZXItYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmU3RlcHBlckl0ZW0gfSBmcm9tICcuL3RoZi1zdGVwcGVyLWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFRoZlN0ZXBwZXJTdGF0dXMgfSBmcm9tICcuL2VudW1zL3RoZi1zdGVwcGVyLXN0YXR1cy5lbnVtJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmU3RlcHBlckJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtc3RlcHBlci1iYXNpY1wiIHRpdGxlPVwiVG90dnMgU3RlcHBlciBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXN0ZXBwZXItYmFzaWMvc2FtcGxlLXRoZi1zdGVwcGVyLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1zdGVwcGVyLWJhc2ljL3NhbXBsZS10aGYtc3RlcHBlci1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtc3RlcHBlci1sYWJzXCIgdGl0bGU9XCJUb3R2cyBTdGVwcGVyIExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1zdGVwcGVyLWxhYnMvc2FtcGxlLXRoZi1zdGVwcGVyLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXN0ZXBwZXItbGFicy9zYW1wbGUtdGhmLXN0ZXBwZXItbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtc3RlcHBlci1zYWxlc1wiIHRpdGxlPVwiVG90dnMgU3RlcHBlciAtIFNhbGVzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc3RlcHBlci1zYWxlcy9zYW1wbGUtdGhmLXN0ZXBwZXItc2FsZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXN0ZXBwZXItc2FsZXMvc2FtcGxlLXRoZi1zdGVwcGVyLXNhbGVzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1zdGVwcGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RoZi1zdGVwcGVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBUaGZTdGVwcGVyQ29tcG9uZW50IGV4dGVuZHMgVGhmU3RlcHBlckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0IHtcblxuICBAQ29udGVudENoaWxkcmVuKFRoZlN0ZXBDb21wb25lbnQpIHRoZlN0ZXBzOiBRdWVyeUxpc3Q8VGhmU3RlcENvbXBvbmVudD47XG5cbiAgcHJpdmF0ZSBjdXJyZW50QWN0aXZlU3RlcDogVGhmU3RlcENvbXBvbmVudDtcbiAgcHJpdmF0ZSBwcmV2aW91c0FjdGl2ZVN0ZXA6IFRoZlN0ZXBDb21wb25lbnQ7XG5cbiAgZ2V0IGN1cnJlbnRTdGVwSW5kZXgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5zdGVwIC0gMTtcbiAgfVxuXG4gIGdldCBzdGVwTGlzdCgpOiBRdWVyeUxpc3Q8VGhmU3RlcENvbXBvbmVudD4gfCBBcnJheTxUaGZTdGVwcGVySXRlbT4ge1xuICAgIHJldHVybiB0aGlzLnVzZVRoZlN0ZXBzICYmIHRoaXMudGhmU3RlcHMgfHwgdGhpcy5zdGVwcztcbiAgfVxuXG4gIGdldCB1c2VUaGZTdGVwcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLnRoZlN0ZXBzLmxlbmd0aDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICB0aGlzLmFjdGl2ZUZpcnN0U3RlcCgpO1xuXG4gICAgdGhpcy50aGZTdGVwcy5jaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRyb2xTdGVwc1N0YXR1cygwLCB0aGlzLnRoZlN0ZXBzLmZpcnN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbHRlcmEgbyBzdGF0dXMgZG8gKnN0ZXAqIHBhcmEgYXRpdm8uXG4gICAqXG4gICAqID4gRXN0ZSBtw6l0b2RvIMOpIHZhbGlkbyBhcGVuYXMgcGFyYSBhcyBpbXBsZW1lbnRhw6fDtWVzIHF1ZSB1dGlsaXphbSBvIGNvbXBvbmVudGUgWyoqdGhmLXN0ZXAqKl0oL2RvY3VtZW50YXRpb24vdGhmLXN0ZXApLlxuICAgKlxuICAgKiBAcGFyYW0gaW5kZXgge251bWJlcn0gw41uZGljZSBkbyBgdGhmLXN0ZXBgIHF1ZSBzZSBkZXNlamEgYXRpdmFyLlxuICAgKi9cbiAgYWN0aXZlKGluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudXNlVGhmU3RlcHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzdGVwc0FycmF5ID0gdGhpcy5nZXRUaGZTdGVwcygpO1xuICAgIGNvbnN0IHN0ZXAgPSBzdGVwc0FycmF5W2luZGV4XTtcbiAgICBjb25zdCBpc0Rpc2FibGVkU3RlcCA9IHN0ZXAuc3RhdHVzID09PSBUaGZTdGVwcGVyU3RhdHVzLkRpc2FibGVkO1xuICAgIGNvbnN0IGlzRXJyb3JTdGVwID0gc3RlcC5zdGF0dXMgPT09IFRoZlN0ZXBwZXJTdGF0dXMuRXJyb3I7XG5cbiAgICBpZiAoIWlzRGlzYWJsZWRTdGVwIHx8IGlzRXJyb3JTdGVwKSB7XG4gICAgICB0aGlzLmNoYW5nZVN0ZXAoaW5kZXgsIHN0ZXApO1xuICAgIH1cblxuICB9XG5cbiAgLyoqXG4gICAqIEF0aXZhIG8gcHJpbWVpcm8gKnN0ZXAqLlxuICAgKlxuICAgKiA+IEVzdGUgbcOpdG9kbyDDqSB2YWxpZG8gYXBlbmFzIHBhcmEgYXMgaW1wbGVtZW50YcOnw7VlcyBxdWUgdXRpbGl6YW0gbyBjb21wb25lbnRlIFsqKnRoZi1zdGVwKipdKC9kb2N1bWVudGF0aW9uL3RoZi1zdGVwKS5cbiAgICovXG4gIGZpcnN0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy51c2VUaGZTdGVwcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZpcnN0U3RlcCA9IHRoaXMudGhmU3RlcHMuZmlyc3Q7XG4gICAgY29uc3QgZmlyc3RTdGVwSW5kZXggPSAwO1xuXG4gICAgdGhpcy5jaGFuZ2VTdGVwKGZpcnN0U3RlcEluZGV4LCBmaXJzdFN0ZXApO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0aXZhIG8gcHLDs3hpbW8gKnN0ZXAqLlxuICAgKlxuICAgKiA+IEVzdGUgbcOpdG9kbyDDqSB2YWxpZG8gYXBlbmFzIHBhcmEgYXMgaW1wbGVtZW50YcOnw7VlcyBxdWUgdXRpbGl6YW0gbyBjb21wb25lbnRlIFsqKnRoZi1zdGVwKipdKC9kb2N1bWVudGF0aW9uL3RoZi1zdGVwKS5cbiAgICovXG4gIG5leHQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnVzZVRoZlN0ZXBzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdGVwcywgc3RlcEluZGV4IH0gPSB0aGlzLmdldFN0ZXBzQW5kSW5kZXgodGhpcy5jdXJyZW50QWN0aXZlU3RlcCk7XG4gICAgY29uc3QgbmV4dEluZGV4ID0gc3RlcEluZGV4ICsgMTtcbiAgICBjb25zdCBuZXh0U3RlcCA9IHN0ZXBzW25leHRJbmRleF07XG5cbiAgICB0aGlzLmNoYW5nZVN0ZXAobmV4dEluZGV4LCBuZXh0U3RlcCk7XG4gIH1cblxuICAvKipcbiAgICogQXRpdmEgbyAqc3RlcCogYW50ZXJpb3IuXG4gICAqXG4gICAqID4gRXN0ZSBtw6l0b2RvIMOpIHZhbGlkbyBhcGVuYXMgcGFyYSBhcyBpbXBsZW1lbnRhw6fDtWVzIHF1ZSB1dGlsaXphbSBvIGNvbXBvbmVudGUgWyoqdGhmLXN0ZXAqKl0oL2RvY3VtZW50YXRpb24vdGhmLXN0ZXApLlxuICAgKi9cbiAgcHJldmlvdXMoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnVzZVRoZlN0ZXBzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdGVwcywgc3RlcEluZGV4IH0gPSB0aGlzLmdldFN0ZXBzQW5kSW5kZXgodGhpcy5jdXJyZW50QWN0aXZlU3RlcCk7XG4gICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHN0ZXBJbmRleCAtIDE7XG4gICAgY29uc3QgcHJldmlvdXNTdGVwID0gc3RlcHNbcHJldmlvdXNJbmRleF07XG5cbiAgICB0aGlzLmNoYW5nZVN0ZXAocHJldmlvdXNJbmRleCwgcHJldmlvdXNTdGVwKTtcbiAgfVxuXG4gIGNoYW5nZVN0ZXAoc3RlcEluZGV4OiBudW1iZXIsIHN0ZXA/OiBUaGZTdGVwQ29tcG9uZW50KTogdm9pZCB7XG4gICAgY29uc3QgaXNEaWZmZXJlbnRTdGVwID0gKCF0aGlzLmN1cnJlbnRBY3RpdmVTdGVwIHx8IHN0ZXAuaWQgIT09IHRoaXMuY3VycmVudEFjdGl2ZVN0ZXAuaWQpO1xuXG4gICAgaWYgKHRoaXMudXNlVGhmU3RlcHMgJiYgaXNEaWZmZXJlbnRTdGVwICYmIHRoaXMuYWxsb3dOZXh0U3RlcChzdGVwSW5kZXgpKSB7XG4gICAgICB0aGlzLmNvbnRyb2xTdGVwc1N0YXR1cyhzdGVwSW5kZXgsIHN0ZXApO1xuXG4gICAgICB0aGlzLm9uQ2hhbmdlU3RlcC5lbWl0KHN0ZXApO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMudXNlVGhmU3RlcHMgJiYgc3RlcEluZGV4ICE9PSB0aGlzLmN1cnJlbnRTdGVwSW5kZXggJiYgdGhpcy5hbGxvd05leHRTdGVwKHN0ZXBJbmRleCkpIHtcbiAgICAgIC8vIGlmIHBhcmEgdHJhdGFtZW50byBkbyBtb2RlbG8gYW50aWdvIGRvIHRoZi1zdGVwcGVyXG4gICAgICB0aGlzLm9uQ2hhbmdlU3RlcC5lbWl0KHN0ZXBJbmRleCArIDEpO1xuICAgIH1cbiAgfVxuXG4gIG9uU3RlcEFjdGl2ZShzdGVwOiBUaGZTdGVwQ29tcG9uZW50KSB7XG4gICAgdGhpcy5jdXJyZW50QWN0aXZlU3RlcCA9IHN0ZXA7XG5cbiAgICB0aGlzLnByZXZpb3VzQWN0aXZlU3RlcCA9IHRoaXMudGhmU3RlcHMuZmluZChzdGVwQ2hpbGQgPT4gc3RlcENoaWxkLnN0YXR1cyA9PT0gVGhmU3RlcHBlclN0YXR1cy5BY3RpdmUgJiYgc3RlcENoaWxkLmlkICE9PSBzdGVwLmlkKTtcblxuICAgIHRoaXMuc2V0UHJldmlvdXNTdGVwQXNEb25lKCk7XG4gIH1cblxuICB0cmFja0J5Rm4oc3RlcDogVGhmU3RlcENvbXBvbmVudCkge1xuICAgIHJldHVybiBzdGVwLmlkO1xuICB9XG5cbiAgcHJpdmF0ZSBhY3RpdmVGaXJzdFN0ZXAoKSB7XG4gICAgY29uc3QgaGFzU3RlcEFjdGl2ZSA9IHRoaXMudGhmU3RlcHMuc29tZSh0aGZTdGVwID0+IHRoZlN0ZXAuc3RhdHVzID09PSBUaGZTdGVwcGVyU3RhdHVzLkFjdGl2ZSk7XG5cbiAgICBpZiAodGhpcy51c2VUaGZTdGVwcyAmJiAhaGFzU3RlcEFjdGl2ZSkge1xuICAgICAgdGhpcy5jaGFuZ2VTdGVwKDAsIHRoaXMudGhmU3RlcHMuZmlyc3QpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWxsb3dOZXh0U3RlcChuZXh0U3RlcEluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuc2VxdWVudGlhbCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudXNlVGhmU3RlcHMpIHtcbiAgICAgIHJldHVybiB0aGlzLmlzQmVmb3JlU3RlcChuZXh0U3RlcEluZGV4KSB8fCB0aGlzLmNhbkFjdGl2ZU5leHRTdGVwKHRoaXMuY3VycmVudEFjdGl2ZVN0ZXApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnN0ZXBzLnNsaWNlKHRoaXMuc3RlcCwgbmV4dFN0ZXBJbmRleCkuZXZlcnkoc3RlcCA9PiBzdGVwLnN0YXR1cyA9PT0gVGhmU3RlcHBlclN0YXR1cy5Eb25lKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FuQWN0aXZlTmV4dFN0ZXAoY3VycmVudEFjdGl2ZVN0ZXAgPSA8YW55PiB7fSkge1xuICAgIGlmICghY3VycmVudEFjdGl2ZVN0ZXAuY2FuQWN0aXZlTmV4dFN0ZXApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IGNhbkFjdGl2ZU5leHRTdGVwID0gY3VycmVudEFjdGl2ZVN0ZXAuY2FuQWN0aXZlTmV4dFN0ZXAoY3VycmVudEFjdGl2ZVN0ZXApO1xuXG4gICAgY3VycmVudEFjdGl2ZVN0ZXAuc3RhdHVzID0gdGhpcy5nZXRTdGVwcGVyU3RhdHVzQnlDYW5BY3RpdmUoY2FuQWN0aXZlTmV4dFN0ZXApO1xuXG4gICAgcmV0dXJuIGNhbkFjdGl2ZU5leHRTdGVwO1xuICB9XG5cbiAgcHJpdmF0ZSBjb250cm9sU3RlcHNTdGF0dXMoc3RlcEluZGV4OiBudW1iZXIsIHN0ZXA6IFRoZlN0ZXBDb21wb25lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy51c2VUaGZTdGVwcykge1xuXG4gICAgICB0aGlzLnNldFN0ZXBBc0FjdGl2ZShzdGVwKTtcbiAgICAgIHRoaXMuc2V0TmV4dFN0ZXBBc0RlZmF1bHQoc3RlcCk7XG5cbiAgICAgIGlmICh0aGlzLmlzQmVmb3JlU3RlcChzdGVwSW5kZXgpKSB7XG4gICAgICAgIHRoaXMuc2V0RmluYWxTdGVwcGVyc0FzRGlzYWJsZWQoc3RlcEluZGV4KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRTdGVwcGVyU3RhdHVzQnlDYW5BY3RpdmUoY2FuQWN0aXZlTmV4dFN0ZXApOiBUaGZTdGVwcGVyU3RhdHVzIHtcbiAgICByZXR1cm4gY2FuQWN0aXZlTmV4dFN0ZXAgPyBUaGZTdGVwcGVyU3RhdHVzLkRvbmUgOiBUaGZTdGVwcGVyU3RhdHVzLkVycm9yO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTdGVwc0FuZEluZGV4KHN0ZXA6IFRoZlN0ZXBDb21wb25lbnQgPSA8YW55PiB7fSk6IHsgc3RlcHM6IEFycmF5PFRoZlN0ZXBDb21wb25lbnQ+LCBzdGVwSW5kZXg6IG51bWJlciB9IHtcbiAgICBjb25zdCBzdGVwcyA9IHRoaXMuZ2V0VGhmU3RlcHMoKTtcbiAgICBjb25zdCBzdGVwSW5kZXggPSBzdGVwcy5maW5kSW5kZXgodGhmU3RlcCA9PiB0aGZTdGVwLmlkID09PSBzdGVwLmlkKTtcblxuICAgIHJldHVybiB7IHN0ZXBzLCBzdGVwSW5kZXggfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGhmU3RlcHMoKTogQXJyYXk8VGhmU3RlcENvbXBvbmVudD4ge1xuICAgIHJldHVybiB0aGlzLnRoZlN0ZXBzLnRvQXJyYXkoKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNCZWZvcmVTdGVwKHN0ZXBJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudEFjdGl2ZVN0ZXBJbmRleCA9ICgpID0+IHRoaXMuZ2V0VGhmU3RlcHMoKS5maW5kSW5kZXgoc3RlcCA9PiBzdGVwLmlkID09PSB0aGlzLmN1cnJlbnRBY3RpdmVTdGVwLmlkKTtcblxuICAgIHJldHVybiAhIXRoaXMuY3VycmVudEFjdGl2ZVN0ZXAgJiYgY3VycmVudEFjdGl2ZVN0ZXBJbmRleCgpID49IHN0ZXBJbmRleDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RmluYWxTdGVwcGVyc0FzRGlzYWJsZWQoc3RlcEluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmdldFRoZlN0ZXBzKClcbiAgICAgIC5maWx0ZXIoKHN0ZXAsIGluZGV4KSA9PiBzdGVwICYmIGluZGV4ID49IHN0ZXBJbmRleCArIDIpXG4gICAgICAuZm9yRWFjaChzdGVwID0+IHN0ZXAuc3RhdHVzID0gVGhmU3RlcHBlclN0YXR1cy5EaXNhYmxlZCk7XG4gIH1cblxuICBwcml2YXRlIHNldFN0ZXBBc0FjdGl2ZShzdGVwOiBUaGZTdGVwQ29tcG9uZW50KTogdm9pZCB7XG4gICAgc3RlcC5zdGF0dXMgPSBUaGZTdGVwcGVyU3RhdHVzLkFjdGl2ZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0TmV4dFN0ZXBBc0RlZmF1bHQoY3VycmVudFN0ZXA6IFRoZlN0ZXBDb21wb25lbnQpOiB2b2lkIHtcbiAgICBjb25zdCB7IHN0ZXBzLCBzdGVwSW5kZXggfSA9IHRoaXMuZ2V0U3RlcHNBbmRJbmRleChjdXJyZW50U3RlcCk7XG4gICAgY29uc3QgbmV4dEluZGV4ID0gc3RlcEluZGV4ICsgMTtcblxuICAgIGlmIChuZXh0SW5kZXggPCB0aGlzLnRoZlN0ZXBzLmxlbmd0aCkge1xuICAgICAgc3RlcHNbbmV4dEluZGV4XS5zdGF0dXMgPSBUaGZTdGVwcGVyU3RhdHVzLkRlZmF1bHQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRQcmV2aW91c1N0ZXBBc0RvbmUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucHJldmlvdXNBY3RpdmVTdGVwKSB7XG4gICAgICB0aGlzLnByZXZpb3VzQWN0aXZlU3RlcC5zdGF0dXMgPSBUaGZTdGVwcGVyU3RhdHVzLkRvbmU7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==