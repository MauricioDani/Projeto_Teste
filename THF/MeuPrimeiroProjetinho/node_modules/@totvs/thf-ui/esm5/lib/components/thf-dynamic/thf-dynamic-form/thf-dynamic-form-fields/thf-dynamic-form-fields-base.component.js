/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Input } from '@angular/core';
import { isTypeof } from '../../../../utils/util';
import { getGridColumnsClasses, isVisibleField } from '../../thf-dynamic.util';
import { ThfDynamicFieldType } from '../../thf-dynamic-field-type.enum';
var ThfDynamicFormFieldsBaseComponent = /** @class */ (function () {
    function ThfDynamicFormFieldsBaseComponent(titleCasePipe) {
        this.titleCasePipe = titleCasePipe;
        this._value = {};
        this.visibleFields = [];
    }
    Object.defineProperty(ThfDynamicFormFieldsBaseComponent.prototype, "fields", {
        get: /**
         * @return {?}
         */
        function () {
            return this._fields;
        },
        // array de objetos que implementam a interface ThfDynamicFormField, que serão exibidos no componente.
        set: 
        // array de objetos que implementam a interface ThfDynamicFormField, que serão exibidos no componente.
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._fields = Array.isArray(value) ? tslib_1.__spread(value) : [];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfDynamicFormFieldsBaseComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        // valor que será utilizado para iniciar valor no componente.
        set: 
        // valor que será utilizado para iniciar valor no componente.
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._value = value && isTypeof(value, 'object') ? value : {};
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @param {?} compareTo
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.compareTo = /**
     * @param {?} value
     * @param {?} compareTo
     * @return {?}
     */
    function (value, compareTo) {
        return value === compareTo;
    };
    // retorna um array com os objetos configurados e visiveis.
    // retorna um array com os objetos configurados e visiveis.
    /**
     * @protected
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.getVisibleFields = 
    // retorna um array com os objetos configurados e visiveis.
    /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var visibleFields = [];
        this.fields.forEach((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            if (_this.existsProperty(visibleFields, field.property)) {
                _this.printError("\"thf-dynamic-form\" property \"" + field.property + "\" est\u00E1 duplicado. Interface: ThfDynamicFormField.");
                return;
            }
            if (!field['property']) {
                _this.printError('"thf-dynamic-form" É obrigatório ser especificado um property.');
                return;
            }
            if (isVisibleField(field)) {
                visibleFields.push(_this.createField(field));
            }
        }));
        return visibleFields;
    };
    // converte um array em string para um array de objetos que contem label e value.
    // converte um array em string para um array de objetos que contem label e value.
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.convertOptions = 
    // converte um array em string para um array de objetos que contem label e value.
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var everyOptionString = options.every((/**
         * @param {?} option
         * @return {?}
         */
        function (option) { return typeof option === 'string'; }));
        if (everyOptionString) {
            return options.map((/**
             * @param {?} value
             * @return {?}
             */
            function (value) { return ({ label: value, value: value }); }));
        }
        return options;
    };
    // cria um novo objeto com as classes de grid system, com control (tipo do componente) e label default.
    // cria um novo objeto com as classes de grid system, com control (tipo do componente) e label default.
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.createField = 
    // cria um novo objeto com as classes de grid system, com control (tipo do componente) e label default.
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var control = this.getComponentControl(field);
        /** @type {?} */
        var options = !!field.options ? this.convertOptions(field.options) : undefined;
        /** @type {?} */
        var componentClass = getGridColumnsClasses(field.gridSmColumns, field.gridMdColumns, field.gridLgColumns, field.gridXlColumns, field.gridColumns);
        return tslib_1.__assign({ label: this.titleCasePipe.transform(field.property) }, field, { componentClass: componentClass,
            control: control,
            options: options });
    };
    /**
     * @private
     * @param {?} fields
     * @param {?} property
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.existsProperty = /**
     * @private
     * @param {?} fields
     * @param {?} property
     * @return {?}
     */
    function (fields, property) {
        return fields.some((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            return field.property === property;
        }));
    };
    // recupera o componente de acordo com algumas regras do field.
    // recupera o componente de acordo com algumas regras do field.
    /**
     * @private
     * @param {?=} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.getComponentControl = 
    // recupera o componente de acordo com algumas regras do field.
    /**
     * @private
     * @param {?=} field
     * @return {?}
     */
    function (field) {
        if (field === void 0) { field = (/** @type {?} */ ({})); }
        /** @type {?} */
        var type = field && field.type ? field.type.toLocaleLowerCase() : 'string';
        if (this.isNumberType(field, type)) {
            return 'number';
        }
        else if (this.isCurrencyType(field, type)) {
            return 'decimal';
        }
        else if (this.isSelect(field)) {
            return 'select';
        }
        else if (this.isRadioGroup(field)) {
            return 'radioGroup';
        }
        else if (this.isCheckboxGroup(field)) {
            return 'checkboxGroup';
        }
        else if (this.isMultiselect(field)) {
            return 'multiselect';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Boolean)) {
            return 'switch';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Date) || this.compareTo(type, ThfDynamicFieldType.DateTime)) {
            return 'datepicker';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Time)) {
            field.mask = field.mask || '99:99';
            return 'input';
        }
        else if (this.isCombo(field)) {
            return 'combo';
        }
        else if (this.isLookup(field)) {
            return 'lookup';
        }
        else if (this.isTextarea(field)) {
            return 'textarea';
        }
        else if (this.isPassword(field)) {
            return 'password';
        }
        return 'input';
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isCheckboxGroup = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var optionsService = field.optionsService, optionsMulti = field.optionsMulti, options = field.options;
        return !optionsService && optionsMulti && !!options && options.length <= 3;
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isCombo = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var optionsService = field.optionsService;
        return !!optionsService && isTypeof(optionsService, 'string');
    };
    /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isCurrencyType = /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    function (field, type) {
        var mask = field.mask, pattern = field.pattern;
        return this.compareTo(type, ThfDynamicFieldType.Currency) && (!mask && !pattern);
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isLookup = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var searchService = field.searchService;
        return !!searchService && isTypeof(searchService, 'string');
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isMultiselect = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var optionsService = field.optionsService, optionsMulti = field.optionsMulti, options = field.options;
        return !optionsService && optionsMulti && !!options && options.length > 3;
    };
    /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isNumberType = /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    function (field, type) {
        var mask = field.mask, pattern = field.pattern;
        return this.compareTo(type, ThfDynamicFieldType.Number) && (!mask && !pattern);
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isPassword = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var secret = field.secret;
        return secret;
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isRadioGroup = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var optionsMulti = field.optionsMulti, options = field.options;
        return !optionsMulti && !!options && options.length <= 3;
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isSelect = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var optionsMulti = field.optionsMulti, options = field.options;
        return !optionsMulti && !!options && options.length > 3;
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.isTextarea = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var rows = field.rows;
        return rows && rows >= 3;
    };
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    ThfDynamicFormFieldsBaseComponent.prototype.printError = /**
     * @private
     * @param {?} error
     * @return {?}
     */
    function (error) {
        console.error(error);
    };
    ThfDynamicFormFieldsBaseComponent.propDecorators = {
        fields: [{ type: Input, args: ['t-fields',] }],
        value: [{ type: Input, args: ['t-value',] }]
    };
    return ThfDynamicFormFieldsBaseComponent;
}());
export { ThfDynamicFormFieldsBaseComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype._fields;
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype._value;
    /** @type {?} */
    ThfDynamicFormFieldsBaseComponent.prototype.visibleFields;
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype.titleCasePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWR5bmFtaWMtZm9ybS1maWVsZHMtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWR5bmFtaWMvdGhmLWR5bmFtaWMtZm9ybS90aGYtZHluYW1pYy1mb3JtLWZpZWxkcy90aGYtZHluYW1pYy1mb3JtLWZpZWxkcy1iYXNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRWxELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMvRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUl4RTtJQXlCRSwyQ0FBb0IsYUFBNEI7UUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUF0QnhDLFdBQU0sR0FBUyxFQUFFLENBQUM7UUFFMUIsa0JBQWEsR0FBdUMsRUFBRSxDQUFDO0lBb0JKLENBQUM7SUFqQnBELHNCQUF1QixxREFBTTs7OztRQUk3QjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN0QixDQUFDO1FBUEQsc0dBQXNHOzs7Ozs7O1FBQ3RHLFVBQThCLEtBQWlDO1lBQzdELElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGtCQUFLLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ3hELENBQUM7OztPQUFBO0lBT0Qsc0JBQXNCLG9EQUFLOzs7O1FBSTNCO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3JCLENBQUM7UUFQRCw2REFBNkQ7Ozs7Ozs7UUFDN0QsVUFBNEIsS0FBVTtZQUNwQyxJQUFJLENBQUMsTUFB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SUFFTyxzREFBVTs7Ozs7SUFBbEIsVUFBbUIsS0FBMEI7UUFDbkMsSUFBQSxpQkFBSTtRQUVaLE9BQU8sSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7Ozs7O0lBRU8sc0RBQVU7Ozs7O0lBQWxCLFVBQW1CLEtBQWE7UUFDOUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixDQUFDOzt5QkF0TEEsS0FBSyxTQUFDLFVBQVU7d0JBU2hCLEtBQUssU0FBQyxTQUFTOztJQStLbEIsd0NBQUM7Q0FBQSxBQWhNRCxJQWdNQztTQWhNWSxpQ0FBaUM7Ozs7OztJQUU1QyxvREFBNEM7Ozs7O0lBQzVDLG1EQUEwQjs7SUFFMUIsMERBQXVEOzs7OztJQW9CM0MsMERBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRpdGxlQ2FzZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5pbXBvcnQgeyBpc1R5cGVvZiB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBnZXRHcmlkQ29sdW1uc0NsYXNzZXMsIGlzVmlzaWJsZUZpZWxkIH0gZnJvbSAnLi4vLi4vdGhmLWR5bmFtaWMudXRpbCc7XG5pbXBvcnQgeyBUaGZEeW5hbWljRmllbGRUeXBlIH0gZnJvbSAnLi4vLi4vdGhmLWR5bmFtaWMtZmllbGQtdHlwZS5lbnVtJztcbmltcG9ydCB7IFRoZkR5bmFtaWNGb3JtRmllbGQgfSBmcm9tICcuLi90aGYtZHluYW1pYy1mb3JtLWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZEeW5hbWljRm9ybUZpZWxkSW50ZXJuYWwgfSBmcm9tICcuL3RoZi1keW5hbWljLWZvcm0tZmllbGQtaW50ZXJuYWwuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNsYXNzIFRoZkR5bmFtaWNGb3JtRmllbGRzQmFzZUNvbXBvbmVudCB7XG5cbiAgcHJpdmF0ZSBfZmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkPjtcbiAgcHJpdmF0ZSBfdmFsdWU/OiBhbnkgPSB7fTtcblxuICB2aXNpYmxlRmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkSW50ZXJuYWw+ID0gW107XG5cbiAgLy8gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgVGhmRHluYW1pY0Zvcm1GaWVsZCwgcXVlIHNlcsOjbyBleGliaWRvcyBubyBjb21wb25lbnRlLlxuICBASW5wdXQoJ3QtZmllbGRzJykgc2V0IGZpZWxkcyh2YWx1ZTogQXJyYXk8VGhmRHluYW1pY0Zvcm1GaWVsZD4pIHtcbiAgICB0aGlzLl9maWVsZHMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IFsuLi52YWx1ZV0gOiBbXTtcbiAgfVxuXG4gIGdldCBmaWVsZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpZWxkcztcbiAgfVxuXG4gIC8vIHZhbG9yIHF1ZSBzZXLDoSB1dGlsaXphZG8gcGFyYSBpbmljaWFyIHZhbG9yIG5vIGNvbXBvbmVudGUuXG4gIEBJbnB1dCgndC12YWx1ZScpIHNldCB2YWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZSAmJiBpc1R5cGVvZih2YWx1ZSwgJ29iamVjdCcpID8gdmFsdWUgOiB7fTtcbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRpdGxlQ2FzZVBpcGU6IFRpdGxlQ2FzZVBpcGUpIHt9XG5cbiAgY29tcGFyZVRvKHZhbHVlLCBjb21wYXJlVG8pIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IGNvbXBhcmVUbztcbiAgfVxuXG4gIC8vIHJldG9ybmEgdW0gYXJyYXkgY29tIG9zIG9iamV0b3MgY29uZmlndXJhZG9zIGUgdmlzaXZlaXMuXG4gIHByb3RlY3RlZCBnZXRWaXNpYmxlRmllbGRzKCkge1xuICAgIGNvbnN0IHZpc2libGVGaWVsZHMgPSBbXTtcblxuICAgIHRoaXMuZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgaWYgKHRoaXMuZXhpc3RzUHJvcGVydHkodmlzaWJsZUZpZWxkcywgZmllbGQucHJvcGVydHkpKSB7XG4gICAgICAgIHRoaXMucHJpbnRFcnJvcihgXCJ0aGYtZHluYW1pYy1mb3JtXCIgcHJvcGVydHkgXCIke2ZpZWxkLnByb3BlcnR5fVwiIGVzdMOhIGR1cGxpY2Fkby4gSW50ZXJmYWNlOiBUaGZEeW5hbWljRm9ybUZpZWxkLmApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghZmllbGRbJ3Byb3BlcnR5J10pIHtcbiAgICAgICAgdGhpcy5wcmludEVycm9yKCdcInRoZi1keW5hbWljLWZvcm1cIiDDiSBvYnJpZ2F0w7NyaW8gc2VyIGVzcGVjaWZpY2FkbyB1bSBwcm9wZXJ0eS4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNWaXNpYmxlRmllbGQoZmllbGQpKSB7XG4gICAgICAgIHZpc2libGVGaWVsZHMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkKGZpZWxkKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdmlzaWJsZUZpZWxkcztcbiAgfVxuXG4gIC8vIGNvbnZlcnRlIHVtIGFycmF5IGVtIHN0cmluZyBwYXJhIHVtIGFycmF5IGRlIG9iamV0b3MgcXVlIGNvbnRlbSBsYWJlbCBlIHZhbHVlLlxuICBwcml2YXRlIGNvbnZlcnRPcHRpb25zKG9wdGlvbnM6IEFycmF5PGFueT4pOiBBcnJheTx7IGxhYmVsOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IGV2ZXJ5T3B0aW9uU3RyaW5nID0gb3B0aW9ucy5ldmVyeShvcHRpb24gPT4gdHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpO1xuXG4gICAgaWYgKGV2ZXJ5T3B0aW9uU3RyaW5nKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5tYXAodmFsdWUgPT4gKHtsYWJlbDogdmFsdWUsIHZhbHVlfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgLy8gY3JpYSB1bSBub3ZvIG9iamV0byBjb20gYXMgY2xhc3NlcyBkZSBncmlkIHN5c3RlbSwgY29tIGNvbnRyb2wgKHRpcG8gZG8gY29tcG9uZW50ZSkgZSBsYWJlbCBkZWZhdWx0LlxuICBwcml2YXRlIGNyZWF0ZUZpZWxkKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKTogVGhmRHluYW1pY0Zvcm1GaWVsZEludGVybmFsIHtcbiAgICBjb25zdCBjb250cm9sID0gdGhpcy5nZXRDb21wb25lbnRDb250cm9sKGZpZWxkKTtcbiAgICBjb25zdCBvcHRpb25zID0gISFmaWVsZC5vcHRpb25zID8gdGhpcy5jb252ZXJ0T3B0aW9ucyhmaWVsZC5vcHRpb25zKSA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IGNvbXBvbmVudENsYXNzID0gZ2V0R3JpZENvbHVtbnNDbGFzc2VzKGZpZWxkLmdyaWRTbUNvbHVtbnMsXG4gICAgICBmaWVsZC5ncmlkTWRDb2x1bW5zLFxuICAgICAgZmllbGQuZ3JpZExnQ29sdW1ucyxcbiAgICAgIGZpZWxkLmdyaWRYbENvbHVtbnMsXG4gICAgICBmaWVsZC5ncmlkQ29sdW1ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6IHRoaXMudGl0bGVDYXNlUGlwZS50cmFuc2Zvcm0oZmllbGQucHJvcGVydHkpLFxuICAgICAgLi4uZmllbGQsXG4gICAgICBjb21wb25lbnRDbGFzcyxcbiAgICAgIGNvbnRyb2wsXG4gICAgICBvcHRpb25zXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZXhpc3RzUHJvcGVydHkoZmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkPiwgcHJvcGVydHk6IHN0cmluZykge1xuICAgIHJldHVybiBmaWVsZHMuc29tZShmaWVsZCA9PiB7XG4gICAgICByZXR1cm4gZmllbGQucHJvcGVydHkgPT09IHByb3BlcnR5O1xuICAgIH0pO1xuICB9XG5cbiAgLy8gcmVjdXBlcmEgbyBjb21wb25lbnRlIGRlIGFjb3JkbyBjb20gYWxndW1hcyByZWdyYXMgZG8gZmllbGQuXG4gIHByaXZhdGUgZ2V0Q29tcG9uZW50Q29udHJvbChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCA9IDxhbnk+IHt9KSB7XG4gICAgY29uc3QgdHlwZSA9IGZpZWxkICYmIGZpZWxkLnR5cGUgPyBmaWVsZC50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgOiAnc3RyaW5nJztcblxuICAgIGlmICh0aGlzLmlzTnVtYmVyVHlwZShmaWVsZCwgdHlwZSkpIHtcbiAgICAgIHJldHVybiAnbnVtYmVyJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDdXJyZW5jeVR5cGUoZmllbGQsIHR5cGUpKSB7XG4gICAgICByZXR1cm4gJ2RlY2ltYWwnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlbGVjdChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnc2VsZWN0JztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNSYWRpb0dyb3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdyYWRpb0dyb3VwJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDaGVja2JveEdyb3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdjaGVja2JveEdyb3VwJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNdWx0aXNlbGVjdChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnbXVsdGlzZWxlY3QnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5Cb29sZWFuKSkge1xuICAgICAgcmV0dXJuICdzd2l0Y2gnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5EYXRlKSB8fCB0aGlzLmNvbXBhcmVUbyh0eXBlLCBUaGZEeW5hbWljRmllbGRUeXBlLkRhdGVUaW1lKSkge1xuICAgICAgcmV0dXJuICdkYXRlcGlja2VyJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29tcGFyZVRvKHR5cGUsIFRoZkR5bmFtaWNGaWVsZFR5cGUuVGltZSkpIHtcbiAgICAgIGZpZWxkLm1hc2sgPSBmaWVsZC5tYXNrIHx8ICc5OTo5OSc7XG5cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc0NvbWJvKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdjb21ibyc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTG9va3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdsb29rdXAnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1RleHRhcmVhKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICd0ZXh0YXJlYSc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzUGFzc3dvcmQoZmllbGQpKSB7XG4gICAgICByZXR1cm4gJ3Bhc3N3b3JkJztcbiAgICB9XG5cbiAgICByZXR1cm4gJ2lucHV0JztcbiAgfVxuXG4gIHByaXZhdGUgaXNDaGVja2JveEdyb3VwKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBvcHRpb25zU2VydmljZSwgb3B0aW9uc011bHRpLCBvcHRpb25zIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiAhb3B0aW9uc1NlcnZpY2UgJiYgb3B0aW9uc011bHRpICYmICEhb3B0aW9ucyAmJiBvcHRpb25zLmxlbmd0aCA8PSAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbWJvKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBvcHRpb25zU2VydmljZSB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gISFvcHRpb25zU2VydmljZSAmJiBpc1R5cGVvZihvcHRpb25zU2VydmljZSwgJ3N0cmluZycpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0N1cnJlbmN5VHlwZShmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCwgdHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBtYXNrLCBwYXR0ZXJuIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh0eXBlLCBUaGZEeW5hbWljRmllbGRUeXBlLkN1cnJlbmN5KSAmJiAoIW1hc2sgJiYgIXBhdHRlcm4pO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvb2t1cChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgc2VhcmNoU2VydmljZSB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gISFzZWFyY2hTZXJ2aWNlICYmIGlzVHlwZW9mKHNlYXJjaFNlcnZpY2UsICdzdHJpbmcnKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNNdWx0aXNlbGVjdChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgb3B0aW9uc1NlcnZpY2UsIG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNTZXJ2aWNlICYmIG9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc051bWJlclR5cGUoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQsIHR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IHsgbWFzaywgcGF0dGVybiB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gdGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5OdW1iZXIpICYmICghbWFzayAmJiAhcGF0dGVybik7XG4gIH1cblxuICBwcml2YXRlIGlzUGFzc3dvcmQoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IHNlY3JldCB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gc2VjcmV0O1xuICB9XG5cbiAgcHJpdmF0ZSBpc1JhZGlvR3JvdXAoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPD0gMztcbiAgfVxuXG4gIHByaXZhdGUgaXNTZWxlY3QoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1RleHRhcmVhKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyByb3dzIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiByb3dzICYmIHJvd3MgPj0gMztcbiAgfVxuXG4gIHByaXZhdGUgcHJpbnRFcnJvcihlcnJvcjogc3RyaW5nKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gIH1cblxufVxuIl19