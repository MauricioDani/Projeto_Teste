/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpClient, HttpEventType, HttpRequest, HttpResponse } from '@angular/common/http';
var ThfUploadBaseService = /** @class */ (function () {
    function ThfUploadBaseService(http) {
        this.http = http;
        this.formField = 'files';
        this.requests = [];
    }
    /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param url URL da requisição a ser efetuada.
     * @param files Arquivos a serem enviados.
     * @param tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     */
    /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param {?} url URL da requisição a ser efetuada.
     * @param {?} files Arquivos a serem enviados.
     * @param {?} tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param {?} uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param {?} successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param {?} errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     * @return {?}
     */
    ThfUploadBaseService.prototype.upload = /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param {?} url URL da requisição a ser efetuada.
     * @param {?} files Arquivos a serem enviados.
     * @param {?} tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param {?} uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param {?} successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param {?} errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     * @return {?}
     */
    function (url, files, tOnUpload, uploadCallback, successCallback, errorCallback) {
        /** @type {?} */
        var filesLength = files.length;
        /** @type {?} */
        var uploadEvent = {
            data: {},
            file: null
        };
        for (var i = 0; i < filesLength; i++) {
            /** @type {?} */
            var formData = new FormData();
            /** @type {?} */
            var file = files[i];
            /** @type {?} */
            var fileName = file.rawFile.name;
            formData.append(this.formField, file.rawFile, fileName);
            // Função upload, onde o desenvolvedor pode enviar dados para a requisição.
            if (tOnUpload) {
                uploadEvent['file'] = file;
                tOnUpload.emit(uploadEvent);
                formData.append('data', JSON.stringify(uploadEvent.data));
            }
            this.sendFile(url, file, formData, uploadCallback, successCallback, errorCallback);
        }
    };
    /**
     * @param {?} url
     * @param {?} file
     * @param {?} formData
     * @param {?} uploadCallback
     * @param {?} successCallback
     * @param {?} errorCallback
     * @return {?}
     */
    ThfUploadBaseService.prototype.sendFile = /**
     * @param {?} url
     * @param {?} file
     * @param {?} formData
     * @param {?} uploadCallback
     * @param {?} successCallback
     * @param {?} errorCallback
     * @return {?}
     */
    function (url, file, formData, uploadCallback, successCallback, errorCallback) {
        var _this = this;
        /** @type {?} */
        var request = this.getRequest(url, formData).subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event.type === HttpEventType.UploadProgress) {
                _this.addRequest(file, request);
                /** @type {?} */
                var percentDone = Math.round(100 * event.loaded / event.total);
                uploadCallback(file, percentDone);
            }
            else if (event instanceof HttpResponse) {
                // Sucesso, arquivos enviados.
                successCallback(file, event);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            errorCallback(file, err);
        }));
    };
    /**
     * @param {?} url
     * @param {?} formData
     * @return {?}
     */
    ThfUploadBaseService.prototype.getRequest = /**
     * @param {?} url
     * @param {?} formData
     * @return {?}
     */
    function (url, formData) {
        /** @type {?} */
        var req = new HttpRequest('POST', url, formData, {
            reportProgress: true
        });
        return this.http.request(req);
    };
    /**
     * @param {?} file
     * @param {?} callback
     * @return {?}
     */
    ThfUploadBaseService.prototype.stopRequestByFile = /**
     * @param {?} file
     * @param {?} callback
     * @return {?}
     */
    function (file, callback) {
        /** @type {?} */
        var requestObj = this.requests.find((/**
         * @param {?} req
         * @return {?}
         */
        function (req) {
            return req.file.uid === file.uid;
        }));
        if (requestObj) {
            /** @type {?} */
            var request = requestObj.request;
            request.unsubscribe();
            this.removeRequest(requestObj);
            callback();
        }
    };
    /**
     * @param {?} requestObj
     * @return {?}
     */
    ThfUploadBaseService.prototype.removeRequest = /**
     * @param {?} requestObj
     * @return {?}
     */
    function (requestObj) {
        /** @type {?} */
        var index = this.requests.indexOf(requestObj);
        this.requests.splice(index, 1);
    };
    /**
     * @param {?} file
     * @param {?} request
     * @return {?}
     */
    ThfUploadBaseService.prototype.addRequest = /**
     * @param {?} file
     * @param {?} request
     * @return {?}
     */
    function (file, request) {
        /** @type {?} */
        var hasRequest = this.requests.some((/**
         * @param {?} req
         * @return {?}
         */
        function (req) {
            return req.file.uid === file.uid;
        }));
        if (!hasRequest) {
            this.requests.push({ file: file, request: request });
        }
    };
    ThfUploadBaseService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ThfUploadBaseService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return ThfUploadBaseService;
}());
export { ThfUploadBaseService };
if (false) {
    /** @type {?} */
    ThfUploadBaseService.prototype.formField;
    /** @type {?} */
    ThfUploadBaseService.prototype.requests;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXVwbG9hZC1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWZpZWxkL3RoZi11cGxvYWQvdGhmLXVwbG9hZC1iYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFxQixXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFNL0c7SUFNRSw4QkFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUhwQyxjQUFTLEdBQVcsT0FBTyxDQUFDO1FBQzVCLGFBQVEsR0FBZSxFQUFFLENBQUM7SUFFYyxDQUFDO0lBRXpDOzs7Ozs7Ozs7T0FTRzs7Ozs7Ozs7Ozs7O0lBQ0kscUNBQU07Ozs7Ozs7Ozs7O0lBQWIsVUFDRSxHQUFXLEVBQ1gsS0FBMkIsRUFDM0IsU0FBNEIsRUFDNUIsY0FBOEQsRUFDOUQsZUFBMEQsRUFDMUQsYUFBd0Q7O1lBRWxELFdBQVcsR0FBRyxLQUFLLENBQUMsTUFBTTs7WUFDMUIsV0FBVyxHQUFRO1lBQ3ZCLElBQUksRUFBRSxFQUFFO1lBQ1IsSUFBSSxFQUFFLElBQUk7U0FDWDtRQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O2dCQUM5QixRQUFRLEdBQWEsSUFBSSxRQUFRLEVBQUU7O2dCQUNuQyxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQzs7Z0JBQ2YsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTtZQUVsQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZ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LEdBQUcsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQ25DLENBQUMsRUFBQztRQUVGLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksTUFBQSxFQUFFLE9BQU8sU0FBQSxFQUFDLENBQUMsQ0FBQztTQUNyQztJQUNILENBQUM7O2dCQS9HRixVQUFVOzs7O2dCQU5GLFVBQVU7O0lBdUhuQiwyQkFBQztDQUFBLEFBakhELElBaUhDO1NBaEhZLG9CQUFvQjs7O0lBRS9CLHlDQUE0Qjs7SUFDNUIsd0NBQTBCOzs7OztJQUVkLG9DQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEV2ZW50VHlwZSwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBSZXF1ZXN0LCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbmltcG9ydCB7IFRoZlVwbG9hZEZpbGUgfSBmcm9tICcuL3RoZi11cGxvYWQtZmlsZSc7XG5cbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVGhmVXBsb2FkQmFzZVNlcnZpY2Uge1xuXG4gIGZvcm1GaWVsZDogc3RyaW5nID0gJ2ZpbGVzJztcbiAgcmVxdWVzdHM6IEFycmF5PGFueT4gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxuXG4gIC8qKlxuICAgKiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgZW52aWFyIG9zIGFycXVpdm9zIGFvIHNlcnZpZG9yLCBjb25mb3JtZSBvIHBhcsOibWV0cm8gVVJMLlxuICAgKlxuICAgKiBAcGFyYW0gdXJsIFVSTCBkYSByZXF1aXNpw6fDo28gYSBzZXIgZWZldHVhZGEuXG4gICAqIEBwYXJhbSBmaWxlcyBBcnF1aXZvcyBhIHNlcmVtIGVudmlhZG9zLlxuICAgKiBAcGFyYW0gdE9uVXBsb2FkIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gbyBhcnF1aXZvIGZvciBlbnZpYWRvIGFvIHNlcnZpZG9yLlxuICAgKiBAcGFyYW0gdXBsb2FkQ2FsbGJhY2sgRnVuw6fDo28gcXVlIHNlcsOhIGV4ZWN1dGFkYSBlbnF1YW50byBvcyBhcnF1aXZvcyBlc3RpdmVyZW0gc2VuZG8gZW52aWFkb3MuXG4gICAqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sgRnVuw6fDo28gYSBzZXIgZXhlY3V0YWRhIHF1YW5kbyBhIHJlcXVpc2nDp8OjbyBmb3IgZWZldHVhZGEgY29tIHN1Y2Vzc28uXG4gICAqIEBwYXJhbSBlcnJvckNhbGxiYWNrIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gYSByZXF1aXNpw6fDo28gZm9pIGVmZXR1YWRhIGNvbSBzdWNlc3NvLlxuICAgKi9cbiAgcHVibGljIHVwbG9hZChcbiAgICB1cmw6IHN0cmluZyxcbiAgICBmaWxlczogQXJyYXk8VGhmVXBsb2FkRmlsZT4sXG4gICAgdE9uVXBsb2FkOiBFdmVudEVtaXR0ZXI8YW55PixcbiAgICB1cGxvYWRDYWxsYmFjazogKGZpbGU6IFRoZlVwbG9hZEZpbGUsIHBlcmNlbnQ6IG51bWJlcikgPT4gdm9pZCxcbiAgICBzdWNjZXNzQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkLFxuICAgIGVycm9yQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkKSB7XG5cbiAgICBjb25zdCBmaWxlc0xlbmd0aCA9IGZpbGVzLmxlbmd0aDtcbiAgICBjb25zdCB1cGxvYWRFdmVudDogYW55ID0ge1xuICAgICAgZGF0YToge30sXG4gICAgICBmaWxlOiBudWxsXG4gICAgfTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXNMZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZm9ybURhdGE6IEZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBmaWxlID0gZmlsZXNbaV07XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGUucmF3RmlsZS5uYW1lO1xuXG4gICAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy5mb3JtRmllbGQsIGZpbGUucmF3RmlsZSwgZmlsZU5hbWUpO1xuXG4gICAgICAvLyBGdW7Dp8OjbyB1cGxvYWQsIG9uZGUgbyBkZXNlbnZvbHZlZG9yIHBvZGUgZW52aWFyIGRhZG9zIHBhcmEgYSByZXF1aXNpw6fDo28uXG4gICAgICBpZiAodE9uVXBsb2FkKSB7XG4gICAgICAgIHVwbG9hZEV2ZW50WydmaWxlJ10gPSBmaWxlO1xuICAgICAgICB0T25VcGxvYWQuZW1pdCh1cGxvYWRFdmVudCk7XG5cbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkodXBsb2FkRXZlbnQuZGF0YSkpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNlbmRGaWxlKHVybCwgZmlsZSwgZm9ybURhdGEsIHVwbG9hZENhbGxiYWNrLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZW5kRmlsZShcbiAgICB1cmw6IHN0cmluZyxcbiAgICBmaWxlOiBUaGZVcGxvYWRGaWxlLFxuICAgIGZvcm1EYXRhOiBGb3JtRGF0YSxcbiAgICB1cGxvYWRDYWxsYmFjazogKGZpbGU6IFRoZlVwbG9hZEZpbGUsIHBlcmNlbnQ6IG51bWJlcikgPT4gdm9pZCxcbiAgICBzdWNjZXNzQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkLFxuICAgIGVycm9yQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkKSB7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5nZXRSZXF1ZXN0KHVybCwgZm9ybURhdGEpLnN1YnNjcmliZShldmVudCA9PiB7XG5cbiAgICAgIGlmIChldmVudC50eXBlID09PSBIdHRwRXZlbnRUeXBlLlVwbG9hZFByb2dyZXNzKSB7XG4gICAgICAgIHRoaXMuYWRkUmVxdWVzdChmaWxlLCByZXF1ZXN0KTtcblxuICAgICAgICBjb25zdCBwZXJjZW50RG9uZSA9IE1hdGgucm91bmQoMTAwICogZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwpO1xuICAgICAgICB1cGxvYWRDYWxsYmFjayhmaWxlLCBwZXJjZW50RG9uZSk7XG5cbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UpIHtcbiAgICAgICAgLy8gU3VjZXNzbywgYXJxdWl2b3MgZW52aWFkb3MuXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhmaWxlLCBldmVudCk7XG4gICAgICB9XG4gICAgfSxcbiAgICAoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgZXJyb3JDYWxsYmFjayhmaWxlLCBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGdldFJlcXVlc3QodXJsOiBzdHJpbmcsIGZvcm1EYXRhOiBGb3JtRGF0YSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgcmVxID0gbmV3IEh0dHBSZXF1ZXN0KCdQT1NUJywgdXJsLCBmb3JtRGF0YSwge1xuICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHRydWVcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChyZXEpO1xuICB9XG5cbiAgcHVibGljIHN0b3BSZXF1ZXN0QnlGaWxlKGZpbGU6IGFueSwgY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICBjb25zdCByZXF1ZXN0T2JqID0gdGhpcy5yZXF1ZXN0cy5maW5kKHJlcSA9PiB7XG4gICAgICByZXR1cm4gcmVxLmZpbGUudWlkID09PSBmaWxlLnVpZDtcbiAgICB9KTtcblxuICAgIGlmIChyZXF1ZXN0T2JqKSB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gcmVxdWVzdE9iai5yZXF1ZXN0O1xuICAgICAgcmVxdWVzdC51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5yZW1vdmVSZXF1ZXN0KHJlcXVlc3RPYmopO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmVtb3ZlUmVxdWVzdChyZXF1ZXN0T2JqOiBhbnkpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucmVxdWVzdHMuaW5kZXhPZihyZXF1ZXN0T2JqKTtcbiAgICB0aGlzLnJlcXVlc3RzLnNwbGljZShpbmRleCwgMSk7XG4gIH1cblxuICBwdWJsaWMgYWRkUmVxdWVzdChmaWxlOiBUaGZVcGxvYWRGaWxlLCByZXF1ZXN0OiBTdWJzY3JpcHRpb24pIHtcbiAgICBjb25zdCBoYXNSZXF1ZXN0ID0gdGhpcy5yZXF1ZXN0cy5zb21lKHJlcSA9PiB7XG4gICAgICByZXR1cm4gcmVxLmZpbGUudWlkID09PSBmaWxlLnVpZDtcbiAgICB9KTtcblxuICAgIGlmICghaGFzUmVxdWVzdCkge1xuICAgICAgdGhpcy5yZXF1ZXN0cy5wdXNoKHtmaWxlLCByZXF1ZXN0fSk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==