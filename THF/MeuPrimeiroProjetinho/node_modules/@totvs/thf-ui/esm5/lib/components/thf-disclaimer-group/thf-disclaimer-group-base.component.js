/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, isKeyCodeEnter, thfLocaleDefault } from '../../utils/util';
/** @type {?} */
export var thfDisclaimerGroupLiteralsDefault = {
    en: { removeAll: 'Remove all' },
    es: { removeAll: 'Eliminar todos' },
    pt: { removeAll: 'Remover todos' }
};
/**
 * \@description
 *
 * O componente `thf-disclaimer-group` é recomendado para manipular palavras-chave de filtros aplicados em uma pesquisa.
 *
 * À partir de dois *disclaimers* com o botão **fechar** habilitado, o componente renderiza de forma automática um novo e destacado
 * *disclaimer* que possibilita **remover todos**, mas que também pode ser desabilitado.
 *
 * Também é possível navegar entre os *disclaimers* através do teclado utilizando a tecla *tab* e, para remoção do *disclaimer* selecionado,
 * basta pressionar a tecla *enter*. Esta funcionalidade não se aplica caso a propriedade `hideClose` estiver habilitada.
 *
 * > Veja a integração destas funcionalidade no componente [thf-page-list](/documentation/thf-page-list).
 */
var ThfDisclaimerGroupBaseComponent = /** @class */ (function () {
    function ThfDisclaimerGroupBaseComponent(differs) {
        this._disclaimers = [];
        this._hideRemoveAll = false;
        this.previousDisclaimers = [];
        this.literals = tslib_1.__assign({}, thfDisclaimerGroupLiteralsDefault[thfLocaleDefault], thfDisclaimerGroupLiteralsDefault[browserLanguage()]);
        /**
         * Função que será disparada quando a lista de *disclaimers* for modificada.
         */
        this.change = new EventEmitter();
        this.differ = differs.find([]).create(null);
    }
    Object.defineProperty(ThfDisclaimerGroupBaseComponent.prototype, "disclaimers", {
        get: /**
         * @return {?}
         */
        function () {
            return this._disclaimers;
        },
        /** Lista de *disclaimers*. */
        /**
         * @description
         *
         * Lista de *disclaimers*.
         *
         * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `ThfDisclaimer`.
         *
         * Exemplo adicionando um *disclaimer* no array:
         *
         * ```
         * this.disclaimers = [...this.disclaimers, disclaimer];
         * ```
         *
         * ou
         *
         * ```
         * this.disclaimers = this.disclaimers.concat(disclaimer);
         * ```
         */
        set: /** Lista de *disclaimers*. */
        /**
         * \@description
         *
         * Lista de *disclaimers*.
         *
         * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `ThfDisclaimer`.
         *
         * Exemplo adicionando um *disclaimer* no array:
         *
         * ```
         * this.disclaimers = [...this.disclaimers, disclaimer];
         * ```
         *
         * ou
         *
         * ```
         * this.disclaimers = this.disclaimers.concat(disclaimer);
         * ```
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.previousDisclaimers = tslib_1.__spread(this.disclaimers);
            this._disclaimers = this.checkDisclaimers(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfDisclaimerGroupBaseComponent.prototype, "hideRemoveAll", {
        get: /**
         * @return {?}
         */
        function () {
            return this._hideRemoveAll;
        },
        /**
         * @optional
         *
         * @description
         *
         * Oculta o botão para remover todos os *disclaimers* do grupo.
         *
         * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Oculta o botão para remover todos os *disclaimers* do grupo.
         *
         * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
         *
         * \@default `false`
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._hideRemoveAll = (/** @type {?} */ (value)) === '' ? true : convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        this.checkChanges();
    };
    /**
     * @param {?} disclaimer
     * @param {?=} emitChange
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.closeItem = /**
     * @param {?} disclaimer
     * @param {?=} emitChange
     * @return {?}
     */
    function (disclaimer, emitChange) {
        if (emitChange === void 0) { emitChange = true; }
        /** @type {?} */
        var itemIndex = this.disclaimers.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d['$id'] === disclaimer['$id']; }));
        this.disclaimers.splice(itemIndex, 1);
        if (emitChange) {
            this.emitChangeDisclaimers();
        }
    };
    /**
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.isRemoveAll = /**
     * @return {?}
     */
    function () {
        return !this.hideRemoveAll && this.disclaimers.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return !c.hideClose; })).length > 1;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.onKeyPress = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (isKeyCodeEnter(event)) {
            this.removeAllItems();
        }
    };
    /**
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.removeAllItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var removeItems = [];
        this.disclaimers.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        function (disclaimer) {
            if (!disclaimer.hideClose) {
                removeItems.push(disclaimer);
            }
        }));
        removeItems.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        function (disclaimer) { return _this.closeItem(disclaimer, false); }));
        this.emitChangeDisclaimers();
    };
    /**
     * @private
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.checkChanges = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.differ) {
            /** @type {?} */
            var changes = this.differ.diff(this.disclaimers);
            if (changes && this.disclaimersAreChanged(this.disclaimers)) {
                this.emitChangeDisclaimers();
            }
        }
    };
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.checkDisclaimers = /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    function (disclaimers) {
        if (Array.isArray(disclaimers)) {
            for (var i = 0; i < disclaimers.length; i++) {
                /** @type {?} */
                var disclaimer = disclaimers[i];
                if (disclaimer.value || disclaimer.value === 0 || disclaimer.value === false) {
                    disclaimer['$id'] = uuid();
                }
                else {
                    disclaimers.splice(i, 1);
                    i--;
                }
            }
            return disclaimers;
        }
        return [];
    };
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.disclaimersAreChanged = /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    function (disclaimers) {
        var _this = this;
        /** @type {?} */
        var currentValues = disclaimers;
        if (currentValues.length !== this.previousDisclaimers.length) {
            return true;
        }
        return currentValues.some((/**
         * @param {?} disclaimer
         * @param {?} index
         * @return {?}
         */
        function (disclaimer, index) { return disclaimer.value !== _this.previousDisclaimers[index].value
            || disclaimer.property !== _this.previousDisclaimers[index].property; }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.emitChangeDisclaimers = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.change.emit(_this.disclaimers);
        }));
        this.previousDisclaimers = tslib_1.__spread(this._disclaimers);
    };
    ThfDisclaimerGroupBaseComponent.propDecorators = {
        disclaimers: [{ type: Input, args: ['t-disclaimers',] }],
        hideRemoveAll: [{ type: Input, args: ['t-hide-remove-all',] }],
        title: [{ type: Input, args: ['t-title',] }],
        change: [{ type: Output, args: ['t-change',] }]
    };
    return ThfDisclaimerGroupBaseComponent;
}());
export { ThfDisclaimerGroupBaseComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype._disclaimers;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype._hideRemoveAll;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype.previousDisclaimers;
    /** @type {?} */
    ThfDisclaimerGroupBaseComponent.prototype.literals;
    /**
     * Título do grupo de *disclaimers*.
     * @type {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.title;
    /**
     * Função que será disparada quando a lista de *disclaimers* for modificada.
     * @type {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWRpc2NsYWltZXItZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWRpc2NsYWltZXItZ3JvdXAvdGhmLWRpc2NsYWltZXItZ3JvdXAtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQVcsWUFBWSxFQUFFLEtBQUssRUFBbUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXRGLE9BQU8sRUFBRSxFQUFFLElBQUksSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRWxDLE9BQU8sRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7O0FBSXZHLE1BQU0sS0FBTyxpQ0FBaUMsR0FBRztJQUMvQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFO0lBQy9CLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtJQUNuQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO0NBQ25DOzs7Ozs7Ozs7Ozs7OztBQWVEO0lBdUVFLHlDQUFZLE9BQXdCO1FBckU1QixpQkFBWSxHQUF5QixFQUFFLENBQUM7UUFDeEMsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFHaEMsd0JBQW1CLEdBQXlCLEVBQUUsQ0FBQztRQUU5QyxhQUFRLHdCQUNWLGlDQUFpQyxDQUFDLGdCQUFnQixDQUFDLEVBQ25ELGlDQUFpQyxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQ3pEOzs7O1FBMERrQixXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7UUFHdkUsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFD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QUFDO0lBQ3pFLENBQUM7Ozs7O0lBRU8sK0RBQXFCOzs7O0lBQTdCO1FBQUEsaUJBS0M7UUFKQyxVQUFVOzs7UUFBQztZQUNULEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyQyxDQUFDLEVBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxtQkFBbUIsb0JBQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3BELENBQUM7OzhCQXBJQSxLQUFLLFNBQUMsZUFBZTtnQ0FzQnJCLEtBQUssU0FBQyxtQkFBbUI7d0JBVXpCLEtBQUssU0FBQyxTQUFTO3lCQUdmLE1BQU0sU0FBQyxVQUFVOztJQW1HcEIsc0NBQUM7Q0FBQSxBQXhLRCxJQXdLQztTQXhLWSwrQkFBK0I7Ozs7OztJQUUxQyx1REFBZ0Q7Ozs7O0lBQ2hELHlEQUF3Qzs7Ozs7SUFFeEMsaURBQWU7Ozs7O0lBQ2YsOERBQXVEOztJQUV2RCxtREFHRTs7Ozs7SUF1REYsZ0RBQWlDOzs7OztJQUdqQyxpREFBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb0NoZWNrLCBFdmVudEVtaXR0ZXIsIElucHV0LCBJdGVyYWJsZURpZmZlcnMsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSAndXVpZCc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgaXNLZXlDb2RlRW50ZXIsIHRoZkxvY2FsZURlZmF1bHQgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgVGhmRGlzY2xhaW1lciB9IGZyb20gJy4uL3RoZi1kaXNjbGFpbWVyL3RoZi1kaXNjbGFpbWVyLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjb25zdCB0aGZEaXNjbGFpbWVyR3JvdXBMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiB7IHJlbW92ZUFsbDogJ1JlbW92ZSBhbGwnIH0sXG4gIGVzOiB7IHJlbW92ZUFsbDogJ0VsaW1pbmFyIHRvZG9zJyB9LFxuICBwdDogeyByZW1vdmVBbGw6ICdSZW1vdmVyIHRvZG9zJyB9XG59O1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gY29tcG9uZW50ZSBgdGhmLWRpc2NsYWltZXItZ3JvdXBgIMOpIHJlY29tZW5kYWRvIHBhcmEgbWFuaXB1bGFyIHBhbGF2cmFzLWNoYXZlIGRlIGZpbHRyb3MgYXBsaWNhZG9zIGVtIHVtYSBwZXNxdWlzYS5cbiAqXG4gKiDDgCBwYXJ0aXIgZGUgZG9pcyAqZGlzY2xhaW1lcnMqIGNvbSBvIGJvdMOjbyAqKmZlY2hhcioqIGhhYmlsaXRhZG8sIG8gY29tcG9uZW50ZSByZW5kZXJpemEgZGUgZm9ybWEgYXV0b23DoXRpY2EgdW0gbm92byBlIGRlc3RhY2Fkb1xuICogKmRpc2NsYWltZXIqIHF1ZSBwb3NzaWJpbGl0YSAqKnJlbW92ZXIgdG9kb3MqKiwgbWFzIHF1ZSB0YW1iw6ltIHBvZGUgc2VyIGRlc2FiaWxpdGFkby5cbiAqXG4gKiBUYW1iw6ltIMOpIHBvc3PDrXZlbCBuYXZlZ2FyIGVudHJlIG9zICpkaXNjbGFpbWVycyogYXRyYXbDqXMgZG8gdGVjbGFkbyB1dGlsaXphbmRvIGEgdGVjbGEgKnRhYiogZSwgcGFyYSByZW1vw6fDo28gZG8gKmRpc2NsYWltZXIqIHNlbGVjaW9uYWRvLFxuICogYmFzdGEgcHJlc3Npb25hciBhIHRlY2xhICplbnRlciouIEVzdGEgZnVuY2lvbmFsaWRhZGUgbsOjbyBzZSBhcGxpY2EgY2FzbyBhIHByb3ByaWVkYWRlIGBoaWRlQ2xvc2VgIGVzdGl2ZXIgaGFiaWxpdGFkYS5cbiAqXG4gKiA+IFZlamEgYSBpbnRlZ3Jhw6fDo28gZGVzdGFzIGZ1bmNpb25hbGlkYWRlIG5vIGNvbXBvbmVudGUgW3RoZi1wYWdlLWxpc3RdKC9kb2N1bWVudGF0aW9uL3RoZi1wYWdlLWxpc3QpLlxuICovXG5leHBvcnQgY2xhc3MgVGhmRGlzY2xhaW1lckdyb3VwQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHByaXZhdGUgX2Rpc2NsYWltZXJzOiBBcnJheTxUaGZEaXNjbGFpbWVyPiA9IFtdO1xuICBwcml2YXRlIF9oaWRlUmVtb3ZlQWxsOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBkaWZmZXI7XG4gIHByaXZhdGUgcHJldmlvdXNEaXNjbGFpbWVyczogQXJyYXk8VGhmRGlzY2xhaW1lcj4gPSBbXTtcblxuICByZWFkb25seSBsaXRlcmFscyA9IHtcbiAgICAgIC4uLnRoZkRpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFt0aGZMb2NhbGVEZWZhdWx0XSxcbiAgICAgIC4uLnRoZkRpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFticm93c2VyTGFuZ3VhZ2UoKV1cbiAgfTtcblxuICAvKiogTGlzdGEgZGUgKmRpc2NsYWltZXJzKi4gKi9cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIExpc3RhIGRlICpkaXNjbGFpbWVycyouXG4gICAqXG4gICAqIFBhcmEgcXVlIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBzZWphIGF0dWFsaXphZGEgZGluYW1pY2FtZW50ZSBkZXZlLXNlIHBhc3NhciB1bWEgbm92YSByZWZlcsOqbmNpYSBkbyBhcnJheSBkZSBgVGhmRGlzY2xhaW1lcmAuXG4gICAqXG4gICAqIEV4ZW1wbG8gYWRpY2lvbmFuZG8gdW0gKmRpc2NsYWltZXIqIG5vIGFycmF5OlxuICAgKlxuICAgKiBgYGBcbiAgICogdGhpcy5kaXNjbGFpbWVycyA9IFsuLi50aGlzLmRpc2NsYWltZXJzLCBkaXNjbGFpbWVyXTtcbiAgICogYGBgXG4gICAqXG4gICAqIG91XG4gICAqXG4gICAqIGBgYFxuICAgKiB0aGlzLmRpc2NsYWltZXJzID0gdGhpcy5kaXNjbGFpbWVycy5jb25jYXQoZGlzY2xhaW1lcik7XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KCd0LWRpc2NsYWltZXJzJykgc2V0IGRpc2NsYWltZXJzKHZhbHVlOiBBcnJheTxUaGZEaXNjbGFpbWVyPikge1xuXG4gICAgdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzID0gWy4uLnRoaXMuZGlzY2xhaW1lcnNdO1xuICAgIHRoaXMuX2Rpc2NsYWltZXJzID0gdGhpcy5jaGVja0Rpc2NsYWltZXJzKHZhbHVlKTtcblxuICB9XG5cbiAgZ2V0IGRpc2NsYWltZXJzKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNjbGFpbWVycztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE9jdWx0YSBvIGJvdMOjbyBwYXJhIHJlbW92ZXIgdG9kb3Mgb3MgKmRpc2NsYWltZXJzKiBkbyBncnVwby5cbiAgICpcbiAgICogPiBQb3IgcGFkcsOjbywgbyBtZXNtbyDDqSBleGliaWRvIMOgIHBhcnRpciBkZSBkb2lzIG91IG1haXMgKmRpc2NsYWltZXJzKiBjb20gYSBvcMOnw6NvIGBoaWRlQ2xvc2VgIGhhYmlsaXRhZGEuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgndC1oaWRlLXJlbW92ZS1hbGwnKVxuICBzZXQgaGlkZVJlbW92ZUFsbCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVSZW1vdmVBbGwgPSA8YW55PnZhbHVlID09PSAnJyA/IHRydWUgOiBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIGdldCBoaWRlUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiB0aGlzLl9oaWRlUmVtb3ZlQWxsO1xuICB9XG5cbiAgLyoqIFTDrXR1bG8gZG8gZ3J1cG8gZGUgKmRpc2NsYWltZXJzKi4gKi9cbiAgQElucHV0KCd0LXRpdGxlJykgdGl0bGU/OiBzdHJpbmc7XG5cbiAgLyoqIEZ1bsOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgcXVhbmRvIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBmb3IgbW9kaWZpY2FkYS4gKi9cbiAgQE91dHB1dCgndC1jaGFuZ2UnKSBjaGFuZ2U/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGNvbnN0cnVjdG9yKGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycykge1xuICAgIHRoaXMuZGlmZmVyID0gZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7XG4gICAgdGhpcy5jaGVja0NoYW5nZXMoKTtcbiAgfVxuXG4gIGNsb3NlSXRlbShkaXNjbGFpbWVyOiBhbnksIGVtaXRDaGFuZ2U6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5kaXNjbGFpbWVycy5maW5kSW5kZXgoZCA9PiBkWyckaWQnXSA9PT0gZGlzY2xhaW1lclsnJGlkJ10pO1xuICAgIHRoaXMuZGlzY2xhaW1lcnMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG5cbiAgICBpZiAoZW1pdENoYW5nZSkge1xuICAgICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgICB9XG4gIH1cblxuICBpc1JlbW92ZUFsbCgpIHtcbiAgICByZXR1cm4gIXRoaXMuaGlkZVJlbW92ZUFsbCAmJiB0aGlzLmRpc2NsYWltZXJzLmZpbHRlcihjID0+ICFjLmhpZGVDbG9zZSkubGVuZ3RoID4gMTtcbiAgfVxuXG4gIG9uS2V5UHJlc3MoZXZlbnQ6IGFueSkge1xuXG4gICAgaWYgKGlzS2V5Q29kZUVudGVyKGV2ZW50KSkge1xuICAgICAgdGhpcy5yZW1vdmVBbGxJdGVtcygpO1xuICAgIH1cblxuICB9XG5cbiAgcmVtb3ZlQWxsSXRlbXMoKSB7XG4gICAgY29uc3QgcmVtb3ZlSXRlbXMgPSBbXTtcblxuICAgIHRoaXMuZGlzY2xhaW1lcnMuZm9yRWFjaChkaXNjbGFpbWVyID0+IHtcbiAgICAgIGlmICghZGlzY2xhaW1lci5oaWRlQ2xvc2UpIHtcbiAgICAgICAgcmVtb3ZlSXRlbXMucHVzaChkaXNjbGFpbWVyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJlbW92ZUl0ZW1zLmZvckVhY2goZGlzY2xhaW1lciA9PiB0aGlzLmNsb3NlSXRlbShkaXNjbGFpbWVyLCBmYWxzZSkpO1xuXG4gICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDaGFuZ2VzKCkge1xuXG4gICAgaWYgKHRoaXMuZGlmZmVyKSB7XG4gICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5kaWZmZXIuZGlmZih0aGlzLmRpc2NsYWltZXJzKTtcblxuICAgICAgaWYgKGNoYW5nZXMgJiYgdGhpcy5kaXNjbGFpbWVyc0FyZUNoYW5nZWQodGhpcy5kaXNjbGFpbWVycykpIHtcbiAgICAgICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgICAgIH1cblxuICAgIH1cblxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0Rpc2NsYWltZXJzKGRpc2NsYWltZXJzOiBBcnJheTxUaGZEaXNjbGFpbWVyPikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGRpc2NsYWltZXJzKSkge1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpc2NsYWltZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGRpc2NsYWltZXIgPSBkaXNjbGFpbWVyc1tpXTtcblxuICAgICAgICBpZiAoZGlzY2xhaW1lci52YWx1ZSB8fCBkaXNjbGFpbWVyLnZhbHVlID09PSAwIHx8IGRpc2NsYWltZXIudmFsdWUgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICBkaXNjbGFpbWVyWyckaWQnXSA9IHV1aWQoKTtcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgZGlzY2xhaW1lcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGktLTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGlzY2xhaW1lcnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNjbGFpbWVyc0FyZUNoYW5nZWQoZGlzY2xhaW1lcnM6IEFycmF5PFRoZkRpc2NsYWltZXI+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlczogQXJyYXk8VGhmRGlzY2xhaW1lcj4gPSBkaXNjbGFpbWVycztcblxuICAgIGlmIChjdXJyZW50VmFsdWVzLmxlbmd0aCAhPT0gdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZXMuc29tZSgoZGlzY2xhaW1lciwgaW5kZXgpID0+IGRpc2NsYWltZXIudmFsdWUgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0udmFsdWVcbiAgICAgIHx8IGRpc2NsYWltZXIucHJvcGVydHkgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0ucHJvcGVydHkpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMuZGlzY2xhaW1lcnMpO1xuICAgIH0pO1xuICAgIHRoaXMucHJldmlvdXNEaXNjbGFpbWVycyA9IFsuLi50aGlzLl9kaXNjbGFpbWVyc107XG4gIH1cblxufVxuIl19