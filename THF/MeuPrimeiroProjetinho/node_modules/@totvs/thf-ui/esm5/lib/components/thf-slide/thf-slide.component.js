/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ContentChild, ElementRef, HostListener, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { ThfSlideBaseComponent } from './thf-slide-base.component';
import { ThfSlideContentTemplateDirective } from './directives/thf-slide-content-template.directive';
import { ThfSlideItemComponent } from './thf-slide-item/thf-slide-item.component';
/** @type {?} */
var thfSlideDefaultHeight = 336;
/** @type {?} */
var thfSlideIntervalMin = 1000;
/** @type {?} */
var thfSlideMinHeight = 192;
/** @type {?} */
var thfSlideTiming = '250ms ease';
/**
 * \@docsExtends ThfSlideBaseComponent
 *
 * \@example
 * <example name="thf-slide-basic" title="Totvs Slide Basic">
 *   <file name="sample-thf-slide-basic/sample-thf-slide-basic.component.html"> </file>
 *   <file name="sample-thf-slide-basic/sample-thf-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-slide-labs" title="Totvs Slide Labs">
 *   <file name="sample-thf-slide-labs/sample-thf-slide-labs.component.html"> </file>
 *   <file name="sample-thf-slide-labs/sample-thf-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-slide-useful-articles" title="Totvs Slide - Useful articles">
 *   <file name="sample-thf-slide-useful-articles/sample-thf-slide-useful-articles.component.html"> </file>
 *   <file name="sample-thf-slide-useful-articles/sample-thf-slide-useful-articles.component.ts"> </file>
 * </example>
 *
 * <example name="thf-slide-landscapes" title="Totvs Slide - Landscapes">
 *   <file name="sample-thf-slide-landscapes/sample-thf-slide-landscapes.component.html"> </file>
 *   <file name="sample-thf-slide-landscapes/sample-thf-slide-landscapes.component.ts"> </file>
 * </example>
 */
var ThfSlideComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfSlideComponent, _super);
    function ThfSlideComponent(builder) {
        var _this = _super.call(this) || this;
        _this.builder = builder;
        _this.isLoaded = false;
        _this.currentSlideIndex = 0;
        _this.slideItems = [];
        return _this;
    }
    Object.defineProperty(ThfSlideComponent.prototype, "hasElements", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return !!this.slide.nativeElement.offsetWidth && !!this.itemsElements && !!this.itemsElements.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfSlideComponent.prototype, "isImageSlide", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return !this.slideContentTemplate;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfSlideComponent.prototype, "offset", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.currentSlideIndex * this.slideItemWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfSlideComponent.prototype, "hasSlides", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.slides && !!this.slides.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.onResize = /**
     * @return {?}
     */
    function () {
        if (this.slide) {
            this.setSlideItemWidth();
            this.goToItem(this.currentSlideIndex);
        }
    };
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        if (!this.isLoaded && this.hasElements) {
            this.setSlideItemWidth();
            this.isLoaded = true;
            if (this.hasSlides) {
                this.startSlide();
            }
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    ThfSlideComponent.prototype.goToItem = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (this.interval > thfSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = index;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.nextControl = /**
     * @return {?}
     */
    function () {
        if (this.interval > thfSlideIntervalMin) {
            this.startInterval();
        }
        this.next();
    };
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.next = /**
     * @return {?}
     */
    function () {
        if (this.currentSlideIndex + 1 === this.slideItems.length) {
            this.currentSlideIndex = 0;
            this.animate(0);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex + 1) % this.slideItems.length;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.previous = /**
     * @return {?}
     */
    function () {
        if (this.currentSlideIndex === 0) {
            this.currentSlideIndex = this.slideItems.length - 1;
            this.animate(this.offset);
            return;
        }
        this.currentSlideIndex = ((this.currentSlideIndex - 1) + this.slideItems.length) % this.slideItems.length;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    ThfSlideComponent.prototype.previousControl = /**
     * @return {?}
     */
    function () {
        if (this.interval > thfSlideIntervalMin) {
            this.startInterval();
        }
        this.previous();
    };
    /**
     * @param {?} height
     * @return {?}
     */
    ThfSlideComponent.prototype.setSlideHeight = /**
     * @param {?} height
     * @return {?}
     */
    function (height) {
        this.setHeight(height);
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    ThfSlideComponent.prototype.animate = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        if (this.hasElements) {
            /** @type {?} */
            var animation = this.buildTransitionAnimation(offset);
            this.player = animation.create(this.slide.nativeElement);
            this.player.play();
        }
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    ThfSlideComponent.prototype.buildTransitionAnimation = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        return this.builder.build([
            animate(thfSlideTiming, keyframes([style({ transform: "translateX(-" + offset + "px)" })]))
        ]);
    };
    /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    ThfSlideComponent.prototype.createArrayForTemplate = /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        this.slideItems = tslib_1.__spread(slides);
    };
    /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    ThfSlideComponent.prototype.createArrayFromSlides = /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        var _this = this;
        /** @type {?} */
        var isStringArray = slides.every((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return typeof item === 'string'; }));
        if (isStringArray) {
            slides.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) { return _this.slideItems.push({ image: "" + element }); }));
        }
        else {
            this.slideItems = tslib_1.__spread((/** @type {?} */ (slides)));
        }
    };
    /**
     * @private
     * @param {?} height
     * @return {?}
     */
    ThfSlideComponent.prototype.setDefaultHeight = /**
     * @private
     * @param {?} height
     * @return {?}
     */
    function (height) {
        if (height && height <= thfSlideMinHeight || !height && this.isImageSlide) {
            this.slide.nativeElement.style.height = thfSlideDefaultHeight + "px";
            this.imageHeight = thfSlideDefaultHeight;
        }
        else {
            this.imageHeight = undefined;
        }
    };
    /**
     * @private
     * @param {?} height
     * @return {?}
     */
    ThfSlideComponent.prototype.setHeight = /**
     * @private
     * @param {?} height
     * @return {?}
     */
    function (height) {
        if (height && height > thfSlideMinHeight) {
            this.slide.nativeElement.style.height = height + "px";
            this.imageHeight = height;
        }
        else {
            this.setDefaultHeight(height);
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfSlideComponent.prototype.setSlideItemWidth = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.hasElements) {
            this.slideItemWidth = this.itemsElements.first.itemElement.nativeElement.getBoundingClientRect().width;
        }
    };
    /**
     * @protected
     * @return {?}
     */
    ThfSlideComponent.prototype.cancelInterval = /**
     * @protected
     * @return {?}
     */
    function () {
        clearInterval(this.setInterval);
    };
    /**
     * @protected
     * @param {?} slides
     * @return {?}
     */
    ThfSlideComponent.prototype.setSlideItems = /**
     * @protected
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        if (this.hasSlides) {
            this.slideContentTemplate ? this.createArrayForTemplate(slides) : this.createArrayFromSlides(slides);
        }
        else {
            this.slideItems = [];
            this.cancelInterval();
        }
    };
    /**
     * @protected
     * @return {?}
     */
    ThfSlideComponent.prototype.startSlide = /**
     * @protected
     * @return {?}
     */
    function () {
        this.setSlideHeight(this.height);
        if (this.interval > thfSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = 0;
    };
    /**
     * @protected
     * @return {?}
     */
    ThfSlideComponent.prototype.startInterval = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.setInterval) {
            this.cancelInterval();
        }
        this.setInterval = this.hasSlides && this.hasElements ? setInterval((/**
         * @return {?}
         */
        function () { _this.next(); }), this.interval) : undefined;
    };
    ThfSlideComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-slide',
                    template: "<div class=\"thf-slide-wrapper\">\n  <div class=\"thf-slide-outer\">\n    <div class=\"thf-slide-inner\" #slide>\n      <ng-container *ngFor=\"let item of slideItems; let index = index;\">\n        <thf-slide-item\n          [t-action]=\"item.action\"\n          [t-data]=\"item\"\n          [t-image]=\"item.image\"\n          [t-image-height]=\"imageHeight\"\n          [t-template]=\"slideContentTemplate\"\n          [t-alt]=\"item.alt\"\n          [t-link]=\"item.link\">\n        </thf-slide-item>\n      </ng-container>\n    </div>\n\n    <thf-slide-control *ngIf=\"hasSlides && slides.length > 1\" \n      t-control=\"previous\"\n      (t-click)=\"previousControl()\">\n    </thf-slide-control>\n\n    <thf-slide-control *ngIf=\"hasSlides && slides.length > 1\"\n      t-control=\"next\"\n      (t-click)=\"nextControl()\">\n    </thf-slide-control>\n\n  </div>\n\n  <thf-slide-circles\n    *ngIf=\"hasSlides && slides.length > 1\"\n    [t-current-slide-index]=\"currentSlideIndex\"\n    [t-items]=\"slideItems\"\n    (t-click)=\"goToItem($event)\">\n  </thf-slide-circles>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    ThfSlideComponent.ctorParameters = function () { return [
        { type: AnimationBuilder }
    ]; };
    ThfSlideComponent.propDecorators = {
        slideContentTemplate: [{ type: ContentChild, args: [ThfSlideContentTemplateDirective, { static: true },] }],
        slide: [{ type: ViewChild, args: ['slide', { static: true },] }],
        itemsElements: [{ type: ViewChildren, args: [ThfSlideItemComponent,] }],
        onResize: [{ type: HostListener, args: ['window:resize',] }]
    };
    return ThfSlideComponent;
}(ThfSlideBaseComponent));
export { ThfSlideComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.isLoaded;
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.setInterval;
    /** @type {?} */
    ThfSlideComponent.prototype.currentSlideIndex;
    /** @type {?} */
    ThfSlideComponent.prototype.imageHeight;
    /** @type {?} */
    ThfSlideComponent.prototype.slideItems;
    /** @type {?} */
    ThfSlideComponent.prototype.slideItemWidth;
    /** @type {?} */
    ThfSlideComponent.prototype.slideContentTemplate;
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.slide;
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.itemsElements;
    /**
     * @type {?}
     * @private
     */
    ThfSlideComponent.prototype.builder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXNsaWRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0b3R2cy90aGYtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtc2xpZGUvdGhmLXNsaWRlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFZLFVBQVUsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFaEksT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBcUMsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXJILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ25FLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBRXJHLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDOztJQUU1RSxxQkFBcUIsR0FBRyxHQUFHOztJQUMzQixtQkFBbUIsR0FBRyxJQUFJOztJQUMxQixpQkFBaUIsR0FBRyxHQUFHOztJQUN2QixjQUFjLEdBQUcsWUFBWTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCbkM7SUFJdUMsNkNBQXFCO0lBd0MxRCwyQkFBb0IsT0FBeUI7UUFBN0MsWUFDRSxpQkFBTyxTQUNSO1FBRm1CLGFBQU8sR0FBUCxPQUFPLENBQWtCO1FBdENyQyxjQUFRLEdBQVksS0FBSyxDQUFDO1FBb0JsQyx1QkFBaUIsR0FBRyxDQUFDLENBQUM7UUFFdEIsZ0JBQVUsR0FBOEIsRUFBRSxDQUFDOztJQWtCM0MsQ0FBQztJQXBDRCxzQkFBWSwwQ0FBVzs7Ozs7UUFBdkI7WUFDRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxXQUFXLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLElB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QUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUN6SCxDQUFDOztnQkF6TUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxXQUFXO29CQUNyQiwra0NBQXlDO2lCQUMxQzs7OztnQkF2Q2lCLGdCQUFnQjs7O3VDQW1FL0IsWUFBWSxTQUFDLGdDQUFnQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTt3QkFFL0QsU0FBUyxTQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0NBRW5DLFlBQVksU0FBQyxxQkFBcUI7MkJBRWxDLFlBQVksU0FBQyxlQUFlOztJQXNLL0Isd0JBQUM7Q0FBQSxBQTNNRCxDQUl1QyxxQkFBcUIsR0F1TTNEO1NBdk1ZLGlCQUFpQjs7Ozs7O0lBRTVCLHFDQUFrQzs7Ozs7SUFDbEMsbUNBQWdDOzs7OztJQUNoQyx3Q0FBeUI7O0lBa0J6Qiw4Q0FBc0I7O0lBQ3RCLHdDQUFvQjs7SUFDcEIsdUNBQTJDOztJQUMzQywyQ0FBdUI7O0lBRXZCLGlEQUF5SDs7Ozs7SUFFekgsa0NBQWdFOzs7OztJQUVoRSwwQ0FBNkY7Ozs7O0lBU2pGLG9DQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBEb0NoZWNrICwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLCBRdWVyeUxpc3QsIFZpZXdDaGlsZCwgVmlld0NoaWxkcmVuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGFuaW1hdGUsIEFuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvbkZhY3RvcnksIEFuaW1hdGlvblBsYXllciwga2V5ZnJhbWVzLCBzdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuXG5pbXBvcnQgeyBUaGZTbGlkZUJhc2VDb21wb25lbnQgfSBmcm9tICcuL3RoZi1zbGlkZS1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZTbGlkZUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSB9IGZyb20gJy4vZGlyZWN0aXZlcy90aGYtc2xpZGUtY29udGVudC10ZW1wbGF0ZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgVGhmU2xpZGVJdGVtIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3RoZi1zbGlkZS1pdGVtLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZTbGlkZUl0ZW1Db21wb25lbnQgfSBmcm9tICcuL3RoZi1zbGlkZS1pdGVtL3RoZi1zbGlkZS1pdGVtLmNvbXBvbmVudCc7XG5cbmNvbnN0IHRoZlNsaWRlRGVmYXVsdEhlaWdodCA9IDMzNjtcbmNvbnN0IHRoZlNsaWRlSW50ZXJ2YWxNaW4gPSAxMDAwO1xuY29uc3QgdGhmU2xpZGVNaW5IZWlnaHQgPSAxOTI7XG5jb25zdCB0aGZTbGlkZVRpbWluZyA9ICcyNTBtcyBlYXNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmU2xpZGVCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtc2xpZGUtYmFzaWNcIiB0aXRsZT1cIlRvdHZzIFNsaWRlIEJhc2ljXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXNsaWRlLWJhc2ljL3NhbXBsZS10aGYtc2xpZGUtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1zbGlkZS1iYXNpYy9zYW1wbGUtdGhmLXNsaWRlLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1zbGlkZS1sYWJzXCIgdGl0bGU9XCJUb3R2cyBTbGlkZSBMYWJzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXNsaWRlLWxhYnMvc2FtcGxlLXRoZi1zbGlkZS1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc2xpZGUtbGFicy9zYW1wbGUtdGhmLXNsaWRlLWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLXNsaWRlLXVzZWZ1bC1hcnRpY2xlc1wiIHRpdGxlPVwiVG90dnMgU2xpZGUgLSBVc2VmdWwgYXJ0aWNsZXNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc2xpZGUtdXNlZnVsLWFydGljbGVzL3NhbXBsZS10aGYtc2xpZGUtdXNlZnVsLWFydGljbGVzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc2xpZGUtdXNlZnVsLWFydGljbGVzL3NhbXBsZS10aGYtc2xpZGUtdXNlZnVsLWFydGljbGVzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1zbGlkZS1sYW5kc2NhcGVzXCIgdGl0bGU9XCJUb3R2cyBTbGlkZSAtIExhbmRzY2FwZXNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc2xpZGUtbGFuZHNjYXBlcy9zYW1wbGUtdGhmLXNsaWRlLWxhbmRzY2FwZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1zbGlkZS1sYW5kc2NhcGVzL3NhbXBsZS10aGYtc2xpZGUtbGFuZHNjYXBlcy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtc2xpZGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLXNsaWRlLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgVGhmU2xpZGVDb21wb25lbnQgZXh0ZW5kcyBUaGZTbGlkZUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrIHtcblxuICBwcml2YXRlIGlzTG9hZGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG4gIHByaXZhdGUgc2V0SW50ZXJ2YWw6IGFueTtcblxuICBwcml2YXRlIGdldCBoYXNFbGVtZW50cygpIHtcbiAgICByZXR1cm4gISF0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggJiYgISF0aGlzLml0ZW1zRWxlbWVudHMgJiYgISF0aGlzLml0ZW1zRWxlbWVudHMubGVuZ3RoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNJbWFnZVNsaWRlKCkge1xuICAgIHJldHVybiAhdGhpcy5zbGlkZUNvbnRlbnRUZW1wbGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG9mZnNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50U2xpZGVJbmRleCAqIHRoaXMuc2xpZGVJdGVtV2lkdGg7XG4gIH1cblxuICBnZXQgaGFzU2xpZGVzKCkge1xuICAgIHJldHVybiAhIXRoaXMuc2xpZGVzICYmICEhdGhpcy5zbGlkZXMubGVuZ3RoO1xuICB9XG5cbiAgY3VycmVudFNsaWRlSW5kZXggPSAwO1xuICBpbWFnZUhlaWdodDogbnVtYmVyO1xuICBzbGlkZUl0ZW1zOiBBcnJheTxUaGZTbGlkZUl0ZW0gfCBhbnk+ID0gW107XG4gIHNsaWRlSXRlbVdpZHRoOiBudW1iZXI7XG5cbiAgQENvbnRlbnRDaGlsZChUaGZTbGlkZUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSwgeyBzdGF0aWM6IHRydWUgfSkgc2xpZGVDb250ZW50VGVtcGxhdGU6IFRoZlNsaWRlQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlO1xuXG4gIEBWaWV3Q2hpbGQoJ3NsaWRlJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBzbGlkZTogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkcmVuKFRoZlNsaWRlSXRlbUNvbXBvbmVudCkgcHJpdmF0ZSBpdGVtc0VsZW1lbnRzOiBRdWVyeUxpc3Q8VGhmU2xpZGVJdGVtQ29tcG9uZW50PjtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJykgb25SZXNpemUoKSB7XG4gICAgaWYgKHRoaXMuc2xpZGUpIHtcbiAgICAgIHRoaXMuc2V0U2xpZGVJdGVtV2lkdGgoKTtcbiAgICAgIHRoaXMuZ29Ub0l0ZW0odGhpcy5jdXJyZW50U2xpZGVJbmRleCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcblxuICAgIGlmICghdGhpcy5pc0xvYWRlZCAmJiB0aGlzLmhhc0VsZW1lbnRzKSB7XG5cbiAgICAgIHRoaXMuc2V0U2xpZGVJdGVtV2lkdGgoKTtcbiAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuXG4gICAgICBpZiAodGhpcy5oYXNTbGlkZXMpIHtcbiAgICAgICAgdGhpcy5zdGFydFNsaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ29Ub0l0ZW0oaW5kZXg6IG51bWJlcikge1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiB0aGZTbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gaW5kZXg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIG5leHRDb250cm9sKCkge1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiB0aGZTbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLm5leHQoKTtcbiAgfVxuXG4gIG5leHQoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFNsaWRlSW5kZXggKyAxID09PSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gMDtcbiAgICAgIHRoaXMuYW5pbWF0ZSgwKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9ICh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSkgJSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoO1xuICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gIH1cblxuICBwcmV2aW91cygpIHtcbiAgICBpZiAodGhpcy5jdXJyZW50U2xpZGVJbmRleCA9PT0gMCkge1xuICAgICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IHRoaXMuc2xpZGVJdGVtcy5sZW5ndGggLSAxO1xuICAgICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9ICgodGhpcy5jdXJyZW50U2xpZGVJbmRleCAtIDEpICsgdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aCkgJSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoO1xuICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gIH1cblxuICBwcmV2aW91c0NvbnRyb2woKSB7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHRoZlNsaWRlSW50ZXJ2YWxNaW4pIHtcbiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMucHJldmlvdXMoKTtcbiAgfVxuXG4gIHNldFNsaWRlSGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRIZWlnaHQoaGVpZ2h0KTtcbiAgfVxuXG4gIHByaXZhdGUgYW5pbWF0ZShvZmZzZXQ6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbkZhY3RvcnkgPSB0aGlzLmJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQpO1xuXG4gICAgICB0aGlzLnBsYXllciA9IGFuaW1hdGlvbi5jcmVhdGUodGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50KTtcbiAgICAgIHRoaXMucGxheWVyLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmJ1aWxkZXIuYnVpbGQoW1xuICAgICAgYW5pbWF0ZShcbiAgICAgICAgdGhmU2xpZGVUaW1pbmcsXG4gICAgICAgIGtleWZyYW1lcyhbc3R5bGUoeyB0cmFuc2Zvcm06IGB0cmFuc2xhdGVYKC0ke29mZnNldH1weClgIH0pXSlcbiAgICAgIClcbiAgICBdKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQXJyYXlGb3JUZW1wbGF0ZShzbGlkZXM6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLnNsaWRlSXRlbXMgPSBbLi4uc2xpZGVzXTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQXJyYXlGcm9tU2xpZGVzKHNsaWRlczogQXJyYXk8VGhmU2xpZGVJdGVtIHwgc3RyaW5nIHwgYW55Pikge1xuICAgIGNvbnN0IGlzU3RyaW5nQXJyYXkgPSBzbGlkZXMuZXZlcnkoaXRlbSA9PiB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycpO1xuXG4gICAgaWYgKGlzU3RyaW5nQXJyYXkpIHtcbiAgICAgIHNsaWRlcy5mb3JFYWNoKGVsZW1lbnQgPT4gdGhpcy5zbGlkZUl0ZW1zLnB1c2goeyBpbWFnZTogYCR7ZWxlbWVudH1gIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zbGlkZUl0ZW1zID0gWy4uLjxBcnJheTxUaGZTbGlkZUl0ZW0+PnNsaWRlc107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXREZWZhdWx0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPD0gdGhmU2xpZGVNaW5IZWlnaHQgfHwgIWhlaWdodCAmJiB0aGlzLmlzSW1hZ2VTbGlkZSkge1xuICAgICAgdGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke3RoZlNsaWRlRGVmYXVsdEhlaWdodH1weGA7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gdGhmU2xpZGVEZWZhdWx0SGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPiB0aGZTbGlkZU1pbkhlaWdodCkge1xuICAgICAgdGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldERlZmF1bHRIZWlnaHQoaGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFNsaWRlSXRlbVdpZHRoKCkge1xuICAgIGlmICh0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICB0aGlzLnNsaWRlSXRlbVdpZHRoID0gdGhpcy5pdGVtc0VsZW1lbnRzLmZpcnN0Lml0ZW1FbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGNhbmNlbEludGVydmFsKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zZXRJbnRlcnZhbCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0U2xpZGVJdGVtcyhzbGlkZXM6IEFycmF5PFRoZlNsaWRlSXRlbSB8IHN0cmluZyB8IGFueT4pIHtcblxuICAgIGlmICh0aGlzLmhhc1NsaWRlcykge1xuICAgICAgdGhpcy5zbGlkZUNvbnRlbnRUZW1wbGF0ZSA/IHRoaXMuY3JlYXRlQXJyYXlGb3JUZW1wbGF0ZShzbGlkZXMpIDogdGhpcy5jcmVhdGVBcnJheUZyb21TbGlkZXMoc2xpZGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zbGlkZUl0ZW1zID0gW107XG4gICAgICB0aGlzLmNhbmNlbEludGVydmFsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHN0YXJ0U2xpZGUoKSB7XG5cbiAgICB0aGlzLnNldFNsaWRlSGVpZ2h0KHRoaXMuaGVpZ2h0KTtcblxuICAgIGlmICh0aGlzLmludGVydmFsID4gdGhmU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRJbnRlcnZhbCgpIHtcblxuICAgIGlmICh0aGlzLnNldEludGVydmFsKSB7XG4gICAgICB0aGlzLmNhbmNlbEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRJbnRlcnZhbCA9IHRoaXMuaGFzU2xpZGVzICYmIHRoaXMuaGFzRWxlbWVudHMgPyBzZXRJbnRlcnZhbCgoKSA9PiB7IHRoaXMubmV4dCgpOyB9LCB0aGlzLmludGVydmFsKSA6IHVuZGVmaW5lZDtcbiAgfVxuXG59XG4iXX0=