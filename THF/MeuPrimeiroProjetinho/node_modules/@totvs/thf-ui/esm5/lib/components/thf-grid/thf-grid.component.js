/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Input, Renderer2, ViewChild } from '@angular/core';
/**
 * \@description
 *
 * Componente grid.
 *
 * Ações / atalhos:
 *
 * - ARROW-UP: Navega para celula superior / Na ultima linha adiciona uma linha em branco no grid;
 * - ARROW-DOWN: Navega para celula inferior;
 * - ARROW-RIGHT: Navega para celula direita;
 * - ARROW-LEFT: Navega para celula esquerda;
 * - TAB: Navega para próxima celula;
 * - SHIFT+TAB: Navega para celula anterior;
 * - CTRL+DEL: Remove linha;
 * - DEL/BACKSPACE: Limpa celula;
 * - ENTER: Edita linha com valor atual/Confirma edição da celula;
 * - DOUBLE-CLICK: Edita linha com valor atual;
 * - ESC: Cancela edição da celula / Cancela inserção de linhas em branco;
 * - A..Z/0..9: Inicia edição com valor em branco.
 *
 * \@example
 *
 * <example name="thf-grid-basic" title="Totvs Grid Basic">
 *  <file name="sample-thf-grid-basic/sample-thf-grid-basic.component.html"> </file>
 *  <file name="sample-thf-grid-basic/sample-thf-grid-basic.component.ts"> </file>
 * </example>
 */
var ThfGridComponent = /** @class */ (function () {
    function ThfGridComponent(changeDetectorRef, elRef, renderer) {
        var _this = this;
        this.changeDetectorRef = changeDetectorRef;
        this.elRef = elRef;
        this.lastCell = '0-0';
        this.lastRow = 0;
        this.lastColumn = 0;
        this.currencyCell = '0-0';
        this.currencyRow = 0;
        this.currencyColumn = 0;
        this.logger = false;
        this.width = '100%';
        this.widthFreeze = 0;
        this.widthActions = 0;
        this._columns = [];
        /**
         * \@description
         *
         * Ações disparadas quando uma linha do grid é manipulada.
         */
        this.rowActions = {};
        /**
         * Lista com os dados que serão exibidos no grid.
         */
        this.data = [];
        this.debounceResize();
        this.resizeListener = renderer.listen('window', 'resize', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.debounceResize();
        }));
    }
    Object.defineProperty(ThfGridComponent.prototype, "columns", {
        get: /**
         * @return {?}
         */
        function () {
            return this._columns.filter((/**
             * @param {?} column
             * @return {?}
             */
            function (column) { return column.freeze !== true && column.action !== true; }));
        },
        /**
         * Colunas exibidas no grid.
         */
        set: /**
         * Colunas exibidas no grid.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._columns = tslib_1.__spread(value);
            this._columns.forEach((/**
             * @param {?} column
             * @return {?}
             */
            function (column) {
                column.label = column.label || column.property;
                if (column.freeze === true) {
                    column.cssWidth = (column.width || 100) + "px";
                }
                else {
                    column.cssWidth = column.width ? column.width + "px" : '100%';
                }
            }));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ThfGridComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.resizeListener) {
            this.resizeListener();
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfGridComponent.prototype.debounceResize = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        clearTimeout(this.timeoutResize);
        this.timeoutResize = setTimeout((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var widthTableWrapper = _this.tableWrapper.nativeElement.offsetWidth;
            _this.width = widthTableWrapper - (_this.widthFreeze + 8) - _this.widthActions + "px";
        }), 100);
    };
    Object.defineProperty(ThfGridComponent.prototype, "freezeColumns", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var freezeColumns = this._columns.filter((/**
             * @param {?} column
             * @return {?}
             */
            function (column) { return column.freeze === true; }));
            this.widthFreeze = freezeColumns.reduce((/**
             * @param {?} prev
             * @param {?} current
             * @return {?}
             */
            function (prev, current) { return prev + (current.width || 100); }), 0);
            return freezeColumns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ThfGridComponent.prototype, "actionColumns", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var actionsColumns = this._columns.filter((/**
             * @param {?} column
             * @return {?}
             */
            function (column) { return column.action === true; }));
            this.widthActions = actionsColumns.length > 0 ? 56 : 0;
            return actionsColumns;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    ThfGridComponent.prototype.cancelRow = /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    function (event, row) {
        var _this = this;
        /** @type {?} */
        var el = event.path.find((/**
         * @param {?} element
         * @return {?}
         */
        function (element) { return element.id; }));
        if (!el) {
            return;
        }
        var _a = tslib_1.__read((el.id).split('-'), 1), x = _a[0];
        if (this.isEmptyRow(x)) {
            if (!this.removeRow(event, row)) {
                return;
            }
            this.currencyObj = Object.assign({}, this.data[this.currencyRow - 1]);
        }
        else {
            this.data[+x - 1] = Object.assign({}, this.currencyObj);
            setTimeout((/**
             * @return {?}
             */
            function () { return _this.selectCell(_this.currencyRow, _this.currencyColumn); }));
        }
    };
    /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    ThfGridComponent.prototype.removeRow = /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    function (event, row) {
        if (this.rowActions.beforeRemove && !this.rowActions.beforeRemove(Object.assign({}, row))) {
            return false;
        }
        /** @type {?} */
        var index = this.data.indexOf(row);
        this.data.splice(index, 1);
        this.changeDetectorRef.detectChanges();
        if ((this.data.length === 0) || (index === this.data.length)) {
            this.selectCell(this.currencyRow - 1, this.currencyColumn);
        }
        else {
            this.selectCell(this.currencyRow, this.currencyColumn);
        }
        return true;
    };
    /**
     * @param {?} event
     * @param {?} direction
     * @return {?}
     */
    ThfGridComponent.prototype.tableKeydown = /**
     * @param {?} event
     * @param {?} direction
     * @return {?}
     */
    function (event, direction) {
        var _a = tslib_1.__read(event.target.id.split('-'), 2), row = _a[0], col = _a[1];
        row = +row;
        col = +col;
        /** @type {?} */
        var prow = +row;
        /** @type {?} */
        var pcol = +col;
        // event.preventDefault();
        // event.stopPropagation();
        // debugger;
        if (direction === 'down') {
            if (row <= this.data.length) {
                prow++;
            }
            if (row === this.data.length) {
                if (row === 0 || !this.isEmptyRow(row)) {
                    if (this.saveRow(row)) {
                        if (!this.insertRow()) {
                            return;
                        }
                    }
                    else {
                        return;
                    }
                }
                else {
                    prow--;
                }
            }
        }
        else if ((direction === 'up') && (row > 0)) {
            prow--;
        }
        else if ((direction === 'left') && (col > 0)) {
            pcol--;
        }
        else if ((direction === 'right') && (col < this._columns.length - 1)) {
            pcol++;
        }
        else if (direction === 'next') {
            if (col < this._columns.length - 1) {
                pcol++;
                event.preventDefault();
            }
            else if (row < this.data.length) {
                pcol = 0;
                prow++;
                event.preventDefault();
            }
        }
        else if (direction === 'prior') {
            if (col > 0) {
                pcol--;
                event.preventDefault();
            }
            else if (row > 0) {
                pcol = this._columns.length - 1;
                prow--;
                event.preventDefault();
            }
        }
        if (this.currencyCell === prow + "-" + pcol) {
            // console.log('vazou');
            return;
        }
        // debugger;
        if (prow !== this.currencyRow && row > 0 && this.data.length >= row) {
            if (!this.isEmptyRow(row)) {
                if (!this.saveRow(row)) {
                    return;
                }
            }
            else {
                if (!this.removeRow(event, row)) {
                    return;
                }
            }
        }
        if (this.currencyRow !== prow) {
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('mudou de linha');
        }
        this.lastCell = event.target.id;
        this.lastRow = row;
        this.lastColumn = col;
        this.selectCell(prow, pcol);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ThfGridComponent.prototype.tableClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var el = event.path.find((/**
         * @param {?} element
         * @return {?}
         */
        function (element) { return element.id; }));
        if (!el) {
            this.selectCell(this.currencyRow, this.currencyColumn);
            return;
        }
        if (this.currencyCell === el.id) {
            return;
        }
        var _a = tslib_1.__read((el.id).split('-'), 2), row = _a[0], col = _a[1];
        /** @type {?} */
        var prow = +row;
        /** @type {?} */
        var pcol = +col;
        if (prow !== this.currencyRow) {
            if (this.currencyRow > 0) {
                if (!this.isEmptyRow(this.currencyRow)) {
                    if (!this.saveRow(this.currencyRow)) {
                        this.selectCell(this.currencyRow, this.currencyColumn);
                        return;
                    }
                }
                else {
                    if (!this.removeRow(event, row)) {
                        return;
                    }
                }
            }
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('>>>>>>> ', prow - 1);
        }
        this.lastCell = this.currencyCell;
        this.lastRow = this.currencyRow;
        this.lastColumn = this.currencyColumn;
        this.currencyCell = el.id;
        this.currencyRow = prow;
        this.currencyColumn = pcol;
    };
    /**
     * @param {?} row
     * @return {?}
     */
    ThfGridComponent.prototype.saveRow = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        // console.log(this.data[row - 1]);
        var _this = this;
        // console.log(this.data[row - 1]);
        /** @type {?} */
        var obj = this.data[row - 1];
        if (!Object.keys(obj).some((/**
         * @param {?} prop
         * @return {?}
         */
        function (prop) { return obj[prop] !== _this.currencyObj[prop]; }))) {
            // console.log('tudo igual');
            return true;
        }
        if (this.rowActions.beforeSave && !this.rowActions.beforeSave(obj, this.currencyObj)) {
            return false;
        }
        /** @type {?} */
        var requireds = [];
        this.columns.forEach((/**
         * @param {?} column
         * @return {?}
         */
        function (column) {
            if (column.required === true && !obj[column.property]) {
                requireds.push(column.property);
            }
        }));
        return requireds.length === 0;
    };
    /**
     * @return {?}
     */
    ThfGridComponent.prototype.insertRow = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var obj = {};
        if (this.rowActions.beforeInsert && !this.rowActions.beforeInsert(obj)) {
            return false;
        }
        // this.currencyObj = Object.assign({}, obj);
        this.data.push(obj);
        this.changeDetectorRef.detectChanges();
        return true;
    };
    /**
     * @param {?} row
     * @return {?}
     */
    ThfGridComponent.prototype.isEmptyRow = /**
     * @param {?} row
     * @return {?}
     */
    function (row) {
        /** @type {?} */
        var obj = this.data[row - 1];
        if (!obj) { // title
            return false;
        }
        /** @type {?} */
        var filled = Object.keys(obj).some((/**
         * @param {?} property
         * @return {?}
         */
        function (property) { return obj[property]; }));
        return !filled;
    };
    /**
     * @param {?} row
     * @param {?} col
     * @return {?}
     */
    ThfGridComponent.prototype.selectCell = /**
     * @param {?} row
     * @param {?} col
     * @return {?}
     */
    function (row, col) {
        /** @type {?} */
        var nextCell = this.elRef.nativeElement.querySelector("[id='" + row + "-" + col + "']");
        if (nextCell) {
            this.currencyCell = row + "-" + col;
            this.currencyRow = row;
            this.currencyColumn = col;
            nextCell.focus();
        }
    };
    ThfGridComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-grid',
                    template: "<div class=\"thf-grid-wrapper thf-grid-row-wrapper\" #wrapper>\n\n  <div *ngIf=\"logger\">\n    lastCell: {{ lastCell }} | currencyCell: {{ currencyCell }} <br>\n    lastRow: {{ lastRow }} | currencyRow: {{ currencyRow }} <br>\n    lastColumn: {{ lastColumn }} | currencyColumn: {{ currencyColumn }} <br>\n    <hr>\n    currencyObj: {{ currencyObj | json }}\n    <hr>\n  </div>\n\n  <div class=\"thf-grid\">\n    <div class=\"thf-grid-body\">\n      <div class=\"thf-grid-row\"\n        #table\n        (keydown.arrowup)=\"tableKeydown($event, 'up')\"\n        (keydown.arrowdown)=\"tableKeydown($event, 'down')\"\n        (keydown.arrowleft)=\"tableKeydown($event, 'left')\"\n        (keydown.arrowright)=\"tableKeydown($event, 'right')\"\n        (keydown.tab)=\"tableKeydown($event, 'next')\"\n        (keydown.shift.tab)=\"tableKeydown($event, 'prior')\"\n        (click)=\"tableClick($event)\"\n        (contextmenu)=\"tableClick($event)\"\n        (dblclick)=\"tableClick($event)\">\n\n        <div class=\"thf-grid-cell thf-grid-cell-freeze\" *ngIf=\"freezeColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divFreezeColumns\"></ng-container>\n        </div>\n\n        <div class=\"thf-grid-cell thf-grid-cell-normal\"\n          [style.width]=\"width\" [style.max-width]=\"width\" [style.min-width]=\"width\">\n          <ng-container *ngTemplateOutlet=\"divColumns\"></ng-container>\n        </div>\n\n        <div class=\"thf-grid-cell thf-grid-cell-action\" *ngIf=\"actionColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divActionColumns\"></ng-container>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- <div class=\"thf-grid-footer-wrapper\">\n    <div class=\"thf-grid-footer\">\n      <div class=\"links\"><a href=\"#\">RODAP\u00C9</a></div>\n    </div>\n  </div> -->\n\n</div>\n\n<!-- Coluna com as colunas congeladas -->\n<ng-template #divFreezeColumns>\n  <div class=\"thf-grid thf-grid-freeze\">\n    <div class=\"thf-grid-header-group\">\n      <div class=\"thf-grid-row\">\n        <thf-grid-head *ngFor=\"let column of freezeColumns; index as i\" class=\"thf-grid-title\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          t-freeze=\"true\"\n          t-position=\"{{ '0-' + i }}\"\n          [t-width]=\"column.width\"\n          [t-align]=\"column.align\"\n          [t-title]=\"column.label\">\n        </thf-grid-head>\n      </div>\n    </div>\n\n    <div class=\"thf-grid-body\">\n      <div class=\"thf-grid-row\" *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\">\n        <thf-grid-cell *ngFor=\"let column of freezeColumns; index as i\" class=\"thf-grid-cell\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          t-freeze=\"true\"\n          [t-align]=\"column.align\"\n          [t-readonly]=\"column.readonly\"\n          [t-required]=\"column.required\"\n          t-position=\"{{ (j + 1) + '-' + i }}\"\n          [t-width]=\"column.width\"\n          [(t-value)]=\"row[column.property]\">\n        </thf-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas congeladas -->\n\n<!-- Coluna com as colunas nornais -->\n<ng-template #divColumns>\n  <div class=\"thf-grid thf-grid-normal\">\n    <div class=\"thf-grid-header-group\">\n      <div class=\"thf-grid-row\">\n        <thf-grid-head *ngFor=\"let column of columns; index as i\" class=\"thf-grid-title\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          [t-align]=\"column.align\"\n          t-position=\"{{ '0-' + (i + freezeColumns.length) }}\"\n          [t-title]=\"column.label\"\n          [t-width]=\"column.width\">\n        </thf-grid-head>\n      </div>\n    </div>\n\n    <div class=\"thf-grid-body\">\n      <div class=\"thf-grid-row\" *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\">\n        <thf-grid-cell *ngFor=\"let column of columns; index as i\" class=\"thf-grid-cell\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          [t-align]=\"column.align\"\n          [t-readonly]=\"column.readonly\"\n          [t-required]=\"column.required\"\n          t-position=\"{{ (j + 1) + '-' + (i + freezeColumns.length) }}\"\n          [(t-value)]=\"row[column.property]\"\n          [t-width]=\"column.width\">\n        </thf-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas nornais -->\n\n<!-- Coluna com as colunas de a\u00E7\u00E3o -->\n<ng-template #divActionColumns>\n    <div class=\"thf-grid thf-grid-actions\">\n      <div class=\"thf-grid-header-group\">\n        <div class=\"thf-grid-row\">\n          <thf-grid-head *ngFor=\"let column of actionColumns; index as i\" class=\"thf-grid-title\"\n            t-position=\"{{ '0-' + (i + freezeColumns.length + columns.length) }}\"\n            [t-title]=\"column.label\"\n            [t-align]=\"column.align\">\n          </thf-grid-head>\n        </div>\n      </div>\n\n      <div class=\"thf-grid-body\">\n        <div class=\"thf-grid-row\" *ngFor=\"let row of data; index as j\"\n          (keydown.control.delete)=\"removeRow($event, row)\"\n          (keydown.esc)=\"cancelRow($event, row)\">\n          <thf-grid-cell-action *ngFor=\"let column of actionColumns; index as i\" class=\"thf-grid-cell\"\n            t-position=\"{{ (j + 1) + '-' + (i + freezeColumns.length + columns.length) }}\"\n            [t-value]=\"row[column.property]\">\n          </thf-grid-cell-action>\n        </div>\n      </div>\n    </div>\n  </ng-template>\n  <!-- FIM: Coluna com as colunas de a\u00E7\u00E3o -->\n",
                    styles: [".thf-grid-wrapper{overflow:auto;border:1px solid #eceeee}.thf-grid{display:table;border-right:none;border-bottom:none}.thf-grid-cell-normal::-webkit-scrollbar,.thf-grid-row-wrapper::-webkit-scrollbar{border-radius:2px;height:4px;opacity:.5;width:4px}.thf-grid-cell-normal::-webkit-scrollbar-thumb,.thf-grid-row-wrapper::-webkit-scrollbar-thumb{background-color:#0c9abe}.thf-grid .fixed{display:table}.thf-grid-header-group{display:table-header-group}.thf-grid-body{display:table-row-group}.thf-grid-row{display:table-row}.thf-grid-cell,.thf-grid-title{display:table-cell;border:none}.thf-grid-cell-freeze{border-right:2px solid #ceeaf2}.thf-grid-cell-action{color:#00f;border-left:2px solid #ceeaf2}.thf-grid-actions,.thf-grid-freeze,.thf-grid-normal{width:100%}.thf-grid-cell-normal{overflow:auto}.thf-grid-footer{display:table-footer-group}.thf-grid-footer-wrapper{border:1px solid #eceeee;border-top:none}"]
                }] }
    ];
    /** @nocollapse */
    ThfGridComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    ThfGridComponent.propDecorators = {
        tableElement: [{ type: ViewChild, args: ['table', { static: true },] }],
        tableWrapper: [{ type: ViewChild, args: ['wrapper', { static: true },] }],
        rowActions: [{ type: Input, args: ['t-row-actions',] }],
        columns: [{ type: Input, args: ['t-columns',] }],
        data: [{ type: Input, args: ['t-data',] }]
    };
    return ThfGridComponent;
}());
export { ThfGridComponent };
if (false) {
    /** @type {?} */
    ThfGridComponent.prototype.lastCell;
    /** @type {?} */
    ThfGridComponent.prototype.lastRow;
    /** @type {?} */
    ThfGridComponent.prototype.lastColumn;
    /** @type {?} */
    ThfGridComponent.prototype.currencyCell;
    /** @type {?} */
    ThfGridComponent.prototype.currencyRow;
    /** @type {?} */
    ThfGridComponent.prototype.currencyColumn;
    /** @type {?} */
    ThfGridComponent.prototype.currencyObj;
    /** @type {?} */
    ThfGridComponent.prototype.logger;
    /** @type {?} */
    ThfGridComponent.prototype.width;
    /** @type {?} */
    ThfGridComponent.prototype.widthFreeze;
    /** @type {?} */
    ThfGridComponent.prototype.widthActions;
    /**
     * @type {?}
     * @private
     */
    ThfGridComponent.prototype.resizeListener;
    /**
     * @type {?}
     * @private
     */
    ThfGridComponent.prototype.timeoutResize;
    /** @type {?} */
    ThfGridComponent.prototype.tableElement;
    /** @type {?} */
    ThfGridComponent.prototype.tableWrapper;
    /**
     * @type {?}
     * @private
     */
    ThfGridComponent.prototype._columns;
    /**
     * \@description
     *
     * Ações disparadas quando uma linha do grid é manipulada.
     * @type {?}
     */
    ThfGridComponent.prototype.rowActions;
    /**
     * Lista com os dados que serão exibidos no grid.
     * @type {?}
     */
    ThfGridComponent.prototype.data;
    /**
     * @type {?}
     * @private
     */
    ThfGridComponent.prototype.changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    ThfGridComponent.prototype.elRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWdyaWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1ncmlkL3RoZi1ncmlkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBYSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0JqSDtJQTZERSwwQkFDVSxpQkFBb0MsRUFDcEMsS0FBaUIsRUFDekIsUUFBbUI7UUFIckIsaUJBVUM7UUFUUyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLFVBQUssR0FBTCxLQUFLLENBQVk7UUF4RDNCLGFBQVEsR0FBVyxLQUFLLENBQUM7UUFDekIsWUFBTyxHQUFXLENBQUMsQ0FBQztRQUNwQixlQUFVLEdBQVcsQ0FBQyxDQUFDO1FBQ3ZCLGlCQUFZLEdBQVcsS0FBSyxDQUFDO1FBQzdCLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBQ3hCLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO1FBRzNCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFFZixVQUFLLEdBQUcsTUFBTSxDQUFDO1FBQ2YsZ0JBQVcsR0FBRyxDQUFDLENBQUM7UUFDaEIsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFRVCxhQUFRLEdBQUcsRUFBRSxDQUFDOzs7Ozs7UUFPRSxlQUFVLEdBQXNCLEVBQUUsQ0FBQzs7OztRQXlCMUMsU0FBSSxHQUFlLEVBQUUsQ0FBQztRQU9yQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFROzs7O1FBQUUsVUFBQyxLQUFVO1lBQ25FLEtBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN4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LEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDO1lBQzFCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNsQjtJQUNILENBQUM7O2dCQS9VRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLHU1TEFBd0M7O2lCQUV6Qzs7OztnQkFuQ1EsaUJBQWlCO2dCQUFhLFVBQVU7Z0JBQW9CLFNBQVM7OzsrQkF1RDNFLFNBQVMsU0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOytCQUNuQyxTQUFTLFNBQUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs2QkFTckMsS0FBSyxTQUFDLGVBQWU7MEJBS3JCLEtBQUssU0FBQyxXQUFXO3VCQW9CakIsS0FBSyxTQUFDLFFBQVE7O0lBcVJqQix1QkFBQztDQUFBLEFBaFZELElBZ1ZDO1NBM1VZLGdCQUFnQjs7O0lBRTNCLG9DQUF5Qjs7SUFDekIsbUNBQW9COztJQUNwQixzQ0FBdUI7O0lBQ3ZCLHdDQUE2Qjs7SUFDN0IsdUNBQXdCOztJQUN4QiwwQ0FBMkI7O0lBQzNCLHVDQUFpQjs7SUFFakIsa0NBQWU7O0lBRWYsaUNBQWU7O0lBQ2YsdUNBQWdCOztJQUNoQix3Q0FBaUI7Ozs7O0lBRWpCLDBDQUFtQzs7Ozs7SUFDbkMseUNBQXNCOztJQUV0Qix3Q0FBK0Q7O0lBQy9ELHdDQUFpRTs7Ozs7SUFFakUsb0NBQXNCOzs7Ozs7O0lBT3RCLHNDQUEyRDs7Ozs7SUF5QjNELGdDQUF1Qzs7Ozs7SUFHckMsNkNBQTRDOzs7OztJQUM1QyxpQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25EZXN0cm95LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBUaGZHcmlkUm93QWN0aW9ucyB9IGZyb20gJy4vdGhmLWdyaWQtcm93LWFjdGlvbnMuaW50ZXJmYWNlJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBDb21wb25lbnRlIGdyaWQuXG4gKlxuICogQcOnw7VlcyAvIGF0YWxob3M6XG4gKlxuICogLSBBUlJPVy1VUDogTmF2ZWdhIHBhcmEgY2VsdWxhIHN1cGVyaW9yIC8gTmEgdWx0aW1hIGxpbmhhIGFkaWNpb25hIHVtYSBsaW5oYSBlbSBicmFuY28gbm8gZ3JpZDtcbiAqIC0gQVJST1ctRE9XTjogTmF2ZWdhIHBhcmEgY2VsdWxhIGluZmVyaW9yO1xuICogLSBBUlJPVy1SSUdIVDogTmF2ZWdhIHBhcmEgY2VsdWxhIGRpcmVpdGE7XG4gKiAtIEFSUk9XLUxFRlQ6IE5hdmVnYSBwYXJhIGNlbHVsYSBlc3F1ZXJkYTtcbiAqIC0gVEFCOiBOYXZlZ2EgcGFyYSBwcsOzeGltYSBjZWx1bGE7XG4gKiAtIFNISUZUK1RBQjogTmF2ZWdhIHBhcmEgY2VsdWxhIGFudGVyaW9yO1xuICogLSBDVFJMK0RFTDogUmVtb3ZlIGxpbmhhO1xuICogLSBERUwvQkFDS1NQQUNFOiBMaW1wYSBjZWx1bGE7XG4gKiAtIEVOVEVSOiBFZGl0YSBsaW5oYSBjb20gdmFsb3IgYXR1YWwvQ29uZmlybWEgZWRpw6fDo28gZGEgY2VsdWxhO1xuICogLSBET1VCTEUtQ0xJQ0s6IEVkaXRhIGxpbmhhIGNvbSB2YWxvciBhdHVhbDtcbiAqIC0gRVNDOiBDYW5jZWxhIGVkacOnw6NvIGRhIGNlbHVsYSAvIENhbmNlbGEgaW5zZXLDp8OjbyBkZSBsaW5oYXMgZW0gYnJhbmNvO1xuICogLSBBLi5aLzAuLjk6IEluaWNpYSBlZGnDp8OjbyBjb20gdmFsb3IgZW0gYnJhbmNvLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1ncmlkLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBHcmlkIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtZ3JpZC1iYXNpYy9zYW1wbGUtdGhmLWdyaWQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWdyaWQtYmFzaWMvc2FtcGxlLXRoZi1ncmlkLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1ncmlkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RoZi1ncmlkLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGhmLWdyaWQuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFRoZkdyaWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIGxhc3RDZWxsOiBzdHJpbmcgPSAnMC0wJztcbiAgbGFzdFJvdzogbnVtYmVyID0gMDtcbiAgbGFzdENvbHVtbjogbnVtYmVyID0gMDtcbiAgY3VycmVuY3lDZWxsOiBzdHJpbmcgPSAnMC0wJztcbiAgY3VycmVuY3lSb3c6IG51bWJlciA9IDA7XG4gIGN1cnJlbmN5Q29sdW1uOiBudW1iZXIgPSAwO1xuICBjdXJyZW5jeU9iajogYW55O1xuXG4gIGxvZ2dlciA9IGZhbHNlO1xuXG4gIHdpZHRoID0gJzEwMCUnO1xuICB3aWR0aEZyZWV6ZSA9IDA7XG4gIHdpZHRoQWN0aW9ucyA9IDA7XG5cbiAgcHJpdmF0ZSByZXNpemVMaXN0ZW5lcjogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSB0aW1lb3V0UmVzaXplO1xuXG4gIEBWaWV3Q2hpbGQoJ3RhYmxlJywgeyBzdGF0aWM6IHRydWUgfSkgdGFibGVFbGVtZW50OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd3cmFwcGVyJywgeyBzdGF0aWM6IHRydWUgfSkgdGFibGVXcmFwcGVyOiBFbGVtZW50UmVmO1xuXG4gIHByaXZhdGUgX2NvbHVtbnMgPSBbXTtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEHDp8O1ZXMgZGlzcGFyYWRhcyBxdWFuZG8gdW1hIGxpbmhhIGRvIGdyaWQgw6kgbWFuaXB1bGFkYS5cbiAgICovXG4gIEBJbnB1dCgndC1yb3ctYWN0aW9ucycpIHJvd0FjdGlvbnM6IFRoZkdyaWRSb3dBY3Rpb25zID0ge307XG5cbiAgLyoqXG4gICAqIENvbHVuYXMgZXhpYmlkYXMgbm8gZ3JpZC5cbiAgICovXG4gIEBJbnB1dCgndC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLl9jb2x1bW5zID0gWy4uLnZhbHVlXTtcblxuICAgIHRoaXMuX2NvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgY29sdW1uLmxhYmVsID0gY29sdW1uLmxhYmVsIHx8IGNvbHVtbi5wcm9wZXJ0eTtcblxuICAgICAgaWYgKGNvbHVtbi5mcmVlemUgPT09IHRydWUpIHtcbiAgICAgICAgY29sdW1uLmNzc1dpZHRoID0gYCR7Y29sdW1uLndpZHRoIHx8IDEwMH1weGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2x1bW4uY3NzV2lkdGggPSBjb2x1bW4ud2lkdGggPyBgJHtjb2x1bW4ud2lkdGh9cHhgIDogJzEwMCUnO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGdldCBjb2x1bW5zKCk6IEFycmF5PGFueT4ge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmZyZWV6ZSAhPT0gdHJ1ZSAmJiBjb2x1bW4uYWN0aW9uICE9PSB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0YSBjb20gb3MgZGFkb3MgcXVlIHNlcsOjbyBleGliaWRvcyBubyBncmlkLlxuICAgKi9cbiAgQElucHV0KCd0LWRhdGEnKSBkYXRhOiBBcnJheTxhbnk+ID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBlbFJlZjogRWxlbWVudFJlZixcbiAgICByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG5cbiAgICB0aGlzLmRlYm91bmNlUmVzaXplKCk7XG5cbiAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyID0gcmVuZGVyZXIubGlzdGVuKCd3aW5kb3cnLCAncmVzaXplJywgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgIHRoaXMuZGVib3VuY2VSZXNpemUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnJlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkZWJvdW5jZVJlc2l6ZSgpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0UmVzaXplKTtcblxuICAgIHRoaXMudGltZW91dFJlc2l6ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3Qgd2lkdGhUYWJsZVdyYXBwZXIgPSB0aGlzLnRhYmxlV3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy53aWR0aCA9IGAke3dpZHRoVGFibGVXcmFwcGVyIC0gKHRoaXMud2lkdGhGcmVlemUgKyA4KSAtIHRoaXMud2lkdGhBY3Rpb25zfXB4YDtcbiAgICB9LCAxMDApO1xuICB9XG5cbiAgZ2V0IGZyZWV6ZUNvbHVtbnMoKSB7XG4gICAgY29uc3QgZnJlZXplQ29sdW1ucyA9IHRoaXMuX2NvbHVtbnMuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uZnJlZXplID09PSB0cnVlKTtcblxuICAgIHRoaXMud2lkdGhGcmVlemUgPSBmcmVlemVDb2x1bW5zLnJlZHVjZSgocHJldiwgY3VycmVudCkgPT4gcHJldiArIChjdXJyZW50LndpZHRoIHx8IDEwMCksIDApO1xuXG4gICAgcmV0dXJuIGZyZWV6ZUNvbHVtbnM7XG4gIH1cblxuICBnZXQgYWN0aW9uQ29sdW1ucygpIHtcbiAgICBjb25zdCBhY3Rpb25zQ29sdW1ucyA9IHRoaXMuX2NvbHVtbnMuZmlsdGVyKGNvbHVtbiA9PiBjb2x1bW4uYWN0aW9uID09PSB0cnVlKTtcblxuICAgIHRoaXMud2lkdGhBY3Rpb25zID0gYWN0aW9uc0NvbHVtbnMubGVuZ3RoID4gMCA/IDU2IDogMDtcblxuICAgIHJldHVybiBhY3Rpb25zQ29sdW1ucztcbiAgfVxuXG4gIGNhbmNlbFJvdyhldmVudDogYW55LCByb3c6IGFueSkge1xuICAgIGNvbnN0IGVsID0gZXZlbnQucGF0aC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5pZCk7XG5cbiAgICBpZiAoIWVsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgW3hdID0gKGVsLmlkKS5zcGxpdCgnLScpO1xuXG4gICAgaWYgKHRoaXMuaXNFbXB0eVJvdyh4KSkge1xuICAgICAgaWYgKCF0aGlzLnJlbW92ZVJvdyhldmVudCwgcm93KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY3VycmVuY3lPYmogPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmRhdGFbdGhpcy5jdXJyZW5jeVJvdyAtIDFdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRhWyt4IC0gMV0gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1cnJlbmN5T2JqKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZWxlY3RDZWxsKHRoaXMuY3VycmVuY3lSb3csIHRoaXMuY3VycmVuY3lDb2x1bW4pKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVSb3coZXZlbnQ6IGFueSwgcm93OiBhbnkpOiBib29sZWFuIHtcblxuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlUmVtb3ZlICYmICF0aGlzLnJvd0FjdGlvbnMuYmVmb3JlUmVtb3ZlKE9iamVjdC5hc3NpZ24oe30sIHJvdykpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmRhdGEuaW5kZXhPZihyb3cpO1xuXG4gICAgdGhpcy5kYXRhLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcblxuICAgIGlmICgodGhpcy5kYXRhLmxlbmd0aCA9PT0gMCkgfHwgKGluZGV4ID09PSB0aGlzLmRhdGEubGVuZ3RoKSkge1xuICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY3VycmVuY3lSb3cgLSAxLCB0aGlzLmN1cnJlbmN5Q29sdW1uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY3VycmVuY3lSb3csIHRoaXMuY3VycmVuY3lDb2x1bW4pO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdGFibGVLZXlkb3duKGV2ZW50OiBhbnksIGRpcmVjdGlvbjogc3RyaW5nKSB7XG4gICAgbGV0IFtyb3csIGNvbF0gPSBldmVudC50YXJnZXQuaWQuc3BsaXQoJy0nKTtcbiAgICByb3cgPSArcm93O1xuICAgIGNvbCA9ICtjb2w7XG4gICAgbGV0IHByb3cgPSArcm93O1xuICAgIGxldCBwY29sID0gK2NvbDtcblxuICAgIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAvLyBkZWJ1Z2dlcjtcbiAgICBpZiAoZGlyZWN0aW9uID09PSAnZG93bicpIHtcbiAgICAgIGlmIChyb3cgPD0gdGhpcy5kYXRhLmxlbmd0aCkge1xuICAgICAgICBwcm93Kys7XG4gICAgICB9XG5cbiAgICAgIGlmIChyb3cgPT09IHRoaXMuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHJvdyA9PT0gMCB8fCAhdGhpcy5pc0VtcHR5Um93KHJvdykpIHtcbiAgICAgICAgICBpZiAodGhpcy5zYXZlUm93KHJvdykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnNlcnRSb3coKSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcHJvdy0tO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgoZGlyZWN0aW9uID09PSAndXAnKSAmJiAocm93ID4gMCkpIHtcbiAgICAgIHByb3ctLTtcbiAgICB9IGVsc2UgaWYgKChkaXJlY3Rpb24gPT09ICdsZWZ0JykgJiYgKGNvbCA+IDApKSB7XG4gICAgICBwY29sLS07XG4gICAgfSBlbHNlIGlmICgoZGlyZWN0aW9uID09PSAncmlnaHQnKSAmJiAoY29sIDwgdGhpcy5fY29sdW1ucy5sZW5ndGggLSAxKSkge1xuICAgICAgcGNvbCsrO1xuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnbmV4dCcpIHtcbiAgICAgIGlmIChjb2wgPCB0aGlzLl9jb2x1bW5zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcGNvbCsrO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSBlbHNlIGlmIChyb3cgPCB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgIHBjb2wgPSAwO1xuICAgICAgICBwcm93Kys7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdwcmlvcicpIHtcbiAgICAgIGlmIChjb2wgPiAwKSB7XG4gICAgICAgIHBjb2wtLTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0gZWxzZSBpZiAocm93ID4gMCkge1xuICAgICAgICBwY29sID0gdGhpcy5fY29sdW1ucy5sZW5ndGggLSAxO1xuICAgICAgICBwcm93LS07XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVuY3lDZWxsID09PSBgJHtwcm93fS0ke3Bjb2x9YCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ3Zhem91Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZGVidWdnZXI7XG4gICAgaWYgKHByb3cgIT09IHRoaXMuY3VycmVuY3lSb3cgJiYgcm93ID4gMCAmJiB0aGlzLmRhdGEubGVuZ3RoID49IHJvdykge1xuICAgICAgaWYgKCF0aGlzLmlzRW1wdHlSb3cocm93KSkge1xuICAgICAgICBpZiAoIXRoaXMuc2F2ZVJvdyhyb3cpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIXRoaXMucmVtb3ZlUm93KGV2ZW50LCByb3cpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVuY3lSb3cgIT09IHByb3cpIHtcbiAgICAgIHRoaXMuY3VycmVuY3lPYmogPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmRhdGFbcHJvdyAtIDFdKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdtdWRvdSBkZSBsaW5oYScpO1xuICAgIH1cblxuICAgIHRoaXMubGFzdENlbGwgPSBldmVudC50YXJnZXQuaWQ7XG4gICAgdGhpcy5sYXN0Um93ID0gcm93O1xuICAgIHRoaXMubGFzdENvbHVtbiA9IGNvbDtcblxuICAgIHRoaXMuc2VsZWN0Q2VsbChwcm93LCBwY29sKTtcbiAgfVxuXG4gIHRhYmxlQ2xpY2soZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGVsID0gZXZlbnQucGF0aC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC5pZCk7XG5cbiAgICBpZiAoIWVsKSB7XG4gICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jdXJyZW5jeVJvdywgdGhpcy5jdXJyZW5jeUNvbHVtbik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVuY3lDZWxsID09PSBlbC5pZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFtyb3csIGNvbF0gPSAoZWwuaWQpLnNwbGl0KCctJyk7XG4gICAgY29uc3QgcHJvdyA9ICtyb3c7XG4gICAgY29uc3QgcGNvbCA9ICtjb2w7XG5cbiAgICBpZiAocHJvdyAhPT0gdGhpcy5jdXJyZW5jeVJvdykge1xuICAgICAgaWYgKHRoaXMuY3VycmVuY3lSb3cgPiAwKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0VtcHR5Um93KHRoaXMuY3VycmVuY3lSb3cpKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnNhdmVSb3codGhpcy5jdXJyZW5jeVJvdykpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93LCB0aGlzLmN1cnJlbmN5Q29sdW1uKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnJlbW92ZVJvdyhldmVudCwgcm93KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kYXRhW3Byb3cgLSAxXSk7XG4gICAgICAvLyBjb25zb2xlLmxvZygnPj4+Pj4+PiAnLCBwcm93IC0gMSk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0Q2VsbCA9IHRoaXMuY3VycmVuY3lDZWxsO1xuICAgIHRoaXMubGFzdFJvdyA9IHRoaXMuY3VycmVuY3lSb3c7XG4gICAgdGhpcy5sYXN0Q29sdW1uID0gdGhpcy5jdXJyZW5jeUNvbHVtbjtcblxuICAgIHRoaXMuY3VycmVuY3lDZWxsID0gZWwuaWQ7XG4gICAgdGhpcy5jdXJyZW5jeVJvdyA9IHByb3c7XG4gICAgdGhpcy5jdXJyZW5jeUNvbHVtbiA9IHBjb2w7XG4gIH1cblxuICBzYXZlUm93KHJvdzogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5kYXRhW3JvdyAtIDFdKTtcblxuICAgIGNvbnN0IG9iaiA9IHRoaXMuZGF0YVtyb3cgLSAxXTtcblxuICAgIGlmICghT2JqZWN0LmtleXMob2JqKS5zb21lKHByb3AgPT4gb2JqW3Byb3BdICE9PSB0aGlzLmN1cnJlbmN5T2JqW3Byb3BdKSkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ3R1ZG8gaWd1YWwnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlU2F2ZSAmJiAhdGhpcy5yb3dBY3Rpb25zLmJlZm9yZVNhdmUob2JqLCB0aGlzLmN1cnJlbmN5T2JqKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcXVpcmVkcyA9IFtdO1xuXG4gICAgdGhpcy5jb2x1bW5zLmZvckVhY2goY29sdW1uID0+IHtcbiAgICAgIGlmIChjb2x1bW4ucmVxdWlyZWQgPT09IHRydWUgJiYgIW9ialtjb2x1bW4ucHJvcGVydHldKSB7XG4gICAgICAgIHJlcXVpcmVkcy5wdXNoKGNvbHVtbi5wcm9wZXJ0eSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVxdWlyZWRzLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIGluc2VydFJvdygpIHtcbiAgICBjb25zdCBvYmogPSB7fTtcblxuICAgIGlmICh0aGlzLnJvd0FjdGlvbnMuYmVmb3JlSW5zZXJ0ICYmICF0aGlzLnJvd0FjdGlvbnMuYmVmb3JlSW5zZXJ0KG9iaikpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgb2JqKTtcblxuICAgIHRoaXMuZGF0YS5wdXNoKG9iaik7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlzRW1wdHlSb3cocm93OiBudW1iZXIpIHtcbiAgICBjb25zdCBvYmogPSB0aGlzLmRhdGFbcm93IC0gMV07XG5cbiAgICBpZiAoIW9iaikgeyAvLyB0aXRsZVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGxlZCA9IE9iamVjdC5rZXlzKG9iaikuc29tZShwcm9wZXJ0eSA9PiBvYmpbcHJvcGVydHldKTtcblxuICAgIHJldHVybiAhZmlsbGVkO1xuICB9XG5cbiAgc2VsZWN0Q2VsbChyb3c6IG51bWJlciwgY29sOiBudW1iZXIpIHtcbiAgICBjb25zdCBuZXh0Q2VsbCA9IHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKGBbaWQ9JyR7cm93fS0ke2NvbH0nXWApO1xuXG4gICAgaWYgKG5leHRDZWxsKSB7XG4gICAgICB0aGlzLmN1cnJlbmN5Q2VsbCA9IGAke3Jvd30tJHtjb2x9YDtcbiAgICAgIHRoaXMuY3VycmVuY3lSb3cgPSByb3c7XG4gICAgICB0aGlzLmN1cnJlbmN5Q29sdW1uID0gY29sO1xuICAgICAgbmV4dENlbGwuZm9jdXMoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==