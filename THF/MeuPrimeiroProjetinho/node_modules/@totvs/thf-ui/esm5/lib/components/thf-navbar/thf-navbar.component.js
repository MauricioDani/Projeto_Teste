/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Renderer2, ViewChild } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { ThfNavbarBaseComponent } from './thf-navbar-base.component';
import { ThfNavbarItemsComponent } from './thf-navbar-items/thf-navbar-items.component';
/**
 * \@docsExtends ThfNavbarBaseComponent
 */
var ThfNavbarComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfNavbarComponent, _super);
    function ThfNavbarComponent(renderer, builder, changeDetector) {
        var _this = _super.call(this) || this;
        _this.renderer = renderer;
        _this.builder = builder;
        _this.changeDetector = changeDetector;
        _this.showItemsNavigation = false;
        _this.offset = 0;
        _this.windowResizeListener = _this.renderer.listen(window, 'resize', _this.displayItemsNavigation.bind(_this));
        return _this;
    }
    /**
     * @return {?}
     */
    ThfNavbarComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.displayItemsNavigation();
        this.menuWrapperAdjust();
    };
    /**
     * @return {?}
     */
    ThfNavbarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.mediaQuery) {
            this.mediaQuery.removeListener();
        }
    };
    /**
     * @param {?} orientation
     * @return {?}
     */
    ThfNavbarComponent.prototype.navigateItems = /**
     * @param {?} orientation
     * @return {?}
     */
    function (orientation) {
        orientation === 'left' ? this.navigateLeft() : this.navigateRight();
        this.animate(this.offset);
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.adjustNavbarMenu = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var navbarMenu = document.querySelector('thf-navbar thf-menu');
        /** @type {?} */
        var page = document.querySelector('.thf-page');
        /** @type {?} */
        var navbarLogo = document.querySelector('.thf-navbar-logo');
        navbarMenu.setAttribute('style', "display: none");
        if (page) {
            page.setAttribute('style', 'margin-left: 0; width: 100%');
        }
        if (navbarLogo) {
            navbarLogo.setAttribute('style', "padding: 0 16px 0 0!important");
        }
        this.mediaQuery.addListener((/**
         * @param {?} changed
         * @return {?}
         */
        function (changed) {
            if (changed.matches) {
                navbarMenu.setAttribute('style', "display: block");
                if (page) {
                    page.setAttribute('style', 'margin-left: 256; width: calc(100% - 256px)');
                }
            }
            else {
                navbarMenu.setAttribute('style', "display: none");
                if (page) {
                    page.setAttribute('style', 'margin-left: 0; width: 100%');
                }
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.adjustUserMenu = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var userMenuItems = this.menu.menus;
        this.mediaQuery.addListener((/**
         * @param {?} changed
         * @return {?}
         */
        function (changed) {
            if (changed.matches) {
                /** @type {?} */
                var subItems = [{ label: _this.literals.navbarLinks, subItems: _this.items }];
                _this.menu.menus = tslib_1.__spread(subItems, _this.menu.menus);
            }
            else {
                _this.menu.menus = userMenuItems;
            }
        }));
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    ThfNavbarComponent.prototype.animate = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        /** @type {?} */
        var animation = this.buildTransitionAnimation(offset);
        this.player = animation.create(this.navbarItems.navbarItemsContainer.nativeElement);
        this.player.play();
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    ThfNavbarComponent.prototype.buildTransitionAnimation = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        return this.builder.build([
            animate('250ms ease', keyframes([style({ transform: "translateX(" + offset + "px)" })]))
        ]);
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.displayItemsNavigation = /**
     * @private
     * @return {?}
     */
    function () {
        this.navbarItemsWidth = this.navbarItemsElement.nativeElement.offsetWidth;
        this.allNavbarItemsWidth =
            this.navbarItems.allNavbarItems.reduce((/**
             * @param {?} previous
             * @param {?} current
             * @return {?}
             */
            function (previous, current) { return previous + current.nativeElement.offsetWidth; }), 0);
        this.showItemsNavigation = this.navbarItemsWidth < this.allNavbarItemsWidth + 88;
        this.changeDetector.detectChanges();
        if (this.offset !== 0) {
            this.offset = 0;
            this.animate(this.offset);
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.menuWrapperAdjust = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var body = document.querySelector('body');
        body.setAttribute('style', "height: calc(100% - 56px)");
        this.mediaQuery = window.matchMedia('(max-width: 768px)');
        !this.menu ? this.adjustNavbarMenu() : this.adjustUserMenu();
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.navigateRight = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var maxAllowedOffset = this.allNavbarItemsWidth - this.navbarItemsElement.nativeElement.offsetWidth;
        /** @type {?} */
        var itemBreakPoint = (this.offset * -1) + this.navbarItemsElement.nativeElement.offsetWidth;
        /** @type {?} */
        var movementInPixels = 0;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        function (navbarItem) {
            /** @type {?} */
            var finalPosition = navbarItem.nativeElement.offsetWidth + navbarItem.nativeElement.offsetLeft;
            if (itemBreakPoint < finalPosition) {
                movementInPixels = navbarItem.nativeElement.offsetLeft;
                return true;
            }
        }));
        this.offset = (movementInPixels * -1);
        if ((this.offset * -1) >= maxAllowedOffset) {
            this.offset = maxAllowedOffset * -1;
            this.disableRight = true;
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfNavbarComponent.prototype.navigateLeft = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.disableRight = false;
        /** @type {?} */
        var movementInPixels;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        function (navbarItem) {
            /** @type {?} */
            var navbarItemOffset = navbarItem.nativeElement.offsetLeft;
            if (navbarItemOffset >= (_this.offset * -1)) {
                movementInPixels = navbarItemOffset - (_this.navbarItemsElement.nativeElement.offsetWidth - navbarItem.nativeElement.offsetWidth);
                return true;
            }
        }));
        this.offset = (movementInPixels * -1);
        if (this.offset > 0) {
            this.offset = 0;
        }
    };
    ThfNavbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-navbar',
                    template: "<header class=\"thf-navbar\"\n  [ngClass]=\"{'thf-navbar-shadow' : shadow}\">\n\n  <thf-navbar-logo\n    class=\"thf-navbar-logo\"\n    [t-logo]=\"logo\">\n  </thf-navbar-logo>\n\n  <thf-navbar-items\n    class=\"thf-navbar-items\"\n    [t-items]=\"items\">\n  </thf-navbar-items>\n\n  <thf-navbar-item-navigation *ngIf=\"showItemsNavigation\"\n    class=\"thf-navbar-item-navigation\"\n    [t-disable-left]=\"offset === 0\"\n    [t-disable-right]=\"disableRight && offset !== 0\"\n    (t-click)=\"navigateItems($event)\">\n  </thf-navbar-item-navigation>\n\n  <thf-navbar-actions\n    class=\"thf-navbar-actions\"\n    [t-icon-actions]=\"iconActions\">\n  </thf-navbar-actions>\n\n</header>\n\n<thf-menu *ngIf=\"!menu\"\n  [t-menus]=\"items\">\n</thf-menu>\n"
                }] }
    ];
    /** @nocollapse */
    ThfNavbarComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: AnimationBuilder },
        { type: ChangeDetectorRef }
    ]; };
    ThfNavbarComponent.propDecorators = {
        navbarItemsElement: [{ type: ViewChild, args: [ThfNavbarItemsComponent, { read: ElementRef, static: true },] }],
        navbarItems: [{ type: ViewChild, args: [ThfNavbarItemsComponent, { static: true },] }]
    };
    return ThfNavbarComponent;
}(ThfNavbarBaseComponent));
export { ThfNavbarComponent };
if (false) {
    /** @type {?} */
    ThfNavbarComponent.prototype.disableRight;
    /** @type {?} */
    ThfNavbarComponent.prototype.showItemsNavigation;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.allNavbarItemsWidth;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.mediaQuery;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.navbarItemsWidth;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.offset;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.player;
    /**
     * @type {?}
     * @protected
     */
    ThfNavbarComponent.prototype.windowResizeListener;
    /** @type {?} */
    ThfNavbarComponent.prototype.navbarItemsElement;
    /** @type {?} */
    ThfNavbarComponent.prototype.navbarItems;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.builder;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLW5hdmJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLW5hdmJhci90aGYtbmF2YmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBYSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pILE9BQU8sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQXFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVySCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQzs7OztBQUt4RjtJQUl3Qyw4Q0FBc0I7SUFpQjVELDRCQUFvQixRQUFtQixFQUFVLE9BQXlCLEVBQVUsY0FBaUM7UUFBckgsWUFDRSxpQkFBTyxTQUVSO1FBSG1CLGNBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxhQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUFVLG9CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQWRySCx5QkFBbUIsR0FBWSxLQUFLLENBQUM7UUFLN0IsWUFBTSxHQUFXLENBQUMsQ0FBQztRQVd6QixLQUFJLENBQUMsb0JBQW9CLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxDQUFDLENBQUM7O0lBQzdHLENBQUM7Ozs7SUFFRCw0Q0FBZTs7O0lBQWY7UUFDRSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUMzQixDQUFDOzs7O0lBRUQsd0NBQVc7OztJQUFY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Rjs7Ozs7SUFFL0Usc0NBQTJCOzs7OztJQUFFLHFDQUFpQzs7Ozs7SUFBRSw0Q0FBeUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBhbmltYXRlLCBBbmltYXRpb25CdWlsZGVyLCBBbmltYXRpb25GYWN0b3J5LCBBbmltYXRpb25QbGF5ZXIsIGtleWZyYW1lcywgc3R5bGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuaW1wb3J0IHsgVGhmTmF2YmFyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLW5hdmJhci1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZOYXZiYXJJdGVtc0NvbXBvbmVudCB9IGZyb20gJy4vdGhmLW5hdmJhci1pdGVtcy90aGYtbmF2YmFyLWl0ZW1zLmNvbXBvbmVudCc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFRoZk5hdmJhckJhc2VDb21wb25lbnRcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGhmLW5hdmJhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGYtbmF2YmFyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBUaGZOYXZiYXJDb21wb25lbnQgZXh0ZW5kcyBUaGZOYXZiYXJCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICBkaXNhYmxlUmlnaHQ6IGJvb2xlYW47XG4gIHNob3dJdGVtc05hdmlnYXRpb246IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIGFsbE5hdmJhckl0ZW1zV2lkdGg6IGFueTtcbiAgcHJpdmF0ZSBtZWRpYVF1ZXJ5OiBhbnk7XG4gIHByaXZhdGUgbmF2YmFySXRlbXNXaWR0aDogYW55O1xuICBwcml2YXRlIG9mZnNldDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBwbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcblxuICBwcm90ZWN0ZWQgd2luZG93UmVzaXplTGlzdGVuZXI6ICgpID0+IHZvaWQ7XG5cbiAgQFZpZXdDaGlsZChUaGZOYXZiYXJJdGVtc0NvbXBvbmVudCwgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgbmF2YmFySXRlbXNFbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoVGhmTmF2YmFySXRlbXNDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIG5hdmJhckl0ZW1zOiBUaGZOYXZiYXJJdGVtc0NvbXBvbmVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlciwgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLmRpc3BsYXlJdGVtc05hdmlnYXRpb24uYmluZCh0aGlzKSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5kaXNwbGF5SXRlbXNOYXZpZ2F0aW9uKCk7XG4gICAgdGhpcy5tZW51V3JhcHBlckFkanVzdCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMubWVkaWFRdWVyeSkge1xuICAgICAgdGhpcy5tZWRpYVF1ZXJ5LnJlbW92ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgbmF2aWdhdGVJdGVtcyhvcmllbnRhdGlvbikge1xuXG4gICAgb3JpZW50YXRpb24gPT09ICdsZWZ0JyA/IHRoaXMubmF2aWdhdGVMZWZ0KCkgOiB0aGlzLm5hdmlnYXRlUmlnaHQoKTtcblxuICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gIH1cblxuICBwcml2YXRlIGFkanVzdE5hdmJhck1lbnUoKSB7XG4gICAgY29uc3QgbmF2YmFyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RoZi1uYXZiYXIgdGhmLW1lbnUnKTtcbiAgICBjb25zdCBwYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRoZi1wYWdlJyk7XG4gICAgY29uc3QgbmF2YmFyTG9nbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aGYtbmF2YmFyLWxvZ28nKTtcbiAgICBuYXZiYXJNZW51LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgZGlzcGxheTogbm9uZWApO1xuICAgIGlmIChwYWdlKSB7XG4gICAgICBwYWdlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnbWFyZ2luLWxlZnQ6IDA7IHdpZHRoOiAxMDAlJyk7XG4gICAgfVxuICAgIGlmIChuYXZiYXJMb2dvKSB7XG4gICAgICBuYXZiYXJMb2dvLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgcGFkZGluZzogMCAxNnB4IDAgMCFpbXBvcnRhbnRgKTtcbiAgICB9XG4gICAgdGhpcy5tZWRpYVF1ZXJ5LmFkZExpc3RlbmVyKGNoYW5nZWQgPT4ge1xuICAgICAgaWYgKGNoYW5nZWQubWF0Y2hlcykge1xuICAgICAgICBuYXZiYXJNZW51LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgZGlzcGxheTogYmxvY2tgKTtcbiAgICAgICAgaWYgKHBhZ2UpIHtcbiAgICAgICAgICBwYWdlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnbWFyZ2luLWxlZnQ6IDI1Njsgd2lkdGg6IGNhbGMoMTAwJSAtIDI1NnB4KScpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuYXZiYXJNZW51LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgZGlzcGxheTogbm9uZWApO1xuICAgICAgICBpZiAocGFnZSkge1xuICAgICAgICAgIHBhZ2Uuc2V0QXR0cmlidXRlKCdzdHlsZScsICdtYXJnaW4tbGVmdDogMDsgd2lkdGg6IDEwMCUnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3RVc2VyTWVudSgpIHtcbiAgICBjb25zdCB1c2VyTWVudUl0ZW1zID0gdGhpcy5tZW51Lm1lbnVzO1xuICAgIHRoaXMubWVkaWFRdWVyeS5hZGRMaXN0ZW5lcihjaGFuZ2VkID0+IHtcbiAgICAgIGlmIChjaGFuZ2VkLm1hdGNoZXMpIHtcbiAgICAgICAgY29uc3Qgc3ViSXRlbXMgPSBbe2xhYmVsOiB0aGlzLmxpdGVyYWxzLm5hdmJhckxpbmtzLCBzdWJJdGVtczogdGhpcy5pdGVtc31dIDtcbiAgICAgICAgdGhpcy5tZW51Lm1lbnVzID0gWy4uLnN1Ykl0ZW1zLCAuLi50aGlzLm1lbnUubWVudXNdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tZW51Lm1lbnVzID0gdXNlck1lbnVJdGVtcztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYW5pbWF0ZShvZmZzZXQ6IG51bWJlcikge1xuICAgIGNvbnN0IGFuaW1hdGlvbjogQW5pbWF0aW9uRmFjdG9yeSA9IHRoaXMuYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldCk7XG5cbiAgICB0aGlzLnBsYXllciA9IGFuaW1hdGlvbi5jcmVhdGUodGhpcy5uYXZiYXJJdGVtcy5uYXZiYXJJdGVtc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50KTtcbiAgICB0aGlzLnBsYXllci5wbGF5KCk7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmJ1aWxkZXIuYnVpbGQoW1xuICAgICAgYW5pbWF0ZShcbiAgICAgICAgJzI1MG1zIGVhc2UnLFxuICAgICAgICBrZXlmcmFtZXMoW3N0eWxlKHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgke29mZnNldH1weClgIH0pXSlcbiAgICAgIClcbiAgICBdKTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheUl0ZW1zTmF2aWdhdGlvbigpIHtcbiAgICB0aGlzLm5hdmJhckl0ZW1zV2lkdGggPSB0aGlzLm5hdmJhckl0ZW1zRWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgdGhpcy5hbGxOYXZiYXJJdGVtc1dpZHRoID1cbiAgICAgIHRoaXMubmF2YmFySXRlbXMuYWxsTmF2YmFySXRlbXMucmVkdWNlKChwcmV2aW91czogYW55LCBjdXJyZW50OiBhbnkpID0+IHByZXZpb3VzICsgY3VycmVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoLCAwKTtcblxuICAgIHRoaXMuc2hvd0l0ZW1zTmF2aWdhdGlvbiA9IHRoaXMubmF2YmFySXRlbXNXaWR0aCA8IHRoaXMuYWxsTmF2YmFySXRlbXNXaWR0aCArIDg4O1xuXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICBpZiAodGhpcy5vZmZzZXQgIT09IDApIHtcbiAgICAgIHRoaXMub2Zmc2V0ID0gMDtcbiAgICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBtZW51V3JhcHBlckFkanVzdCgpIHtcbiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgIGJvZHkuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBoZWlnaHQ6IGNhbGMoMTAwJSAtIDU2cHgpYCk7XG4gICAgdGhpcy5tZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDc2OHB4KScpO1xuXG4gICAgIXRoaXMubWVudSA/IHRoaXMuYWRqdXN0TmF2YmFyTWVudSgpIDogdGhpcy5hZGp1c3RVc2VyTWVudSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBuYXZpZ2F0ZVJpZ2h0KCkge1xuXG4gICAgY29uc3QgbWF4QWxsb3dlZE9mZnNldCA9IHRoaXMuYWxsTmF2YmFySXRlbXNXaWR0aCAtIHRoaXMubmF2YmFySXRlbXNFbGVtZW50Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgaXRlbUJyZWFrUG9pbnQgPSAodGhpcy5vZmZzZXQgKiAtMSkgKyB0aGlzLm5hdmJhckl0ZW1zRWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgbGV0IG1vdmVtZW50SW5QaXhlbHMgPSAwO1xuXG4gICAgdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5zb21lKG5hdmJhckl0ZW0gPT4ge1xuICAgICAgY29uc3QgZmluYWxQb3NpdGlvbiA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCArIG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuXG4gICAgICBpZiAoaXRlbUJyZWFrUG9pbnQgPCBmaW5hbFBvc2l0aW9uKSB7XG4gICAgICAgIG1vdmVtZW50SW5QaXhlbHMgPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHRoaXMub2Zmc2V0ID0gKG1vdmVtZW50SW5QaXhlbHMgKiAtMSk7XG5cbiAgICBpZiAoKHRoaXMub2Zmc2V0ICogLTEpID49IG1heEFsbG93ZWRPZmZzZXQpIHtcbiAgICAgIHRoaXMub2Zmc2V0ID0gbWF4QWxsb3dlZE9mZnNldCAqIC0xO1xuICAgICAgdGhpcy5kaXNhYmxlUmlnaHQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbmF2aWdhdGVMZWZ0KCkge1xuICAgIHRoaXMuZGlzYWJsZVJpZ2h0ID0gZmFsc2U7XG5cbiAgICBsZXQgbW92ZW1lbnRJblBpeGVscztcblxuICAgIHRoaXMubmF2YmFySXRlbXMuYWxsTmF2YmFySXRlbXMuc29tZShuYXZiYXJJdGVtID0+IHtcblxuICAgICAgY29uc3QgbmF2YmFySXRlbU9mZnNldCA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuXG4gICAgICBpZiAobmF2YmFySXRlbU9mZnNldCA+PSAodGhpcy5vZmZzZXQgKiAtMSkpIHtcbiAgICAgICAgbW92ZW1lbnRJblBpeGVscyA9IG5hdmJhckl0ZW1PZmZzZXQgLSAodGhpcy5uYXZiYXJJdGVtc0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCAtIG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB0aGlzLm9mZnNldCA9IChtb3ZlbWVudEluUGl4ZWxzICogLTEpO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0ID4gMCkge1xuICAgICAgdGhpcy5vZmZzZXQgPSAwO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=