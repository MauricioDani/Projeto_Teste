/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewContainerRef } from '@angular/core';
import { Location } from '@angular/common';
import { NavigationEnd, Router } from '@angular/router';
import { callFunction, getFormattedLink, openExternalLink } from '../../utils/util';
import { ThfMenuPanelBaseComponent } from './thf-menu-panel-base.component';
import { ThfMenuPanelItemsService } from './services/thf-menu-panel-items.service';
/**
 * \@docsExtends ThfMenuPanelBaseComponent
 *
 * \@description
 *
 * Para o menu funcionar corretamente é necessário importar o `RouterModule` e `Routes` do módulo principal de
 *  sua aplicação:
 *
 * ````
 * import { RouterModule, Routes } from '\@angular/router';
 *
 * ...
 *
 * \@NgModule({
 *   imports: [
 *     RouterModule,
 *     Routes,
 *     ...
 *     ThfModule,
 *     ...
 *   ],
 *   declarations: [
 *     AppComponent
 *   ],
 *   providers: [],
 *   bootstrap: [AppComponent]
 * })
 * export class AppModule { }
 * ```
 *
 * Além disso é necessário criar um módulo configurando as rotas da aplicação.
 *
 * ```
 * import { NgModule } from '\@angular/core';
 *
 * import { RouterModule, Routes } from '\@angular/router';
 *
 * import { HelloWorldComponent } from './hello-world/hello-world.component';
 *
 * const routes: Routes = [
 *   {path: 'hello-world', component: HelloWorldComponent}
 * ];
 *
 * \@NgModule({
 *   imports: [RouterModule.forRoot(routes, {useHash: true})],
 *   exports: [RouterModule]
 * })
 * export class AppRoutingModule {}
 * ```
 *
 * \@example
 *
 * <example name="thf-menu-panel-basic" title="Totvs Menu Panel Basic">
 *   <file name="sample-thf-menu-panel-basic/sample-thf-menu-panel-basic.component.html"> </file>
 *   <file name="sample-thf-menu-panel-basic/sample-thf-menu-panel-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-menu-panel-labs" title="Totvs Menu Panel Labs">
 *   <file name="sample-thf-menu-panel-labs/sample-thf-menu-panel-labs.component.html"> </file>
 *   <file name="sample-thf-menu-panel-labs/sample-thf-menu-panel-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-menu-panel-customer" title="Totvs Menu Panel - Customers">
 *   <file name="sample-thf-menu-panel-customer/sample-thf-menu-panel-customer.component.html"> </file>
 *   <file name="sample-thf-menu-panel-customer/sample-thf-menu-panel-customer.component.ts"> </file>
 * </example>
 */
var ThfMenuPanelComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfMenuPanelComponent, _super);
    function ThfMenuPanelComponent(viewRef, location, menuItemsService, router) {
        var _this = _super.call(this) || this;
        _this.location = location;
        _this.menuItemsService = menuItemsService;
        _this.router = router;
        _this.parentRef = viewRef['_view']['component'];
        return _this;
    }
    /**
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.itemSubscription.unsubscribe();
        this.routeSubscription.unsubscribe();
    };
    /**
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.subscribeToMenuItem();
        this.subscribeToRoute();
    };
    /**
     * @private
     * @param {?} urlPath
     * @param {?} menus
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.activateMenuByUrl = /**
     * @private
     * @param {?} urlPath
     * @param {?} menus
     * @return {?}
     */
    function (urlPath, menus) {
        var _this = this;
        if (menus) {
            return menus.some((/**
             * @param {?} menu
             * @return {?}
             */
            function (menu) {
                if (getFormattedLink(menu.link) === urlPath) {
                    _this.activateMenuItem(menu);
                    return true;
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.activateMenuItem = /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        this.activeMenuItem = menu;
        this.linkActive = getFormattedLink(menu.link);
        this.menuItemsService.sendToChildMenuClicked({ active: this.activeMenuItem, activatedByRoute: true });
    };
    /**
     * @private
     * @param {?} urlPath
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.checkActiveMenuByUrl = /**
     * @private
     * @param {?} urlPath
     * @return {?}
     */
    function (urlPath) {
        if (!this.linkActive || this.linkActive !== urlPath) {
            this.activateMenuByUrl(urlPath, this.menus);
        }
    };
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.clickMenuItem = /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        if (menu.action) {
            callFunction(menu.action, this.parentRef, menu);
        }
        if (menu.type === 'externalLink') {
            openExternalLink(menu.link);
        }
        else if (menu.type === 'internalLink') {
            this.activateMenuItem(menu);
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.subscribeToRoute = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.routeSubscription = this.router.events.subscribe((/**
         * @param {?} rounterEvent
         * @return {?}
         */
        function (rounterEvent) {
            if (rounterEvent instanceof NavigationEnd) {
                _this.checkActiveMenuByUrl(_this.location.path());
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ThfMenuPanelComponent.prototype.subscribeToMenuItem = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.itemSubscription =
            this.menuItemsService.receiveFromChildMenuClicked().subscribe((/**
             * @param {?} menu
             * @return {?}
             */
            function (menu) { return _this.clickMenuItem(menu); }));
    };
    ThfMenuPanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-menu-panel',
                    template: "<div class=\"thf-menu-panel\">\n  <div class=\"thf-menu-panel-logo-container\">\n    <a href=\"./\">\n      <div class=\"thf-menu-panel-logo\"></div>\n    </a>\n  </div>\n\n  <nav class=\"thf-menu-panel-container\">\n    <div class=\"thf-menu-panel-inner\">\n      <div *ngFor=\"let menu of menus, let menuIndex = index;\" class=\"thf-menu-panel-item-wrapper\">\n        <thf-menu-panel-item\n          [class.thf-menu-panel-item-first]=\"menuIndex === 0\"\n          [t-menu-item-internal]=\"menu\">\n        </thf-menu-panel-item>\n      </div>\n    </div>\n  </nav>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    ThfMenuPanelComponent.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: Location },
        { type: ThfMenuPanelItemsService },
        { type: Router }
    ]; };
    return ThfMenuPanelComponent;
}(ThfMenuPanelBaseComponent));
export { ThfMenuPanelComponent };
if (false) {
    /** @type {?} */
    ThfMenuPanelComponent.prototype.activeMenuItem;
    /** @type {?} */
    ThfMenuPanelComponent.prototype.linkActive;
    /** @type {?} */
    ThfMenuPanelComponent.prototype.parentRef;
    /**
     * @type {?}
     * @private
     */
    ThfMenuPanelComponent.prototype.routeSubscription;
    /**
     * @type {?}
     * @private
     */
    ThfMenuPanelComponent.prototype.itemSubscription;
    /**
     * @type {?}
     * @private
     */
    ThfMenuPanelComponent.prototype.location;
    /**
     * @type {?}
     * @private
     */
    ThfMenuPanelComponent.prototype.menuItemsService;
    /**
     * @type {?}
     * @private
     */
    ThfMenuPanelComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLW1lbnUtcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1tZW51LXBhbmVsL3RoZi1tZW51LXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXFCLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBSXhELE9BQU8sRUFBRSxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVwRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUc1RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzRW5GO0lBSTJDLGlEQUF5QjtJQVNsRSwrQkFDRSxPQUF5QixFQUNqQixRQUFrQixFQUNsQixnQkFBMEMsRUFDMUMsTUFBYztRQUp4QixZQU1FLGlCQUFPLFNBRVI7UUFOUyxjQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLHNCQUFnQixHQUFoQixnQkFBZ0IsQ0FBMEI7UUFDMUMsWUFBTSxHQUFOLE1BQU0sQ0FBUTtRQUd0QixLQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQzs7SUFDakQsQ0FBQzs7OztJQUVELDJDQUFXOzs7SUFBWDtRQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsaUJBQWlC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R0FnRm5FO1NBaEZZLHFCQUFxQjs7O0lBRWhDLCtDQUFpQzs7SUFDakMsMkNBQW1COztJQUNuQiwwQ0FBZTs7Ozs7SUFFZixrREFBd0M7Ozs7O0lBQ3hDLGlEQUF1Qzs7Ozs7SUFJckMseUNBQTBCOzs7OztJQUMxQixpREFBa0Q7Ozs7O0lBQ2xELHVDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBPbkluaXQsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IExvY2F0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE5hdmlnYXRpb25FbmQsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBjYWxsRnVuY3Rpb24sIGdldEZvcm1hdHRlZExpbmssIG9wZW5FeHRlcm5hbExpbmsgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgVGhmTWVudVBhbmVsQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLW1lbnUtcGFuZWwtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmTWVudVBhbmVsSXRlbSB9IGZyb20gJy4vdGhmLW1lbnUtcGFuZWwtaXRlbS90aGYtbWVudS1wYW5lbC1pdGVtLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZNZW51UGFuZWxJdGVtSW50ZXJuYWwgfSBmcm9tICcuL3RoZi1tZW51LXBhbmVsLWl0ZW0vdGhmLW1lbnUtcGFuZWwtaXRlbS1pbnRlcm5hbC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmTWVudVBhbmVsSXRlbXNTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy90aGYtbWVudS1wYW5lbC1pdGVtcy5zZXJ2aWNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmTWVudVBhbmVsQmFzZUNvbXBvbmVudFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIFBhcmEgbyBtZW51IGZ1bmNpb25hciBjb3JyZXRhbWVudGUgw6kgbmVjZXNzw6FyaW8gaW1wb3J0YXIgbyBgUm91dGVyTW9kdWxlYCBlIGBSb3V0ZXNgIGRvIG3Ds2R1bG8gcHJpbmNpcGFsIGRlXG4gKiAgc3VhIGFwbGljYcOnw6NvOlxuICpcbiAqIGBgYGBcbiAqIGltcG9ydCB7IFJvdXRlck1vZHVsZSwgUm91dGVzIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbiAqXG4gKiAuLi5cbiAqXG4gKiBATmdNb2R1bGUoe1xuICogICBpbXBvcnRzOiBbXG4gKiAgICAgUm91dGVyTW9kdWxlLFxuICogICAgIFJvdXRlcyxcbiAqICAgICAuLi5cbiAqICAgICBUaGZNb2R1bGUsXG4gKiAgICAgLi4uXG4gKiAgIF0sXG4gKiAgIGRlY2xhcmF0aW9uczogW1xuICogICAgIEFwcENvbXBvbmVudFxuICogICBdLFxuICogICBwcm92aWRlcnM6IFtdLFxuICogICBib290c3RyYXA6IFtBcHBDb21wb25lbnRdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7IH1cbiAqIGBgYFxuICpcbiAqIEFsw6ltIGRpc3NvIMOpIG5lY2Vzc8OhcmlvIGNyaWFyIHVtIG3Ds2R1bG8gY29uZmlndXJhbmRvIGFzIHJvdGFzIGRhIGFwbGljYcOnw6NvLlxuICpcbiAqIGBgYFxuICogaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqXG4gKiBpbXBvcnQgeyBSb3V0ZXJNb2R1bGUsIFJvdXRlcyB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG4gKlxuICogaW1wb3J0IHsgSGVsbG9Xb3JsZENvbXBvbmVudCB9IGZyb20gJy4vaGVsbG8td29ybGQvaGVsbG8td29ybGQuY29tcG9uZW50JztcbiAqXG4gKiBjb25zdCByb3V0ZXM6IFJvdXRlcyA9IFtcbiAqICAge3BhdGg6ICdoZWxsby13b3JsZCcsIGNvbXBvbmVudDogSGVsbG9Xb3JsZENvbXBvbmVudH1cbiAqIF07XG4gKlxuICogQE5nTW9kdWxlKHtcbiAqICAgaW1wb3J0czogW1JvdXRlck1vZHVsZS5mb3JSb290KHJvdXRlcywge3VzZUhhc2g6IHRydWV9KV0sXG4gKiAgIGV4cG9ydHM6IFtSb3V0ZXJNb2R1bGVdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcFJvdXRpbmdNb2R1bGUge31cbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1tZW51LXBhbmVsLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBNZW51IFBhbmVsIEJhc2ljXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1lbnUtcGFuZWwtYmFzaWMvc2FtcGxlLXRoZi1tZW51LXBhbmVsLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtbWVudS1wYW5lbC1iYXNpYy9zYW1wbGUtdGhmLW1lbnUtcGFuZWwtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLW1lbnUtcGFuZWwtbGFic1wiIHRpdGxlPVwiVG90dnMgTWVudSBQYW5lbCBMYWJzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1lbnUtcGFuZWwtbGFicy9zYW1wbGUtdGhmLW1lbnUtcGFuZWwtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1lbnUtcGFuZWwtbGFicy9zYW1wbGUtdGhmLW1lbnUtcGFuZWwtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtbWVudS1wYW5lbC1jdXN0b21lclwiIHRpdGxlPVwiVG90dnMgTWVudSBQYW5lbCAtIEN1c3RvbWVyc1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1tZW51LXBhbmVsLWN1c3RvbWVyL3NhbXBsZS10aGYtbWVudS1wYW5lbC1jdXN0b21lci5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLW1lbnUtcGFuZWwtY3VzdG9tZXIvc2FtcGxlLXRoZi1tZW51LXBhbmVsLWN1c3RvbWVyLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGhmLW1lbnUtcGFuZWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLW1lbnUtcGFuZWwuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFRoZk1lbnVQYW5lbENvbXBvbmVudCBleHRlbmRzIFRoZk1lbnVQYW5lbEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgYWN0aXZlTWVudUl0ZW06IFRoZk1lbnVQYW5lbEl0ZW07XG4gIGxpbmtBY3RpdmU6IHN0cmluZztcbiAgcGFyZW50UmVmOiBhbnk7XG5cbiAgcHJpdmF0ZSByb3V0ZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGl0ZW1TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICB2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uLFxuICAgIHByaXZhdGUgbWVudUl0ZW1zU2VydmljZTogVGhmTWVudVBhbmVsSXRlbXNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIpIHtcblxuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5wYXJlbnRSZWYgPSB2aWV3UmVmWydfdmlldyddWydjb21wb25lbnQnXTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuaXRlbVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMucm91dGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgdGhpcy5zdWJzY3JpYmVUb01lbnVJdGVtKCk7XG4gICB0aGlzLnN1YnNjcmliZVRvUm91dGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgYWN0aXZhdGVNZW51QnlVcmwodXJsUGF0aDogc3RyaW5nLCBtZW51czogQXJyYXk8VGhmTWVudVBhbmVsSXRlbT4pIHtcbiAgICBpZiAobWVudXMpIHtcbiAgICAgIHJldHVybiBtZW51cy5zb21lKG1lbnUgPT4ge1xuICAgICAgICBpZiAoZ2V0Rm9ybWF0dGVkTGluayhtZW51LmxpbmspID09PSB1cmxQYXRoKSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmF0ZU1lbnVJdGVtKG1lbnUpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFjdGl2YXRlTWVudUl0ZW0obWVudTogVGhmTWVudVBhbmVsSXRlbSk6IHZvaWQge1xuICAgIHRoaXMuYWN0aXZlTWVudUl0ZW0gPSBtZW51O1xuICAgIHRoaXMubGlua0FjdGl2ZSA9IGdldEZvcm1hdHRlZExpbmsobWVudS5saW5rKTtcbiAgICB0aGlzLm1lbnVJdGVtc1NlcnZpY2Uuc2VuZFRvQ2hpbGRNZW51Q2xpY2tlZCh7IGFjdGl2ZTogdGhpcy5hY3RpdmVNZW51SXRlbSwgYWN0aXZhdGVkQnlSb3V0ZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tBY3RpdmVNZW51QnlVcmwodXJsUGF0aDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmxpbmtBY3RpdmUgfHwgdGhpcy5saW5rQWN0aXZlICE9PSB1cmxQYXRoKSB7XG4gICAgICB0aGlzLmFjdGl2YXRlTWVudUJ5VXJsKHVybFBhdGgsIHRoaXMubWVudXMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xpY2tNZW51SXRlbShtZW51OiBUaGZNZW51UGFuZWxJdGVtSW50ZXJuYWwpIHtcbiAgICBpZiAobWVudS5hY3Rpb24pIHtcbiAgICAgIGNhbGxGdW5jdGlvbihtZW51LmFjdGlvbiwgdGhpcy5wYXJlbnRSZWYsIG1lbnUpO1xuICAgIH1cblxuICAgIGlmIChtZW51LnR5cGUgPT09ICdleHRlcm5hbExpbmsnKSB7XG5cbiAgICAgIG9wZW5FeHRlcm5hbExpbmsobWVudS5saW5rKTtcblxuICAgIH0gZWxzZSBpZiAobWVudS50eXBlID09PSAnaW50ZXJuYWxMaW5rJykge1xuXG4gICAgICB0aGlzLmFjdGl2YXRlTWVudUl0ZW0obWVudSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdWJzY3JpYmVUb1JvdXRlKCkge1xuICAgICB0aGlzLnJvdXRlU3Vic2NyaXB0aW9uID0gdGhpcy5yb3V0ZXIuZXZlbnRzLnN1YnNjcmliZShyb3VudGVyRXZlbnQgPT4ge1xuICAgICAgaWYgKHJvdW50ZXJFdmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpIHtcbiAgICAgICAgdGhpcy5jaGVja0FjdGl2ZU1lbnVCeVVybCh0aGlzLmxvY2F0aW9uLnBhdGgoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHN1YnNjcmliZVRvTWVudUl0ZW0oKSB7XG4gICAgdGhpcy5pdGVtU3Vic2NyaXB0aW9uID1cbiAgICAgIHRoaXMubWVudUl0ZW1zU2VydmljZS5yZWNlaXZlRnJvbUNoaWxkTWVudUNsaWNrZWQoKS5zdWJzY3JpYmUoKG1lbnU6IFRoZk1lbnVQYW5lbEl0ZW1JbnRlcm5hbCkgPT4gdGhpcy5jbGlja01lbnVJdGVtKG1lbnUpKTtcbiAgfVxuXG59XG4iXX0=