/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ComponentFactoryResolver, ElementRef, HostListener, IterableDiffers, ViewChild, ViewContainerRef } from '@angular/core';
import { Subject } from 'rxjs';
import { ThfChartBaseComponent } from './thf-chart-base.component';
import { ThfChartColors } from './thf-chart-colors.constant';
import { ThfChartPieComponent } from './thf-chart-types/thf-chart-pie/thf-chart-pie.component';
import { ThfChartType } from './enums/thf-chart-type.enum';
/**
 * \@docsExtends ThfChartBaseComponent
 *
 * \@example
 *
 * <example name="thf-chart-basic" title="Totvs Chart Basic">
 *  <file name="sample-thf-chart-basic/sample-thf-chart-basic.component.html"> </file>
 *  <file name="sample-thf-chart-basic/sample-thf-chart-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-chart-labs" title="Totvs Chart Labs">
 *  <file name="sample-thf-chart-labs/sample-thf-chart-labs.component.html"> </file>
 *  <file name="sample-thf-chart-labs/sample-thf-chart-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-chart-coffee-ranking" title="Totvs Chart - Coffee Ranking">
 *  <file name="sample-thf-chart-coffee-ranking/sample-thf-chart-coffee-ranking.component.html"> </file>
 *  <file name="sample-thf-chart-coffee-ranking/sample-thf-chart-coffee-ranking.component.ts"> </file>
 * </example>
 */
var ThfChartComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ThfChartComponent, _super);
    function ThfChartComponent(changeDetector, componentFactoryResolver, differs) {
        var _a;
        var _this = _super.call(this) || this;
        _this.changeDetector = changeDetector;
        _this.componentFactoryResolver = componentFactoryResolver;
        _this.differs = differs;
        _this.calculatedElement = false;
        _this.initialized = false;
        _this.windowResizeListener = new Subject();
        _this.mappings = (_a = {},
            _a[ThfChartType.Pie] = ThfChartPieComponent,
            _a);
        _this.onResize = (/**
         * @return {?}
         */
        function () { return _this.windowResizeListener.next(); });
        _this.differ = _this.differs.find([]).create(null);
        return _this;
    }
    /**
     * @return {?}
     */
    ThfChartComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initialized = true;
    };
    /**
     * @return {?}
     */
    ThfChartComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var charWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        // Permite que o chart seja calculado na primeira vez que o componente torna-se visÃ­vel,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        if (charWrapperWidth && !this.calculatedElement && this.initialized) {
            this.calculatedElement = true;
            this.getSeriesColor();
            this.dynamicComponentSetting();
        }
        this.checkingForSerieChanges();
    };
    /**
     * @return {?}
     */
    ThfChartComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.removeWindowResizeListener();
    };
    /**
     * @return {?}
     */
    ThfChartComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getSeriesColor();
    };
    /**
     * @return {?}
     */
    ThfChartComponent.prototype.rebuildComponent = /**
     * @return {?}
     */
    function () {
        if (this.componentRef) {
            this.componentRef.destroy();
            this.dynamicComponentSetting();
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfChartComponent.prototype.checkingForSerieChanges = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.componentRef && this.differ) {
            /** @type {?} */
            var changeSeries = this.differ.diff(this.series);
            if (changeSeries) {
                this.getSeriesColor();
                this.rebuildComponent();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    ThfChartComponent.prototype.createComponent = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var componentType = this.getComponentType(this.type);
        /** @type {?} */
        var factory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        this.componentRef = this.chartContainer.createComponent(factory);
        /** @type {?} */
        var instance = (/** @type {?} */ (this.componentRef.instance));
        this.setChartProperties(instance);
        return instance;
    };
    /**
     * @private
     * @return {?}
     */
    ThfChartComponent.prototype.dynamicComponentSetting = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var instance = this.createComponent();
        this.setResizeListenerSubscribe(instance);
        this.changeDetector.detectChanges();
        this.setClickSubscribe(instance);
        this.setHoverSubscribe(instance);
    };
    /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    ThfChartComponent.prototype.getComponentType = /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    function (typeName) {
        return this.mappings[typeName];
    };
    /**
     * @private
     * @return {?}
     */
    ThfChartComponent.prototype.getSeriesColor = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var colorsLength = ThfChartColors.length - 1;
        if (!this.series) {
            return this.colors = ThfChartColors[colorsLength];
        }
        /** @type {?} */
        var seriesLength = this.series.length - 1;
        if (seriesLength > colorsLength) {
            /** @type {?} */
            var colors = ThfChartColors[colorsLength];
            // recupera o resultado da divisao entre tamanho das series e o numero de cores disponiveis
            /** @type {?} */
            var quantityDuplicates = seriesLength / colorsLength;
            for (var i = 1; i <= quantityDuplicates; i++) {
                colors = colors.concat(ThfChartColors[colorsLength]);
            }
            return this.colors = colors;
        }
        return this.colors = ThfChartColors[seriesLength];
    };
    /**
     * @private
     * @return {?}
     */
    ThfChartComponent.prototype.removeWindowResizeListener = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.onResize) {
            this.onResize = (/**
             * @return {?}
             */
            function () { });
        }
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    ThfChartComponent.prototype.setChartProperties = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
        instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
        instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        instance.colors = this.colors;
        instance.height = this.height;
        instance.series = this.series || [];
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    ThfChartComponent.prototype.setClickSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        instance.onSerieClick.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.onSeriesClick(event);
        }));
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    ThfChartComponent.prototype.setHoverSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        instance.onSerieHover.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.onSeriesHover(event);
        }));
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    ThfChartComponent.prototype.setResizeListenerSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        this.windowResizeListener.subscribe((/**
         * @return {?}
         */
        function () {
            instance.chartHeader = _this.chartHeader.nativeElement.offsetHeight;
            instance.chartLegend = _this.chartLegend.nativeElement.offsetHeight;
            instance.chartWrapper = _this.chartWrapper.nativeElement.offsetWidth;
        }));
    };
    ThfChartComponent.decorators = [
        { type: Component, args: [{
                    selector: 'thf-chart',
                    template: "<div #chartWrapper class=\"thf-chart-wrapper\">\n  <div #chartHeader class=\"thf-chart-header\">\n    <div class=\"thf-chart-title\">{{ title }}</div>\n  </div>\n  <ng-template #chartContainer></ng-template>\n  <div #chartLegend class=\"thf-chart-legend\">\n    <div class=\"thf-chart-legend-container\">\n      <div class=\"thf-chart-legend-item\" *ngFor=\"let serie of series; let i = index\">\n        <div class=\"thf-chart-legend-square\" [style.background]=\"colors[i]\"></div>\n        <span class=\"thf-chart-legend-text\">{{ serie.category }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    ThfChartComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ComponentFactoryResolver },
        { type: IterableDiffers }
    ]; };
    ThfChartComponent.propDecorators = {
        chartContainer: [{ type: ViewChild, args: ['chartContainer', { read: ViewContainerRef, static: true },] }],
        chartHeader: [{ type: ViewChild, args: ['chartHeader', { static: true },] }],
        chartLegend: [{ type: ViewChild, args: ['chartLegend', { static: true },] }],
        chartWrapper: [{ type: ViewChild, args: ['chartWrapper', { static: true },] }],
        onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return ThfChartComponent;
}(ThfChartBaseComponent));
export { ThfChartComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.calculatedElement;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.windowResizeListener;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.mappings;
    /** @type {?} */
    ThfChartComponent.prototype.colors;
    /** @type {?} */
    ThfChartComponent.prototype.chartContainer;
    /** @type {?} */
    ThfChartComponent.prototype.chartHeader;
    /** @type {?} */
    ThfChartComponent.prototype.chartLegend;
    /** @type {?} */
    ThfChartComponent.prototype.chartWrapper;
    /** @type {?} */
    ThfChartComponent.prototype.onResize;
    /** @type {?} */
    ThfChartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.differs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0b3R2cy90aGYtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtY2hhcnQvdGhmLWNoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLHdCQUF3QixFQUF5QixVQUFVLEVBQUUsWUFBWSxFQUM3SCxlQUFlLEVBQStDLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuSCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ25FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUU3RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUMvRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNCM0Q7SUFJdUMsNkNBQXFCO0lBd0IxRCwyQkFDUyxjQUFpQyxFQUNoQyx3QkFBa0QsRUFDbEQsT0FBd0I7O1FBSGxDLFlBSUksaUJBQU8sU0FHVjtRQU5RLG9CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQUNoQyw4QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELGFBQU8sR0FBUCxPQUFPLENBQWlCO1FBekIxQix1QkFBaUIsR0FBWSxLQUFLLENBQUM7UUFHbkMsaUJBQVcsR0FBWSxLQUFLLENBQUM7UUFDN0IsMEJBQW9CLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFbkQsY0FBUTtZQUNkLEdBQUMsWUFBWSxDQUFDLEdBQUcsSUFBRyxvQkFBb0I7Z0JBQ3hDO1FBWUYsY0FBUTs7O1FBQUcsY0FBTSxPQUFBLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJ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QUFnQixFQUFFLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7OEJBR3BFLFNBQVMsU0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzhCQUN6QyxTQUFTLFNBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTsrQkFDekMsU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBRTFDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBNkkzQyx3QkFBQztDQUFBLEFBdEtELENBSXVDLHFCQUFxQixHQWtLM0Q7U0FsS1ksaUJBQWlCOzs7Ozs7SUFFNUIsOENBQTJDOzs7OztJQUMzQyx5Q0FBdUM7Ozs7O0lBQ3ZDLG1DQUFvQjs7Ozs7SUFDcEIsd0NBQXFDOzs7OztJQUNyQyxpREFBMkQ7Ozs7O0lBRTNELHFDQUVFOztJQUVGLG1DQUFzQjs7SUFFdEIsMkNBQ2lDOztJQUVqQyx3Q0FBb0U7O0lBQ3BFLHdDQUFvRTs7SUFDcEUseUNBQXNFOztJQUV0RSxxQ0FDaUQ7O0lBRy9DLDJDQUF3Qzs7Ozs7SUFDeEMscURBQTBEOzs7OztJQUMxRCxvQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRG9DaGVjaywgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLFxuICBJdGVyYWJsZURpZmZlcnMsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IFRoZkNoYXJ0QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLWNoYXJ0LWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZkNoYXJ0Q29sb3JzIH0gZnJvbSAnLi90aGYtY2hhcnQtY29sb3JzLmNvbnN0YW50JztcbmltcG9ydCB7IFRoZkNoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgfSBmcm9tICcuL3RoZi1jaGFydC10eXBlcy90aGYtY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZDaGFydFBpZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLWNoYXJ0LXR5cGVzL3RoZi1jaGFydC1waWUvdGhmLWNoYXJ0LXBpZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmQ2hhcnRUeXBlIH0gZnJvbSAnLi9lbnVtcy90aGYtY2hhcnQtdHlwZS5lbnVtJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmQ2hhcnRCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLWNoYXJ0LWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBDaGFydCBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWNoYXJ0LWJhc2ljL3NhbXBsZS10aGYtY2hhcnQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWNoYXJ0LWJhc2ljL3NhbXBsZS10aGYtY2hhcnQtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLWNoYXJ0LWxhYnNcIiB0aXRsZT1cIlRvdHZzIENoYXJ0IExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1jaGFydC1sYWJzL3NhbXBsZS10aGYtY2hhcnQtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtY2hhcnQtbGFicy9zYW1wbGUtdGhmLWNoYXJ0LWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwidGhmLWNoYXJ0LWNvZmZlZS1yYW5raW5nXCIgdGl0bGU9XCJUb3R2cyBDaGFydCAtIENvZmZlZSBSYW5raW5nXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtY2hhcnQtY29mZmVlLXJhbmtpbmcvc2FtcGxlLXRoZi1jaGFydC1jb2ZmZWUtcmFua2luZy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtY2hhcnQtY29mZmVlLXJhbmtpbmcvc2FtcGxlLXRoZi1jaGFydC1jb2ZmZWUtcmFua2luZy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aGYtY2hhcnQnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLWNoYXJ0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBUaGZDaGFydENvbXBvbmVudCBleHRlbmRzIFRoZkNoYXJ0QmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIERvQ2hlY2ssIE9uRGVzdHJveSwgT25Jbml0IHtcblxuICBwcml2YXRlIGNhbGN1bGF0ZWRFbGVtZW50OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8e30+O1xuICBwcml2YXRlIGRpZmZlcjogYW55O1xuICBwcml2YXRlIGluaXRpYWxpemVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgd2luZG93UmVzaXplTGlzdGVuZXI6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgcHJpdmF0ZSBtYXBwaW5ncyA9IHtcbiAgICBbVGhmQ2hhcnRUeXBlLlBpZV06IFRoZkNoYXJ0UGllQ29tcG9uZW50LFxuICB9O1xuXG4gIGNvbG9yczogQXJyYXk8c3RyaW5nPjtcblxuICBAVmlld0NoaWxkKCdjaGFydENvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiwgc3RhdGljOiB0cnVlIH0pXG4gIGNoYXJ0Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIEBWaWV3Q2hpbGQoJ2NoYXJ0SGVhZGVyJywgeyBzdGF0aWM6IHRydWUgfSkgY2hhcnRIZWFkZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2NoYXJ0TGVnZW5kJywgeyBzdGF0aWM6IHRydWUgfSkgY2hhcnRMZWdlbmQ6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2NoYXJ0V3JhcHBlcicsIHsgc3RhdGljOiB0cnVlIH0pIGNoYXJ0V3JhcHBlcjogRWxlbWVudFJlZjtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJywgWyckZXZlbnQnXSlcbiAgb25SZXNpemUgPSAoKSA9PiB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyLm5leHQoKVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycykge1xuICAgICAgc3VwZXIoKTtcblxuICAgICAgdGhpcy5kaWZmZXIgPSB0aGlzLmRpZmZlcnMuZmluZChbXSkuY3JlYXRlKG51bGwpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICB9XG5cbiAgbmdEb0NoZWNrKCkge1xuICAgIGNvbnN0IGNoYXJXcmFwcGVyV2lkdGggPSB0aGlzLmNoYXJ0V3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgLy8gUGVybWl0ZSBxdWUgbyBjaGFydCBzZWphIGNhbGN1bGFkbyBuYSBwcmltZWlyYSB2ZXogcXVlIG8gY29tcG9uZW50ZSB0b3JuYS1zZSB2aXPDrXZlbCxcbiAgICAvLyBldml0YW5kbyBjb20gaXNzbywgcHJvYmxlbWFzIGNvbSBUYWJzIG91IERpdnMgcXVlIGluaWNpZW0gZXNjb25kaWRhcy5cbiAgICBpZiAoY2hhcldyYXBwZXJXaWR0aCAmJiAhdGhpcy5jYWxjdWxhdGVkRWxlbWVudCAmJiB0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICB0aGlzLmNhbGN1bGF0ZWRFbGVtZW50ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2V0U2VyaWVzQ29sb3IoKTtcbiAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNldHRpbmcoKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoZWNraW5nRm9yU2VyaWVDaGFuZ2VzKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmdldFNlcmllc0NvbG9yKCk7XG4gIH1cblxuICByZWJ1aWxkQ29tcG9uZW50KCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2V0dGluZygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdGb3JTZXJpZUNoYW5nZXMoKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmICYmIHRoaXMuZGlmZmVyKSB7XG4gICAgICBjb25zdCBjaGFuZ2VTZXJpZXMgPSB0aGlzLmRpZmZlci5kaWZmKHRoaXMuc2VyaWVzKTtcbiAgICAgIGlmIChjaGFuZ2VTZXJpZXMpIHtcbiAgICAgICAgdGhpcy5nZXRTZXJpZXNDb2xvcigpO1xuICAgICAgICB0aGlzLnJlYnVpbGRDb21wb25lbnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNvbXBvbmVudCgpIHtcbiAgICBjb25zdCBjb21wb25lbnRUeXBlID0gdGhpcy5nZXRDb21wb25lbnRUeXBlKHRoaXMudHlwZSk7XG4gICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudFR5cGUpO1xuXG4gICAgdGhpcy5jb21wb25lbnRSZWYgPSB0aGlzLmNoYXJ0Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcblxuICAgIGNvbnN0IGluc3RhbmNlID0gPFRoZkNoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQ+dGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XG5cbiAgICB0aGlzLnNldENoYXJ0UHJvcGVydGllcyhpbnN0YW5jZSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jcmVhdGVDb21wb25lbnQoKTtcblxuICAgIHRoaXMuc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRUeXBlKHR5cGVOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwcGluZ3NbdHlwZU5hbWVdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXJpZXNDb2xvcigpIHtcbiAgICBjb25zdCBjb2xvcnNMZW5ndGggPSBUaGZDaGFydENvbG9ycy5sZW5ndGggLSAxO1xuXG4gICAgaWYgKCF0aGlzLnNlcmllcykge1xuICAgICAgcmV0dXJuIHRoaXMuY29sb3JzID0gVGhmQ2hhcnRDb2xvcnNbY29sb3JzTGVuZ3RoXTtcbiAgICB9XG5cbiAgICBjb25zdCBzZXJpZXNMZW5ndGggPSB0aGlzLnNlcmllcy5sZW5ndGggLSAxO1xuXG4gICAgaWYgKHNlcmllc0xlbmd0aCA+IGNvbG9yc0xlbmd0aCkge1xuICAgICAgbGV0IGNvbG9ycyA9IFRoZkNoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF07XG5cbiAgICAgIC8vIHJlY3VwZXJhIG8gcmVzdWx0YWRvIGRhIGRpdmlzYW8gZW50cmUgdGFtYW5obyBkYXMgc2VyaWVzIGUgbyBudW1lcm8gZGUgY29yZXMgZGlzcG9uaXZlaXNcbiAgICAgIGNvbnN0IHF1YW50aXR5RHVwbGljYXRlcyA9IHNlcmllc0xlbmd0aCAvIGNvbG9yc0xlbmd0aDtcblxuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcXVhbnRpdHlEdXBsaWNhdGVzOyBpKyspIHtcbiAgICAgICAgY29sb3JzID0gY29sb3JzLmNvbmNhdChUaGZDaGFydENvbG9yc1tjb2xvcnNMZW5ndGhdKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuY29sb3JzID0gY29sb3JzO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNvbG9ycyA9IFRoZkNoYXJ0Q29sb3JzW3Nlcmllc0xlbmd0aF07XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLm9uUmVzaXplKSB7XG4gICAgICB0aGlzLm9uUmVzaXplID0gKCkgPT4ge307XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRDaGFydFByb3BlcnRpZXMoaW5zdGFuY2U6IFRoZkNoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICBpbnN0YW5jZS5jaGFydEhlYWRlciA9IHRoaXMuY2hhcnRIZWFkZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaW5zdGFuY2UuY2hhcnRMZWdlbmQgPSB0aGlzLmNoYXJ0TGVnZW5kLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgaW5zdGFuY2UuY29sb3JzID0gdGhpcy5jb2xvcnM7XG4gICAgaW5zdGFuY2UuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgaW5zdGFuY2Uuc2VyaWVzID0gdGhpcy5zZXJpZXMgfHwgW107XG4gIH1cblxuICBwcml2YXRlIHNldENsaWNrU3Vic2NyaWJlKGluc3RhbmNlOiBUaGZDaGFydER5bmFtaWNUeXBlQ29tcG9uZW50KSB7XG4gICAgaW5zdGFuY2Uub25TZXJpZUNsaWNrLnN1YnNjcmliZShldmVudCA9PiB7XG4gICAgICB0aGlzLm9uU2VyaWVzQ2xpY2soZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRIb3ZlclN1YnNjcmliZShpbnN0YW5jZTogVGhmQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLm9uU2VyaWVIb3Zlci5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5vblNlcmllc0hvdmVyKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFRoZkNoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICBpbnN0YW5jZS5jaGFydEhlYWRlciA9IHRoaXMuY2hhcnRIZWFkZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICBpbnN0YW5jZS5jaGFydExlZ2VuZCA9IHRoaXMuY2hhcnRMZWdlbmQubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICBpbnN0YW5jZS5jaGFydFdyYXBwZXIgPSB0aGlzLmNoYXJ0V3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIH0pO1xuICB9XG5cbn1cbiJdfQ==