/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ContentChildren, QueryList, ViewChild } from '@angular/core';
import { ThfTabComponent } from './thf-tab/thf-tab.component';
import { ThfTabDropdownComponent } from './thf-tab-dropdown/thf-tab-dropdown.component';
import { ThfTabsBaseComponent } from './thf-tabs-base.component';
/** @type {?} */
const thfTabsMaxNumberOfTabs = 5;
/**
 * \@docsExtends ThfTabsBaseComponent
 *
 * \@example
 *
 * <example name="thf-tabs-basic" title="Totvs Tabs Basic">
 *  <file name="sample-thf-tabs-basic/sample-thf-tabs-basic.component.html"> </file>
 *  <file name="sample-thf-tabs-basic/sample-thf-tabs-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-tabs-labs" title="Totvs Tabs Labs">
 *  <file name="sample-thf-tabs-labs/sample-thf-tabs-labs.component.html"> </file>
 *  <file name="sample-thf-tabs-labs/sample-thf-tabs-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-tabs-travel" title="Totvs Tabs - Travel">
 *  <file name="sample-thf-tabs-travel/sample-thf-tabs-travel.component.html"> </file>
 *  <file name="sample-thf-tabs-travel/sample-thf-tabs-travel.component.ts"> </file>
 * </example>
 *
 * <example name="thf-tabs-business-conf" title="Totvs Tabs - Business Conference">
 *  <file name="sample-thf-tabs-business-conf/sample-thf-tabs-business-conf.component.html"> </file>
 *  <file name="sample-thf-tabs-business-conf/sample-thf-tabs-business-conf.component.ts"> </file>
 * </example>
 */
export class ThfTabsComponent extends ThfTabsBaseComponent {
    /**
     * @param {?} changeDetector
     */
    constructor(changeDetector) {
        super();
        this.changeDetector = changeDetector;
        this.maxNumberOfTabs = thfTabsMaxNumberOfTabs;
    }
    /**
     * @return {?}
     */
    get isShowTabDropdown() {
        return this.visibleTabs.length > this.maxNumberOfTabs;
    }
    // tabs que serão apresentadas na aba "Mais"
    /**
     * @return {?}
     */
    get overflowedTabs() {
        return this.visibleTabs.filter((/**
         * @param {?} _tab
         * @param {?} index
         * @return {?}
         */
        (_tab, index) => index > (this.maxNumberOfTabs - 2)));
    }
    /**
     * @return {?}
     */
    get visibleTabs() {
        return this.tabs.filter((/**
         * @param {?} tab
         * @return {?}
         */
        tab => !tab.hide));
    }
    /**
     * @return {?}
     */
    closePopover() {
        /** @type {?} */
        const containsPopoverVisible = this.tabDropdown && this.tabDropdown.popover && !this.tabDropdown.popover.isHidden;
        if (containsPopoverVisible) {
            this.tabDropdown.popover.close();
        }
    }
    /**
     * @param {?} tab
     * @return {?}
     */
    isVisibleTab(tab) {
        /** @type {?} */
        const visibleTabIndex = this.visibleTabs.findIndex((/**
         * @param {?} visibleTab
         * @return {?}
         */
        visibleTab => visibleTab.id === tab.id));
        return (this.visibleTabs.length <= this.maxNumberOfTabs) || (visibleTabIndex < (this.maxNumberOfTabs - 1));
    }
    // Função disparada quando alguma tab ficar ativa
    /**
     * @param {?} tab
     * @return {?}
     */
    onTabActive(tab) {
        this.previousActiveTab = this.tabs.find((/**
         * @param {?} tabChild
         * @return {?}
         */
        tabChild => tabChild.active && tabChild.id !== tab.id));
        this.deactivateTab();
    }
    // funcao será disparada quando mudar o estado do thfTab para desabilitado ou escondido.
    /**
     * @param {?} tab
     * @return {?}
     */
    onTabChangeState(tab) {
        if (tab.active) {
            tab.active = false;
            this.activeDistinctTab();
            this.changeDetector.detectChanges();
        }
    }
    // selectiona a aba informada por parametro, caso houver click faz a emição do evento.
    /**
     * @param {?} tab
     * @return {?}
     */
    selectedTab(tab) {
        tab.active = true;
        if (tab.click) {
            tab.click.emit(tab);
        }
        this.changeDetector.detectChanges();
    }
    /**
     * @param {?} _i
     * @param {?} tab
     * @return {?}
     */
    trackByFn(_i, tab) {
        return tab.id;
    }
    // ativa a previousActiveTab ou primeira tab encontrada.
    /**
     * @private
     * @return {?}
     */
    activeDistinctTab() {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = true;
        }
        else {
            this.activeFirstTab();
        }
    }
    // Ativa a primeira Tab que não estiver desabilitada ou escondida.
    /**
     * @private
     * @return {?}
     */
    activeFirstTab() {
        this.tabs.some((/**
         * @param {?} tabChild
         * @return {?}
         */
        tabChild => {
            if (!tabChild.disabled && !tabChild.hide) {
                tabChild.active = true;
                return true;
            }
        }));
    }
    // desativa previousActiveTab e dispara a detecção de mudança.
    /**
     * @private
     * @return {?}
     */
    deactivateTab() {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = false;
            this.changeDetector.detectChanges();
        }
    }
}
ThfTabsComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-tabs',
                template: "<div class=\"thf-tabs-header\">\n\n  <ng-container *ngFor=\"let tab of tabs; trackBy: trackByFn\">\n    <thf-tab-button *ngIf=\"isVisibleTab(tab)\"\n      class=\"thf-tab-button\"\n      [t-active]=\"tab.active\"\n      [t-disabled]=\"tab.disabled\"\n      [t-id]=\"tab.id\"\n      [t-hide]=\"tab.hide\"\n      [t-label]=\"tab.label\"\n      [t-small]=\"small\"\n      (keyup.enter)=\"closePopover()\"\n      (t-activated)=\"onTabActive(tab)\"\n      (t-change-state)=\"onTabChangeState(tab)\"\n      (t-click)=\"selectedTab(tab)\">\n    </thf-tab-button>\n  </ng-container>\n\n  <thf-tab-dropdown #tabDropdown\n    *ngIf=\"isShowTabDropdown\"\n    class=\"thf-tab-button thf-tab-dropdown\"\n    t-label=\"Mais\"\n    [t-small]=\"small\"\n    [t-tabs]=\"overflowedTabs\"\n    (t-activated)=\"onTabActive($event)\"\n    (t-change-state)=\"onTabChangeState($event)\"\n    (t-click)=\"selectedTab($event)\">\n  </thf-tab-dropdown>\n</div>\n\n<div class=\"thf-tabs-container\">\n  <ng-content></ng-content>\n</div>\n\n"
            }] }
];
/** @nocollapse */
ThfTabsComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ThfTabsComponent.propDecorators = {
    tabs: [{ type: ContentChildren, args: [ThfTabComponent,] }],
    tabDropdown: [{ type: ViewChild, args: ['tabDropdown', { static: true },] }]
};
if (false) {
    /** @type {?} */
    ThfTabsComponent.prototype.maxNumberOfTabs;
    /**
     * @type {?}
     * @private
     */
    ThfTabsComponent.prototype.previousActiveTab;
    /** @type {?} */
    ThfTabsComponent.prototype.tabs;
    /** @type {?} */
    ThfTabsComponent.prototype.tabDropdown;
    /**
     * @type {?}
     * @private
     */
    ThfTabsComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXRhYnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi10YWJzL3RoZi10YWJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVwRyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDOUQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFDeEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7O01BRTNELHNCQUFzQixHQUFHLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0JoQyxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsb0JBQW9COzs7O0lBV3hELFlBQW9CLGNBQWlDO1FBQ25ELEtBQUssRUFBRSxDQUFDO1FBRFUsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBVHJELG9CQUFlLEdBQUcsc0JBQXNCLENBQUM7SUFXekMsQ0FBQzs7OztJQUVELElBQUksaUJBQWlCO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUN4RCxDQUFDOzs7OztJQUdELElBQUksY0FBYztRQUNoQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTTs7Ozs7UUFBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUN0RixDQUFDOzs7O0lBRUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07Ozs7UUFBQyxHQUFHLENB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YUFDekM7Ozs7WUFwQ1EsaUJBQWlCOzs7bUJBNEN2QixlQUFlLFNBQUMsZUFBZTswQkFFL0IsU0FBUyxTQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Ozs7SUFQMUMsMkNBQXlDOzs7OztJQUV6Qyw2Q0FBMkM7O0lBRzNDLGdDQUFtRTs7SUFFbkUsdUNBQWlGOzs7OztJQUVyRSwwQ0FBeUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFRoZlRhYkNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXRhYi90aGYtdGFiLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZUYWJEcm9wZG93bkNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXRhYi1kcm9wZG93bi90aGYtdGFiLWRyb3Bkb3duLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZUYWJzQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLXRhYnMtYmFzZS5jb21wb25lbnQnO1xuXG5jb25zdCB0aGZUYWJzTWF4TnVtYmVyT2ZUYWJzID0gNTtcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgVGhmVGFic0Jhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtdGFicy1iYXNpY1wiIHRpdGxlPVwiVG90dnMgVGFicyBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXRhYnMtYmFzaWMvc2FtcGxlLXRoZi10YWJzLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi10YWJzLWJhc2ljL3NhbXBsZS10aGYtdGFicy1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtdGFicy1sYWJzXCIgdGl0bGU9XCJUb3R2cyBUYWJzIExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi10YWJzLWxhYnMvc2FtcGxlLXRoZi10YWJzLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXRhYnMtbGFicy9zYW1wbGUtdGhmLXRhYnMtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtdGFicy10cmF2ZWxcIiB0aXRsZT1cIlRvdHZzIFRhYnMgLSBUcmF2ZWxcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi10YWJzLXRyYXZlbC9zYW1wbGUtdGhmLXRhYnMtdHJhdmVsLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi10YWJzLXRyYXZlbC9zYW1wbGUtdGhmLXRhYnMtdHJhdmVsLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi10YWJzLWJ1c2luZXNzLWNvbmZcIiB0aXRsZT1cIlRvdHZzIFRhYnMgLSBCdXNpbmVzcyBDb25mZXJlbmNlXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtdGFicy1idXNpbmVzcy1jb25mL3NhbXBsZS10aGYtdGFicy1idXNpbmVzcy1jb25mLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi10YWJzLWJ1c2luZXNzLWNvbmYvc2FtcGxlLXRoZi10YWJzLWJ1c2luZXNzLWNvbmYuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGhmLXRhYnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLXRhYnMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFRoZlRhYnNDb21wb25lbnQgZXh0ZW5kcyBUaGZUYWJzQmFzZUNvbXBvbmVudCB7XG5cbiAgbWF4TnVtYmVyT2ZUYWJzID0gdGhmVGFic01heE51bWJlck9mVGFicztcblxuICBwcml2YXRlIHByZXZpb3VzQWN0aXZlVGFiOiBUaGZUYWJDb21wb25lbnQ7XG5cbiAgLy8gVGFicyB1dGlsaXphZG9zIG5vIG5nLWNvbnRlbnRcbiAgQENvbnRlbnRDaGlsZHJlbihUaGZUYWJDb21wb25lbnQpIHRhYnM6IFF1ZXJ5TGlzdDxUaGZUYWJDb21wb25lbnQ+O1xuXG4gIEBWaWV3Q2hpbGQoJ3RhYkRyb3Bkb3duJywgeyBzdGF0aWM6IHRydWUgfSkgdGFiRHJvcGRvd246IFRoZlRhYkRyb3Bkb3duQ29tcG9uZW50O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIGdldCBpc1Nob3dUYWJEcm9wZG93bigpIHtcbiAgICByZXR1cm4gdGhpcy52aXNpYmxlVGFicy5sZW5ndGggPiB0aGlzLm1heE51bWJlck9mVGFicztcbiAgfVxuXG4gIC8vIHRhYnMgcXVlIHNlcsOjbyBhcHJlc2VudGFkYXMgbmEgYWJhIFwiTWFpc1wiXG4gIGdldCBvdmVyZmxvd2VkVGFicygpIHtcbiAgICByZXR1cm4gdGhpcy52aXNpYmxlVGFicy5maWx0ZXIoKF90YWIsIGluZGV4KSA9PiBpbmRleCA+ICh0aGlzLm1heE51bWJlck9mVGFicyAtIDIpKTtcbiAgfVxuXG4gIGdldCB2aXNpYmxlVGFicygpIHtcbiAgICByZXR1cm4gdGhpcy50YWJzLmZpbHRlcih0YWIgPT4gIXRhYi5oaWRlKTtcbiAgfVxuXG4gIGNsb3NlUG9wb3ZlcigpOiB2b2lkIHtcbiAgICBjb25zdCBjb250YWluc1BvcG92ZXJWaXNpYmxlID0gdGhpcy50YWJEcm9wZG93biAmJiB0aGlzLnRhYkRyb3Bkb3duLnBvcG92ZXIgJiYgIXRoaXMudGFiRHJvcGRvd24ucG9wb3Zlci5pc0hpZGRlbjtcblxuICAgIGlmIChjb250YWluc1BvcG92ZXJWaXNpYmxlKSB7XG4gICAgICB0aGlzLnRhYkRyb3Bkb3duLnBvcG92ZXIuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBpc1Zpc2libGVUYWIodGFiKSB7XG4gICAgY29uc3QgdmlzaWJsZVRhYkluZGV4ID0gdGhpcy52aXNpYmxlVGFicy5maW5kSW5kZXgodmlzaWJsZVRhYiA9PiB2aXNpYmxlVGFiLmlkID09PSB0YWIuaWQpO1xuXG4gICAgcmV0dXJuICh0aGlzLnZpc2libGVUYWJzLmxlbmd0aCA8PSB0aGlzLm1heE51bWJlck9mVGFicykgfHwgKHZpc2libGVUYWJJbmRleCA8ICh0aGlzLm1heE51bWJlck9mVGFicyAtIDEpKTtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBxdWFuZG8gYWxndW1hIHRhYiBmaWNhciBhdGl2YVxuICBvblRhYkFjdGl2ZSh0YWIpIHtcbiAgICB0aGlzLnByZXZpb3VzQWN0aXZlVGFiID0gdGhpcy50YWJzLmZpbmQodGFiQ2hpbGQgPT4gdGFiQ2hpbGQuYWN0aXZlICYmIHRhYkNoaWxkLmlkICE9PSB0YWIuaWQpO1xuXG4gICAgdGhpcy5kZWFjdGl2YXRlVGFiKCk7XG4gIH1cblxuICAvLyBmdW5jYW8gc2Vyw6EgZGlzcGFyYWRhIHF1YW5kbyBtdWRhciBvIGVzdGFkbyBkbyB0aGZUYWIgcGFyYSBkZXNhYmlsaXRhZG8gb3UgZXNjb25kaWRvLlxuICBvblRhYkNoYW5nZVN0YXRlKHRhYjogVGhmVGFiQ29tcG9uZW50KSB7XG4gICAgaWYgKHRhYi5hY3RpdmUpIHtcbiAgICAgIHRhYi5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgdGhpcy5hY3RpdmVEaXN0aW5jdFRhYigpO1xuXG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICAvLyBzZWxlY3Rpb25hIGEgYWJhIGluZm9ybWFkYSBwb3IgcGFyYW1ldHJvLCBjYXNvIGhvdXZlciBjbGljayBmYXogYSBlbWnDp8OjbyBkbyBldmVudG8uXG4gIHNlbGVjdGVkVGFiKHRhYjogVGhmVGFiQ29tcG9uZW50KSB7XG4gICAgdGFiLmFjdGl2ZSA9IHRydWU7XG5cbiAgICBpZiAodGFiLmNsaWNrKSB7XG4gICAgICB0YWIuY2xpY2suZW1pdCh0YWIpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgdHJhY2tCeUZuKF9pLCB0YWI6IFRoZlRhYkNvbXBvbmVudCkge1xuICAgIHJldHVybiB0YWIuaWQ7XG4gIH1cblxuICAvLyBhdGl2YSBhIHByZXZpb3VzQWN0aXZlVGFiIG91IHByaW1laXJhIHRhYiBlbmNvbnRyYWRhLlxuICBwcml2YXRlIGFjdGl2ZURpc3RpbmN0VGFiKCkge1xuICAgIGlmICh0aGlzLnByZXZpb3VzQWN0aXZlVGFiKSB7XG4gICAgICB0aGlzLnByZXZpb3VzQWN0aXZlVGFiLmFjdGl2ZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aXZlRmlyc3RUYWIoKTtcbiAgICB9XG4gIH1cblxuICAvLyBBdGl2YSBhIHByaW1laXJhIFRhYiBxdWUgbsOjbyBlc3RpdmVyIGRlc2FiaWxpdGFkYSBvdSBlc2NvbmRpZGEuXG4gIHByaXZhdGUgYWN0aXZlRmlyc3RUYWIoKSB7XG4gICAgdGhpcy50YWJzLnNvbWUodGFiQ2hpbGQgPT4ge1xuICAgICAgaWYgKCF0YWJDaGlsZC5kaXNhYmxlZCAmJiAhdGFiQ2hpbGQuaGlkZSkge1xuICAgICAgICB0YWJDaGlsZC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIGRlc2F0aXZhIHByZXZpb3VzQWN0aXZlVGFiIGUgZGlzcGFyYSBhIGRldGVjw6fDo28gZGUgbXVkYW7Dp2EuXG4gIHByaXZhdGUgZGVhY3RpdmF0ZVRhYigpIHtcbiAgICBpZiAodGhpcy5wcmV2aW91c0FjdGl2ZVRhYikge1xuICAgICAgdGhpcy5wcmV2aW91c0FjdGl2ZVRhYi5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==