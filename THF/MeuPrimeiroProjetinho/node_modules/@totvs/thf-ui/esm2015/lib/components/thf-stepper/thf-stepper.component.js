/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ContentChildren, QueryList } from '@angular/core';
import { ThfStepComponent } from './thf-step/thf-step.component';
import { ThfStepperBaseComponent } from './thf-stepper-base.component';
import { ThfStepperStatus } from './enums/thf-stepper-status.enum';
/**
 * \@docsExtends ThfStepperBaseComponent
 *
 * \@example
 *
 * <example name="thf-stepper-basic" title="Totvs Stepper Basic">
 *  <file name="sample-thf-stepper-basic/sample-thf-stepper-basic.component.html"> </file>
 *  <file name="sample-thf-stepper-basic/sample-thf-stepper-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-stepper-labs" title="Totvs Stepper Labs">
 *  <file name="sample-thf-stepper-labs/sample-thf-stepper-labs.component.html"> </file>
 *  <file name="sample-thf-stepper-labs/sample-thf-stepper-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-stepper-sales" title="Totvs Stepper - Sales">
 *  <file name="sample-thf-stepper-sales/sample-thf-stepper-sales.component.html"> </file>
 *  <file name="sample-thf-stepper-sales/sample-thf-stepper-sales.component.ts"> </file>
 * </example>
 */
export class ThfStepperComponent extends ThfStepperBaseComponent {
    /**
     * @param {?} changeDetector
     */
    constructor(changeDetector) {
        super();
        this.changeDetector = changeDetector;
    }
    /**
     * @return {?}
     */
    get currentStepIndex() {
        return this.step - 1;
    }
    /**
     * @return {?}
     */
    get stepList() {
        return this.useThfSteps && this.thfSteps || this.steps;
    }
    /**
     * @return {?}
     */
    get useThfSteps() {
        return !!this.thfSteps.length;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.activeFirstStep();
        this.thfSteps.changes.subscribe((/**
         * @return {?}
         */
        () => {
            this.controlStepsStatus(0, this.thfSteps.first);
        }));
    }
    /**
     * Altera o status do *step* para ativo.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     *
     * @param {?} index {number} Índice do `thf-step` que se deseja ativar.
     * @return {?}
     */
    active(index) {
        if (!this.useThfSteps) {
            return;
        }
        /** @type {?} */
        const stepsArray = this.getThfSteps();
        /** @type {?} */
        const step = stepsArray[index];
        /** @type {?} */
        const isDisabledStep = step.status === ThfStepperStatus.Disabled;
        /** @type {?} */
        const isErrorStep = step.status === ThfStepperStatus.Error;
        if (!isDisabledStep || isErrorStep) {
            this.changeStep(index, step);
        }
    }
    /**
     * Ativa o primeiro *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    first() {
        if (!this.useThfSteps) {
            return;
        }
        /** @type {?} */
        const firstStep = this.thfSteps.first;
        /** @type {?} */
        const firstStepIndex = 0;
        this.changeStep(firstStepIndex, firstStep);
    }
    /**
     * Ativa o próximo *step*.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    next() {
        if (!this.useThfSteps) {
            return;
        }
        const { steps, stepIndex } = this.getStepsAndIndex(this.currentActiveStep);
        /** @type {?} */
        const nextIndex = stepIndex + 1;
        /** @type {?} */
        const nextStep = steps[nextIndex];
        this.changeStep(nextIndex, nextStep);
    }
    /**
     * Ativa o *step* anterior.
     *
     * > Este método é valido apenas para as implementações que utilizam o componente [**thf-step**](/documentation/thf-step).
     * @return {?}
     */
    previous() {
        if (!this.useThfSteps) {
            return;
        }
        const { steps, stepIndex } = this.getStepsAndIndex(this.currentActiveStep);
        /** @type {?} */
        const previousIndex = stepIndex - 1;
        /** @type {?} */
        const previousStep = steps[previousIndex];
        this.changeStep(previousIndex, previousStep);
    }
    /**
     * @param {?} stepIndex
     * @param {?=} step
     * @return {?}
     */
    changeStep(stepIndex, step) {
        /** @type {?} */
        const isDifferentStep = (!this.currentActiveStep || step.id !== this.currentActiveStep.id);
        if (this.useThfSteps && isDifferentStep && this.allowNextStep(stepIndex)) {
            this.controlStepsStatus(stepIndex, step);
            this.onChangeStep.emit(step);
        }
        else if (!this.useThfSteps && stepIndex !== this.currentStepIndex && this.allowNextStep(stepIndex)) {
            // if para tratamento do modelo antigo do thf-stepper
            this.onChangeStep.emit(stepIndex + 1);
        }
    }
    /**
     * @param {?} step
     * @return {?}
     */
    onStepActive(step) {
        this.currentActiveStep = step;
        this.previousActiveStep = this.thfSteps.find((/**
         * @param {?} stepChild
         * @return {?}
         */
        stepChild => stepChild.status === ThfStepperStatus.Active && stepChild.id !== step.id));
        this.setPreviousStepAsDone();
    }
    /**
     * @param {?} step
     * @return {?}
     */
    trackByFn(step) {
        return step.id;
    }
    /**
     * @private
     * @return {?}
     */
    activeFirstStep() {
        /** @type {?} */
        const hasStepActive = this.thfSteps.some((/**
         * @param {?} thfStep
         * @return {?}
         */
        thfStep => thfStep.status === ThfStepperStatus.Active));
        if (this.useThfSteps && !hasStepActive) {
            this.changeStep(0, this.thfSteps.first);
        }
    }
    /**
     * @private
     * @param {?} nextStepIndex
     * @return {?}
     */
    allowNextStep(nextStepIndex) {
        if (!this.sequential) {
            return true;
        }
        if (this.useThfSteps) {
            return this.isBeforeStep(nextStepIndex) || this.canActiveNextStep(this.currentActiveStep);
        }
        return this.steps.slice(this.step, nextStepIndex).every((/**
         * @param {?} step
         * @return {?}
         */
        step => step.status === ThfStepperStatus.Done));
    }
    /**
     * @private
     * @param {?=} currentActiveStep
     * @return {?}
     */
    canActiveNextStep(currentActiveStep = (/** @type {?} */ ({}))) {
        if (!currentActiveStep.canActiveNextStep) {
            return true;
        }
        /** @type {?} */
        const canActiveNextStep = currentActiveStep.canActiveNextStep(currentActiveStep);
        currentActiveStep.status = this.getStepperStatusByCanActive(canActiveNextStep);
        return canActiveNextStep;
    }
    /**
     * @private
     * @param {?} stepIndex
     * @param {?} step
     * @return {?}
     */
    controlStepsStatus(stepIndex, step) {
        if (this.useThfSteps) {
            this.setStepAsActive(step);
            this.setNextStepAsDefault(step);
            if (this.isBeforeStep(stepIndex)) {
                this.setFinalSteppersAsDisabled(stepIndex);
            }
            this.changeDetector.detectChanges();
        }
    }
    /**
     * @private
     * @param {?} canActiveNextStep
     * @return {?}
     */
    getStepperStatusByCanActive(canActiveNextStep) {
        return canActiveNextStep ? ThfStepperStatus.Done : ThfStepperStatus.Error;
    }
    /**
     * @private
     * @param {?=} step
     * @return {?}
     */
    getStepsAndIndex(step = (/** @type {?} */ ({}))) {
        /** @type {?} */
        const steps = this.getThfSteps();
        /** @type {?} */
        const stepIndex = steps.findIndex((/**
         * @param {?} thfStep
         * @return {?}
         */
        thfStep => thfStep.id === step.id));
        return { steps, stepIndex };
    }
    /**
     * @private
     * @return {?}
     */
    getThfSteps() {
        return this.thfSteps.toArray();
    }
    /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    isBeforeStep(stepIndex) {
        /** @type {?} */
        const currentActiveStepIndex = (/**
         * @return {?}
         */
        () => this.getThfSteps().findIndex((/**
         * @param {?} step
         * @return {?}
         */
        step => step.id === this.currentActiveStep.id)));
        return !!this.currentActiveStep && currentActiveStepIndex() >= stepIndex;
    }
    /**
     * @private
     * @param {?} stepIndex
     * @return {?}
     */
    setFinalSteppersAsDisabled(stepIndex) {
        this.getThfSteps()
            .filter((/**
         * @param {?} step
         * @param {?} index
         * @return {?}
         */
        (step, index) => step && index >= stepIndex + 2))
            .forEach((/**
         * @param {?} step
         * @return {?}
         */
        step => step.status = ThfStepperStatus.Disabled));
    }
    /**
     * @private
     * @param {?} step
     * @return {?}
     */
    setStepAsActive(step) {
        step.status = ThfStepperStatus.Active;
    }
    /**
     * @private
     * @param {?} currentStep
     * @return {?}
     */
    setNextStepAsDefault(currentStep) {
        const { steps, stepIndex } = this.getStepsAndIndex(currentStep);
        /** @type {?} */
        const nextIndex = stepIndex + 1;
        if (nextIndex < this.thfSteps.length) {
            steps[nextIndex].status = ThfStepperStatus.Default;
        }
    }
    /**
     * @private
     * @return {?}
     */
    setPreviousStepAsDone() {
        if (this.previousActiveStep) {
            this.previousActiveStep.status = ThfStepperStatus.Done;
        }
    }
}
ThfStepperComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-stepper',
                template: "<div class=\"thf-stepper thf-stepper-{{ orientation }}\">\n\n  <div class=\"thf-stepper-container\">\n    <thf-stepper-step *ngFor=\"let step of stepList; let index = index; trackBy: trackByFn\"\n      class=\"thf-stepper-step-position\"\n      [t-circle-content]=\"index+1\"\n      [t-label]=\"step.label\"\n      [t-orientation]=\"orientation\"\n      [t-status]=\"step.status\"\n      [t-step-icons]=\"stepIcons\"\n      [t-step-size]=\"stepSize\"\n      (t-activated)=\"onStepActive(step)\"\n      (t-click)=\"changeStep(index, step)\"\n      (t-enter)=\"changeStep(index, step)\">\n    </thf-stepper-step>\n  </div>\n\n  <div *ngIf=\"useThfSteps\" class=\"thf-stepper-content\">\n    <ng-content></ng-content>\n  </div>\n\n</div>\n"
            }] }
];
/** @nocollapse */
ThfStepperComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ThfStepperComponent.propDecorators = {
    thfSteps: [{ type: ContentChildren, args: [ThfStepComponent,] }]
};
if (false) {
    /** @type {?} */
    ThfStepperComponent.prototype.thfSteps;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.currentActiveStep;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.previousActiveStep;
    /**
     * @type {?}
     * @private
     */
    ThfStepperComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXN0ZXBwZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1zdGVwcGVyL3RoZi1zdGVwcGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFvQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzRyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUV2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJuRSxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsdUJBQXVCOzs7O0lBbUI5RCxZQUFvQixjQUFpQztRQUNuRCxLQUFLLEVBQUUsQ0FBQztRQURVLG1CQUFjLEdBQWQsY0FBYyxDQUFtQjtJQUVyRCxDQUFDOzs7O0lBZEQsSUFBSSxnQkFBZ0I7UUFDbEIsT0FBTyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztJQUN2QixDQUFDOzs7O0lBRUQsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN6RCxDQUFDOzs7O0lBRUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDaEMsQ0FBQzs7OztJQU1ELGtCQUFrQjtRQUNoQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUzs7O1FBQUMsR0FBRyxFQUFFO1lBQ25DLElBQUksQ0FBQyxrQkFBa0IsQ0FB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LEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO1NBQ3BEO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxxQkFBcUI7UUFDM0IsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7U0FDeEQ7SUFDSCxDQUFDOzs7WUEvTkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxhQUFhO2dCQUN2Qiw0dUJBQTJDO2FBQzVDOzs7O1lBOUIwQixpQkFBaUI7Ozt1QkFpQ3pDLGVBQWUsU0FBQyxnQkFBZ0I7Ozs7SUFBakMsdUNBQXlFOzs7OztJQUV6RSxnREFBNEM7Ozs7O0lBQzVDLGlEQUE2Qzs7Ozs7SUFjakMsNkNBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJDb250ZW50SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgVGhmU3RlcENvbXBvbmVudCB9IGZyb20gJy4vdGhmLXN0ZXAvdGhmLXN0ZXAuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZlN0ZXBwZXJCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtc3RlcHBlci1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZTdGVwcGVySXRlbSB9IGZyb20gJy4vdGhmLXN0ZXBwZXItaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmU3RlcHBlclN0YXR1cyB9IGZyb20gJy4vZW51bXMvdGhmLXN0ZXBwZXItc3RhdHVzLmVudW0nO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZTdGVwcGVyQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1zdGVwcGVyLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBTdGVwcGVyIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc3RlcHBlci1iYXNpYy9zYW1wbGUtdGhmLXN0ZXBwZXItYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXN0ZXBwZXItYmFzaWMvc2FtcGxlLXRoZi1zdGVwcGVyLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1zdGVwcGVyLWxhYnNcIiB0aXRsZT1cIlRvdHZzIFN0ZXBwZXIgTGFic1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLXN0ZXBwZXItbGFicy9zYW1wbGUtdGhmLXN0ZXBwZXItbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc3RlcHBlci1sYWJzL3NhbXBsZS10aGYtc3RlcHBlci1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1zdGVwcGVyLXNhbGVzXCIgdGl0bGU9XCJUb3R2cyBTdGVwcGVyIC0gU2FsZXNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1zdGVwcGVyLXNhbGVzL3NhbXBsZS10aGYtc3RlcHBlci1zYWxlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtc3RlcHBlci1zYWxlcy9zYW1wbGUtdGhmLXN0ZXBwZXItc2FsZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGhmLXN0ZXBwZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLXN0ZXBwZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFRoZlN0ZXBwZXJDb21wb25lbnQgZXh0ZW5kcyBUaGZTdGVwcGVyQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQge1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oVGhmU3RlcENvbXBvbmVudCkgdGhmU3RlcHM6IFF1ZXJ5TGlzdDxUaGZTdGVwQ29tcG9uZW50PjtcblxuICBwcml2YXRlIGN1cnJlbnRBY3RpdmVTdGVwOiBUaGZTdGVwQ29tcG9uZW50O1xuICBwcml2YXRlIHByZXZpb3VzQWN0aXZlU3RlcDogVGhmU3RlcENvbXBvbmVudDtcblxuICBnZXQgY3VycmVudFN0ZXBJbmRleCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnN0ZXAgLSAxO1xuICB9XG5cbiAgZ2V0IHN0ZXBMaXN0KCk6IFF1ZXJ5TGlzdDxUaGZTdGVwQ29tcG9uZW50PiB8IEFycmF5PFRoZlN0ZXBwZXJJdGVtPiB7XG4gICAgcmV0dXJuIHRoaXMudXNlVGhmU3RlcHMgJiYgdGhpcy50aGZTdGVwcyB8fCB0aGlzLnN0ZXBzO1xuICB9XG5cbiAgZ2V0IHVzZVRoZlN0ZXBzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMudGhmU3RlcHMubGVuZ3RoO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuYWN0aXZlRmlyc3RTdGVwKCk7XG5cbiAgICB0aGlzLnRoZlN0ZXBzLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuY29udHJvbFN0ZXBzU3RhdHVzKDAsIHRoaXMudGhmU3RlcHMuZmlyc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsdGVyYSBvIHN0YXR1cyBkbyAqc3RlcCogcGFyYSBhdGl2by5cbiAgICpcbiAgICogPiBFc3RlIG3DqXRvZG8gw6kgdmFsaWRvIGFwZW5hcyBwYXJhIGFzIGltcGxlbWVudGHDp8O1ZXMgcXVlIHV0aWxpemFtIG8gY29tcG9uZW50ZSBbKip0aGYtc3RlcCoqXSgvZG9jdW1lbnRhdGlvbi90aGYtc3RlcCkuXG4gICAqXG4gICAqIEBwYXJhbSBpbmRleCB7bnVtYmVyfSDDjW5kaWNlIGRvIGB0aGYtc3RlcGAgcXVlIHNlIGRlc2VqYSBhdGl2YXIuXG4gICAqL1xuICBhY3RpdmUoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy51c2VUaGZTdGVwcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHN0ZXBzQXJyYXkgPSB0aGlzLmdldFRoZlN0ZXBzKCk7XG4gICAgY29uc3Qgc3RlcCA9IHN0ZXBzQXJyYXlbaW5kZXhdO1xuICAgIGNvbnN0IGlzRGlzYWJsZWRTdGVwID0gc3RlcC5zdGF0dXMgPT09IFRoZlN0ZXBwZXJTdGF0dXMuRGlzYWJsZWQ7XG4gICAgY29uc3QgaXNFcnJvclN0ZXAgPSBzdGVwLnN0YXR1cyA9PT0gVGhmU3RlcHBlclN0YXR1cy5FcnJvcjtcblxuICAgIGlmICghaXNEaXNhYmxlZFN0ZXAgfHwgaXNFcnJvclN0ZXApIHtcbiAgICAgIHRoaXMuY2hhbmdlU3RlcChpbmRleCwgc3RlcCk7XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICogQXRpdmEgbyBwcmltZWlybyAqc3RlcCouXG4gICAqXG4gICAqID4gRXN0ZSBtw6l0b2RvIMOpIHZhbGlkbyBhcGVuYXMgcGFyYSBhcyBpbXBsZW1lbnRhw6fDtWVzIHF1ZSB1dGlsaXphbSBvIGNvbXBvbmVudGUgWyoqdGhmLXN0ZXAqKl0oL2RvY3VtZW50YXRpb24vdGhmLXN0ZXApLlxuICAgKi9cbiAgZmlyc3QoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnVzZVRoZlN0ZXBzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3RTdGVwID0gdGhpcy50aGZTdGVwcy5maXJzdDtcbiAgICBjb25zdCBmaXJzdFN0ZXBJbmRleCA9IDA7XG5cbiAgICB0aGlzLmNoYW5nZVN0ZXAoZmlyc3RTdGVwSW5kZXgsIGZpcnN0U3RlcCk7XG4gIH1cblxuICAvKipcbiAgICogQXRpdmEgbyBwcsOzeGltbyAqc3RlcCouXG4gICAqXG4gICAqID4gRXN0ZSBtw6l0b2RvIMOpIHZhbGlkbyBhcGVuYXMgcGFyYSBhcyBpbXBsZW1lbnRhw6fDtWVzIHF1ZSB1dGlsaXphbSBvIGNvbXBvbmVudGUgWyoqdGhmLXN0ZXAqKl0oL2RvY3VtZW50YXRpb24vdGhmLXN0ZXApLlxuICAgKi9cbiAgbmV4dCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudXNlVGhmU3RlcHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IHN0ZXBzLCBzdGVwSW5kZXggfSA9IHRoaXMuZ2V0U3RlcHNBbmRJbmRleCh0aGlzLmN1cnJlbnRBY3RpdmVTdGVwKTtcbiAgICBjb25zdCBuZXh0SW5kZXggPSBzdGVwSW5kZXggKyAxO1xuICAgIGNvbnN0IG5leHRTdGVwID0gc3RlcHNbbmV4dEluZGV4XTtcblxuICAgIHRoaXMuY2hhbmdlU3RlcChuZXh0SW5kZXgsIG5leHRTdGVwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdGl2YSBvICpzdGVwKiBhbnRlcmlvci5cbiAgICpcbiAgICogPiBFc3RlIG3DqXRvZG8gw6kgdmFsaWRvIGFwZW5hcyBwYXJhIGFzIGltcGxlbWVudGHDp8O1ZXMgcXVlIHV0aWxpemFtIG8gY29tcG9uZW50ZSBbKip0aGYtc3RlcCoqXSgvZG9jdW1lbnRhdGlvbi90aGYtc3RlcCkuXG4gICAqL1xuICBwcmV2aW91cygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudXNlVGhmU3RlcHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IHN0ZXBzLCBzdGVwSW5kZXggfSA9IHRoaXMuZ2V0U3RlcHNBbmRJbmRleCh0aGlzLmN1cnJlbnRBY3RpdmVTdGVwKTtcbiAgICBjb25zdCBwcmV2aW91c0luZGV4ID0gc3RlcEluZGV4IC0gMTtcbiAgICBjb25zdCBwcmV2aW91c1N0ZXAgPSBzdGVwc1twcmV2aW91c0luZGV4XTtcblxuICAgIHRoaXMuY2hhbmdlU3RlcChwcmV2aW91c0luZGV4LCBwcmV2aW91c1N0ZXApO1xuICB9XG5cbiAgY2hhbmdlU3RlcChzdGVwSW5kZXg6IG51bWJlciwgc3RlcD86IFRoZlN0ZXBDb21wb25lbnQpOiB2b2lkIHtcbiAgICBjb25zdCBpc0RpZmZlcmVudFN0ZXAgPSAoIXRoaXMuY3VycmVudEFjdGl2ZVN0ZXAgfHwgc3RlcC5pZCAhPT0gdGhpcy5jdXJyZW50QWN0aXZlU3RlcC5pZCk7XG5cbiAgICBpZiAodGhpcy51c2VUaGZTdGVwcyAmJiBpc0RpZmZlcmVudFN0ZXAgJiYgdGhpcy5hbGxvd05leHRTdGVwKHN0ZXBJbmRleCkpIHtcbiAgICAgIHRoaXMuY29udHJvbFN0ZXBzU3RhdHVzKHN0ZXBJbmRleCwgc3RlcCk7XG5cbiAgICAgIHRoaXMub25DaGFuZ2VTdGVwLmVtaXQoc3RlcCk7XG4gICAgfSBlbHNlIGlmICghdGhpcy51c2VUaGZTdGVwcyAmJiBzdGVwSW5kZXggIT09IHRoaXMuY3VycmVudFN0ZXBJbmRleCAmJiB0aGlzLmFsbG93TmV4dFN0ZXAoc3RlcEluZGV4KSkge1xuICAgICAgLy8gaWYgcGFyYSB0cmF0YW1lbnRvIGRvIG1vZGVsbyBhbnRpZ28gZG8gdGhmLXN0ZXBwZXJcbiAgICAgIHRoaXMub25DaGFuZ2VTdGVwLmVtaXQoc3RlcEluZGV4ICsgMSk7XG4gICAgfVxuICB9XG5cbiAgb25TdGVwQWN0aXZlKHN0ZXA6IFRoZlN0ZXBDb21wb25lbnQpIHtcbiAgICB0aGlzLmN1cnJlbnRBY3RpdmVTdGVwID0gc3RlcDtcblxuICAgIHRoaXMucHJldmlvdXNBY3RpdmVTdGVwID0gdGhpcy50aGZTdGVwcy5maW5kKHN0ZXBDaGlsZCA9PiBzdGVwQ2hpbGQuc3RhdHVzID09PSBUaGZTdGVwcGVyU3RhdHVzLkFjdGl2ZSAmJiBzdGVwQ2hpbGQuaWQgIT09IHN0ZXAuaWQpO1xuXG4gICAgdGhpcy5zZXRQcmV2aW91c1N0ZXBBc0RvbmUoKTtcbiAgfVxuXG4gIHRyYWNrQnlGbihzdGVwOiBUaGZTdGVwQ29tcG9uZW50KSB7XG4gICAgcmV0dXJuIHN0ZXAuaWQ7XG4gIH1cblxuICBwcml2YXRlIGFjdGl2ZUZpcnN0U3RlcCgpIHtcbiAgICBjb25zdCBoYXNTdGVwQWN0aXZlID0gdGhpcy50aGZTdGVwcy5zb21lKHRoZlN0ZXAgPT4gdGhmU3RlcC5zdGF0dXMgPT09IFRoZlN0ZXBwZXJTdGF0dXMuQWN0aXZlKTtcblxuICAgIGlmICh0aGlzLnVzZVRoZlN0ZXBzICYmICFoYXNTdGVwQWN0aXZlKSB7XG4gICAgICB0aGlzLmNoYW5nZVN0ZXAoMCwgdGhpcy50aGZTdGVwcy5maXJzdCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhbGxvd05leHRTdGVwKG5leHRTdGVwSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5zZXF1ZW50aWFsKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy51c2VUaGZTdGVwcykge1xuICAgICAgcmV0dXJuIHRoaXMuaXNCZWZvcmVTdGVwKG5leHRTdGVwSW5kZXgpIHx8IHRoaXMuY2FuQWN0aXZlTmV4dFN0ZXAodGhpcy5jdXJyZW50QWN0aXZlU3RlcCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc3RlcHMuc2xpY2UodGhpcy5zdGVwLCBuZXh0U3RlcEluZGV4KS5ldmVyeShzdGVwID0+IHN0ZXAuc3RhdHVzID09PSBUaGZTdGVwcGVyU3RhdHVzLkRvbmUpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYW5BY3RpdmVOZXh0U3RlcChjdXJyZW50QWN0aXZlU3RlcCA9IDxhbnk+IHt9KSB7XG4gICAgaWYgKCFjdXJyZW50QWN0aXZlU3RlcC5jYW5BY3RpdmVOZXh0U3RlcCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgY2FuQWN0aXZlTmV4dFN0ZXAgPSBjdXJyZW50QWN0aXZlU3RlcC5jYW5BY3RpdmVOZXh0U3RlcChjdXJyZW50QWN0aXZlU3RlcCk7XG5cbiAgICBjdXJyZW50QWN0aXZlU3RlcC5zdGF0dXMgPSB0aGlzLmdldFN0ZXBwZXJTdGF0dXNCeUNhbkFjdGl2ZShjYW5BY3RpdmVOZXh0U3RlcCk7XG5cbiAgICByZXR1cm4gY2FuQWN0aXZlTmV4dFN0ZXA7XG4gIH1cblxuICBwcml2YXRlIGNvbnRyb2xTdGVwc1N0YXR1cyhzdGVwSW5kZXg6IG51bWJlciwgc3RlcDogVGhmU3RlcENvbXBvbmVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnVzZVRoZlN0ZXBzKSB7XG5cbiAgICAgIHRoaXMuc2V0U3RlcEFzQWN0aXZlKHN0ZXApO1xuICAgICAgdGhpcy5zZXROZXh0U3RlcEFzRGVmYXVsdChzdGVwKTtcblxuICAgICAgaWYgKHRoaXMuaXNCZWZvcmVTdGVwKHN0ZXBJbmRleCkpIHtcbiAgICAgICAgdGhpcy5zZXRGaW5hbFN0ZXBwZXJzQXNEaXNhYmxlZChzdGVwSW5kZXgpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFN0ZXBwZXJTdGF0dXNCeUNhbkFjdGl2ZShjYW5BY3RpdmVOZXh0U3RlcCk6IFRoZlN0ZXBwZXJTdGF0dXMge1xuICAgIHJldHVybiBjYW5BY3RpdmVOZXh0U3RlcCA/IFRoZlN0ZXBwZXJTdGF0dXMuRG9uZSA6IFRoZlN0ZXBwZXJTdGF0dXMuRXJyb3I7XG4gIH1cblxuICBwcml2YXRlIGdldFN0ZXBzQW5kSW5kZXgoc3RlcDogVGhmU3RlcENvbXBvbmVudCA9IDxhbnk+IHt9KTogeyBzdGVwczogQXJyYXk8VGhmU3RlcENvbXBvbmVudD4sIHN0ZXBJbmRleDogbnVtYmVyIH0ge1xuICAgIGNvbnN0IHN0ZXBzID0gdGhpcy5nZXRUaGZTdGVwcygpO1xuICAgIGNvbnN0IHN0ZXBJbmRleCA9IHN0ZXBzLmZpbmRJbmRleCh0aGZTdGVwID0+IHRoZlN0ZXAuaWQgPT09IHN0ZXAuaWQpO1xuXG4gICAgcmV0dXJuIHsgc3RlcHMsIHN0ZXBJbmRleCB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUaGZTdGVwcygpOiBBcnJheTxUaGZTdGVwQ29tcG9uZW50PiB7XG4gICAgcmV0dXJuIHRoaXMudGhmU3RlcHMudG9BcnJheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0JlZm9yZVN0ZXAoc3RlcEluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBjb25zdCBjdXJyZW50QWN0aXZlU3RlcEluZGV4ID0gKCkgPT4gdGhpcy5nZXRUaGZTdGVwcygpLmZpbmRJbmRleChzdGVwID0+IHN0ZXAuaWQgPT09IHRoaXMuY3VycmVudEFjdGl2ZVN0ZXAuaWQpO1xuXG4gICAgcmV0dXJuICEhdGhpcy5jdXJyZW50QWN0aXZlU3RlcCAmJiBjdXJyZW50QWN0aXZlU3RlcEluZGV4KCkgPj0gc3RlcEluZGV4O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRGaW5hbFN0ZXBwZXJzQXNEaXNhYmxlZChzdGVwSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuZ2V0VGhmU3RlcHMoKVxuICAgICAgLmZpbHRlcigoc3RlcCwgaW5kZXgpID0+IHN0ZXAgJiYgaW5kZXggPj0gc3RlcEluZGV4ICsgMilcbiAgICAgIC5mb3JFYWNoKHN0ZXAgPT4gc3RlcC5zdGF0dXMgPSBUaGZTdGVwcGVyU3RhdHVzLkRpc2FibGVkKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0U3RlcEFzQWN0aXZlKHN0ZXA6IFRoZlN0ZXBDb21wb25lbnQpOiB2b2lkIHtcbiAgICBzdGVwLnN0YXR1cyA9IFRoZlN0ZXBwZXJTdGF0dXMuQWN0aXZlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXROZXh0U3RlcEFzRGVmYXVsdChjdXJyZW50U3RlcDogVGhmU3RlcENvbXBvbmVudCk6IHZvaWQge1xuICAgIGNvbnN0IHsgc3RlcHMsIHN0ZXBJbmRleCB9ID0gdGhpcy5nZXRTdGVwc0FuZEluZGV4KGN1cnJlbnRTdGVwKTtcbiAgICBjb25zdCBuZXh0SW5kZXggPSBzdGVwSW5kZXggKyAxO1xuXG4gICAgaWYgKG5leHRJbmRleCA8IHRoaXMudGhmU3RlcHMubGVuZ3RoKSB7XG4gICAgICBzdGVwc1tuZXh0SW5kZXhdLnN0YXR1cyA9IFRoZlN0ZXBwZXJTdGF0dXMuRGVmYXVsdDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFByZXZpb3VzU3RlcEFzRG9uZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wcmV2aW91c0FjdGl2ZVN0ZXApIHtcbiAgICAgIHRoaXMucHJldmlvdXNBY3RpdmVTdGVwLnN0YXR1cyA9IFRoZlN0ZXBwZXJTdGF0dXMuRG9uZTtcbiAgICB9XG4gIH1cblxufVxuIl19