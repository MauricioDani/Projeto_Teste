/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Input } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, convertToInt, isExternalLink, isTypeof, thfLocaleDefault, validValue } from '../../utils/util';
/** @type {?} */
export const thfMenuLiteralsDefault = {
    en: { itemNotFound: 'Item not found.' },
    es: { itemNotFound: 'Elemento no encontrado.' },
    pt: { itemNotFound: 'Item não encontrado.' }
};
/**
 * \@description
 *
 * Este é um componente de menu lateral que é utilizado para navegação nas páginas de uma aplicação.
 *
 * O componente thf-menu recebe uma lista de objetos do tipo `MenuItem` com as informações dos itens de menu como
 * textos, links para redirecionamento, ações, até 4 níveis de menu e ícones para o primeiro nível de menu.
 * @abstract
 */
export class ThfMenuBaseComponent {
    /**
     * @param {?} menuService
     */
    constructor(menuService) {
        this.menuService = menuService;
        this._collapsed = false;
        this._filter = false;
        this._maxLevel = 4;
        this._menus = [];
        this.literals = Object.assign({}, thfMenuLiteralsDefault[thfLocaleDefault], thfMenuLiteralsDefault[browserLanguage()]);
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Colapsa (retrai) o menu e caso receba o valor `false` expande o menu.
     *
     * > Utilize esta propriedade para iniciar o menu colapsado.
     *
     * > Ao utilizar os métodos [`colapse`](documentation/thf-menu#colapseMethod), [`expand`](documentation/thf-menu#expandMethod) e
     * [`toggle`](documentation/thf-menu#toggleMethod) o valor desta propriedade não é alterado.
     *
     * **Importante:**
     *
     * > O menu será colapsado/expandido apenas se todos os itens de menu tiverem valor nas propriedades `icon` e `shortLabel`.
     *
     * \@default `false`
     * @param {?} collapsed
     * @return {?}
     */
    set collapsed(collapsed) {
        this._collapsed = convertToBoolean(collapsed);
        this.validateCollapseClass();
    }
    /**
     * @return {?}
     */
    get collapsed() {
        return this._collapsed;
    }
    /**
     * Lista dos itens do menu. Se o valor estiver indefinido ou inválido, será inicializado como um array vazio.
     * @param {?} menus
     * @return {?}
     */
    set menus(menus) {
        this._menus = Array.isArray(menus) ? menus : [];
    }
    /**
     * @return {?}
     */
    get menus() {
        return this._menus;
    }
    /**
     * @return {?}
     */
    get maxLevel() {
        return this._maxLevel;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Habilita um campo para pesquisa no menu.
     * A pesquisa é realizada em todos os níveis do menu e busca apenas pelos itens que contém uma ação e/ou link definidos,
     * ou também, pode ser realizada através de um serviço definido na propriedade `t-service`.
     *
     * > O campo de pesquisa é desabilitado se o menu estiver colapsado.
     *
     * \@default `false`
     * @param {?} filter
     * @return {?}
     */
    set filter(filter) {
        this._filter = (/** @type {?} */ (filter)) === '' ? true : convertToBoolean(filter);
        this.filteredItems = [...this._menus];
    }
    /**
     * @return {?}
     */
    get filter() {
        return this._filter;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Nesta propriedade deve ser informada a URL do serviço em que será utilizado para realizar o filtro de itens do
     * menu quando realizar uma busca. Caso haja a necessidade de customização, pode ser informado um
     * serviço implementando a interface `ThfMenuFilter`.
     *
     * Caso utilizada uma URL, o serviço deve retornar os dados conforme o
     * [Guia de implementação de API da Totvs](http://tdn.totvs.com/display/public/INT/Guia+de+implementacao+das+APIs+TOTVS).
     *
     * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando o valor digitado
     * no parâmetro `search`, veja exemplo:
     *
     * > O filtro no serviço será realizado caso contenha no mínimo três caracteres no campo de busca, por exemplo `tot`.
     *
     * ```
     * <thf-menu t-service="/api/v1/fnd/menu">
     * </thf-menu>
     *
     * Requisição: GET /api/v1/fnd/menu?search=contas
     * ```
     *
     * > É necessário que propriedade `t-filter` esteja habilitada.
     * @param {?} value
     * @return {?}
     */
    set service(value) {
        this._service = value || undefined;
        this.configService(this.service);
    }
    /**
     * @return {?}
     */
    get service() {
        return this._service;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Deve ser informado um objeto que deseja-se utilizar na requisição de filtro dos itens de menu.
     *
     * Caso utilizado um serviço customizado, implementando a interface `ThfMenuFilter`, o valor desta propriedade
     * será passado como parâmetro, na função `getFilteredData`.
     *
     * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando os valores informados
     * nesta propriedade em conjunto com o parâmetro `search`, veja exemplo:
     *
     * ```
     * <thf-menu t-service="/api/v1/fnd/menu" [t-params]="{ company: 1, user: 297767512 }">
     * </thf-menu>
     *
     * Requisição: GET /api/v1/fnd/menu?search=contas&company=1&user=297767512
     * ```
     * @param {?} value
     * @return {?}
     */
    set params(value) {
        this._params = value && isTypeof(value, 'object') ? value : undefined;
    }
    /**
     * @return {?}
     */
    get params() {
        return this._params;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Caminho para a logomarca, que será exibida quando o componente estiver expandido, localizada na parte superior.
     *
     * > **Importante:**
     * - Caso esta propriedade estiver indefinida ou inválida o espaço para logomarca será removido.
     * - Como boa prática, indica-se utilizar imagens com até `24px` de altura e `224px` de largura,
     * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
     * @param {?} value
     * @return {?}
     */
    set logo(value) {
        this._logo = isTypeof(value, 'string') && value.trim() ? value : undefined;
    }
    /**
     * @return {?}
     */
    get logo() {
        return this._logo;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Caminho para a logomarca, que será exibida quando o componente estiver colapsado, localizada na parte superior.
     *
     * > **Importante:**
     * - Caso esta propriedade estiver indefinida ou inválida passa a assumir o valor informado na propriedade `t-logo` e na ausência desta o
     * espaço para logomarca será removido.
     * - Como boa prática, indica-se utilizar imagens com até `48px` de altura e `48px` de largura,
     * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
     * - Caso não informar um valor, esta propriedade passa a assumir o valor informado na propriedade `t-logo`.
     * @param {?} value
     * @return {?}
     */
    set shortLogo(value) {
        this._shortLogo = isTypeof(value, 'string') && value.trim() ? value : undefined;
    }
    /**
     * @return {?}
     */
    get shortLogo() {
        return this._shortLogo;
    }
    /**
     * @private
     * @param {?} service
     * @return {?}
     */
    configService(service) {
        if (typeof service === 'string' && service.trim()) {
            // service url
            this.menuService.configProperties(service);
            this.filterService = this.menuService;
        }
        else if (typeof service === 'object' && service.getFilteredData) {
            // custom service
            this.filterService = service;
        }
        else {
            this.filterService = undefined;
        }
    }
    /**
     * @protected
     * @return {?}
     */
    setMenuExtraProperties() {
        this.allowIcons = !!this.menus.length;
        this.allowCollapseMenu = !!this.menus.length;
        this.menus.forEach((/**
         * @param {?} menuItem
         * @return {?}
         */
        menuItem => {
            this._level = 1;
            this.allowIcons = this.allowIcons ? validValue(menuItem.icon) : false;
            this.allowCollapseMenu = this.allowCollapseMenu && this.allowIcons ? validValue(menuItem.shortLabel) : false;
            this.removeBadgeAlert(menuItem);
            this.setMenuItemProperties(menuItem);
            if (menuItem.subItems) {
                this._level++;
                this.processSubItems(menuItem);
            }
        }));
    }
    /**
     * @protected
     * @param {?} menuItem
     * @return {?}
     */
    setMenuItemProperties(menuItem) {
        menuItem['id'] = menuItem['id'] || uuid();
        menuItem['level'] = this._level;
        menuItem['type'] = this.setMenuType(menuItem);
    }
    /**
     * @protected
     * @param {?} menus
     * @return {?}
     */
    validateMenus(menus) {
        menus.forEach((/**
         * @param {?} menu
         * @return {?}
         */
        menu => this.validateMenu(menu)));
    }
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    processSubItems(menu) {
        menu.subItems.forEach((/**
         * @param {?} menuItem
         * @param {?} index
         * @param {?} menuItems
         * @return {?}
         */
        (menuItem, index, menuItems) => {
            /** @type {?} */
            const previousItem = menuItems[index - 1];
            if (previousItem && previousItem.subItems) {
                this._level = previousItem['level'];
            }
            if (this._level <= this.maxLevel) {
                this.setMenuItemProperties(menuItem);
                if (menuItem.subItems) {
                    this._level++;
                    this.processSubItems(menuItem);
                }
            }
            if (!menu['badgeAlert']) {
                menu = this.setMenuBadgeAlert(menu, menuItem);
            }
        }));
        menu.subItems = Object.assign([], menu.subItems);
    }
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    removeBadgeAlert(menuItem) {
        if (menuItem['badgeAlert']) {
            delete menuItem['badgeAlert'];
        }
        if (menuItem.subItems) {
            menuItem.subItems.forEach((/**
             * @param {?} subItem
             * @return {?}
             */
            subItem => this.removeBadgeAlert(subItem)));
        }
    }
    /**
     * @private
     * @param {?} parent
     * @param {?} child
     * @return {?}
     */
    setMenuBadgeAlert(parent, child) {
        /** @type {?} */
        const childHasSubItems = child.subItems && child.subItems.length;
        /** @type {?} */
        const childHasBadgeAlert = child['badgeAlert'];
        /** @type {?} */
        const childHasBadge = child.badge && convertToInt(child.badge.value) >= 0;
        parent['badgeAlert'] = childHasBadgeAlert || (childHasBadge && !childHasSubItems);
        return parent;
    }
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    setMenuType(menuItem) {
        if (menuItem.subItems && menuItem.subItems.length > 0 && this._level < this.maxLevel) {
            return 'subItems';
        }
        if (!menuItem.link) {
            return 'noLink';
        }
        if (isExternalLink(menuItem.link)) {
            return 'externalLink';
        }
        return 'internalLink';
    }
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    validateMenu(menuItem) {
        if (!menuItem.label || menuItem.label.trim() === '') {
            throw new Error('O atributo ThfMenuItem.label não pode ser vazio.');
        }
        else if (menuItem.subItems) {
            menuItem.subItems.forEach((/**
             * @param {?} subItem
             * @return {?}
             */
            subItem => {
                this.validateMenu(subItem);
            }));
        }
    }
}
ThfMenuBaseComponent.propDecorators = {
    collapsed: [{ type: Input, args: ['t-collapsed',] }],
    menus: [{ type: Input, args: ['t-menus',] }],
    filter: [{ type: Input, args: ['t-filter',] }],
    service: [{ type: Input, args: ['t-service',] }],
    params: [{ type: Input, args: ['t-params',] }],
    logo: [{ type: Input, args: ['t-logo',] }],
    shortLogo: [{ type: Input, args: ['t-short-logo',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._collapsed;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._filter;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._level;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._logo;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._maxLevel;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._menus;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._params;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._service;
    /**
     * @type {?}
     * @private
     */
    ThfMenuBaseComponent.prototype._shortLogo;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.allowIcons;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.allowCollapseMenu;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.filteredItems;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.filterService;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.literals;
    /** @type {?} */
    ThfMenuBaseComponent.prototype.menuService;
    /**
     * @abstract
     * @protected
     * @return {?}
     */
    ThfMenuBaseComponent.prototype.validateCollapseClass = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLW1lbnUtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLW1lbnUvdGhmLW1lbnUtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdEMsT0FBTyxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxVQUFVLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7QUFNM0ksTUFBTSxPQUFPLHNCQUFzQixHQUFHO0lBQ3BDLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRTtJQUN2QyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUseUJBQXlCLEVBQUU7SUFDL0MsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLHNCQUFzQixFQUFFO0NBQzdDOzs7Ozs7Ozs7O0FBVUQsTUFBTSxPQUFnQixvQkFBb0I7Ozs7SUFnTXhDLFlBQW1CLFdBQTJCO1FBQTNCLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtRQTlMdEMsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixZQUFPLEdBQUcsS0FBSyxDQUFDO1FBR2hCLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFDZCxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBV1gsYUFBUSxxQkFDWixzQkFBc0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUN4QyxzQkFBc0IsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUM1QztJQTJLZ0QsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBdkpuRCxJQUEwQixTQUFTLENBQUMsU0FBa0I7UUFDcEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxnQkFBZ0IsQ0FB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dXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgdjQgYXMgdXVpZCB9IGZyb20gJ3V1aWQnO1xuaW1wb3J0IHsgYnJvd3Nlckxhbmd1YWdlLCBjb252ZXJ0VG9Cb29sZWFuLCBjb252ZXJ0VG9JbnQsIGlzRXh0ZXJuYWxMaW5rLCBpc1R5cGVvZiwgdGhmTG9jYWxlRGVmYXVsdCwgdmFsaWRWYWx1ZSB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBUaGZNZW51RmlsdGVyIH0gZnJvbSAnLi90aGYtbWVudS1maWx0ZXIvdGhmLW1lbnUtZmlsdGVyLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZNZW51SXRlbSB9IGZyb20gJy4vdGhmLW1lbnUtaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmTWVudVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3RoZi1tZW51LnNlcnZpY2UnO1xuXG5leHBvcnQgY29uc3QgdGhmTWVudUxpdGVyYWxzRGVmYXVsdCA9IHtcbiAgZW46IHsgaXRlbU5vdEZvdW5kOiAnSXRlbSBub3QgZm91bmQuJyB9LFxuICBlczogeyBpdGVtTm90Rm91bmQ6ICdFbGVtZW50byBubyBlbmNvbnRyYWRvLicgfSxcbiAgcHQ6IHsgaXRlbU5vdEZvdW5kOiAnSXRlbSBuw6NvIGVuY29udHJhZG8uJyB9XG59O1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIEVzdGUgw6kgdW0gY29tcG9uZW50ZSBkZSBtZW51IGxhdGVyYWwgcXVlIMOpIHV0aWxpemFkbyBwYXJhIG5hdmVnYcOnw6NvIG5hcyBww6FnaW5hcyBkZSB1bWEgYXBsaWNhw6fDo28uXG4gKlxuICogTyBjb21wb25lbnRlIHRoZi1tZW51IHJlY2ViZSB1bWEgbGlzdGEgZGUgb2JqZXRvcyBkbyB0aXBvIGBNZW51SXRlbWAgY29tIGFzIGluZm9ybWHDp8O1ZXMgZG9zIGl0ZW5zIGRlIG1lbnUgY29tb1xuICogdGV4dG9zLCBsaW5rcyBwYXJhIHJlZGlyZWNpb25hbWVudG8sIGHDp8O1ZXMsIGF0w6kgNCBuw612ZWlzIGRlIG1lbnUgZSDDrWNvbmVzIHBhcmEgbyBwcmltZWlybyBuw612ZWwgZGUgbWVudS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRoZk1lbnVCYXNlQ29tcG9uZW50IHtcblxuICBwcml2YXRlIF9jb2xsYXBzZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfZmlsdGVyID0gZmFsc2U7XG4gIHByaXZhdGUgX2xldmVsO1xuICBwcml2YXRlIF9sb2dvOiBzdHJpbmc7XG4gIHByaXZhdGUgX21heExldmVsID0gNDtcbiAgcHJpdmF0ZSBfbWVudXMgPSBbXTtcbiAgcHJpdmF0ZSBfcGFyYW1zOiBhbnk7XG4gIHByaXZhdGUgX3NlcnZpY2U6IHN0cmluZyB8IFRoZk1lbnVGaWx0ZXI7XG4gIHByaXZhdGUgX3Nob3J0TG9nbzogc3RyaW5nO1xuXG4gIGFsbG93SWNvbnM6IGJvb2xlYW47XG4gIGFsbG93Q29sbGFwc2VNZW51OiBib29sZWFuO1xuXG4gIGZpbHRlcmVkSXRlbXM7XG4gIGZpbHRlclNlcnZpY2U6IFRoZk1lbnVGaWx0ZXI7XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgLi4udGhmTWVudUxpdGVyYWxzRGVmYXVsdFt0aGZMb2NhbGVEZWZhdWx0XSxcbiAgICAuLi50aGZNZW51TGl0ZXJhbHNEZWZhdWx0W2Jyb3dzZXJMYW5ndWFnZSgpXVxuICB9O1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIENvbGFwc2EgKHJldHJhaSkgbyBtZW51IGUgY2FzbyByZWNlYmEgbyB2YWxvciBgZmFsc2VgIGV4cGFuZGUgbyBtZW51LlxuICAgKlxuICAgKiA+IFV0aWxpemUgZXN0YSBwcm9wcmllZGFkZSBwYXJhIGluaWNpYXIgbyBtZW51IGNvbGFwc2Fkby5cbiAgICpcbiAgICogPiBBbyB1dGlsaXphciBvcyBtw6l0b2RvcyBbYGNvbGFwc2VgXShkb2N1bWVudGF0aW9uL3RoZi1tZW51I2NvbGFwc2VNZXRob2QpLCBbYGV4cGFuZGBdKGRvY3VtZW50YXRpb24vdGhmLW1lbnUjZXhwYW5kTWV0aG9kKSBlXG4gICAqIFtgdG9nZ2xlYF0oZG9jdW1lbnRhdGlvbi90aGYtbWVudSN0b2dnbGVNZXRob2QpIG8gdmFsb3IgZGVzdGEgcHJvcHJpZWRhZGUgbsOjbyDDqSBhbHRlcmFkby5cbiAgICpcbiAgICogKipJbXBvcnRhbnRlOioqXG4gICAqXG4gICAqID4gTyBtZW51IHNlcsOhIGNvbGFwc2Fkby9leHBhbmRpZG8gYXBlbmFzIHNlIHRvZG9zIG9zIGl0ZW5zIGRlIG1lbnUgdGl2ZXJlbSB2YWxvciBuYXMgcHJvcHJpZWRhZGVzIGBpY29uYCBlIGBzaG9ydExhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCd0LWNvbGxhcHNlZCcpIHNldCBjb2xsYXBzZWQoY29sbGFwc2VkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fY29sbGFwc2VkID0gY29udmVydFRvQm9vbGVhbihjb2xsYXBzZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZUNvbGxhcHNlQ2xhc3MoKTtcbiAgfVxuXG4gIGdldCBjb2xsYXBzZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbGxhcHNlZDtcbiAgfVxuXG4gIC8qKiBMaXN0YSBkb3MgaXRlbnMgZG8gbWVudS4gU2UgbyB2YWxvciBlc3RpdmVyIGluZGVmaW5pZG8gb3UgaW52w6FsaWRvLCBzZXLDoSBpbmljaWFsaXphZG8gY29tbyB1bSBhcnJheSB2YXppby4gKi9cbiAgQElucHV0KCd0LW1lbnVzJykgc2V0IG1lbnVzKG1lbnVzOiBBcnJheTxUaGZNZW51SXRlbT4pIHtcbiAgICB0aGlzLl9tZW51cyA9IEFycmF5LmlzQXJyYXkobWVudXMpID8gbWVudXMgOiBbXTtcbiAgfVxuXG4gIGdldCBtZW51cygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVudXM7XG4gIH1cblxuICBnZXQgbWF4TGV2ZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21heExldmVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSGFiaWxpdGEgdW0gY2FtcG8gcGFyYSBwZXNxdWlzYSBubyBtZW51LlxuICAgKiBBIHBlc3F1aXNhIMOpIHJlYWxpemFkYSBlbSB0b2RvcyBvcyBuw612ZWlzIGRvIG1lbnUgZSBidXNjYSBhcGVuYXMgcGVsb3MgaXRlbnMgcXVlIGNvbnTDqW0gdW1hIGHDp8OjbyBlL291IGxpbmsgZGVmaW5pZG9zLFxuICAgKiBvdSB0YW1iw6ltLCBwb2RlIHNlciByZWFsaXphZGEgYXRyYXbDqXMgZGUgdW0gc2VydmnDp28gZGVmaW5pZG8gbmEgcHJvcHJpZWRhZGUgYHQtc2VydmljZWAuXG4gICAqXG4gICAqID4gTyBjYW1wbyBkZSBwZXNxdWlzYSDDqSBkZXNhYmlsaXRhZG8gc2UgbyBtZW51IGVzdGl2ZXIgY29sYXBzYWRvLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3QtZmlsdGVyJykgc2V0IGZpbHRlcihmaWx0ZXI6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9maWx0ZXIgPSA8YW55PmZpbHRlciA9PT0gJycgPyB0cnVlIDogY29udmVydFRvQm9vbGVhbihmaWx0ZXIpO1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFsuLi50aGlzLl9tZW51c107XG4gIH1cblxuICBnZXQgZmlsdGVyKCkge1xuICAgIHJldHVybiB0aGlzLl9maWx0ZXI7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBOZXN0YSBwcm9wcmllZGFkZSBkZXZlIHNlciBpbmZvcm1hZGEgYSBVUkwgZG8gc2VydmnDp28gZW0gcXVlIHNlcsOhIHV0aWxpemFkbyBwYXJhIHJlYWxpemFyIG8gZmlsdHJvIGRlIGl0ZW5zIGRvXG4gICAqIG1lbnUgcXVhbmRvIHJlYWxpemFyIHVtYSBidXNjYS4gQ2FzbyBoYWphIGEgbmVjZXNzaWRhZGUgZGUgY3VzdG9taXphw6fDo28sIHBvZGUgc2VyIGluZm9ybWFkbyB1bVxuICAgKiBzZXJ2acOnbyBpbXBsZW1lbnRhbmRvIGEgaW50ZXJmYWNlIGBUaGZNZW51RmlsdGVyYC5cbiAgICpcbiAgICogQ2FzbyB1dGlsaXphZGEgdW1hIFVSTCwgbyBzZXJ2acOnbyBkZXZlIHJldG9ybmFyIG9zIGRhZG9zIGNvbmZvcm1lIG9cbiAgICogW0d1aWEgZGUgaW1wbGVtZW50YcOnw6NvIGRlIEFQSSBkYSBUb3R2c10oaHR0cDovL3Rkbi50b3R2cy5jb20vZGlzcGxheS9wdWJsaWMvSU5UL0d1aWErZGUraW1wbGVtZW50YWNhbytkYXMrQVBJcytUT1RWUykuXG4gICAqXG4gICAqIFF1YW5kbyB1dGlsaXphZGEgdW1hIFVSTCBkZSBzZXJ2acOnbywgc2Vyw6EgcmVhbGl6YWRvIHVtICpHRVQqIG5hIFVSTCBpbmZvcm1hZGEsIHBhc3NhbmRvIG8gdmFsb3IgZGlnaXRhZG9cbiAgICogbm8gcGFyw6JtZXRybyBgc2VhcmNoYCwgdmVqYSBleGVtcGxvOlxuICAgKlxuICAgKiA+IE8gZmlsdHJvIG5vIHNlcnZpw6dvIHNlcsOhIHJlYWxpemFkbyBjYXNvIGNvbnRlbmhhIG5vIG3DrW5pbW8gdHLDqnMgY2FyYWN0ZXJlcyBubyBjYW1wbyBkZSBidXNjYSwgcG9yIGV4ZW1wbG8gYHRvdGAuXG4gICAqXG4gICAqIGBgYFxuICAgKiA8dGhmLW1lbnUgdC1zZXJ2aWNlPVwiL2FwaS92MS9mbmQvbWVudVwiPlxuICAgKiA8L3RoZi1tZW51PlxuICAgKlxuICAgKiBSZXF1aXNpw6fDo286IEdFVCAvYXBpL3YxL2ZuZC9tZW51P3NlYXJjaD1jb250YXNcbiAgICogYGBgXG4gICAqXG4gICAqID4gw4kgbmVjZXNzw6FyaW8gcXVlIHByb3ByaWVkYWRlIGB0LWZpbHRlcmAgZXN0ZWphIGhhYmlsaXRhZGEuXG4gICAqL1xuICBASW5wdXQoJ3Qtc2VydmljZScpIHNldCBzZXJ2aWNlKHZhbHVlOiBzdHJpbmcgfCBUaGZNZW51RmlsdGVyKSB7XG4gICAgdGhpcy5fc2VydmljZSA9IHZhbHVlIHx8IHVuZGVmaW5lZDtcblxuICAgIHRoaXMuY29uZmlnU2VydmljZSh0aGlzLnNlcnZpY2UpO1xuICB9XG5cbiAgZ2V0IHNlcnZpY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlcnZpY2U7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZXZlIHNlciBpbmZvcm1hZG8gdW0gb2JqZXRvIHF1ZSBkZXNlamEtc2UgdXRpbGl6YXIgbmEgcmVxdWlzacOnw6NvIGRlIGZpbHRybyBkb3MgaXRlbnMgZGUgbWVudS5cbiAgICpcbiAgICogQ2FzbyB1dGlsaXphZG8gdW0gc2VydmnDp28gY3VzdG9taXphZG8sIGltcGxlbWVudGFuZG8gYSBpbnRlcmZhY2UgYFRoZk1lbnVGaWx0ZXJgLCBvIHZhbG9yIGRlc3RhIHByb3ByaWVkYWRlXG4gICAqIHNlcsOhIHBhc3NhZG8gY29tbyBwYXLDom1ldHJvLCBuYSBmdW7Dp8OjbyBgZ2V0RmlsdGVyZWREYXRhYC5cbiAgICpcbiAgICogUXVhbmRvIHV0aWxpemFkYSB1bWEgVVJMIGRlIHNlcnZpw6dvLCBzZXLDoSByZWFsaXphZG8gdW0gKkdFVCogbmEgVVJMIGluZm9ybWFkYSwgcGFzc2FuZG8gb3MgdmFsb3JlcyBpbmZvcm1hZG9zXG4gICAqIG5lc3RhIHByb3ByaWVkYWRlIGVtIGNvbmp1bnRvIGNvbSBvIHBhcsOibWV0cm8gYHNlYXJjaGAsIHZlamEgZXhlbXBsbzpcbiAgICpcbiAgICogYGBgXG4gICAqIDx0aGYtbWVudSB0LXNlcnZpY2U9XCIvYXBpL3YxL2ZuZC9tZW51XCIgW3QtcGFyYW1zXT1cInsgY29tcGFueTogMSwgdXNlcjogMjk3NzY3NTEyIH1cIj5cbiAgICogPC90aGYtbWVudT5cbiAgICpcbiAgICogUmVxdWlzacOnw6NvOiBHRVQgL2FwaS92MS9mbmQvbWVudT9zZWFyY2g9Y29udGFzJmNvbXBhbnk9MSZ1c2VyPTI5Nzc2NzUxMlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgndC1wYXJhbXMnKSBzZXQgcGFyYW1zKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLl9wYXJhbXMgPSB2YWx1ZSAmJiBpc1R5cGVvZih2YWx1ZSwgJ29iamVjdCcpID8gdmFsdWUgOiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXQgcGFyYW1zKCkge1xuICAgIHJldHVybiB0aGlzLl9wYXJhbXM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBDYW1pbmhvIHBhcmEgYSBsb2dvbWFyY2EsIHF1ZSBzZXLDoSBleGliaWRhIHF1YW5kbyBvIGNvbXBvbmVudGUgZXN0aXZlciBleHBhbmRpZG8sIGxvY2FsaXphZGEgbmEgcGFydGUgc3VwZXJpb3IuXG4gICAqXG4gICAqID4gKipJbXBvcnRhbnRlOioqXG4gICAqIC0gQ2FzbyBlc3RhIHByb3ByaWVkYWRlIGVzdGl2ZXIgaW5kZWZpbmlkYSBvdSBpbnbDoWxpZGEgbyBlc3Bhw6dvIHBhcmEgbG9nb21hcmNhIHNlcsOhIHJlbW92aWRvLlxuICAgKiAtIENvbW8gYm9hIHByw6F0aWNhLCBpbmRpY2Etc2UgdXRpbGl6YXIgaW1hZ2VucyBjb20gYXTDqSBgMjRweGAgZGUgYWx0dXJhIGUgYDIyNHB4YCBkZSBsYXJndXJhLFxuICAgKiBjYXNvIHVsdHJhcGFzc2FyIGVzc2VzIHZhbG9yZXMgYSBpbWFnZW0gc2Vyw6EgcmVhZGVxdWFkYSBubyBlc3Bhw6dvIGRpc3BvbsOtdmVsLlxuICAgKi9cbiAgQElucHV0KCd0LWxvZ28nKSBzZXQgbG9nbyh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fbG9nbyA9IGlzVHlwZW9mKHZhbHVlLCAnc3RyaW5nJykgJiYgdmFsdWUudHJpbSgpID8gdmFsdWUgOiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXQgbG9nbygpIHtcbiAgICByZXR1cm4gdGhpcy5fbG9nbztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIENhbWluaG8gcGFyYSBhIGxvZ29tYXJjYSwgcXVlIHNlcsOhIGV4aWJpZGEgcXVhbmRvIG8gY29tcG9uZW50ZSBlc3RpdmVyIGNvbGFwc2FkbywgbG9jYWxpemFkYSBuYSBwYXJ0ZSBzdXBlcmlvci5cbiAgICpcbiAgICogPiAqKkltcG9ydGFudGU6KipcbiAgICogLSBDYXNvIGVzdGEgcHJvcHJpZWRhZGUgZXN0aXZlciBpbmRlZmluaWRhIG91IGludsOhbGlkYSBwYXNzYSBhIGFzc3VtaXIgbyB2YWxvciBpbmZvcm1hZG8gbmEgcHJvcHJpZWRhZGUgYHQtbG9nb2AgZSBuYSBhdXPDqm5jaWEgZGVzdGEgb1xuICAgKiBlc3Bhw6dvIHBhcmEgbG9nb21hcmNhIHNlcsOhIHJlbW92aWRvLlxuICAgKiAtIENvbW8gYm9hIHByw6F0aWNhLCBpbmRpY2Etc2UgdXRpbGl6YXIgaW1hZ2VucyBjb20gYXTDqSBgNDhweGAgZGUgYWx0dXJhIGUgYDQ4cHhgIGRlIGxhcmd1cmEsXG4gICAqIGNhc28gdWx0cmFwYXNzYXIgZXNzZXMgdmFsb3JlcyBhIGltYWdlbSBzZXLDoSByZWFkZXF1YWRhIG5vIGVzcGHDp28gZGlzcG9uw612ZWwuXG4gICAqIC0gQ2FzbyBuw6NvIGluZm9ybWFyIHVtIHZhbG9yLCBlc3RhIHByb3ByaWVkYWRlIHBhc3NhIGEgYXNzdW1pciBvIHZhbG9yIGluZm9ybWFkbyBuYSBwcm9wcmllZGFkZSBgdC1sb2dvYC5cbiAgICovXG4gIEBJbnB1dCgndC1zaG9ydC1sb2dvJykgc2V0IHNob3J0TG9nbyh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fc2hvcnRMb2dvID0gaXNUeXBlb2YodmFsdWUsICdzdHJpbmcnKSAmJiB2YWx1ZS50cmltKCkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldCBzaG9ydExvZ28oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Nob3J0TG9nbztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtZW51U2VydmljZTogVGhmTWVudVNlcnZpY2UpIHsgfVxuXG4gIHByaXZhdGUgY29uZmlnU2VydmljZShzZXJ2aWNlOiBzdHJpbmcgfCBUaGZNZW51RmlsdGVyKSB7XG4gICAgaWYgKHR5cGVvZiBzZXJ2aWNlID09PSAnc3RyaW5nJyAmJiBzZXJ2aWNlLnRyaW0oKSkge1xuICAgICAgLy8gc2VydmljZSB1cmxcbiAgICAgIHRoaXMubWVudVNlcnZpY2UuY29uZmlnUHJvcGVydGllcyhzZXJ2aWNlKTtcbiAgICAgIHRoaXMuZmlsdGVyU2VydmljZSA9IHRoaXMubWVudVNlcnZpY2U7XG5cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZXJ2aWNlID09PSAnb2JqZWN0JyAmJiBzZXJ2aWNlLmdldEZpbHRlcmVkRGF0YSkge1xuICAgICAgLy8gY3VzdG9tIHNlcnZpY2VcbiAgICAgIHRoaXMuZmlsdGVyU2VydmljZSA9IHNlcnZpY2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlsdGVyU2VydmljZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0TWVudUV4dHJhUHJvcGVydGllcygpIHtcbiAgICB0aGlzLmFsbG93SWNvbnMgPSAhIXRoaXMubWVudXMubGVuZ3RoO1xuICAgIHRoaXMuYWxsb3dDb2xsYXBzZU1lbnUgPSAhIXRoaXMubWVudXMubGVuZ3RoO1xuXG4gICAgdGhpcy5tZW51cy5mb3JFYWNoKG1lbnVJdGVtID0+IHtcbiAgICAgIHRoaXMuX2xldmVsID0gMTtcbiAgICAgIHRoaXMuYWxsb3dJY29ucyA9IHRoaXMuYWxsb3dJY29ucyA/IHZhbGlkVmFsdWUobWVudUl0ZW0uaWNvbikgOiBmYWxzZTtcbiAgICAgIHRoaXMuYWxsb3dDb2xsYXBzZU1lbnUgPSB0aGlzLmFsbG93Q29sbGFwc2VNZW51ICYmIHRoaXMuYWxsb3dJY29ucyA/IHZhbGlkVmFsdWUobWVudUl0ZW0uc2hvcnRMYWJlbCkgOiBmYWxzZTtcbiAgICAgIHRoaXMucmVtb3ZlQmFkZ2VBbGVydChtZW51SXRlbSk7XG4gICAgICB0aGlzLnNldE1lbnVJdGVtUHJvcGVydGllcyhtZW51SXRlbSk7XG5cbiAgICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcykge1xuICAgICAgICB0aGlzLl9sZXZlbCsrO1xuICAgICAgICB0aGlzLnByb2Nlc3NTdWJJdGVtcyhtZW51SXRlbSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0TWVudUl0ZW1Qcm9wZXJ0aWVzKG1lbnVJdGVtOiBUaGZNZW51SXRlbSk6IHZvaWQge1xuICAgIG1lbnVJdGVtWydpZCddID0gbWVudUl0ZW1bJ2lkJ10gfHwgdXVpZCgpO1xuICAgIG1lbnVJdGVtWydsZXZlbCddID0gdGhpcy5fbGV2ZWw7XG4gICAgbWVudUl0ZW1bJ3R5cGUnXSA9IHRoaXMuc2V0TWVudVR5cGUobWVudUl0ZW0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIHZhbGlkYXRlTWVudXMobWVudXMpOiB2b2lkIHtcbiAgICBtZW51cy5mb3JFYWNoKG1lbnUgPT4gdGhpcy52YWxpZGF0ZU1lbnUobWVudSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBwcm9jZXNzU3ViSXRlbXMobWVudSkge1xuICAgIG1lbnUuc3ViSXRlbXMuZm9yRWFjaCgobWVudUl0ZW0sIGluZGV4LCBtZW51SXRlbXMpID0+IHtcblxuICAgICAgY29uc3QgcHJldmlvdXNJdGVtID0gbWVudUl0ZW1zW2luZGV4IC0gMV07XG4gICAgICBpZiAocHJldmlvdXNJdGVtICYmIHByZXZpb3VzSXRlbS5zdWJJdGVtcykge1xuICAgICAgICB0aGlzLl9sZXZlbCA9IHByZXZpb3VzSXRlbVsnbGV2ZWwnXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2xldmVsIDw9IHRoaXMubWF4TGV2ZWwpIHtcbiAgICAgICAgdGhpcy5zZXRNZW51SXRlbVByb3BlcnRpZXMobWVudUl0ZW0pO1xuXG4gICAgICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcykge1xuICAgICAgICAgIHRoaXMuX2xldmVsKys7XG4gICAgICAgICAgdGhpcy5wcm9jZXNzU3ViSXRlbXMobWVudUl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghbWVudVsnYmFkZ2VBbGVydCddKSB7XG4gICAgICAgIG1lbnUgPSB0aGlzLnNldE1lbnVCYWRnZUFsZXJ0KG1lbnUsIG1lbnVJdGVtKTtcbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgbWVudS5zdWJJdGVtcyA9IE9iamVjdC5hc3NpZ24oW10sIG1lbnUuc3ViSXRlbXMpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVCYWRnZUFsZXJ0KG1lbnVJdGVtOiBUaGZNZW51SXRlbSk6IHZvaWQge1xuXG4gICAgaWYgKG1lbnVJdGVtWydiYWRnZUFsZXJ0J10pIHtcbiAgICAgIGRlbGV0ZSBtZW51SXRlbVsnYmFkZ2VBbGVydCddO1xuICAgIH1cblxuICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcykge1xuICAgICAgbWVudUl0ZW0uc3ViSXRlbXMuZm9yRWFjaChzdWJJdGVtID0+IHRoaXMucmVtb3ZlQmFkZ2VBbGVydChzdWJJdGVtKSk7XG4gICAgfVxuXG4gIH1cblxuICBwcml2YXRlIHNldE1lbnVCYWRnZUFsZXJ0KHBhcmVudDogVGhmTWVudUl0ZW0sIGNoaWxkOiBUaGZNZW51SXRlbSk6IFRoZk1lbnVJdGVtIHtcbiAgICBjb25zdCBjaGlsZEhhc1N1Ykl0ZW1zID0gY2hpbGQuc3ViSXRlbXMgJiYgY2hpbGQuc3ViSXRlbXMubGVuZ3RoO1xuICAgIGNvbnN0IGNoaWxkSGFzQmFkZ2VBbGVydCA9IGNoaWxkWydiYWRnZUFsZXJ0J107XG4gICAgY29uc3QgY2hpbGRIYXNCYWRnZSA9IGNoaWxkLmJhZGdlICYmIGNvbnZlcnRUb0ludChjaGlsZC5iYWRnZS52YWx1ZSkgPj0gMDtcblxuICAgIHBhcmVudFsnYmFkZ2VBbGVydCddID0gY2hpbGRIYXNCYWRnZUFsZXJ0IHx8IChjaGlsZEhhc0JhZGdlICYmICFjaGlsZEhhc1N1Ykl0ZW1zKTtcblxuICAgIHJldHVybiBwYXJlbnQ7XG4gIH1cblxuICBwcml2YXRlIHNldE1lbnVUeXBlKG1lbnVJdGVtOiBUaGZNZW51SXRlbSk6IHN0cmluZyB7XG4gICAgaWYgKG1lbnVJdGVtLnN1Ykl0ZW1zICYmIG1lbnVJdGVtLnN1Ykl0ZW1zLmxlbmd0aCA+IDAgJiYgdGhpcy5fbGV2ZWwgPCB0aGlzLm1heExldmVsKSB7XG4gICAgICByZXR1cm4gJ3N1Ykl0ZW1zJztcbiAgICB9XG4gICAgaWYgKCFtZW51SXRlbS5saW5rKSB7XG4gICAgICByZXR1cm4gJ25vTGluayc7XG4gICAgfVxuICAgIGlmIChpc0V4dGVybmFsTGluayhtZW51SXRlbS5saW5rKSkge1xuICAgICAgcmV0dXJuICdleHRlcm5hbExpbmsnO1xuICAgIH1cbiAgICByZXR1cm4gJ2ludGVybmFsTGluayc7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlTWVudShtZW51SXRlbTogVGhmTWVudUl0ZW0pOiB2b2lkIHtcbiAgICBpZiAoIW1lbnVJdGVtLmxhYmVsIHx8IG1lbnVJdGVtLmxhYmVsLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTyBhdHJpYnV0byBUaGZNZW51SXRlbS5sYWJlbCBuw6NvIHBvZGUgc2VyIHZhemlvLicpO1xuICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcbiAgICAgIG1lbnVJdGVtLnN1Ykl0ZW1zLmZvckVhY2goc3ViSXRlbSA9PiB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVNZW51KHN1Ykl0ZW0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHZhbGlkYXRlQ29sbGFwc2VDbGFzcygpO1xuXG59XG4iXX0=