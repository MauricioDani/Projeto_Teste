/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input, Output } from '@angular/core';
import { browserLanguage, convertToBoolean, isEquals, thfLocaleDefault } from '../../../utils/util';
import { requiredFailed } from '../validators';
import { ThfUploadFile } from './thf-upload-file';
import { ThfUploadStatus } from './thf-upload-status.enum';
/** @type {?} */
export const thfUploadLiteralsDefault = {
    en: (/** @type {?} */ ({
        selectFile: 'Select file',
        deleteFile: 'Delete',
        cancel: 'Cancel',
        tryAgain: 'Try again',
        startSending: 'Start sending'
    })),
    es: (/** @type {?} */ ({
        selectFile: 'Seleccionar archivo',
        deleteFile: 'Borrar',
        cancel: 'Cancelar',
        tryAgain: 'Intentar de nuevo',
        startSending: 'Iniciar carga'
    })),
    pt: (/** @type {?} */ ({
        selectFile: 'Selecionar arquivo',
        deleteFile: 'Excluir',
        cancel: 'Cancelar',
        tryAgain: 'Tentar Novamente',
        startSending: 'Iniciar envio'
    }))
};
/** @type {?} */
const thfUploadFormFieldDefault = 'files';
/**
 * \@description
 *
 * O componente `thf-upload` permite que o usuário envie arquivo(s) ao servidor e acompanhe o progresso.
 * Este componente também possibilita algumas configurações como:
 *  - Múltipla seleção, onde o usuário pode enviar mais de um arquivo ao servidor.
 *  - Auto envio, onde o arquivo é enviado imediatamente após a seleção do usuário, não necessitando que o usuário
 * clique em enviar.
 *  - Restrições de formatos de arquivo e tamanho.
 *  - Função de sucesso que será disparada quando os arquivos forem enviados com sucesso.
 *  - Função de erro que será disparada quando houver erro no envio dos arquivos.
 */
export class ThfUploadBaseComponent {
    /**
     * @param {?} uploadService
     */
    constructor(uploadService) {
        this.uploadService = uploadService;
        /**
         * Define o valor do atributo `name` do componente.
         */
        this.name = 'file';
        /**
         * \@optional
         *
         * \@description
         *
         * Define se o envio do arquivo será automático ao selecionar o mesmo.
         *
         * \@default `false`
         */
        this.autoUpload = false;
        /**
         * Função que será executada no momento de realizar o envio do arquivo,
         * onde será possível adicionar informações ao parâmetro que será enviado na requisição.
         * É passado por parâmetro um objeto com o arquivo e a propiedade data nesta propriedade pode ser informado algum dado,
         * que será enviado em conjunto com o arquivo na requisição, por exemplo:
         *
         * ```
         *   event.data = {id: 'id do usuario'};
         * ```
         */
        this.onUpload = new EventEmitter();
        /**
         * Evento será disparado quando ocorrer algum erro no envio do arquivo.
         * > Por parâmetro será passado o objeto do retorno que é do tipo `HttpErrorResponse`.
         */
        this.onError = new EventEmitter();
        /**
         * Evento será disparado quando o envio do arquivo for realizado com sucesso.
         * > Por parâmetro será passado o objeto do retorno que é do tipo `HttpResponse`.
         */
        this.onSuccess = new EventEmitter();
        // Função para atualizar o ngModel do componente, necessário quando não for utilizado dentro da *tag* `form`.
        this.ngModelChange = new EventEmitter();
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Omite o botão de seleção de arquivos.
     *
     * > Caso o valor definido seja `true`, caberá ao desenvolvedor a responsabilidade
     * pela chamada do método `selectFiles()` para seleção de arquivos.
     *
     * \@default `false`
     * @param {?} value
     * @return {?}
     */
    set hideSelectButton(value) {
        this._hideSelectButton = convertToBoolean(value);
    }
    /**
     * @return {?}
     */
    get hideSelectButton() {
        return this._hideSelectButton;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Omite o botão de envio de arquivos.
     *
     * > Caso o valor definido seja `true`, caberá ao desenvolvedor a responsabilidade
     * pela chamada do método `sendFiles()` para envio do(s) arquivo(s) selecionado(s).
     *
     * \@default `false`
     * @param {?} value
     * @return {?}
     */
    set hideSendButton(value) {
        this._hideSendButton = convertToBoolean(value);
    }
    /**
     * @return {?}
     */
    get hideSendButton() {
        return this._hideSendButton;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Objeto com as literais usadas no `thf-upload`.
     *
     * Existem duas maneiras de customizar o componente, passando um objeto com todas as literais disponíveis:
     *
     * ```
     *  const customLiterals: ThfUploadLiterals = {
     *    selectFile: 'Buscar arquivo',
     *    deleteFile: 'Deletar',
     *    cancel: 'Desistir',
     *    tryAgain: 'Recomeçar',
     *    startSending: 'Enviar'
     *  };
     * ```
     *
     * Ou passando apenas as literais que deseja customizar:
     *
     * ```
     *  const customLiterals: ThfUploadLiterals = {
     *    deleteFile: 'Deletar'
     *  };
     * ```
     *
     * E para carregar as literais customizadas, basta apenas passar o objeto para o componente:
     *
     * ```
     * <thf-upload
     *   [t-literals]="customLiterals">
     * </thf-upload>
     * ```
     *
     * > O objeto padrão de literais será traduzido de acordo com o idioma do *browser* (pt, en, es).
     * @param {?} value
     * @return {?}
     */
    set literals(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._literals = Object.assign({}, thfUploadLiteralsDefault[thfLocaleDefault], thfUploadLiteralsDefault[browserLanguage()], value);
        }
        else {
            this._literals = thfUploadLiteralsDefault[browserLanguage()];
        }
    }
    /**
     * @return {?}
     */
    get literals() {
        return this._literals || thfUploadLiteralsDefault[browserLanguage()];
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Objeto que segue a definição da interface `ThfFileRestrictions`,
     * que possibilita definir tamanho máximo/mínimo e extensão dos arquivos permitidos.
     * @param {?} restrictions
     * @return {?}
     */
    set fileRestrictions(restrictions) {
        this._fileRestrictions = restrictions;
        this.setAllowedExtensions(restrictions);
    }
    /**
     * @return {?}
     */
    get fileRestrictions() {
        return this._fileRestrictions;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Nome do campo de formulário que será enviado para o serviço informado na propriedade `t-url`.
     *
     * \@default `files`
     * @param {?} value
     * @return {?}
     */
    set formField(value) {
        this._formField = value && typeof value === 'string' ? value : thfUploadFormFieldDefault;
        this.getUploadService().formField = this.formField;
    }
    /**
     * @return {?}
     */
    get formField() {
        return this._formField;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Indica que o campo será desabilitado.
     * @param {?} value
     * @return {?}
     */
    set disabled(value) {
        this._disabled = convertToBoolean(value);
        this.validateModel(this.currentFiles);
    }
    /**
     * @return {?}
     */
    get disabled() {
        return this._disabled;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Indica que o campo será obrigatório.
     *
     * \@default `false`
     * @param {?} required
     * @return {?}
     */
    set required(required) {
        this._required = convertToBoolean(required);
        this.validateModel(this.currentFiles);
    }
    /**
     * @return {?}
     */
    get required() {
        return this._required;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onModelChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onModelTouched = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnValidatorChange(fn) {
        this.validatorChange = fn;
    }
    /**
     * @param {?} abstractControl
     * @return {?}
     */
    validate(abstractControl) {
        if (requiredFailed(this.required, this.disabled, abstractControl.value)) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    }
    /**
     * @param {?} model
     * @return {?}
     */
    writeValue(model) {
        if (model) {
            if (!isEquals(this.currentFiles, model)) {
                this.currentFiles = this.parseFiles(model);
            }
        }
        else {
            this.currentFiles = undefined;
        }
    }
    /**
     * @protected
     * @param {?} currentFilesLength
     * @return {?}
     */
    isExceededFileLimit(currentFilesLength) {
        return this.isMultiple &&
            this.fileRestrictions &&
            this.fileRestrictions.maxFiles > 0 &&
            this.fileRestrictions.maxFiles <= currentFilesLength;
    }
    // Faz o parse dos arquivos selecionados para arquivos do formato ThfUploadFile e atualiza os arquivos correntes.
    /**
     * @protected
     * @param {?} files
     * @return {?}
     */
    parseFiles(files) {
        /** @type {?} */
        let thfUploadFiles = this.currentFiles || [];
        /** @type {?} */
        const filesLength = files.length;
        for (let i = 0; i < filesLength; i++) {
            if (this.isExceededFileLimit(thfUploadFiles.length)) {
                break;
            }
            /** @type {?} */
            const file = new ThfUploadFile(files[i]);
            if (this.checkRestrictions(file)) {
                thfUploadFiles = this.insertFileInFiles(file, thfUploadFiles);
            }
        }
        return thfUploadFiles;
    }
    /**
     * @protected
     * @param {?} model
     * @return {?}
     */
    validateModel(model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    }
    // Verifica se o arquivo está de acordo com as restrições.
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    checkRestrictions(file) {
        /** @type {?} */
        const restrictions = this.fileRestrictions;
        if (restrictions) {
            /** @type {?} */
            const allowedExtensions = restrictions.allowedExtensions;
            /** @type {?} */
            const minFileSize = restrictions.minFileSize || 0;
            /** @type {?} */
            const maxFileSize = restrictions.maxFileSize || 31457280;
            // 30MB
            /** @type {?} */
            const isAccept = allowedExtensions ? this.isAllowedExtension(file.extension, allowedExtensions) : true;
            /** @type {?} */
            const isAcceptSize = file.size >= minFileSize && file.size <= maxFileSize;
            return isAccept && isAcceptSize;
        }
        return true;
    }
    /**
     * @private
     * @param {?} file
     * @param {?} files
     * @return {?}
     */
    existsFileSameName(file, files) {
        return files.some((/**
         * @param {?} currentFile
         * @return {?}
         */
        currentFile => file.name === currentFile.name));
    }
    /**
     * @private
     * @return {?}
     */
    getUploadService() {
        return this.uploadService;
    }
    /**
     * @private
     * @param {?} newFile
     * @param {?} files
     * @return {?}
     */
    insertFileInFiles(newFile, files) {
        if (this.existsFileSameName(newFile, files)) {
            return this.updateExistsFileInFiles(newFile, files);
        }
        if (this.isMultiple) {
            files.push(newFile);
        }
        else {
            files.splice(0, files.length, newFile);
        }
        return files;
    }
    /**
     * @private
     * @param {?} extension
     * @param {?=} allowedExtensions
     * @return {?}
     */
    isAllowedExtension(extension, allowedExtensions = []) {
        return allowedExtensions.some((/**
         * @param {?} ext
         * @return {?}
         */
        ext => ext.toLowerCase() === extension));
    }
    /**
     * @private
     * @param {?=} restrictions
     * @return {?}
     */
    setAllowedExtensions(restrictions = {}) {
        /** @type {?} */
        const _allowedExtensions = restrictions.allowedExtensions || [];
        this.allowedExtensions = _allowedExtensions.join(',');
    }
    /**
     * @private
     * @param {?} newFile
     * @param {?} files
     * @return {?}
     */
    updateExistsFileInFiles(newFile, files) {
        /** @type {?} */
        const fileIndex = files.findIndex((/**
         * @param {?} currentFile
         * @return {?}
         */
        currentFile => newFile.name === currentFile.name && currentFile.status !== ThfUploadStatus.Uploaded));
        if (fileIndex !== -1) {
            files.splice(fileIndex, 1, newFile);
        }
        return files;
    }
}
ThfUploadBaseComponent.propDecorators = {
    hideSelectButton: [{ type: Input, args: ['t-hide-select-button',] }],
    hideSendButton: [{ type: Input, args: ['t-hide-send-button',] }],
    label: [{ type: Input, args: ['t-label',] }],
    literals: [{ type: Input, args: ['t-literals',] }],
    help: [{ type: Input, args: ['t-help',] }],
    url: [{ type: Input, args: ['t-url',] }],
    fileRestrictions: [{ type: Input, args: ['t-restrictions',] }],
    name: [{ type: Input, args: ['name',] }],
    formField: [{ type: Input, args: ['t-form-field',] }],
    disabled: [{ type: Input, args: ['t-disabled',] }],
    autoUpload: [{ type: Input, args: ['t-auto-upload',] }],
    isMultiple: [{ type: Input, args: ['t-multiple',] }],
    optional: [{ type: Input, args: ['t-optional',] }],
    required: [{ type: Input, args: ['t-required',] }],
    onUpload: [{ type: Output, args: ['t-upload',] }],
    onError: [{ type: Output, args: ['t-error',] }],
    onSuccess: [{ type: Output, args: ['t-success',] }],
    ngModelChange: [{ type: Output, args: ['ngModelChange',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._fileRestrictions;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._formField;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._hideSelectButton;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._hideSendButton;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._literals;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype._required;
    /** @type {?} */
    ThfUploadBaseComponent.prototype.allowedExtensions;
    /** @type {?} */
    ThfUploadBaseComponent.prototype.currentFiles;
    /** @type {?} */
    ThfUploadBaseComponent.prototype.onModelChange;
    /** @type {?} */
    ThfUploadBaseComponent.prototype.onModelTouched;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseComponent.prototype.validatorChange;
    /**
     * Rótulo do campo.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.label;
    /**
     * Texto de apoio para o campo.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.help;
    /**
     * URL que deve ser feita a requisição com os arquivos selecionados.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.url;
    /**
     * Define o valor do atributo `name` do componente.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.name;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se o envio do arquivo será automático ao selecionar o mesmo.
     *
     * \@default `false`
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.autoUpload;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se pode selecionar mais de um arquivo.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.isMultiple;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se a indicação de campo opcional será exibida.
     *
     * > Não será exibida a indicação se:
     *  - O campo conter `t-required`;
     *  - Não possuir `t-help` e/ou `t-label`.
     *
     * \@default `false`
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.optional;
    /**
     * Função que será executada no momento de realizar o envio do arquivo,
     * onde será possível adicionar informações ao parâmetro que será enviado na requisição.
     * É passado por parâmetro um objeto com o arquivo e a propiedade data nesta propriedade pode ser informado algum dado,
     * que será enviado em conjunto com o arquivo na requisição, por exemplo:
     *
     * ```
     *   event.data = {id: 'id do usuario'};
     * ```
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.onUpload;
    /**
     * Evento será disparado quando ocorrer algum erro no envio do arquivo.
     * > Por parâmetro será passado o objeto do retorno que é do tipo `HttpErrorResponse`.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.onError;
    /**
     * Evento será disparado quando o envio do arquivo for realizado com sucesso.
     * > Por parâmetro será passado o objeto do retorno que é do tipo `HttpResponse`.
     * @type {?}
     */
    ThfUploadBaseComponent.prototype.onSuccess;
    /** @type {?} */
    ThfUploadBaseComponent.prototype.ngModelChange;
    /**
     * @type {?}
     * @protected
     */
    ThfUploadBaseComponent.prototype.uploadService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXVwbG9hZC1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0b3R2cy90aGYtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtZmllbGQvdGhmLXVwbG9hZC90aGYtdXBsb2FkLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFNUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNwRyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRS9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUlsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7O0FBRTNELE1BQU0sT0FBTyx3QkFBd0IsR0FBRztJQUN0QyxFQUFFLEVBQUUsbUJBQW9CO1FBQ3RCLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLE1BQU0sRUFBRSxRQUFRO1FBQ2hCLFFBQVEsRUFBRSxXQUFXO1FBQ3JCLFlBQVksRUFBRSxlQUFlO0tBQzlCLEVBQUE7SUFDRCxFQUFFLEVBQUUsbUJBQW9CO1FBQ3RCLFVBQVUsRUFBRSxxQkFBcUI7UUFDakMsVUFBVSxFQUFFLFFBQVE7UUFDcEIsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLG1CQUFtQjtRQUM3QixZQUFZLEVBQUUsZUFBZTtLQUM5QixFQUFBO0lBQ0QsRUFBRSxFQUFFLG1CQUFvQjtRQUN0QixVQUFVLEVBQUUsb0JBQW9CO1FBQ2hDLFVBQVUsRUFBRSxTQUFTO1FBQ3JCLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFFBQVEsRUFBRSxrQkFBa0I7UUFDNUIsWUFBWSxFQUFFLGVBQWU7S0FD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QyxTQUFTO3dCQU1oQixNQUFNLFNBQUMsV0FBVzs0QkFHbEIsTUFBTSxTQUFDLGVBQWU7Ozs7Ozs7SUEzUHZCLDJDQUE0Qjs7Ozs7SUFDNUIsbURBQXNEOzs7OztJQUN0RCw0Q0FBNEI7Ozs7O0lBQzVCLG1EQUFvQzs7Ozs7SUFDcEMsaURBQWtDOzs7OztJQUNsQywyQ0FBd0I7Ozs7O0lBQ3hCLDJDQUE0Qjs7SUFFNUIsbURBQTBCOztJQUMxQiw4Q0FBbUM7O0lBRW5DLCtDQUFtQjs7SUFDbkIsZ0RBQW9COzs7OztJQUVwQixpREFBNkI7Ozs7O0lBeUM3Qix1Q0FBaUM7Ozs7O0lBdURqQyxzQ0FBK0I7Ozs7O0lBRy9CLHFDQUE0Qjs7Ozs7SUFxQjVCLHNDQUFxQzs7Ozs7Ozs7Ozs7SUErQ3JDLDRDQUFxRDs7Ozs7Ozs7O0lBU3JELDRDQUEwQzs7Ozs7Ozs7Ozs7Ozs7O0lBZTFDLDBDQUF1Qzs7Ozs7Ozs7Ozs7O0lBK0J2QywwQ0FBMkU7Ozs7OztJQU0zRSx5Q0FBeUU7Ozs7OztJQU16RSwyQ0FBNkU7O0lBRzdFLCtDQUFxRjs7Ozs7SUFFekUsK0NBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgaXNFcXVhbHMsIHRoZkxvY2FsZURlZmF1bHQgfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFRoZlVwbG9hZEZpbGUgfSBmcm9tICcuL3RoZi11cGxvYWQtZmlsZSc7XG5pbXBvcnQgeyBUaGZVcGxvYWRGaWxlUmVzdHJpY3Rpb25zIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3RoZi11cGxvYWQtZmlsZS1yZXN0cmljdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmVXBsb2FkTGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvdGhmLXVwbG9hZC1saXRlcmFscy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGhmVXBsb2FkU2VydmljZSB9IGZyb20gJy4vdGhmLXVwbG9hZC5zZXJ2aWNlJztcbmltcG9ydCB7IFRoZlVwbG9hZFN0YXR1cyB9IGZyb20gJy4vdGhmLXVwbG9hZC1zdGF0dXMuZW51bSc7XG5cbmV4cG9ydCBjb25zdCB0aGZVcGxvYWRMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiA8VGhmVXBsb2FkTGl0ZXJhbHM+IHtcbiAgICBzZWxlY3RGaWxlOiAnU2VsZWN0IGZpbGUnLFxuICAgIGRlbGV0ZUZpbGU6ICdEZWxldGUnLFxuICAgIGNhbmNlbDogJ0NhbmNlbCcsXG4gICAgdHJ5QWdhaW46ICdUcnkgYWdhaW4nLFxuICAgIHN0YXJ0U2VuZGluZzogJ1N0YXJ0IHNlbmRpbmcnXG4gIH0sXG4gIGVzOiA8VGhmVXBsb2FkTGl0ZXJhbHM+IHtcbiAgICBzZWxlY3RGaWxlOiAnU2VsZWNjaW9uYXIgYXJjaGl2bycsXG4gICAgZGVsZXRlRmlsZTogJ0JvcnJhcicsXG4gICAgY2FuY2VsOiAnQ2FuY2VsYXInLFxuICAgIHRyeUFnYWluOiAnSW50ZW50YXIgZGUgbnVldm8nLFxuICAgIHN0YXJ0U2VuZGluZzogJ0luaWNpYXIgY2FyZ2EnXG4gIH0sXG4gIHB0OiA8VGhmVXBsb2FkTGl0ZXJhbHM+IHtcbiAgICBzZWxlY3RGaWxlOiAnU2VsZWNpb25hciBhcnF1aXZvJyxcbiAgICBkZWxldGVGaWxlOiAnRXhjbHVpcicsXG4gICAgY2FuY2VsOiAnQ2FuY2VsYXInLFxuICAgIHRyeUFnYWluOiAnVGVudGFyIE5vdmFtZW50ZScsXG4gICAgc3RhcnRTZW5kaW5nOiAnSW5pY2lhciBlbnZpbydcbiAgfVxufTtcblxuY29uc3QgdGhmVXBsb2FkRm9ybUZpZWxkRGVmYXVsdCA9ICdmaWxlcyc7XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogTyBjb21wb25lbnRlIGB0aGYtdXBsb2FkYCBwZXJtaXRlIHF1ZSBvIHVzdcOhcmlvIGVudmllIGFycXVpdm8ocykgYW8gc2Vydmlkb3IgZSBhY29tcGFuaGUgbyBwcm9ncmVzc28uXG4gKiBFc3RlIGNvbXBvbmVudGUgdGFtYsOpbSBwb3NzaWJpbGl0YSBhbGd1bWFzIGNvbmZpZ3VyYcOnw7VlcyBjb21vOlxuICogIC0gTcO6bHRpcGxhIHNlbGXDp8Ojbywgb25kZSBvIHVzdcOhcmlvIHBvZGUgZW52aWFyIG1haXMgZGUgdW0gYXJxdWl2byBhbyBzZXJ2aWRvci5cbiAqICAtIEF1dG8gZW52aW8sIG9uZGUgbyBhcnF1aXZvIMOpIGVudmlhZG8gaW1lZGlhdGFtZW50ZSBhcMOzcyBhIHNlbGXDp8OjbyBkbyB1c3XDoXJpbywgbsOjbyBuZWNlc3NpdGFuZG8gcXVlIG8gdXN1w6FyaW9cbiAqIGNsaXF1ZSBlbSBlbnZpYXIuXG4gKiAgLSBSZXN0cmnDp8O1ZXMgZGUgZm9ybWF0b3MgZGUgYXJxdWl2byBlIHRhbWFuaG8uXG4gKiAgLSBGdW7Dp8OjbyBkZSBzdWNlc3NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgcXVhbmRvIG9zIGFycXVpdm9zIGZvcmVtIGVudmlhZG9zIGNvbSBzdWNlc3NvLlxuICogIC0gRnVuw6fDo28gZGUgZXJybyBxdWUgc2Vyw6EgZGlzcGFyYWRhIHF1YW5kbyBob3V2ZXIgZXJybyBubyBlbnZpbyBkb3MgYXJxdWl2b3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBUaGZVcGxvYWRCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XG5cbiAgcHJpdmF0ZSBfZGlzYWJsZWQ/OiBib29sZWFuO1xuICBwcml2YXRlIF9maWxlUmVzdHJpY3Rpb25zPzogVGhmVXBsb2FkRmlsZVJlc3RyaWN0aW9ucztcbiAgcHJpdmF0ZSBfZm9ybUZpZWxkPzogc3RyaW5nO1xuICBwcml2YXRlIF9oaWRlU2VsZWN0QnV0dG9uPzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfaGlkZVNlbmRCdXR0b24/OiBib29sZWFuO1xuICBwcml2YXRlIF9saXRlcmFscz86IGFueTtcbiAgcHJpdmF0ZSBfcmVxdWlyZWQ/OiBib29sZWFuO1xuXG4gIGFsbG93ZWRFeHRlbnNpb25zOiBzdHJpbmc7XG4gIGN1cnJlbnRGaWxlczogQXJyYXk8VGhmVXBsb2FkRmlsZT47XG5cbiAgb25Nb2RlbENoYW5nZTogYW55O1xuICBvbk1vZGVsVG91Y2hlZDogYW55O1xuXG4gIHByaXZhdGUgdmFsaWRhdG9yQ2hhbmdlOiBhbnk7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogT21pdGUgbyBib3TDo28gZGUgc2VsZcOnw6NvIGRlIGFycXVpdm9zLlxuICAgKlxuICAgKiA+IENhc28gbyB2YWxvciBkZWZpbmlkbyBzZWphIGB0cnVlYCwgY2FiZXLDoSBhbyBkZXNlbnZvbHZlZG9yIGEgcmVzcG9uc2FiaWxpZGFkZVxuICAgKiBwZWxhIGNoYW1hZGEgZG8gbcOpdG9kbyBgc2VsZWN0RmlsZXMoKWAgcGFyYSBzZWxlw6fDo28gZGUgYXJxdWl2b3MuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgndC1oaWRlLXNlbGVjdC1idXR0b24nKSBzZXQgaGlkZVNlbGVjdEJ1dHRvbih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVTZWxlY3RCdXR0b24gPSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuICBnZXQgaGlkZVNlbGVjdEJ1dHRvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZVNlbGVjdEJ1dHRvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE9taXRlIG8gYm90w6NvIGRlIGVudmlvIGRlIGFycXVpdm9zLlxuICAgKlxuICAgKiA+IENhc28gbyB2YWxvciBkZWZpbmlkbyBzZWphIGB0cnVlYCwgY2FiZXLDoSBhbyBkZXNlbnZvbHZlZG9yIGEgcmVzcG9uc2FiaWxpZGFkZVxuICAgKiBwZWxhIGNoYW1hZGEgZG8gbcOpdG9kbyBgc2VuZEZpbGVzKClgIHBhcmEgZW52aW8gZG8ocykgYXJxdWl2byhzKSBzZWxlY2lvbmFkbyhzKS5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCd0LWhpZGUtc2VuZC1idXR0b24nKSBzZXQgaGlkZVNlbmRCdXR0b24odmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9oaWRlU2VuZEJ1dHRvbiA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuICB9XG4gIGdldCBoaWRlU2VuZEJ1dHRvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZVNlbmRCdXR0b247XG4gIH1cblxuICAvKiogUsOzdHVsbyBkbyBjYW1wby4gKi9cbiAgQElucHV0KCd0LWxhYmVsJykgbGFiZWw/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogT2JqZXRvIGNvbSBhcyBsaXRlcmFpcyB1c2FkYXMgbm8gYHRoZi11cGxvYWRgLlxuICAgKlxuICAgKiBFeGlzdGVtIGR1YXMgbWFuZWlyYXMgZGUgY3VzdG9taXphciBvIGNvbXBvbmVudGUsIHBhc3NhbmRvIHVtIG9iamV0byBjb20gdG9kYXMgYXMgbGl0ZXJhaXMgZGlzcG9uw612ZWlzOlxuICAgKlxuICAgKiBgYGBcbiAgICogIGNvbnN0IGN1c3RvbUxpdGVyYWxzOiBUaGZVcGxvYWRMaXRlcmFscyA9IHtcbiAgICogICAgc2VsZWN0RmlsZTogJ0J1c2NhciBhcnF1aXZvJyxcbiAgICogICAgZGVsZXRlRmlsZTogJ0RlbGV0YXInLFxuICAgKiAgICBjYW5jZWw6ICdEZXNpc3RpcicsXG4gICAqICAgIHRyeUFnYWluOiAnUmVjb21lw6dhcicsXG4gICAqICAgIHN0YXJ0U2VuZGluZzogJ0VudmlhcidcbiAgICogIH07XG4gICAqIGBgYFxuICAgKlxuICAgKiBPdSBwYXNzYW5kbyBhcGVuYXMgYXMgbGl0ZXJhaXMgcXVlIGRlc2VqYSBjdXN0b21pemFyOlxuICAgKlxuICAgKiBgYGBcbiAgICogIGNvbnN0IGN1c3RvbUxpdGVyYWxzOiBUaGZVcGxvYWRMaXRlcmFscyA9IHtcbiAgICogICAgZGVsZXRlRmlsZTogJ0RlbGV0YXInXG4gICAqICB9O1xuICAgKiBgYGBcbiAgICpcbiAgICogRSBwYXJhIGNhcnJlZ2FyIGFzIGxpdGVyYWlzIGN1c3RvbWl6YWRhcywgYmFzdGEgYXBlbmFzIHBhc3NhciBvIG9iamV0byBwYXJhIG8gY29tcG9uZW50ZTpcbiAgICpcbiAgICogYGBgXG4gICAqIDx0aGYtdXBsb2FkXG4gICAqICAgW3QtbGl0ZXJhbHNdPVwiY3VzdG9tTGl0ZXJhbHNcIj5cbiAgICogPC90aGYtdXBsb2FkPlxuICAgKiBgYGBcbiAgICpcbiAgICogPiBPIG9iamV0byBwYWRyw6NvIGRlIGxpdGVyYWlzIHNlcsOhIHRyYWR1emlkbyBkZSBhY29yZG8gY29tIG8gaWRpb21hIGRvICpicm93c2VyKiAocHQsIGVuLCBlcykuXG4gICAqL1xuICBASW5wdXQoJ3QtbGl0ZXJhbHMnKSBzZXQgbGl0ZXJhbHModmFsdWU6IFRoZlVwbG9hZExpdGVyYWxzKSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIHRoaXMuX2xpdGVyYWxzID0ge1xuICAgICAgICAuLi50aGZVcGxvYWRMaXRlcmFsc0RlZmF1bHRbdGhmTG9jYWxlRGVmYXVsdF0sXG4gICAgICAgIC4uLnRoZlVwbG9hZExpdGVyYWxzRGVmYXVsdFticm93c2VyTGFuZ3VhZ2UoKV0sXG4gICAgICAgIC4uLnZhbHVlXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saXRlcmFscyA9IHRoZlVwbG9hZExpdGVyYWxzRGVmYXVsdFticm93c2VyTGFuZ3VhZ2UoKV07XG4gICAgfVxuICB9XG4gIGdldCBsaXRlcmFscygpIHtcbiAgICByZXR1cm4gdGhpcy5fbGl0ZXJhbHMgfHwgdGhmVXBsb2FkTGl0ZXJhbHNEZWZhdWx0W2Jyb3dzZXJMYW5ndWFnZSgpXTtcbiAgfVxuXG4gIC8qKiBUZXh0byBkZSBhcG9pbyBwYXJhIG8gY2FtcG8uICovXG4gIEBJbnB1dCgndC1oZWxwJykgaGVscD86IHN0cmluZztcblxuICAvKiogVVJMIHF1ZSBkZXZlIHNlciBmZWl0YSBhIHJlcXVpc2nDp8OjbyBjb20gb3MgYXJxdWl2b3Mgc2VsZWNpb25hZG9zLiAqL1xuICBASW5wdXQoJ3QtdXJsJykgdXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogT2JqZXRvIHF1ZSBzZWd1ZSBhIGRlZmluacOnw6NvIGRhIGludGVyZmFjZSBgVGhmRmlsZVJlc3RyaWN0aW9uc2AsXG4gICAqIHF1ZSBwb3NzaWJpbGl0YSBkZWZpbmlyIHRhbWFuaG8gbcOheGltby9tw61uaW1vIGUgZXh0ZW5zw6NvIGRvcyBhcnF1aXZvcyBwZXJtaXRpZG9zLlxuICAgKi9cbiAgQElucHV0KCd0LXJlc3RyaWN0aW9ucycpIHNldCBmaWxlUmVzdHJpY3Rpb25zKHJlc3RyaWN0aW9uczogVGhmVXBsb2FkRmlsZVJlc3RyaWN0aW9ucykge1xuICAgIHRoaXMuX2ZpbGVSZXN0cmljdGlvbnMgPSByZXN0cmljdGlvbnM7XG5cbiAgICB0aGlzLnNldEFsbG93ZWRFeHRlbnNpb25zKHJlc3RyaWN0aW9ucyk7XG4gIH1cblxuICBnZXQgZmlsZVJlc3RyaWN0aW9ucygpOiBUaGZVcGxvYWRGaWxlUmVzdHJpY3Rpb25zIHtcbiAgICByZXR1cm4gdGhpcy5fZmlsZVJlc3RyaWN0aW9ucztcbiAgfVxuXG4gIC8qKiBEZWZpbmUgbyB2YWxvciBkbyBhdHJpYnV0byBgbmFtZWAgZG8gY29tcG9uZW50ZS4gKi9cbiAgQElucHV0KCduYW1lJykgbmFtZTogc3RyaW5nID0gJ2ZpbGUnO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE5vbWUgZG8gY2FtcG8gZGUgZm9ybXVsw6FyaW8gcXVlIHNlcsOhIGVudmlhZG8gcGFyYSBvIHNlcnZpw6dvIGluZm9ybWFkbyBuYSBwcm9wcmllZGFkZSBgdC11cmxgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmlsZXNgXG4gICAqL1xuICBASW5wdXQoJ3QtZm9ybS1maWVsZCcpIHNldCBmb3JtRmllbGQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuX2Zvcm1GaWVsZCA9IHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB2YWx1ZSA6IHRoZlVwbG9hZEZvcm1GaWVsZERlZmF1bHQ7XG5cbiAgICB0aGlzLmdldFVwbG9hZFNlcnZpY2UoKS5mb3JtRmllbGQgPSB0aGlzLmZvcm1GaWVsZDtcbiAgfVxuXG4gIGdldCBmb3JtRmllbGQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fZm9ybUZpZWxkO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSW5kaWNhIHF1ZSBvIGNhbXBvIHNlcsOhIGRlc2FiaWxpdGFkby5cbiAgICovXG4gIEBJbnB1dCgndC1kaXNhYmxlZCcpIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2Rpc2FibGVkID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwodGhpcy5jdXJyZW50RmlsZXMpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBvIGVudmlvIGRvIGFycXVpdm8gc2Vyw6EgYXV0b23DoXRpY28gYW8gc2VsZWNpb25hciBvIG1lc21vLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3QtYXV0by11cGxvYWQnKSBhdXRvVXBsb2FkPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBwb2RlIHNlbGVjaW9uYXIgbWFpcyBkZSB1bSBhcnF1aXZvLlxuICAgKi9cbiAgQElucHV0KCd0LW11bHRpcGxlJykgaXNNdWx0aXBsZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIHNlIGEgaW5kaWNhw6fDo28gZGUgY2FtcG8gb3BjaW9uYWwgc2Vyw6EgZXhpYmlkYS5cbiAgICpcbiAgICogPiBOw6NvIHNlcsOhIGV4aWJpZGEgYSBpbmRpY2HDp8OjbyBzZTpcbiAgICogIC0gTyBjYW1wbyBjb250ZXIgYHQtcmVxdWlyZWRgO1xuICAgKiAgLSBOw6NvIHBvc3N1aXIgYHQtaGVscGAgZS9vdSBgdC1sYWJlbGAuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgndC1vcHRpb25hbCcpIG9wdGlvbmFsOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBxdWUgbyBjYW1wbyBzZXLDoSBvYnJpZ2F0w7NyaW8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgndC1yZXF1aXJlZCcpIHNldCByZXF1aXJlZChyZXF1aXJlZDogYm9vbGVhbikge1xuICAgIHRoaXMuX3JlcXVpcmVkID0gY29udmVydFRvQm9vbGVhbihyZXF1aXJlZCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwodGhpcy5jdXJyZW50RmlsZXMpO1xuICB9XG5cbiAgZ2V0IHJlcXVpcmVkKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1aXJlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW7Dp8OjbyBxdWUgc2Vyw6EgZXhlY3V0YWRhIG5vIG1vbWVudG8gZGUgcmVhbGl6YXIgbyBlbnZpbyBkbyBhcnF1aXZvLFxuICAgKiBvbmRlIHNlcsOhIHBvc3PDrXZlbCBhZGljaW9uYXIgaW5mb3JtYcOnw7VlcyBhbyBwYXLDom1ldHJvIHF1ZSBzZXLDoSBlbnZpYWRvIG5hIHJlcXVpc2nDp8Ojby5cbiAgICogw4kgcGFzc2FkbyBwb3IgcGFyw6JtZXRybyB1bSBvYmpldG8gY29tIG8gYXJxdWl2byBlIGEgcHJvcGllZGFkZSBkYXRhIG5lc3RhIHByb3ByaWVkYWRlIHBvZGUgc2VyIGluZm9ybWFkbyBhbGd1bSBkYWRvLFxuICAgKiBxdWUgc2Vyw6EgZW52aWFkbyBlbSBjb25qdW50byBjb20gbyBhcnF1aXZvIG5hIHJlcXVpc2nDp8OjbywgcG9yIGV4ZW1wbG86XG4gICAqXG4gICAqIGBgYFxuICAgKiAgIGV2ZW50LmRhdGEgPSB7aWQ6ICdpZCBkbyB1c3VhcmlvJ307XG4gICAqIGBgYFxuICAgKi9cbiAgQE91dHB1dCgndC11cGxvYWQnKSBvblVwbG9hZD86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqXG4gICAqIEV2ZW50byBzZXLDoSBkaXNwYXJhZG8gcXVhbmRvIG9jb3JyZXIgYWxndW0gZXJybyBubyBlbnZpbyBkbyBhcnF1aXZvLlxuICAgKiA+IFBvciBwYXLDom1ldHJvIHNlcsOhIHBhc3NhZG8gbyBvYmpldG8gZG8gcmV0b3JubyBxdWUgw6kgZG8gdGlwbyBgSHR0cEVycm9yUmVzcG9uc2VgLlxuICAgKi9cbiAgQE91dHB1dCgndC1lcnJvcicpIG9uRXJyb3I/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKlxuICAgKiBFdmVudG8gc2Vyw6EgZGlzcGFyYWRvIHF1YW5kbyBvIGVudmlvIGRvIGFycXVpdm8gZm9yIHJlYWxpemFkbyBjb20gc3VjZXNzby5cbiAgICogPiBQb3IgcGFyw6JtZXRybyBzZXLDoSBwYXNzYWRvIG8gb2JqZXRvIGRvIHJldG9ybm8gcXVlIMOpIGRvIHRpcG8gYEh0dHBSZXNwb25zZWAuXG4gICAqL1xuICBAT3V0cHV0KCd0LXN1Y2Nlc3MnKSBvblN1Y2Nlc3M/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8vIEZ1bsOnw6NvIHBhcmEgYXR1YWxpemFyIG8gbmdNb2RlbCBkbyBjb21wb25lbnRlLCBuZWNlc3PDoXJpbyBxdWFuZG8gbsOjbyBmb3IgdXRpbGl6YWRvIGRlbnRybyBkYSAqdGFnKiBgZm9ybWAuXG4gIEBPdXRwdXQoJ25nTW9kZWxDaGFuZ2UnKSBuZ01vZGVsQ2hhbmdlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgdXBsb2FkU2VydmljZTogVGhmVXBsb2FkU2VydmljZSkgeyB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbk1vZGVsVG91Y2hlZCA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZShmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICB2YWxpZGF0ZShhYnN0cmFjdENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55OyB9IHtcblxuICAgIGlmIChyZXF1aXJlZEZhaWxlZCh0aGlzLnJlcXVpcmVkLCB0aGlzLmRpc2FibGVkLCBhYnN0cmFjdENvbnRyb2wudmFsdWUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXF1aXJlZDoge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgfVxuXG4gIHdyaXRlVmFsdWUobW9kZWw6IGFueSk6IHZvaWQge1xuICAgIGlmIChtb2RlbCkge1xuICAgICAgaWYgKCFpc0VxdWFscyh0aGlzLmN1cnJlbnRGaWxlcywgbW9kZWwpKSB7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50RmlsZXMgPSB0aGlzLnBhcnNlRmlsZXMobW9kZWwpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG5cbiAgICAgIHRoaXMuY3VycmVudEZpbGVzID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBpc0V4Y2VlZGVkRmlsZUxpbWl0KGN1cnJlbnRGaWxlc0xlbmd0aDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNNdWx0aXBsZSAmJlxuICAgICAgdGhpcy5maWxlUmVzdHJpY3Rpb25zICYmXG4gICAgICB0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZXMgPiAwICYmXG4gICAgICB0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZXMgPD0gY3VycmVudEZpbGVzTGVuZ3RoO1xuICB9XG5cbiAgLy8gRmF6IG8gcGFyc2UgZG9zIGFycXVpdm9zIHNlbGVjaW9uYWRvcyBwYXJhIGFycXVpdm9zIGRvIGZvcm1hdG8gVGhmVXBsb2FkRmlsZSBlIGF0dWFsaXphIG9zIGFycXVpdm9zIGNvcnJlbnRlcy5cbiAgcHJvdGVjdGVkIHBhcnNlRmlsZXMoZmlsZXM6IEFycmF5PEZpbGU+KTogQXJyYXk8VGhmVXBsb2FkRmlsZT4ge1xuICAgIGxldCB0aGZVcGxvYWRGaWxlczogQXJyYXk8VGhmVXBsb2FkRmlsZT4gPSB0aGlzLmN1cnJlbnRGaWxlcyB8fCBbXTtcbiAgICBjb25zdCBmaWxlc0xlbmd0aCA9IGZpbGVzLmxlbmd0aDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXNMZW5ndGg7IGkrKykge1xuXG4gICAgICBpZiAodGhpcy5pc0V4Y2VlZGVkRmlsZUxpbWl0KHRoZlVwbG9hZEZpbGVzLmxlbmd0aCkpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgVGhmVXBsb2FkRmlsZShmaWxlc1tpXSk7XG5cbiAgICAgIGlmICh0aGlzLmNoZWNrUmVzdHJpY3Rpb25zKGZpbGUpKSB7XG4gICAgICAgIHRoZlVwbG9hZEZpbGVzID0gdGhpcy5pbnNlcnRGaWxlSW5GaWxlcyhmaWxlLCB0aGZVcGxvYWRGaWxlcyk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gdGhmVXBsb2FkRmlsZXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGVNb2RlbChtb2RlbDogYW55KSB7XG4gICAgaWYgKHRoaXMudmFsaWRhdG9yQ2hhbmdlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRvckNoYW5nZShtb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgLy8gVmVyaWZpY2Egc2UgbyBhcnF1aXZvIGVzdMOhIGRlIGFjb3JkbyBjb20gYXMgcmVzdHJpw6fDtWVzLlxuICBwcml2YXRlIGNoZWNrUmVzdHJpY3Rpb25zKGZpbGU6IFRoZlVwbG9hZEZpbGUpOiBib29sZWFuIHtcbiAgICBjb25zdCByZXN0cmljdGlvbnMgPSB0aGlzLmZpbGVSZXN0cmljdGlvbnM7XG5cbiAgICBpZiAocmVzdHJpY3Rpb25zKSB7XG4gICAgICBjb25zdCBhbGxvd2VkRXh0ZW5zaW9ucyA9IHJlc3RyaWN0aW9ucy5hbGxvd2VkRXh0ZW5zaW9ucztcbiAgICAgIGNvbnN0IG1pbkZpbGVTaXplID0gcmVzdHJpY3Rpb25zLm1pbkZpbGVTaXplIHx8IDA7XG4gICAgICBjb25zdCBtYXhGaWxlU2l6ZSA9IHJlc3RyaWN0aW9ucy5tYXhGaWxlU2l6ZSB8fCAzMTQ1NzI4MDsgLy8gMzBNQlxuXG4gICAgICBjb25zdCBpc0FjY2VwdCA9IGFsbG93ZWRFeHRlbnNpb25zID8gdGhpcy5pc0FsbG93ZWRFeHRlbnNpb24oZmlsZS5leHRlbnNpb24sIGFsbG93ZWRFeHRlbnNpb25zKSA6IHRydWU7XG4gICAgICBjb25zdCBpc0FjY2VwdFNpemUgPSBmaWxlLnNpemUgPj0gbWluRmlsZVNpemUgJiYgZmlsZS5zaXplIDw9IG1heEZpbGVTaXplO1xuXG4gICAgICByZXR1cm4gaXNBY2NlcHQgJiYgaXNBY2NlcHRTaXplO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBleGlzdHNGaWxlU2FtZU5hbWUoZmlsZTogVGhmVXBsb2FkRmlsZSwgZmlsZXM6IEFycmF5PFRoZlVwbG9hZEZpbGU+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZpbGVzLnNvbWUoY3VycmVudEZpbGUgPT4gZmlsZS5uYW1lID09PSBjdXJyZW50RmlsZS5uYW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VXBsb2FkU2VydmljZSgpOiBUaGZVcGxvYWRTZXJ2aWNlIHtcbiAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlO1xuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnRGaWxlSW5GaWxlcyhuZXdGaWxlOiBUaGZVcGxvYWRGaWxlLCBmaWxlczogQXJyYXk8VGhmVXBsb2FkRmlsZT4pIHtcblxuICAgIGlmICh0aGlzLmV4aXN0c0ZpbGVTYW1lTmFtZShuZXdGaWxlLCBmaWxlcykpIHtcblxuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlRXhpc3RzRmlsZUluRmlsZXMobmV3RmlsZSwgZmlsZXMpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzTXVsdGlwbGUpIHtcblxuICAgICAgZmlsZXMucHVzaChuZXdGaWxlKTtcbiAgICB9IGVsc2Uge1xuXG4gICAgICBmaWxlcy5zcGxpY2UoMCwgZmlsZXMubGVuZ3RoLCBuZXdGaWxlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsZXM7XG4gIH1cblxuICBwcml2YXRlIGlzQWxsb3dlZEV4dGVuc2lvbihleHRlbnNpb246IHN0cmluZywgYWxsb3dlZEV4dGVuc2lvbnM6IEFycmF5PHN0cmluZz4gPSBbXSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBhbGxvd2VkRXh0ZW5zaW9ucy5zb21lKGV4dCA9PiBleHQudG9Mb3dlckNhc2UoKSA9PT0gZXh0ZW5zaW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWxsb3dlZEV4dGVuc2lvbnMocmVzdHJpY3Rpb25zOiBUaGZVcGxvYWRGaWxlUmVzdHJpY3Rpb25zID0ge30pIHtcbiAgICBjb25zdCBfYWxsb3dlZEV4dGVuc2lvbnMgPSByZXN0cmljdGlvbnMuYWxsb3dlZEV4dGVuc2lvbnMgfHwgW107XG5cbiAgICB0aGlzLmFsbG93ZWRFeHRlbnNpb25zID0gX2FsbG93ZWRFeHRlbnNpb25zLmpvaW4oJywnKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRXhpc3RzRmlsZUluRmlsZXMobmV3RmlsZTogVGhmVXBsb2FkRmlsZSwgZmlsZXM6IEFycmF5PFRoZlVwbG9hZEZpbGU+KSB7XG4gICAgY29uc3QgZmlsZUluZGV4ID0gZmlsZXMuZmluZEluZGV4KGN1cnJlbnRGaWxlID0+IG5ld0ZpbGUubmFtZSA9PT0gY3VycmVudEZpbGUubmFtZSAmJiBjdXJyZW50RmlsZS5zdGF0dXMgIT09IFRoZlVwbG9hZFN0YXR1cy5VcGxvYWRlZCk7XG5cbiAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xuICAgICAgZmlsZXMuc3BsaWNlKGZpbGVJbmRleCwgMSwgbmV3RmlsZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZpbGVzO1xuICB9XG5cbn1cbiJdfQ==