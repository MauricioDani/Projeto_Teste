/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean, convertToInt } from './../../../utils/util';
import { requiredFailed } from '../validators';
/** @type {?} */
const thfCheckboxGroupColumnsDefaultLength = 6;
/** @type {?} */
const thfCheckboxGroupColumnsTotalLength = 12;
/**
 * \@description
 *
 * O componente `thf-checkbox-group` exibe uma lista de múltipla escolha onde o usuário pode marcar e desmarcar,
 * utilizando a tecla de espaço ou o clique do mouse, várias opções.
 *
 * > Para seleção única, utilize o [**Totvs Radio Group**](/documentation/thf-radio-group).
 *
 * Por padrão, o thf-checkbox-group retorna um array com os valores dos itens selecionados para o model.
 *
 * ```
 * favorites = ['THF', 'Angular'];
 * ```
 *
 * Na maioria das situações, o array com os objetos setados já atende as necessidades mas, caso o desenvolvedor
 * tenha necessidade de usar um valor indeterminado (`null`), ou seja, nem marcado (`true`) e nem desmarcado (`false`),
 * deve setar a propriedade `t-indeterminate` como `true`.
 *
 * Nesse caso, o thf-checkbox-group vai retornar um objeto com todas as opções disponíveis e seus valores.
 *
 * ```
 * favorites = {
 *  THF: true,
 *  Angular: true,
 *  VueJS: false,
 *  React: null // indeterminado
 * };
 * ```
 */
export class ThfCheckboxGroupBaseComponent {
    constructor() {
        this.checkedOptions = {};
        this.checkedOptionsList = [];
        this.mdColumns = thfCheckboxGroupColumnsDefaultLength;
        this._columns = thfCheckboxGroupColumnsDefaultLength;
        this._disabled = false;
        this._indeterminate = false;
        this._required = false;
        // Função para atualizar o `ngModel` do componente, necessário quando não for utilizado dentro da tag form.
        this.ngModelChange = new EventEmitter();
        /**
         * Evento disparado ao alterar valor do campo
         */
        this.change = new EventEmitter();
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
     * - É possível exibir as opções entre `1` e `4` colunas.
     * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
     * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
     * o *grid system* será composto por `2` colunas.
     *
     * \@default `2`
     *
     * @param {?} value
     * @return {?}
     */
    set columns(value) {
        /** @type {?} */
        const columns = convertToInt(value, thfCheckboxGroupColumnsDefaultLength);
        this._columns = this.getGridSystemColumns(columns, 4);
        this.mdColumns = this.getGridSystemColumns(columns, 2);
    }
    /**
     * @return {?}
     */
    get columns() {
        return this._columns;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Desabilita todos os itens do checkbox.
     *
     * \@default `false`
     * @param {?} value
     * @return {?}
     */
    set disabled(value) {
        this._disabled = convertToBoolean(value);
        this.validateModel(this.checkIndeterminate());
    }
    /**
     * @return {?}
     */
    get disabled() {
        return this._disabled;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
     * a propriedade `t-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
     *
     * Quando essa propriedade é setada como `true`, o *thf-checkbox-group* passa a devolver um objeto completo para o
     * `ngModel`, diferente do array que contém apenas os valores selecionados.
     *
     * \@default `false`
     * @param {?} indeterminate
     * @return {?}
     */
    set indeterminate(indeterminate) {
        this._indeterminate = convertToBoolean(indeterminate);
    }
    /**
     * @return {?}
     */
    get indeterminate() {
        return this._indeterminate;
    }
    /**
     * \@optional
     *
     * \@description
     * Lista de opções que serão exibidas
     * Nesta propriedade deve ser definido um array de objetos que implementam a interface ThfCheckboxGroupOption
     * @param {?} value
     * @return {?}
     */
    set options(value) {
        this._options = Array.isArray(value) ? value : [];
        this.removeDuplicatedOptions();
    }
    /**
     * @return {?}
     */
    get options() {
        return this._options;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Define que o campo será obrigatório.
     *
     * \@default `false`
     * @param {?} required
     * @return {?}
     */
    set required(required) {
        this._required = convertToBoolean(required);
        this.validateModel(this.checkIndeterminate());
    }
    /**
     * @return {?}
     */
    get required() {
        return this._required;
    }
    /**
     * @return {?}
     */
    changeValue() {
        /** @type {?} */
        const value = this.checkIndeterminate();
        if (this.propagateChange) {
            this.propagateChange(value);
        }
        else {
            this.ngModelChange.emit(value);
        }
        this.change.emit(value);
    }
    /**
     * @return {?}
     */
    checkIndeterminate() {
        return this.indeterminate ? this.checkedOptions : this.checkedOptionsList;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    checkOption(value) {
        if (!this._disabled && !value.disabled) {
            this.checkOptionModel(value);
            this.changeValue();
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.propagateChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) { }
    /**
     * @param {?} optionsModel
     * @return {?}
     */
    writeValue(optionsModel) {
        if (optionsModel && this.checkedOptions !== optionsModel) {
            this.generateCheckOptions(optionsModel);
        }
        else {
            this.checkedOptionsList = [];
            this.checkedOptions = {};
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnValidatorChange(fn) {
        this.validatorChange = fn;
    }
    /**
     * @param {?} abstractControl
     * @return {?}
     */
    validate(abstractControl) {
        if ((!this.indeterminate && requiredFailed(this.required, this.disabled, abstractControl.value)) || this.isInvalidIndeterminate()) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    }
    /**
     * @protected
     * @param {?} model
     * @return {?}
     */
    validateModel(model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    }
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    checkColumnsRange(columns, maxColumns) {
        /** @type {?} */
        const minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    }
    /**
     * @private
     * @param {?} optionChecked
     * @return {?}
     */
    checkOptionModel(optionChecked) {
        this.checkedOptions[optionChecked.value] = !this.checkedOptions[optionChecked.value];
        if (!this.indeterminate && this.checkedOptionsList.includes(optionChecked.value)) {
            this.checkedOptionsList.splice(this.checkedOptionsList.indexOf(optionChecked.value), 1);
        }
        else if (!this.indeterminate) {
            this.checkedOptionsList.push(optionChecked.value);
        }
    }
    /**
     * @private
     * @param {?} optionsModel
     * @return {?}
     */
    generateCheckOptions(optionsModel) {
        this.checkedOptions = {};
        if (optionsModel instanceof Array) {
            this.checkedOptionsList = optionsModel;
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            (option) => {
                this.checkedOptions[option.value] = optionsModel.includes(option.value);
            }));
        }
        else {
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            (option) => {
                optionsModel[option.value] = optionsModel[option.value] === undefined ? false : optionsModel[option.value];
                this.checkedOptions = optionsModel;
            }));
        }
    }
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    getGridSystemColumns(columns, maxColumns) {
        /** @type {?} */
        const gridSystemColumns = thfCheckboxGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : thfCheckboxGroupColumnsDefaultLength;
    }
    /**
     * @private
     * @return {?}
     */
    isInvalidIndeterminate() {
        if (this.indeterminate && this.required && this.checkedOptions) {
            return ((/** @type {?} */ (Object))).values(this.checkedOptions).every((/**
             * @param {?} value
             * @return {?}
             */
            value => value === false));
        }
        return false;
    }
    /**
     * @private
     * @return {?}
     */
    removeDuplicatedOptions() {
        this.options.forEach((/**
         * @param {?} option
         * @param {?} index
         * @return {?}
         */
        (option, index) => {
            /** @type {?} */
            const duplicatedIndex = this.options.findIndex((/**
             * @param {?} optionFind
             * @return {?}
             */
            (optionFind) => optionFind.value === option.value)) === index;
            if (!duplicatedIndex) {
                this.options.splice(this.options.indexOf(option), 1);
            }
        }));
    }
}
ThfCheckboxGroupBaseComponent.propDecorators = {
    name: [{ type: Input, args: ['name',] }],
    columns: [{ type: Input, args: ['t-columns',] }],
    disabled: [{ type: Input, args: ['t-disabled',] }],
    help: [{ type: Input, args: ['t-help',] }],
    indeterminate: [{ type: Input, args: ['t-indeterminate',] }],
    label: [{ type: Input, args: ['t-label',] }],
    optional: [{ type: Input, args: ['t-optional',] }],
    options: [{ type: Input, args: ['t-options',] }],
    required: [{ type: Input, args: ['t-required',] }],
    ngModelChange: [{ type: Output, args: ['ngModelChange',] }],
    change: [{ type: Output, args: ['t-change',] }]
};
if (false) {
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.checkedOptions;
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.checkedOptionsList;
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.mdColumns;
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.propagateChange;
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.validatorChange;
    /**
     * @type {?}
     * @private
     */
    ThfCheckboxGroupBaseComponent.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    ThfCheckboxGroupBaseComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    ThfCheckboxGroupBaseComponent.prototype._indeterminate;
    /**
     * @type {?}
     * @private
     */
    ThfCheckboxGroupBaseComponent.prototype._options;
    /**
     * @type {?}
     * @private
     */
    ThfCheckboxGroupBaseComponent.prototype._required;
    /**
     * Nome dos checkboxes
     * @type {?}
     */
    ThfCheckboxGroupBaseComponent.prototype.name;
    /**
     * Texto de apoio do campo
     * @type {?}
     */
    ThfCheckboxGroupBaseComponent.prototype.help;
    /**
     * Label do campo
     * @type {?}
     */
    ThfCheckboxGroupBaseComponent.prototype.label;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se a indicação de campo opcional será exibida.
     *
     * > Não será exibida a indicação se:
     * - O campo conter `t-required`;
     * - Não possuir `t-help` e/ou `t-label`.
     *
     * \@default `false`
     * @type {?}
     */
    ThfCheckboxGroupBaseComponent.prototype.optional;
    /** @type {?} */
    ThfCheckboxGroupBaseComponent.prototype.ngModelChange;
    /**
     * Evento disparado ao alterar valor do campo
     * @type {?}
     */
    ThfCheckboxGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1maWVsZC90aGYtY2hlY2tib3gtZ3JvdXAvdGhmLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFNUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7O01BSXpDLG9DQUFvQyxHQUFXLENBQUM7O01BQ2hELGtDQUFrQyxHQUFXLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQStCckQsTUFBTSxPQUFPLDZCQUE2QjtJQUExQztRQUVFLG1CQUFjLEdBQVEsRUFBRSxDQUFDO1FBQ3pCLHVCQUFrQixHQUFRLEVBQUUsQ0FBQztRQUM3QixjQUFTLEdBQVcsb0NBQW9DLENBQUM7UUFJakQsYUFBUSxHQUFXLG9DQUFvQyxDQUFDO1FBQ3hELGNBQVMsR0FBYSxLQUFLLENBQUM7UUFDNUIsbUJBQWMsR0FBYSxLQUFLLENBQUM7UUFFakMsY0FBUyxHQUFhLEtBQUssQ0FBQzs7UUErSFgsa0JBQWEsR0FBdUIsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7OztRQUdqRSxXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7SUF3SDNFLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBdk9DLElBQXdCLE9BQU8sQ0FBQyxLQUFhOztjQUNyQyxPQUFPLEdBQUcsWUFBWSxDQUFDLEtBQUssRUFBRSxvQ0FBb0MsQ0FBQztRQUV6RSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxP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QkFrQmpCLEtBQUssU0FBQyxZQUFZOzRCQVdsQixNQUFNLFNBQUMsZUFBZTtxQkFHdEIsTUFBTSxTQUFDLFVBQVU7Ozs7SUE1SWxCLHVEQUF5Qjs7SUFDekIsMkRBQTZCOztJQUM3QixrREFBeUQ7O0lBQ3pELHdEQUFxQjs7SUFDckIsd0RBQXFCOzs7OztJQUVyQixpREFBZ0U7Ozs7O0lBQ2hFLGtEQUFvQzs7Ozs7SUFDcEMsdURBQXlDOzs7OztJQUN6QyxpREFBaUQ7Ozs7O0lBQ2pELGtEQUFvQzs7Ozs7SUFHcEMsNkNBQTRCOzs7OztJQStDNUIsNkNBQStCOzs7OztJQXdCL0IsOENBQWlDOzs7Ozs7Ozs7Ozs7Ozs7SUFlakMsaURBQXVDOztJQXNDdkMsc0RBQXFGOzs7OztJQUdyRiwrQ0FBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgY29udmVydFRvQm9vbGVhbiwgY29udmVydFRvSW50IH0gZnJvbSAnLi8uLi8uLi8uLi91dGlscy91dGlsJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFRoZkNoZWNrYm94R3JvdXBPcHRpb24gfSBmcm9tICcuL3RoZi1jaGVja2JveC1ncm91cC1vcHRpb24uaW50ZXJmYWNlJztcblxuY29uc3QgdGhmQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoOiBudW1iZXIgPSA2O1xuY29uc3QgdGhmQ2hlY2tib3hHcm91cENvbHVtbnNUb3RhbExlbmd0aDogbnVtYmVyID0gMTI7XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogTyBjb21wb25lbnRlIGB0aGYtY2hlY2tib3gtZ3JvdXBgIGV4aWJlIHVtYSBsaXN0YSBkZSBtw7psdGlwbGEgZXNjb2xoYSBvbmRlIG8gdXN1w6FyaW8gcG9kZSBtYXJjYXIgZSBkZXNtYXJjYXIsXG4gKiB1dGlsaXphbmRvIGEgdGVjbGEgZGUgZXNwYcOnbyBvdSBvIGNsaXF1ZSBkbyBtb3VzZSwgdsOhcmlhcyBvcMOnw7Vlcy5cbiAqXG4gKiA+IFBhcmEgc2VsZcOnw6NvIMO6bmljYSwgdXRpbGl6ZSBvIFsqKlRvdHZzIFJhZGlvIEdyb3VwKipdKC9kb2N1bWVudGF0aW9uL3RoZi1yYWRpby1ncm91cCkuXG4gKlxuICogUG9yIHBhZHLDo28sIG8gdGhmLWNoZWNrYm94LWdyb3VwIHJldG9ybmEgdW0gYXJyYXkgY29tIG9zIHZhbG9yZXMgZG9zIGl0ZW5zIHNlbGVjaW9uYWRvcyBwYXJhIG8gbW9kZWwuXG4gKlxuICogYGBgXG4gKiBmYXZvcml0ZXMgPSBbJ1RIRicsICdBbmd1bGFyJ107XG4gKiBgYGBcbiAqXG4gKiBOYSBtYWlvcmlhIGRhcyBzaXR1YcOnw7VlcywgbyBhcnJheSBjb20gb3Mgb2JqZXRvcyBzZXRhZG9zIGrDoSBhdGVuZGUgYXMgbmVjZXNzaWRhZGVzIG1hcywgY2FzbyBvIGRlc2Vudm9sdmVkb3JcbiAqIHRlbmhhIG5lY2Vzc2lkYWRlIGRlIHVzYXIgdW0gdmFsb3IgaW5kZXRlcm1pbmFkbyAoYG51bGxgKSwgb3Ugc2VqYSwgbmVtIG1hcmNhZG8gKGB0cnVlYCkgZSBuZW0gZGVzbWFyY2FkbyAoYGZhbHNlYCksXG4gKiBkZXZlIHNldGFyIGEgcHJvcHJpZWRhZGUgYHQtaW5kZXRlcm1pbmF0ZWAgY29tbyBgdHJ1ZWAuXG4gKlxuICogTmVzc2UgY2FzbywgbyB0aGYtY2hlY2tib3gtZ3JvdXAgdmFpIHJldG9ybmFyIHVtIG9iamV0byBjb20gdG9kYXMgYXMgb3DDp8O1ZXMgZGlzcG9uw612ZWlzIGUgc2V1cyB2YWxvcmVzLlxuICpcbiAqIGBgYFxuICogZmF2b3JpdGVzID0ge1xuICogIFRIRjogdHJ1ZSxcbiAqICBBbmd1bGFyOiB0cnVlLFxuICogIFZ1ZUpTOiBmYWxzZSxcbiAqICBSZWFjdDogbnVsbCAvLyBpbmRldGVybWluYWRvXG4gKiB9O1xuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBUaGZDaGVja2JveEdyb3VwQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3Ige1xuXG4gIGNoZWNrZWRPcHRpb25zOiBhbnkgPSB7fTtcbiAgY2hlY2tlZE9wdGlvbnNMaXN0OiBhbnkgPSBbXTtcbiAgbWRDb2x1bW5zOiBudW1iZXIgPSB0aGZDaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByb3BhZ2F0ZUNoYW5nZTogYW55O1xuICB2YWxpZGF0b3JDaGFuZ2U6IGFueTtcblxuICBwcml2YXRlIF9jb2x1bW5zOiBudW1iZXIgPSB0aGZDaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByaXZhdGUgX2Rpc2FibGVkPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9pbmRldGVybWluYXRlPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9vcHRpb25zPzogQXJyYXk8VGhmQ2hlY2tib3hHcm91cE9wdGlvbj47XG4gIHByaXZhdGUgX3JlcXVpcmVkPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKiBOb21lIGRvcyBjaGVja2JveGVzICovXG4gIEBJbnB1dCgnbmFtZScpIG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBQb3NzaWJpbGl0YSBkZWZpbmlyIGEgcXVhbnRpZGFkZSBkZSBjb2x1bmFzIHBhcmEgZXhpYmnDp8OjbyBkb3MgaXRlbnMgZG8gKmNoZWNrYm94Ki5cbiAgICogLSDDiSBwb3Nzw612ZWwgZXhpYmlyIGFzIG9ww6fDtWVzIGVudHJlIGAxYCBlIGA0YCBjb2x1bmFzLlxuICAgKiAtIFBhcmEgcmVzb2x1w6fDo28gYHNtYCBhIGNvbHVuYWdlbSBpbnZhcmlhdmVsbWVudGUgcGFzc2EgcGFyYSBgMWAgY29sdW5hLlxuICAgKiAtIFF1YW5kbyBzZSB0cmF0YSBkZSByZXNvbHXDp8OjbyBgbWRgIGUgbyB2YWxvciBlc3RhYmVsZWNpZG8gcGFyYSBjb2x1bmFzIGZvciBzdXBlcmlvciBhIGAyYCxcbiAgICogbyAqZ3JpZCBzeXN0ZW0qIHNlcsOhIGNvbXBvc3RvIHBvciBgMmAgY29sdW5hcy5cbiAgICpcbiAgICogQGRlZmF1bHQgYDJgXG4gICAqXG4gICAqL1xuICBASW5wdXQoJ3QtY29sdW1ucycpIHNldCBjb2x1bW5zKHZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBjb2x1bW5zID0gY29udmVydFRvSW50KHZhbHVlLCB0aGZDaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGgpO1xuXG4gICAgdGhpcy5fY29sdW1ucyA9IHRoaXMuZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1ucywgNCk7XG4gICAgdGhpcy5tZENvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDIpO1xuICB9XG5cbiAgZ2V0IGNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbHVtbnM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZXNhYmlsaXRhIHRvZG9zIG9zIGl0ZW5zIGRvIGNoZWNrYm94LlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3QtZGlzYWJsZWQnKSBzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCkpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuXG4gIC8qKiBUZXh0byBkZSBhcG9pbyBkbyBjYW1wbyAqL1xuICBASW5wdXQoJ3QtaGVscCcpIGhlbHA/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQ2FzbyBleGlzdGEgYSBuZWNlc3NpZGFkZSBkZSB1c2FyIG8gdmFsb3IgaW5kZXRlcm1pbmFkbyAoYG51bGxgKSBkZW50cm8gZGEgbGlzdGEgZGUgb3DDp8O1ZXMsIMOpIG5lY2Vzc8OhcmlvIHNldGFyXG4gICAqIGEgcHJvcHJpZWRhZGUgYHQtaW5kZXRlcm1pbmF0ZWAgY29tbyBgdHJ1ZWAsIHBvciBwYWRyw6NvIGVzc2EgcHJvcHJpZWRhZGUgdmVtIGRlc2FiaWxpdGFkYSAoYGZhbHNlYCkuXG4gICAqXG4gICAqIFF1YW5kbyBlc3NhIHByb3ByaWVkYWRlIMOpIHNldGFkYSBjb21vIGB0cnVlYCwgbyAqdGhmLWNoZWNrYm94LWdyb3VwKiBwYXNzYSBhIGRldm9sdmVyIHVtIG9iamV0byBjb21wbGV0byBwYXJhIG9cbiAgICogYG5nTW9kZWxgLCBkaWZlcmVudGUgZG8gYXJyYXkgcXVlIGNvbnTDqW0gYXBlbmFzIG9zIHZhbG9yZXMgc2VsZWNpb25hZG9zLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3QtaW5kZXRlcm1pbmF0ZScpIHNldCBpbmRldGVybWluYXRlKGluZGV0ZXJtaW5hdGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pbmRldGVybWluYXRlID0gY29udmVydFRvQm9vbGVhbihpbmRldGVybWluYXRlKTtcbiAgfVxuXG4gIGdldCBpbmRldGVybWluYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9pbmRldGVybWluYXRlO1xuICB9XG5cbiAgLyoqIExhYmVsIGRvIGNhbXBvICovXG4gIEBJbnB1dCgndC1sYWJlbCcpIGxhYmVsPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBzZSBhIGluZGljYcOnw6NvIGRlIGNhbXBvIG9wY2lvbmFsIHNlcsOhIGV4aWJpZGEuXG4gICAqXG4gICAqID4gTsOjbyBzZXLDoSBleGliaWRhIGEgaW5kaWNhw6fDo28gc2U6XG4gICAqIC0gTyBjYW1wbyBjb250ZXIgYHQtcmVxdWlyZWRgO1xuICAgKiAtIE7Do28gcG9zc3VpciBgdC1oZWxwYCBlL291IGB0LWxhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCd0LW9wdGlvbmFsJykgb3B0aW9uYWw6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogTGlzdGEgZGUgb3DDp8O1ZXMgcXVlIHNlcsOjbyBleGliaWRhc1xuICAgKiBOZXN0YSBwcm9wcmllZGFkZSBkZXZlIHNlciBkZWZpbmlkbyB1bSBhcnJheSBkZSBvYmpldG9zIHF1ZSBpbXBsZW1lbnRhbSBhIGludGVyZmFjZSBUaGZDaGVja2JveEdyb3VwT3B0aW9uXG4gICAqL1xuICBASW5wdXQoJ3Qtb3B0aW9ucycpIHNldCBvcHRpb25zKHZhbHVlOiBBcnJheTxUaGZDaGVja2JveEdyb3VwT3B0aW9uPikge1xuICAgIHRoaXMuX29wdGlvbnMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW107XG4gICAgdGhpcy5yZW1vdmVEdXBsaWNhdGVkT3B0aW9ucygpO1xuICB9XG5cbiAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgcXVlIG8gY2FtcG8gc2Vyw6Egb2JyaWdhdMOzcmlvLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3QtcmVxdWlyZWQnKSBzZXQgcmVxdWlyZWQocmVxdWlyZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9yZXF1aXJlZCA9IGNvbnZlcnRUb0Jvb2xlYW4ocmVxdWlyZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCkpO1xuICB9XG5cbiAgZ2V0IHJlcXVpcmVkKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1aXJlZDtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIHBhcmEgYXR1YWxpemFyIG8gYG5nTW9kZWxgIGRvIGNvbXBvbmVudGUsIG5lY2Vzc8OhcmlvIHF1YW5kbyBuw6NvIGZvciB1dGlsaXphZG8gZGVudHJvIGRhIHRhZyBmb3JtLlxuICBAT3V0cHV0KCduZ01vZGVsQ2hhbmdlJykgbmdNb2RlbENoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqIEV2ZW50byBkaXNwYXJhZG8gYW8gYWx0ZXJhciB2YWxvciBkbyBjYW1wbyAqL1xuICBAT3V0cHV0KCd0LWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY2hhbmdlVmFsdWUoKSB7XG5cbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCk7XG5cbiAgICBpZiAodGhpcy5wcm9wYWdhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ01vZGVsQ2hhbmdlLmVtaXQodmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlLmVtaXQodmFsdWUpO1xuICB9XG5cbiAgY2hlY2tJbmRldGVybWluYXRlKCkge1xuICAgIHJldHVybiB0aGlzLmluZGV0ZXJtaW5hdGUgPyB0aGlzLmNoZWNrZWRPcHRpb25zIDogdGhpcy5jaGVja2VkT3B0aW9uc0xpc3Q7XG4gIH1cblxuICBjaGVja09wdGlvbih2YWx1ZTogVGhmQ2hlY2tib3hHcm91cE9wdGlvbikge1xuICAgIGlmICghdGhpcy5fZGlzYWJsZWQgJiYgIXZhbHVlLmRpc2FibGVkKSB7XG4gICAgICB0aGlzLmNoZWNrT3B0aW9uTW9kZWwodmFsdWUpO1xuICAgICAgdGhpcy5jaGFuZ2VWYWx1ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7IH1cblxuICB3cml0ZVZhbHVlKG9wdGlvbnNNb2RlbDogYW55KSB7XG4gICAgaWYgKG9wdGlvbnNNb2RlbCAmJiB0aGlzLmNoZWNrZWRPcHRpb25zICE9PSBvcHRpb25zTW9kZWwpIHtcbiAgICAgIHRoaXMuZ2VuZXJhdGVDaGVja09wdGlvbnMob3B0aW9uc01vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QgPSBbXTtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSB7fTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uVmFsaWRhdG9yQ2hhbmdlKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy52YWxpZGF0b3JDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHZhbGlkYXRlKGFic3RyYWN0Q29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnk7IH0ge1xuXG4gICAgaWYgKCghdGhpcy5pbmRldGVybWluYXRlICYmIHJlcXVpcmVkRmFpbGVkKHRoaXMucmVxdWlyZWQsIHRoaXMuZGlzYWJsZWQsIGFic3RyYWN0Q29udHJvbC52YWx1ZSkpIHx8IHRoaXMuaXNJbnZhbGlkSW5kZXRlcm1pbmF0ZSgpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXF1aXJlZDoge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZU1vZGVsKG1vZGVsOiBhbnkpIHtcbiAgICBpZiAodGhpcy52YWxpZGF0b3JDaGFuZ2UpIHtcbiAgICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlKG1vZGVsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpOiBib29sZWFuIHtcbiAgICBjb25zdCBtaW5Db2x1bW5zID0gMTtcblxuICAgIHJldHVybiBjb2x1bW5zID49IG1pbkNvbHVtbnMgJiYgY29sdW1ucyA8PSBtYXhDb2x1bW5zO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja09wdGlvbk1vZGVsKG9wdGlvbkNoZWNrZWQ6IFRoZkNoZWNrYm94R3JvdXBPcHRpb24pIHtcbiAgICB0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbkNoZWNrZWQudmFsdWVdID0gIXRoaXMuY2hlY2tlZE9wdGlvbnNbb3B0aW9uQ2hlY2tlZC52YWx1ZV07XG5cbiAgICBpZiAoIXRoaXMuaW5kZXRlcm1pbmF0ZSAmJiB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5pbmNsdWRlcyhvcHRpb25DaGVja2VkLnZhbHVlKSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3Quc3BsaWNlKHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LmluZGV4T2Yob3B0aW9uQ2hlY2tlZC52YWx1ZSksIDEpO1xuXG4gICAgfSBlbHNlIGlmICghdGhpcy5pbmRldGVybWluYXRlKSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5wdXNoKG9wdGlvbkNoZWNrZWQudmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaGVja09wdGlvbnMob3B0aW9uc01vZGVsOiBhbnkpIHtcblxuICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSB7fTtcblxuICAgIGlmIChvcHRpb25zTW9kZWwgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QgPSBvcHRpb25zTW9kZWw7XG5cbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb246IFRoZkNoZWNrYm94R3JvdXBPcHRpb24pID0+IHtcbiAgICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc1tvcHRpb24udmFsdWVdID0gb3B0aW9uc01vZGVsLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbjogVGhmQ2hlY2tib3hHcm91cE9wdGlvbikgPT4ge1xuICAgICAgICBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXSA9IG9wdGlvbnNNb2RlbFtvcHRpb24udmFsdWVdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG9wdGlvbnNNb2RlbFtvcHRpb24udmFsdWVdO1xuICAgICAgICB0aGlzLmNoZWNrZWRPcHRpb25zID0gb3B0aW9uc01vZGVsO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zOiBudW1iZXIsIG1heENvbHVtbnM6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgZ3JpZFN5c3RlbUNvbHVtbnMgPSB0aGZDaGVja2JveEdyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoIC8gY29sdW1ucztcblxuICAgIHJldHVybiB0aGlzLmNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpID8gZ3JpZFN5c3RlbUNvbHVtbnMgOiB0aGZDaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIGlzSW52YWxpZEluZGV0ZXJtaW5hdGUoKSB7XG4gICAgaWYgKHRoaXMuaW5kZXRlcm1pbmF0ZSAmJiB0aGlzLnJlcXVpcmVkICYmIHRoaXMuY2hlY2tlZE9wdGlvbnMpIHtcbiAgICAgIHJldHVybiAoPGFueT5PYmplY3QpLnZhbHVlcyh0aGlzLmNoZWNrZWRPcHRpb25zKS5ldmVyeSh2YWx1ZSA9PiB2YWx1ZSA9PT0gZmFsc2UpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUR1cGxpY2F0ZWRPcHRpb25zKCkge1xuICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb24sIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBkdXBsaWNhdGVkSW5kZXggPSB0aGlzLm9wdGlvbnMuZmluZEluZGV4KChvcHRpb25GaW5kOiBhbnkpID0+IG9wdGlvbkZpbmQudmFsdWUgPT09IG9wdGlvbi52YWx1ZSkgPT09IGluZGV4O1xuICAgICAgaWYgKCFkdXBsaWNhdGVkSW5kZXgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnNwbGljZSh0aGlzLm9wdGlvbnMuaW5kZXhPZihvcHRpb24pLCAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=