/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, Renderer2, ViewChild } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { ThfNavbarBaseComponent } from './thf-navbar-base.component';
import { ThfNavbarItemsComponent } from './thf-navbar-items/thf-navbar-items.component';
/**
 * \@docsExtends ThfNavbarBaseComponent
 */
export class ThfNavbarComponent extends ThfNavbarBaseComponent {
    /**
     * @param {?} renderer
     * @param {?} builder
     * @param {?} changeDetector
     */
    constructor(renderer, builder, changeDetector) {
        super();
        this.renderer = renderer;
        this.builder = builder;
        this.changeDetector = changeDetector;
        this.showItemsNavigation = false;
        this.offset = 0;
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.displayItemsNavigation.bind(this));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.displayItemsNavigation();
        this.menuWrapperAdjust();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.mediaQuery) {
            this.mediaQuery.removeListener();
        }
    }
    /**
     * @param {?} orientation
     * @return {?}
     */
    navigateItems(orientation) {
        orientation === 'left' ? this.navigateLeft() : this.navigateRight();
        this.animate(this.offset);
    }
    /**
     * @private
     * @return {?}
     */
    adjustNavbarMenu() {
        /** @type {?} */
        const navbarMenu = document.querySelector('thf-navbar thf-menu');
        /** @type {?} */
        const page = document.querySelector('.thf-page');
        /** @type {?} */
        const navbarLogo = document.querySelector('.thf-navbar-logo');
        navbarMenu.setAttribute('style', `display: none`);
        if (page) {
            page.setAttribute('style', 'margin-left: 0; width: 100%');
        }
        if (navbarLogo) {
            navbarLogo.setAttribute('style', `padding: 0 16px 0 0!important`);
        }
        this.mediaQuery.addListener((/**
         * @param {?} changed
         * @return {?}
         */
        changed => {
            if (changed.matches) {
                navbarMenu.setAttribute('style', `display: block`);
                if (page) {
                    page.setAttribute('style', 'margin-left: 256; width: calc(100% - 256px)');
                }
            }
            else {
                navbarMenu.setAttribute('style', `display: none`);
                if (page) {
                    page.setAttribute('style', 'margin-left: 0; width: 100%');
                }
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    adjustUserMenu() {
        /** @type {?} */
        const userMenuItems = this.menu.menus;
        this.mediaQuery.addListener((/**
         * @param {?} changed
         * @return {?}
         */
        changed => {
            if (changed.matches) {
                /** @type {?} */
                const subItems = [{ label: this.literals.navbarLinks, subItems: this.items }];
                this.menu.menus = [...subItems, ...this.menu.menus];
            }
            else {
                this.menu.menus = userMenuItems;
            }
        }));
    }
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    animate(offset) {
        /** @type {?} */
        const animation = this.buildTransitionAnimation(offset);
        this.player = animation.create(this.navbarItems.navbarItemsContainer.nativeElement);
        this.player.play();
    }
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    buildTransitionAnimation(offset) {
        return this.builder.build([
            animate('250ms ease', keyframes([style({ transform: `translateX(${offset}px)` })]))
        ]);
    }
    /**
     * @private
     * @return {?}
     */
    displayItemsNavigation() {
        this.navbarItemsWidth = this.navbarItemsElement.nativeElement.offsetWidth;
        this.allNavbarItemsWidth =
            this.navbarItems.allNavbarItems.reduce((/**
             * @param {?} previous
             * @param {?} current
             * @return {?}
             */
            (previous, current) => previous + current.nativeElement.offsetWidth), 0);
        this.showItemsNavigation = this.navbarItemsWidth < this.allNavbarItemsWidth + 88;
        this.changeDetector.detectChanges();
        if (this.offset !== 0) {
            this.offset = 0;
            this.animate(this.offset);
        }
    }
    /**
     * @private
     * @return {?}
     */
    menuWrapperAdjust() {
        /** @type {?} */
        const body = document.querySelector('body');
        body.setAttribute('style', `height: calc(100% - 56px)`);
        this.mediaQuery = window.matchMedia('(max-width: 768px)');
        !this.menu ? this.adjustNavbarMenu() : this.adjustUserMenu();
    }
    /**
     * @private
     * @return {?}
     */
    navigateRight() {
        /** @type {?} */
        const maxAllowedOffset = this.allNavbarItemsWidth - this.navbarItemsElement.nativeElement.offsetWidth;
        /** @type {?} */
        const itemBreakPoint = (this.offset * -1) + this.navbarItemsElement.nativeElement.offsetWidth;
        /** @type {?} */
        let movementInPixels = 0;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        navbarItem => {
            /** @type {?} */
            const finalPosition = navbarItem.nativeElement.offsetWidth + navbarItem.nativeElement.offsetLeft;
            if (itemBreakPoint < finalPosition) {
                movementInPixels = navbarItem.nativeElement.offsetLeft;
                return true;
            }
        }));
        this.offset = (movementInPixels * -1);
        if ((this.offset * -1) >= maxAllowedOffset) {
            this.offset = maxAllowedOffset * -1;
            this.disableRight = true;
        }
    }
    /**
     * @private
     * @return {?}
     */
    navigateLeft() {
        this.disableRight = false;
        /** @type {?} */
        let movementInPixels;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        navbarItem => {
            /** @type {?} */
            const navbarItemOffset = navbarItem.nativeElement.offsetLeft;
            if (navbarItemOffset >= (this.offset * -1)) {
                movementInPixels = navbarItemOffset - (this.navbarItemsElement.nativeElement.offsetWidth - navbarItem.nativeElement.offsetWidth);
                return true;
            }
        }));
        this.offset = (movementInPixels * -1);
        if (this.offset > 0) {
            this.offset = 0;
        }
    }
}
ThfNavbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-navbar',
                template: "<header class=\"thf-navbar\"\n  [ngClass]=\"{'thf-navbar-shadow' : shadow}\">\n\n  <thf-navbar-logo\n    class=\"thf-navbar-logo\"\n    [t-logo]=\"logo\">\n  </thf-navbar-logo>\n\n  <thf-navbar-items\n    class=\"thf-navbar-items\"\n    [t-items]=\"items\">\n  </thf-navbar-items>\n\n  <thf-navbar-item-navigation *ngIf=\"showItemsNavigation\"\n    class=\"thf-navbar-item-navigation\"\n    [t-disable-left]=\"offset === 0\"\n    [t-disable-right]=\"disableRight && offset !== 0\"\n    (t-click)=\"navigateItems($event)\">\n  </thf-navbar-item-navigation>\n\n  <thf-navbar-actions\n    class=\"thf-navbar-actions\"\n    [t-icon-actions]=\"iconActions\">\n  </thf-navbar-actions>\n\n</header>\n\n<thf-menu *ngIf=\"!menu\"\n  [t-menus]=\"items\">\n</thf-menu>\n"
            }] }
];
/** @nocollapse */
ThfNavbarComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: AnimationBuilder },
    { type: ChangeDetectorRef }
];
ThfNavbarComponent.propDecorators = {
    navbarItemsElement: [{ type: ViewChild, args: [ThfNavbarItemsComponent, { read: ElementRef, static: true },] }],
    navbarItems: [{ type: ViewChild, args: [ThfNavbarItemsComponent, { static: true },] }]
};
if (false) {
    /** @type {?} */
    ThfNavbarComponent.prototype.disableRight;
    /** @type {?} */
    ThfNavbarComponent.prototype.showItemsNavigation;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.allNavbarItemsWidth;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.mediaQuery;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.navbarItemsWidth;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.offset;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.player;
    /**
     * @type {?}
     * @protected
     */
    ThfNavbarComponent.prototype.windowResizeListener;
    /** @type {?} */
    ThfNavbarComponent.prototype.navbarItemsElement;
    /** @type {?} */
    ThfNavbarComponent.prototype.navbarItems;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.builder;
    /**
     * @type {?}
     * @private
     */
    ThfNavbarComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLW5hdmJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLW5hdmJhci90aGYtbmF2YmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFhLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekgsT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBcUMsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXJILE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLCtDQUErQyxDQUFDOzs7O0FBU3hGLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSxzQkFBc0I7Ozs7OztJQWlCNUQsWUFBb0IsUUFBbUIsRUFBVSxPQUF5QixFQUFVLGNBQWlDO1FBQ25ILEtBQUssRUFBRSxDQUFDO1FBRFUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUFVLFlBQU8sR0FBUCxPQUFPLENBQWtCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBZHJILHdCQUFtQixHQUFZLEtBQUssQ0FBQztRQUs3QixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBV3pCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM3RyxDQUFDOzs7O0lBRUQsZUFBZTtRQUNiLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7SUFFRCxXQUFX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QWdCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQzFDLGdCQUFnQixHQUFHLGdCQUFnQixHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDakksT0FBTyxJQUFJLENBQUM7YUFDYjtRQUVILENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdEMsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUM7OztZQXhLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLG13QkFBMEM7YUFDM0M7Ozs7WUFaNEUsU0FBUztZQUNwRSxnQkFBZ0I7WUFEVixpQkFBaUI7OztpQ0EwQnRDLFNBQVMsU0FBQyx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTswQkFFckUsU0FBUyxTQUFDLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7OztJQWJwRCwwQ0FBc0I7O0lBQ3RCLGlEQUFxQzs7Ozs7SUFFckMsaURBQWlDOzs7OztJQUNqQyx3Q0FBd0I7Ozs7O0lBQ3hCLDhDQUE4Qjs7Ozs7SUFDOUIsb0NBQTJCOzs7OztJQUMzQixvQ0FBZ0M7Ozs7O0lBRWhDLGtEQUEyQzs7SUFFM0MsZ0RBQXVHOztJQUV2Ryx5Q0FBMkY7Ozs7O0lBRS9FLHNDQUEyQjs7Ozs7SUFBRSxxQ0FBaUM7Ozs7O0lBQUUsNENBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgYW5pbWF0ZSwgQW5pbWF0aW9uQnVpbGRlciwgQW5pbWF0aW9uRmFjdG9yeSwgQW5pbWF0aW9uUGxheWVyLCBrZXlmcmFtZXMsIHN0eWxlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5cbmltcG9ydCB7IFRoZk5hdmJhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3RoZi1uYXZiYXItYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmTmF2YmFySXRlbXNDb21wb25lbnQgfSBmcm9tICcuL3RoZi1uYXZiYXItaXRlbXMvdGhmLW5hdmJhci1pdGVtcy5jb21wb25lbnQnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZOYXZiYXJCYXNlQ29tcG9uZW50XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1uYXZiYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vdGhmLW5hdmJhci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgVGhmTmF2YmFyQ29tcG9uZW50IGV4dGVuZHMgVGhmTmF2YmFyQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgZGlzYWJsZVJpZ2h0OiBib29sZWFuO1xuICBzaG93SXRlbXNOYXZpZ2F0aW9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBhbGxOYXZiYXJJdGVtc1dpZHRoOiBhbnk7XG4gIHByaXZhdGUgbWVkaWFRdWVyeTogYW55O1xuICBwcml2YXRlIG5hdmJhckl0ZW1zV2lkdGg6IGFueTtcbiAgcHJpdmF0ZSBvZmZzZXQ6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG5cbiAgcHJvdGVjdGVkIHdpbmRvd1Jlc2l6ZUxpc3RlbmVyOiAoKSA9PiB2b2lkO1xuXG4gIEBWaWV3Q2hpbGQoVGhmTmF2YmFySXRlbXNDb21wb25lbnQsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIG5hdmJhckl0ZW1zRWxlbWVudDogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKFRoZk5hdmJhckl0ZW1zQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBuYXZiYXJJdGVtczogVGhmTmF2YmFySXRlbXNDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGJ1aWxkZXI6IEFuaW1hdGlvbkJ1aWxkZXIsIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4od2luZG93LCAncmVzaXplJywgdGhpcy5kaXNwbGF5SXRlbXNOYXZpZ2F0aW9uLmJpbmQodGhpcykpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuZGlzcGxheUl0ZW1zTmF2aWdhdGlvbigpO1xuICAgIHRoaXMubWVudVdyYXBwZXJBZGp1c3QoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLm1lZGlhUXVlcnkpIHtcbiAgICAgIHRoaXMubWVkaWFRdWVyeS5yZW1vdmVMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIG5hdmlnYXRlSXRlbXMob3JpZW50YXRpb24pIHtcblxuICAgIG9yaWVudGF0aW9uID09PSAnbGVmdCcgPyB0aGlzLm5hdmlnYXRlTGVmdCgpIDogdGhpcy5uYXZpZ2F0ZVJpZ2h0KCk7XG5cbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3ROYXZiYXJNZW51KCkge1xuICAgIGNvbnN0IG5hdmJhck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0aGYtbmF2YmFyIHRoZi1tZW51Jyk7XG4gICAgY29uc3QgcGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aGYtcGFnZScpO1xuICAgIGNvbnN0IG5hdmJhckxvZ28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGhmLW5hdmJhci1sb2dvJyk7XG4gICAgbmF2YmFyTWVudS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGRpc3BsYXk6IG5vbmVgKTtcbiAgICBpZiAocGFnZSkge1xuICAgICAgcGFnZS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ21hcmdpbi1sZWZ0OiAwOyB3aWR0aDogMTAwJScpO1xuICAgIH1cbiAgICBpZiAobmF2YmFyTG9nbykge1xuICAgICAgbmF2YmFyTG9nby5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYHBhZGRpbmc6IDAgMTZweCAwIDAhaW1wb3J0YW50YCk7XG4gICAgfVxuICAgIHRoaXMubWVkaWFRdWVyeS5hZGRMaXN0ZW5lcihjaGFuZ2VkID0+IHtcbiAgICAgIGlmIChjaGFuZ2VkLm1hdGNoZXMpIHtcbiAgICAgICAgbmF2YmFyTWVudS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGRpc3BsYXk6IGJsb2NrYCk7XG4gICAgICAgIGlmIChwYWdlKSB7XG4gICAgICAgICAgcGFnZS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ21hcmdpbi1sZWZ0OiAyNTY7IHdpZHRoOiBjYWxjKDEwMCUgLSAyNTZweCknKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmF2YmFyTWVudS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGRpc3BsYXk6IG5vbmVgKTtcbiAgICAgICAgaWYgKHBhZ2UpIHtcbiAgICAgICAgICBwYWdlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnbWFyZ2luLWxlZnQ6IDA7IHdpZHRoOiAxMDAlJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRqdXN0VXNlck1lbnUoKSB7XG4gICAgY29uc3QgdXNlck1lbnVJdGVtcyA9IHRoaXMubWVudS5tZW51cztcbiAgICB0aGlzLm1lZGlhUXVlcnkuYWRkTGlzdGVuZXIoY2hhbmdlZCA9PiB7XG4gICAgICBpZiAoY2hhbmdlZC5tYXRjaGVzKSB7XG4gICAgICAgIGNvbnN0IHN1Ykl0ZW1zID0gW3tsYWJlbDogdGhpcy5saXRlcmFscy5uYXZiYXJMaW5rcywgc3ViSXRlbXM6IHRoaXMuaXRlbXN9XSA7XG4gICAgICAgIHRoaXMubWVudS5tZW51cyA9IFsuLi5zdWJJdGVtcywgLi4udGhpcy5tZW51Lm1lbnVzXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubWVudS5tZW51cyA9IHVzZXJNZW51SXRlbXM7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFuaW1hdGUob2Zmc2V0OiBudW1iZXIpIHtcbiAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbkZhY3RvcnkgPSB0aGlzLmJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQpO1xuXG4gICAgdGhpcy5wbGF5ZXIgPSBhbmltYXRpb24uY3JlYXRlKHRoaXMubmF2YmFySXRlbXMubmF2YmFySXRlbXNDb250YWluZXIubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5wbGF5ZXIucGxheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5idWlsZGVyLmJ1aWxkKFtcbiAgICAgIGFuaW1hdGUoXG4gICAgICAgICcyNTBtcyBlYXNlJyxcbiAgICAgICAga2V5ZnJhbWVzKFtzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoJHtvZmZzZXR9cHgpYCB9KV0pXG4gICAgICApXG4gICAgXSk7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlJdGVtc05hdmlnYXRpb24oKSB7XG4gICAgdGhpcy5uYXZiYXJJdGVtc1dpZHRoID0gdGhpcy5uYXZiYXJJdGVtc0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIHRoaXMuYWxsTmF2YmFySXRlbXNXaWR0aCA9XG4gICAgICB0aGlzLm5hdmJhckl0ZW1zLmFsbE5hdmJhckl0ZW1zLnJlZHVjZSgocHJldmlvdXM6IGFueSwgY3VycmVudDogYW55KSA9PiBwcmV2aW91cyArIGN1cnJlbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCwgMCk7XG5cbiAgICB0aGlzLnNob3dJdGVtc05hdmlnYXRpb24gPSB0aGlzLm5hdmJhckl0ZW1zV2lkdGggPCB0aGlzLmFsbE5hdmJhckl0ZW1zV2lkdGggKyA4ODtcblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0ICE9PSAwKSB7XG4gICAgICB0aGlzLm9mZnNldCA9IDA7XG4gICAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbWVudVdyYXBwZXJBZGp1c3QoKSB7XG4gICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICBib2R5LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgaGVpZ2h0OiBjYWxjKDEwMCUgLSA1NnB4KWApO1xuICAgIHRoaXMubWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiA3NjhweCknKTtcblxuICAgICF0aGlzLm1lbnUgPyB0aGlzLmFkanVzdE5hdmJhck1lbnUoKSA6IHRoaXMuYWRqdXN0VXNlck1lbnUoKTtcbiAgfVxuXG4gIHByaXZhdGUgbmF2aWdhdGVSaWdodCgpIHtcblxuICAgIGNvbnN0IG1heEFsbG93ZWRPZmZzZXQgPSB0aGlzLmFsbE5hdmJhckl0ZW1zV2lkdGggLSB0aGlzLm5hdmJhckl0ZW1zRWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIGNvbnN0IGl0ZW1CcmVha1BvaW50ID0gKHRoaXMub2Zmc2V0ICogLTEpICsgdGhpcy5uYXZiYXJJdGVtc0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIGxldCBtb3ZlbWVudEluUGl4ZWxzID0gMDtcblxuICAgIHRoaXMubmF2YmFySXRlbXMuYWxsTmF2YmFySXRlbXMuc29tZShuYXZiYXJJdGVtID0+IHtcbiAgICAgIGNvbnN0IGZpbmFsUG9zaXRpb24gPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggKyBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcblxuICAgICAgaWYgKGl0ZW1CcmVha1BvaW50IDwgZmluYWxQb3NpdGlvbikge1xuICAgICAgICBtb3ZlbWVudEluUGl4ZWxzID0gbmF2YmFySXRlbS5uYXRpdmVFbGVtZW50Lm9mZnNldExlZnQ7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB0aGlzLm9mZnNldCA9IChtb3ZlbWVudEluUGl4ZWxzICogLTEpO1xuXG4gICAgaWYgKCh0aGlzLm9mZnNldCAqIC0xKSA+PSBtYXhBbGxvd2VkT2Zmc2V0KSB7XG4gICAgICB0aGlzLm9mZnNldCA9IG1heEFsbG93ZWRPZmZzZXQgKiAtMTtcbiAgICAgIHRoaXMuZGlzYWJsZVJpZ2h0ID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG5hdmlnYXRlTGVmdCgpIHtcbiAgICB0aGlzLmRpc2FibGVSaWdodCA9IGZhbHNlO1xuXG4gICAgbGV0IG1vdmVtZW50SW5QaXhlbHM7XG5cbiAgICB0aGlzLm5hdmJhckl0ZW1zLmFsbE5hdmJhckl0ZW1zLnNvbWUobmF2YmFySXRlbSA9PiB7XG5cbiAgICAgIGNvbnN0IG5hdmJhckl0ZW1PZmZzZXQgPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcblxuICAgICAgaWYgKG5hdmJhckl0ZW1PZmZzZXQgPj0gKHRoaXMub2Zmc2V0ICogLTEpKSB7XG4gICAgICAgIG1vdmVtZW50SW5QaXhlbHMgPSBuYXZiYXJJdGVtT2Zmc2V0IC0gKHRoaXMubmF2YmFySXRlbXNFbGVtZW50Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgdGhpcy5vZmZzZXQgPSAobW92ZW1lbnRJblBpeGVscyAqIC0xKTtcblxuICAgIGlmICh0aGlzLm9mZnNldCA+IDApIHtcbiAgICAgIHRoaXMub2Zmc2V0ID0gMDtcbiAgICB9XG4gIH1cblxufVxuIl19