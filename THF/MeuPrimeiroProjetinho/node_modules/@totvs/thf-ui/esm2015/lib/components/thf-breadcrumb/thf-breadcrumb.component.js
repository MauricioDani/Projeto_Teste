/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, IterableDiffers, Renderer2, ViewChild } from '@angular/core';
import { ThfBreadcrumbBaseComponent } from './thf-breadcrumb-base.component';
/**
 * \@docsExtends ThfBreadcrumbBaseComponent
 *
 * \@example
 *
 * <example name="thf-breadcrumb-basic" title="Totvs Breadcrumb Basic">
 *  <file name="sample-thf-breadcrumb-basic/sample-thf-breadcrumb-basic.component.html"> </file>
 *  <file name="sample-thf-breadcrumb-basic/sample-thf-breadcrumb-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-breadcrumb-labs" title="Totvs Breadcrumb Labs">
 *  <file name="sample-thf-breadcrumb-labs/sample-thf-breadcrumb-labs.component.html"> </file>
 *  <file name="sample-thf-breadcrumb-labs/sample-thf-breadcrumb-labs.component.ts"> </file>
 * </example>
 */
export class ThfBreadcrumbComponent extends ThfBreadcrumbBaseComponent {
    /**
     * @param {?} differs
     * @param {?} element
     * @param {?} renderer
     */
    constructor(differs, element, renderer) {
        super();
        this.element = element;
        this.renderer = renderer;
        this.showDropdown = false;
        this.showDropdownToggle = false;
        this._breadcrumbItemsLenght = 0;
        this.calculatedElement = false;
        this.hiddenWithoutResize = false;
        this.initialized = false;
        this.wasClickedonDropdown = (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            /** @type {?} */
            const clickedOutIconDropdown = this.checkClickOutElement(event, this.dropdownIcon);
            if (clickedOutIconDropdown) {
                this.showDropdown = false;
                this.removeClickoutListener();
            }
        });
        this.differ = differs.find([]).create(null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initialized = true;
        this.initializeResizeListener();
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        /** @type {?} */
        const breadcrumbWidth = this.breadcrumbElement.nativeElement.offsetWidth;
        // Permite que os disclaimers sejam calculados na primeira vez que o componente torna-se vis√≠vel,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        if (breadcrumbWidth && !this.calculatedElement && this.initialized) {
            this.initBreadcrumbSize();
        }
        if (this.hiddenWithoutResize) {
            this.debounceResize();
            this.hiddenWithoutResize = false;
        }
        this.checkChangeOnItems();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.removeClickoutListener();
        this.removeResizeListener();
    }
    /**
     * @return {?}
     */
    toggleDropdown() {
        this.showDropdown = !this.showDropdown;
        this.initializeClickoutListener();
    }
    /**
     * @private
     * @param {?} event
     * @param {?} element
     * @return {?}
     */
    checkClickOutElement(event, element) {
        return element && !element.nativeElement.contains(event.target);
    }
    /**
     * @private
     * @return {?}
     */
    checkChangeOnItems() {
        if (this.differ) {
            /** @type {?} */
            const changes = this.differ.diff(this.items);
            if (changes) {
                this.calcBreadcrumbItemsWidth();
                this.calculatedElement = false;
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    calcBreadcrumb() {
        /** @type {?} */
        const breadcrumbFavorite = this.getBreadcrumbFavoriteWidth();
        /** @type {?} */
        const breadcrumb = this.getBreadcrumbWidth(breadcrumbFavorite);
        if (breadcrumb <= this._breadcrumbItemsLenght) {
            this.enableBreadcrumbResponsive();
        }
        else {
            this.disableBreadcrumbResponsive();
        }
    }
    /**
     * @private
     * @return {?}
     */
    getBreadcrumbFavoriteWidth() {
        return this.favoriteService ? this.element.nativeElement
            .querySelector('.thf-breadcrumb-favorite').offsetWidth + 20 : 0;
    }
    /**
     * @private
     * @param {?} breadcrumbFavorite
     * @return {?}
     */
    getBreadcrumbWidth(breadcrumbFavorite) {
        return this.element.nativeElement.querySelector('.thf-breadcrumb').offsetWidth - breadcrumbFavorite;
    }
    /**
     * @private
     * @return {?}
     */
    calcBreadcrumbItemsWidth() {
        /** @type {?} */
        const breadcrumbItem = this.element.nativeElement
            .querySelectorAll('.thf-breadcrumb-item, .thf-breadcrumb-item-unclickable');
        this._breadcrumbItemsLenght = Array.from(breadcrumbItem)
            .map((/**
         * @param {?} breadcrumb
         * @return {?}
         */
        breadcrumb => breadcrumb['offsetWidth']))
            .reduce((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => a + b), 16);
    }
    /**
     * @private
     * @return {?}
     */
    enableBreadcrumbResponsive() {
        this.showDropdownToggle = true;
        this.itemsView = this.items.slice(-2);
        this.dropdownItems = this.items.slice(0, -2).reverse();
    }
    /**
     * @private
     * @return {?}
     */
    disableBreadcrumbResponsive() {
        this.showDropdownToggle = false;
        this.itemsView = [].concat(this.items);
        this.showDropdown = false;
    }
    /**
     * @private
     * @return {?}
     */
    debounceResize() {
        clearTimeout(this.timeoutResize);
        this.timeoutResize = setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.calculatedElement && !this.hiddenWithoutResize && this.breadcrumbElement.nativeElement.offsetWidth === 0) {
                this.hiddenWithoutResize = true;
            }
            else {
                this.calcBreadcrumb();
            }
        }), 50);
    }
    /**
     * @private
     * @return {?}
     */
    initBreadcrumbSize() {
        this.calcBreadcrumbItemsWidth();
        this.calcBreadcrumb();
        this.calculatedElement = true;
    }
    /**
     * @private
     * @return {?}
     */
    initializeClickoutListener() {
        this.clickoutListener = this.renderer.listen('document', 'click', this.wasClickedonDropdown);
    }
    /**
     * @private
     * @return {?}
     */
    initializeResizeListener() {
        this.resizeListener = this.renderer.listen('window', 'resize', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            this.debounceResize();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    removeClickoutListener() {
        if (this.clickoutListener) {
            this.clickoutListener();
        }
    }
    /**
     * @private
     * @return {?}
     */
    removeResizeListener() {
        this.resizeListener();
    }
}
ThfBreadcrumbComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-breadcrumb',
                template: "<div class=\"thf-breadcrumb\" #breadcrumb>\n\n  <ul class=\"thf-breadcrumb-items\">\n\n    <li #dropdownIcon\n      *ngIf=\"showDropdownToggle\"\n      class=\"thf-breadcrumb-item thf-clickable\"\n      (click)=\"toggleDropdown()\">\n\n      <span class=\"thf-breadcrumb-icon-more thf-icon thf-icon-more\"></span>\n      <div class=\"thf-breadcrumb-arrow\"></div>\n    </li>\n\n    <div *ngFor=\"let item of itemsView, let itemIndex = index;\">\n      <thf-breadcrumb-item\n        [t-action]=\"item.action\"\n        [t-label]=\"item.label\"\n        [t-link]=\"item.link\"\n        [t-item-active]=\"itemIndex === (itemsView.length - 1)\">\n      </thf-breadcrumb-item>\n    </div>\n\n  </ul>\n\n  <thf-breadcrumb-favorite *ngIf=\"favoriteService\"\n    [t-favorite-service]=\"favoriteService\"\n    [t-item-active]=\"items[items.length - 1]\"\n    [t-params-service]=\"paramsService\">\n  </thf-breadcrumb-favorite>\n\n  <thf-breadcrumb-dropdown *ngIf=\"showDropdown\"\n    [t-items]=\"dropdownItems\">\n  </thf-breadcrumb-dropdown>\n\n</div>\n"
            }] }
];
/** @nocollapse */
ThfBreadcrumbComponent.ctorParameters = () => [
    { type: IterableDiffers },
    { type: ElementRef },
    { type: Renderer2 }
];
ThfBreadcrumbComponent.propDecorators = {
    breadcrumbElement: [{ type: ViewChild, args: ['breadcrumb', { read: ElementRef, static: true },] }],
    dropdownIcon: [{ type: ViewChild, args: ['dropdownIcon', { read: ElementRef, static: false },] }]
};
if (false) {
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.showDropdown;
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.showDropdownToggle;
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.dropdownItems;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype._breadcrumbItemsLenght;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.calculatedElement;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.hiddenWithoutResize;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.timeoutResize;
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.breadcrumbElement;
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.dropdownIcon;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.wasClickedonDropdown;
    /**
     * @type {?}
     * @private
     */
    ThfBreadcrumbComponent.prototype.element;
    /** @type {?} */
    ThfBreadcrumbComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWJyZWFkY3J1bWIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvdHZzL3RoZi11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RoZi1icmVhZGNydW1iL3RoZi1icmVhZGNydW1iLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixTQUFTLEVBQVcsVUFBVSxFQUFFLGVBQWUsRUFBYSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWhJLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FBc0I3RSxNQUFNLE9BQU8sc0JBQXVCLFNBQVEsMEJBQTBCOzs7Ozs7SUFnQnBFLFlBQVksT0FBd0IsRUFBVSxPQUFtQixFQUFTLFFBQW1CO1FBQzNGLEtBQUssRUFBRSxDQUFDO1FBRG9DLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBUyxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBZDdGLGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBQzlCLHVCQUFrQixHQUFZLEtBQUssQ0FBQztRQUc1QiwyQkFBc0IsR0FBVyxDQUFDLENBQUM7UUFDbkMsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBRTFCLHdCQUFtQixHQUFHLEtBQUssQ0FBQztRQUM1QixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQTRDcEIseUJBQW9COzs7O1FBQUcsQ0FBQyxLQUFpQixFQUFFLEVBQUU7O2tCQUM3QyxzQkFBc0IsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUM7WUFFbEYsSUFBSSxzQkFBc0IsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxFQUFBO1FBM0NDLElBQUksQ0FBQyxNQUFNLEdBQUcs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Q0FBZTs7Ozs7SUFDZixxREFBb0M7Ozs7O0lBQ3BDLDZDQUE0Qjs7Ozs7SUFDNUIsK0NBQXNCOztJQUV0QixtREFBMkY7O0lBQzNGLDhDQUF5Rjs7Ozs7SUF3Q3pGLHNEQU9DOzs7OztJQTdDcUMseUNBQTJCOztJQUFFLDBDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRG9DaGVjaywgRWxlbWVudFJlZiwgSXRlcmFibGVEaWZmZXJzLCBPbkRlc3Ryb3ksIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFRoZkJyZWFkY3J1bWJCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtYnJlYWRjcnVtYi1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZCcmVhZGNydW1iSXRlbSB9IGZyb20gJy4vdGhmLWJyZWFkY3J1bWItaXRlbS5pbnRlcmZhY2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZCcmVhZGNydW1iQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1icmVhZGNydW1iLWJhc2ljXCIgdGl0bGU9XCJUb3R2cyBCcmVhZGNydW1iIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtYnJlYWRjcnVtYi1iYXNpYy9zYW1wbGUtdGhmLWJyZWFkY3J1bWItYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWJyZWFkY3J1bWItYmFzaWMvc2FtcGxlLXRoZi1icmVhZGNydW1iLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInRoZi1icmVhZGNydW1iLWxhYnNcIiB0aXRsZT1cIlRvdHZzIEJyZWFkY3J1bWIgTGFic1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWJyZWFkY3J1bWItbGFicy9zYW1wbGUtdGhmLWJyZWFkY3J1bWItbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtYnJlYWRjcnVtYi1sYWJzL3NhbXBsZS10aGYtYnJlYWRjcnVtYi1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1icmVhZGNydW1iJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RoZi1icmVhZGNydW1iLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBUaGZCcmVhZGNydW1iQ29tcG9uZW50IGV4dGVuZHMgVGhmQnJlYWRjcnVtYkJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3kge1xuXG4gIHNob3dEcm9wZG93bjogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93RHJvcGRvd25Ub2dnbGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgZHJvcGRvd25JdGVtczogQXJyYXk8VGhmQnJlYWRjcnVtYkl0ZW0+O1xuXG4gIHByaXZhdGUgX2JyZWFkY3J1bWJJdGVtc0xlbmdodDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBjYWxjdWxhdGVkRWxlbWVudCA9IGZhbHNlO1xuICBwcml2YXRlIGRpZmZlcjtcbiAgcHJpdmF0ZSBoaWRkZW5XaXRob3V0UmVzaXplID0gZmFsc2U7XG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSB0aW1lb3V0UmVzaXplO1xuXG4gIEBWaWV3Q2hpbGQoJ2JyZWFkY3J1bWInLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBicmVhZGNydW1iRWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnZHJvcGRvd25JY29uJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IGZhbHNlIH0pIGRyb3Bkb3duSWNvbjogRWxlbWVudFJlZjtcblxuICBjb25zdHJ1Y3RvcihkaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMsIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHVibGljIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuZGlmZmVyID0gZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICB0aGlzLmluaXRpYWxpemVSZXNpemVMaXN0ZW5lcigpO1xuICB9XG5cbiAgbmdEb0NoZWNrKCkge1xuICAgIGNvbnN0IGJyZWFkY3J1bWJXaWR0aCA9IHRoaXMuYnJlYWRjcnVtYkVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIC8vIFBlcm1pdGUgcXVlIG9zIGRpc2NsYWltZXJzIHNlamFtIGNhbGN1bGFkb3MgbmEgcHJpbWVpcmEgdmV6IHF1ZSBvIGNvbXBvbmVudGUgdG9ybmEtc2Ugdmlzw612ZWwsXG4gICAgLy8gZXZpdGFuZG8gY29tIGlzc28sIHByb2JsZW1hcyBjb20gVGFicyBvdSBEaXZzIHF1ZSBpbmljaWVtIGVzY29uZGlkYXMuXG4gICAgaWYgKGJyZWFkY3J1bWJXaWR0aCAmJiAhdGhpcy5jYWxjdWxhdGVkRWxlbWVudCAmJiB0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICB0aGlzLmluaXRCcmVhZGNydW1iU2l6ZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhpZGRlbldpdGhvdXRSZXNpemUpIHtcbiAgICAgIHRoaXMuZGVib3VuY2VSZXNpemUoKTtcbiAgICAgIHRoaXMuaGlkZGVuV2l0aG91dFJlc2l6ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuY2hlY2tDaGFuZ2VPbkl0ZW1zKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlbW92ZUNsaWNrb3V0TGlzdGVuZXIoKTtcbiAgICB0aGlzLnJlbW92ZVJlc2l6ZUxpc3RlbmVyKCk7XG4gIH1cblxuICB0b2dnbGVEcm9wZG93bigpIHtcbiAgICB0aGlzLnNob3dEcm9wZG93biA9ICF0aGlzLnNob3dEcm9wZG93bjtcbiAgICB0aGlzLmluaXRpYWxpemVDbGlja291dExpc3RlbmVyKCk7XG4gIH1cblxuICBwcml2YXRlIHdhc0NsaWNrZWRvbkRyb3Bkb3duID0gKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgY29uc3QgY2xpY2tlZE91dEljb25Ecm9wZG93biA9IHRoaXMuY2hlY2tDbGlja091dEVsZW1lbnQoZXZlbnQsIHRoaXMuZHJvcGRvd25JY29uKTtcblxuICAgIGlmIChjbGlja2VkT3V0SWNvbkRyb3Bkb3duKSB7XG4gICAgICB0aGlzLnNob3dEcm9wZG93biA9IGZhbHNlO1xuICAgICAgdGhpcy5yZW1vdmVDbGlja291dExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0NsaWNrT3V0RWxlbWVudChldmVudCwgZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50ICYmICFlbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDaGFuZ2VPbkl0ZW1zKCkge1xuICAgIGlmICh0aGlzLmRpZmZlcikge1xuICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuZGlmZmVyLmRpZmYodGhpcy5pdGVtcyk7XG4gICAgICBpZiAoY2hhbmdlcykge1xuICAgICAgICB0aGlzLmNhbGNCcmVhZGNydW1iSXRlbXNXaWR0aCgpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZWRFbGVtZW50ID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjQnJlYWRjcnVtYigpIHtcbiAgICBjb25zdCBicmVhZGNydW1iRmF2b3JpdGUgPSB0aGlzLmdldEJyZWFkY3J1bWJGYXZvcml0ZVdpZHRoKCk7XG4gICAgY29uc3QgYnJlYWRjcnVtYiA9IHRoaXMuZ2V0QnJlYWRjcnVtYldpZHRoKGJyZWFkY3J1bWJGYXZvcml0ZSk7XG5cbiAgICBpZiAoYnJlYWRjcnVtYiA8PSB0aGlzLl9icmVhZGNydW1iSXRlbXNMZW5naHQpIHtcbiAgICAgIHRoaXMuZW5hYmxlQnJlYWRjcnVtYlJlc3BvbnNpdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlQnJlYWRjcnVtYlJlc3BvbnNpdmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEJyZWFkY3J1bWJGYXZvcml0ZVdpZHRoKCkge1xuICAgIHJldHVybiB0aGlzLmZhdm9yaXRlU2VydmljZSA/IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcignLnRoZi1icmVhZGNydW1iLWZhdm9yaXRlJykub2Zmc2V0V2lkdGggKyAyMCA6IDA7XG4gIH1cblxuICBwcml2YXRlIGdldEJyZWFkY3J1bWJXaWR0aChicmVhZGNydW1iRmF2b3JpdGUpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnRoZi1icmVhZGNydW1iJykub2Zmc2V0V2lkdGggLSBicmVhZGNydW1iRmF2b3JpdGU7XG4gIH1cblxuICBwcml2YXRlIGNhbGNCcmVhZGNydW1iSXRlbXNXaWR0aCgpIHtcbiAgICBjb25zdCBicmVhZGNydW1iSXRlbSA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvckFsbCgnLnRoZi1icmVhZGNydW1iLWl0ZW0sIC50aGYtYnJlYWRjcnVtYi1pdGVtLXVuY2xpY2thYmxlJyk7XG5cbiAgICB0aGlzLl9icmVhZGNydW1iSXRlbXNMZW5naHQgPSBBcnJheS5mcm9tKGJyZWFkY3J1bWJJdGVtKVxuICAgICAgLm1hcChicmVhZGNydW1iID0+IGJyZWFkY3J1bWJbJ29mZnNldFdpZHRoJ10pXG4gICAgICAucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMTYpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbmFibGVCcmVhZGNydW1iUmVzcG9uc2l2ZSgpIHtcbiAgICB0aGlzLnNob3dEcm9wZG93blRvZ2dsZSA9IHRydWU7XG4gICAgdGhpcy5pdGVtc1ZpZXcgPSB0aGlzLml0ZW1zLnNsaWNlKC0yKTtcbiAgICB0aGlzLmRyb3Bkb3duSXRlbXMgPSB0aGlzLml0ZW1zLnNsaWNlKDAsIC0yKS5yZXZlcnNlKCk7XG4gIH1cblxuICBwcml2YXRlIGRpc2FibGVCcmVhZGNydW1iUmVzcG9uc2l2ZSgpIHtcbiAgICB0aGlzLnNob3dEcm9wZG93blRvZ2dsZSA9IGZhbHNlO1xuICAgIHRoaXMuaXRlbXNWaWV3ID0gW10uY29uY2F0KHRoaXMuaXRlbXMpO1xuICAgIHRoaXMuc2hvd0Ryb3Bkb3duID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGRlYm91bmNlUmVzaXplKCkge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXRSZXNpemUpO1xuICAgIHRoaXMudGltZW91dFJlc2l6ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXG4gICAgICBpZiAodGhpcy5jYWxjdWxhdGVkRWxlbWVudCAmJiAhdGhpcy5oaWRkZW5XaXRob3V0UmVzaXplICYmIHRoaXMuYnJlYWRjcnVtYkVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCA9PT0gMCkge1xuICAgICAgICB0aGlzLmhpZGRlbldpdGhvdXRSZXNpemUgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jYWxjQnJlYWRjcnVtYigpO1xuICAgICAgfVxuXG4gICAgfSwgNTApO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0QnJlYWRjcnVtYlNpemUoKSB7XG4gICAgdGhpcy5jYWxjQnJlYWRjcnVtYkl0ZW1zV2lkdGgoKTtcbiAgICB0aGlzLmNhbGNCcmVhZGNydW1iKCk7XG4gICAgdGhpcy5jYWxjdWxhdGVkRWxlbWVudCA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVDbGlja291dExpc3RlbmVyKCkge1xuICAgIHRoaXMuY2xpY2tvdXRMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKCdkb2N1bWVudCcsICdjbGljaycsIHRoaXMud2FzQ2xpY2tlZG9uRHJvcGRvd24pO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUmVzaXplTGlzdGVuZXIoKSB7XG4gICAgdGhpcy5yZXNpemVMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKCd3aW5kb3cnLCAncmVzaXplJywgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmRlYm91bmNlUmVzaXplKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUNsaWNrb3V0TGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMuY2xpY2tvdXRMaXN0ZW5lcikge1xuICAgICAgdGhpcy5jbGlja291dExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVSZXNpemVMaXN0ZW5lcigpIHtcbiAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyKCk7XG4gIH1cblxufVxuIl19