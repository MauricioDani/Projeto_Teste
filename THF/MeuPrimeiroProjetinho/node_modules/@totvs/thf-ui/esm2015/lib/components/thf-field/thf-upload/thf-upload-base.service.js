/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpClient, HttpEventType, HttpRequest, HttpResponse } from '@angular/common/http';
export class ThfUploadBaseService {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.formField = 'files';
        this.requests = [];
    }
    /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param {?} url URL da requisição a ser efetuada.
     * @param {?} files Arquivos a serem enviados.
     * @param {?} tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param {?} uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param {?} successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param {?} errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     * @return {?}
     */
    upload(url, files, tOnUpload, uploadCallback, successCallback, errorCallback) {
        /** @type {?} */
        const filesLength = files.length;
        /** @type {?} */
        const uploadEvent = {
            data: {},
            file: null
        };
        for (let i = 0; i < filesLength; i++) {
            /** @type {?} */
            const formData = new FormData();
            /** @type {?} */
            const file = files[i];
            /** @type {?} */
            const fileName = file.rawFile.name;
            formData.append(this.formField, file.rawFile, fileName);
            // Função upload, onde o desenvolvedor pode enviar dados para a requisição.
            if (tOnUpload) {
                uploadEvent['file'] = file;
                tOnUpload.emit(uploadEvent);
                formData.append('data', JSON.stringify(uploadEvent.data));
            }
            this.sendFile(url, file, formData, uploadCallback, successCallback, errorCallback);
        }
    }
    /**
     * @param {?} url
     * @param {?} file
     * @param {?} formData
     * @param {?} uploadCallback
     * @param {?} successCallback
     * @param {?} errorCallback
     * @return {?}
     */
    sendFile(url, file, formData, uploadCallback, successCallback, errorCallback) {
        /** @type {?} */
        const request = this.getRequest(url, formData).subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            if (event.type === HttpEventType.UploadProgress) {
                this.addRequest(file, request);
                /** @type {?} */
                const percentDone = Math.round(100 * event.loaded / event.total);
                uploadCallback(file, percentDone);
            }
            else if (event instanceof HttpResponse) {
                // Sucesso, arquivos enviados.
                successCallback(file, event);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            errorCallback(file, err);
        }));
    }
    /**
     * @param {?} url
     * @param {?} formData
     * @return {?}
     */
    getRequest(url, formData) {
        /** @type {?} */
        const req = new HttpRequest('POST', url, formData, {
            reportProgress: true
        });
        return this.http.request(req);
    }
    /**
     * @param {?} file
     * @param {?} callback
     * @return {?}
     */
    stopRequestByFile(file, callback) {
        /** @type {?} */
        const requestObj = this.requests.find((/**
         * @param {?} req
         * @return {?}
         */
        req => {
            return req.file.uid === file.uid;
        }));
        if (requestObj) {
            /** @type {?} */
            const request = requestObj.request;
            request.unsubscribe();
            this.removeRequest(requestObj);
            callback();
        }
    }
    /**
     * @param {?} requestObj
     * @return {?}
     */
    removeRequest(requestObj) {
        /** @type {?} */
        const index = this.requests.indexOf(requestObj);
        this.requests.splice(index, 1);
    }
    /**
     * @param {?} file
     * @param {?} request
     * @return {?}
     */
    addRequest(file, request) {
        /** @type {?} */
        const hasRequest = this.requests.some((/**
         * @param {?} req
         * @return {?}
         */
        req => {
            return req.file.uid === file.uid;
        }));
        if (!hasRequest) {
            this.requests.push({ file, request });
        }
    }
}
ThfUploadBaseService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ThfUploadBaseService.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    ThfUploadBaseService.prototype.formField;
    /** @type {?} */
    ThfUploadBaseService.prototype.requests;
    /**
     * @type {?}
     * @private
     */
    ThfUploadBaseService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLXVwbG9hZC1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWZpZWxkL3RoZi11cGxvYWQvdGhmLXVwbG9hZC1iYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFxQixXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFPL0csTUFBTSxPQUFPLG9CQUFvQjs7OztJQUsvQixZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBSHBDLGNBQVMsR0FBVyxPQUFPLENBQUM7UUFDNUIsYUFBUSxHQUFlLEVBQUUsQ0FBQztJQUVjLENBQUM7Ozs7Ozs7Ozs7OztJQVlsQyxNQUFNLENBQ1gsR0FBVyxFQUNYLEtBQTJCLEVBQzNCLFNBQTRCLEVBQzVCLGNBQThELEVBQzlELGVBQTBELEVBQzFELGFBQXdEOztjQUVsRCxXQUFXLEdBQUcsS0FBSyxDQUFDLE1BQU07O2NBQzFCLFdBQVcsR0FBUTtZQUN2QixJQUFJLEVBQUUsRUFBRTtZQUNSLElBQUksRUFBRSxJQUFJO1NBQ1g7UUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDOUIsUUFBUSxHQUFhLElBQUksUUFBUSxFQUFFOztrQkFDbkMsSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7O2tCQUNmLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUk7WUFFbEMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFeEQsMkVBQTJFO1lB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VUFBVSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztTQUNyQztJQUNILENBQUM7OztZQS9HRixVQUFVOzs7O1lBTkYsVUFBVTs7OztJQVNqQix5Q0FBNEI7O0lBQzVCLHdDQUEwQjs7Ozs7SUFFZCxvQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFdmVudFR5cGUsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwUmVxdWVzdCwgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBUaGZVcGxvYWRGaWxlIH0gZnJvbSAnLi90aGYtdXBsb2FkLWZpbGUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRoZlVwbG9hZEJhc2VTZXJ2aWNlIHtcblxuICBmb3JtRmllbGQ6IHN0cmluZyA9ICdmaWxlcyc7XG4gIHJlcXVlc3RzOiBBcnJheTxhbnk+ID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7IH1cblxuICAvKipcbiAgICogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIGVudmlhciBvcyBhcnF1aXZvcyBhbyBzZXJ2aWRvciwgY29uZm9ybWUgbyBwYXLDom1ldHJvIFVSTC5cbiAgICpcbiAgICogQHBhcmFtIHVybCBVUkwgZGEgcmVxdWlzacOnw6NvIGEgc2VyIGVmZXR1YWRhLlxuICAgKiBAcGFyYW0gZmlsZXMgQXJxdWl2b3MgYSBzZXJlbSBlbnZpYWRvcy5cbiAgICogQHBhcmFtIHRPblVwbG9hZCBGdW7Dp8OjbyBhIHNlciBleGVjdXRhZGEgcXVhbmRvIG8gYXJxdWl2byBmb3IgZW52aWFkbyBhbyBzZXJ2aWRvci5cbiAgICogQHBhcmFtIHVwbG9hZENhbGxiYWNrIEZ1bsOnw6NvIHF1ZSBzZXLDoSBleGVjdXRhZGEgZW5xdWFudG8gb3MgYXJxdWl2b3MgZXN0aXZlcmVtIHNlbmRvIGVudmlhZG9zLlxuICAgKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gYSByZXF1aXNpw6fDo28gZm9yIGVmZXR1YWRhIGNvbSBzdWNlc3NvLlxuICAgKiBAcGFyYW0gZXJyb3JDYWxsYmFjayBGdW7Dp8OjbyBhIHNlciBleGVjdXRhZGEgcXVhbmRvIGEgcmVxdWlzacOnw6NvIGZvaSBlZmV0dWFkYSBjb20gc3VjZXNzby5cbiAgICovXG4gIHB1YmxpYyB1cGxvYWQoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgZmlsZXM6IEFycmF5PFRoZlVwbG9hZEZpbGU+LFxuICAgIHRPblVwbG9hZDogRXZlbnRFbWl0dGVyPGFueT4sXG4gICAgdXBsb2FkQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBwZXJjZW50OiBudW1iZXIpID0+IHZvaWQsXG4gICAgc3VjY2Vzc0NhbGxiYWNrOiAoZmlsZTogVGhmVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZCxcbiAgICBlcnJvckNhbGxiYWNrOiAoZmlsZTogVGhmVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZCkge1xuXG4gICAgY29uc3QgZmlsZXNMZW5ndGggPSBmaWxlcy5sZW5ndGg7XG4gICAgY29uc3QgdXBsb2FkRXZlbnQ6IGFueSA9IHtcbiAgICAgIGRhdGE6IHt9LFxuICAgICAgZmlsZTogbnVsbFxuICAgIH07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGZvcm1EYXRhOiBGb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgY29uc3QgZmlsZSA9IGZpbGVzW2ldO1xuICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlLnJhd0ZpbGUubmFtZTtcblxuICAgICAgZm9ybURhdGEuYXBwZW5kKHRoaXMuZm9ybUZpZWxkLCBmaWxlLnJhd0ZpbGUsIGZpbGVOYW1lKTtcblxuICAgICAgLy8gRnVuw6fDo28gdXBsb2FkLCBvbmRlIG8gZGVzZW52b2x2ZWRvciBwb2RlIGVudmlhciBkYWRvcyBwYXJhIGEgcmVxdWlzacOnw6NvLlxuICAgICAgaWYgKHRPblVwbG9hZCkge1xuICAgICAgICB1cGxvYWRFdmVudFsnZmlsZSddID0gZmlsZTtcbiAgICAgICAgdE9uVXBsb2FkLmVtaXQodXBsb2FkRXZlbnQpO1xuXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZGF0YScsIEpTT04uc3RyaW5naWZ5KHVwbG9hZEV2ZW50LmRhdGEpKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZW5kRmlsZSh1cmwsIGZpbGUsIGZvcm1EYXRhLCB1cGxvYWRDYWxsYmFjaywgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2VuZEZpbGUoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgZmlsZTogVGhmVXBsb2FkRmlsZSxcbiAgICBmb3JtRGF0YTogRm9ybURhdGEsXG4gICAgdXBsb2FkQ2FsbGJhY2s6IChmaWxlOiBUaGZVcGxvYWRGaWxlLCBwZXJjZW50OiBudW1iZXIpID0+IHZvaWQsXG4gICAgc3VjY2Vzc0NhbGxiYWNrOiAoZmlsZTogVGhmVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZCxcbiAgICBlcnJvckNhbGxiYWNrOiAoZmlsZTogVGhmVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZCkge1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuZ2V0UmVxdWVzdCh1cmwsIGZvcm1EYXRhKS5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuXG4gICAgICBpZiAoZXZlbnQudHlwZSA9PT0gSHR0cEV2ZW50VHlwZS5VcGxvYWRQcm9ncmVzcykge1xuICAgICAgICB0aGlzLmFkZFJlcXVlc3QoZmlsZSwgcmVxdWVzdCk7XG5cbiAgICAgICAgY29uc3QgcGVyY2VudERvbmUgPSBNYXRoLnJvdW5kKDEwMCAqIGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsKTtcbiAgICAgICAgdXBsb2FkQ2FsbGJhY2soZmlsZSwgcGVyY2VudERvbmUpO1xuXG4gICAgICB9IGVsc2UgaWYgKGV2ZW50IGluc3RhbmNlb2YgSHR0cFJlc3BvbnNlKSB7XG4gICAgICAgIC8vIFN1Y2Vzc28sIGFycXVpdm9zIGVudmlhZG9zLlxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZmlsZSwgZXZlbnQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgKGVycjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgIGVycm9yQ2FsbGJhY2soZmlsZSwgZXJyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZXF1ZXN0KHVybDogc3RyaW5nLCBmb3JtRGF0YTogRm9ybURhdGEpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHJlcSA9IG5ldyBIdHRwUmVxdWVzdCgnUE9TVCcsIHVybCwgZm9ybURhdGEsIHtcbiAgICAgIHJlcG9ydFByb2dyZXNzOiB0cnVlXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QocmVxKTtcbiAgfVxuXG4gIHB1YmxpYyBzdG9wUmVxdWVzdEJ5RmlsZShmaWxlOiBhbnksIGNhbGxiYWNrOiAoKSA9PiB2b2lkKSB7XG4gICAgY29uc3QgcmVxdWVzdE9iaiA9IHRoaXMucmVxdWVzdHMuZmluZChyZXEgPT4ge1xuICAgICAgcmV0dXJuIHJlcS5maWxlLnVpZCA9PT0gZmlsZS51aWQ7XG4gICAgfSk7XG5cbiAgICBpZiAocmVxdWVzdE9iaikge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHJlcXVlc3RPYmoucmVxdWVzdDtcbiAgICAgIHJlcXVlc3QudW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMucmVtb3ZlUmVxdWVzdChyZXF1ZXN0T2JqKTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlbW92ZVJlcXVlc3QocmVxdWVzdE9iajogYW55KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnJlcXVlc3RzLmluZGV4T2YocmVxdWVzdE9iaik7XG4gICAgdGhpcy5yZXF1ZXN0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG5cbiAgcHVibGljIGFkZFJlcXVlc3QoZmlsZTogVGhmVXBsb2FkRmlsZSwgcmVxdWVzdDogU3Vic2NyaXB0aW9uKSB7XG4gICAgY29uc3QgaGFzUmVxdWVzdCA9IHRoaXMucmVxdWVzdHMuc29tZShyZXEgPT4ge1xuICAgICAgcmV0dXJuIHJlcS5maWxlLnVpZCA9PT0gZmlsZS51aWQ7XG4gICAgfSk7XG5cbiAgICBpZiAoIWhhc1JlcXVlc3QpIHtcbiAgICAgIHRoaXMucmVxdWVzdHMucHVzaCh7ZmlsZSwgcmVxdWVzdH0pO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=