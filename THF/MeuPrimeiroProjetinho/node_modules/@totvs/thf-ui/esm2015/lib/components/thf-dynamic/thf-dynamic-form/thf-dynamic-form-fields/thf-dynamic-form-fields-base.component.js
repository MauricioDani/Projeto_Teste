/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Input } from '@angular/core';
import { isTypeof } from '../../../../utils/util';
import { getGridColumnsClasses, isVisibleField } from '../../thf-dynamic.util';
import { ThfDynamicFieldType } from '../../thf-dynamic-field-type.enum';
export class ThfDynamicFormFieldsBaseComponent {
    /**
     * @param {?} titleCasePipe
     */
    constructor(titleCasePipe) {
        this.titleCasePipe = titleCasePipe;
        this._value = {};
        this.visibleFields = [];
    }
    // array de objetos que implementam a interface ThfDynamicFormField, que serão exibidos no componente.
    /**
     * @param {?} value
     * @return {?}
     */
    set fields(value) {
        this._fields = Array.isArray(value) ? [...value] : [];
    }
    /**
     * @return {?}
     */
    get fields() {
        return this._fields;
    }
    // valor que será utilizado para iniciar valor no componente.
    /**
     * @param {?} value
     * @return {?}
     */
    set value(value) {
        this._value = value && isTypeof(value, 'object') ? value : {};
    }
    /**
     * @return {?}
     */
    get value() {
        return this._value;
    }
    /**
     * @param {?} value
     * @param {?} compareTo
     * @return {?}
     */
    compareTo(value, compareTo) {
        return value === compareTo;
    }
    // retorna um array com os objetos configurados e visiveis.
    /**
     * @protected
     * @return {?}
     */
    getVisibleFields() {
        /** @type {?} */
        const visibleFields = [];
        this.fields.forEach((/**
         * @param {?} field
         * @return {?}
         */
        field => {
            if (this.existsProperty(visibleFields, field.property)) {
                this.printError(`"thf-dynamic-form" property "${field.property}" está duplicado. Interface: ThfDynamicFormField.`);
                return;
            }
            if (!field['property']) {
                this.printError('"thf-dynamic-form" É obrigatório ser especificado um property.');
                return;
            }
            if (isVisibleField(field)) {
                visibleFields.push(this.createField(field));
            }
        }));
        return visibleFields;
    }
    // converte um array em string para um array de objetos que contem label e value.
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    convertOptions(options) {
        /** @type {?} */
        const everyOptionString = options.every((/**
         * @param {?} option
         * @return {?}
         */
        option => typeof option === 'string'));
        if (everyOptionString) {
            return options.map((/**
             * @param {?} value
             * @return {?}
             */
            value => ({ label: value, value })));
        }
        return options;
    }
    // cria um novo objeto com as classes de grid system, com control (tipo do componente) e label default.
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    createField(field) {
        /** @type {?} */
        const control = this.getComponentControl(field);
        /** @type {?} */
        const options = !!field.options ? this.convertOptions(field.options) : undefined;
        /** @type {?} */
        const componentClass = getGridColumnsClasses(field.gridSmColumns, field.gridMdColumns, field.gridLgColumns, field.gridXlColumns, field.gridColumns);
        return Object.assign({ label: this.titleCasePipe.transform(field.property) }, field, { componentClass,
            control,
            options });
    }
    /**
     * @private
     * @param {?} fields
     * @param {?} property
     * @return {?}
     */
    existsProperty(fields, property) {
        return fields.some((/**
         * @param {?} field
         * @return {?}
         */
        field => {
            return field.property === property;
        }));
    }
    // recupera o componente de acordo com algumas regras do field.
    /**
     * @private
     * @param {?=} field
     * @return {?}
     */
    getComponentControl(field = (/** @type {?} */ ({}))) {
        /** @type {?} */
        const type = field && field.type ? field.type.toLocaleLowerCase() : 'string';
        if (this.isNumberType(field, type)) {
            return 'number';
        }
        else if (this.isCurrencyType(field, type)) {
            return 'decimal';
        }
        else if (this.isSelect(field)) {
            return 'select';
        }
        else if (this.isRadioGroup(field)) {
            return 'radioGroup';
        }
        else if (this.isCheckboxGroup(field)) {
            return 'checkboxGroup';
        }
        else if (this.isMultiselect(field)) {
            return 'multiselect';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Boolean)) {
            return 'switch';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Date) || this.compareTo(type, ThfDynamicFieldType.DateTime)) {
            return 'datepicker';
        }
        else if (this.compareTo(type, ThfDynamicFieldType.Time)) {
            field.mask = field.mask || '99:99';
            return 'input';
        }
        else if (this.isCombo(field)) {
            return 'combo';
        }
        else if (this.isLookup(field)) {
            return 'lookup';
        }
        else if (this.isTextarea(field)) {
            return 'textarea';
        }
        else if (this.isPassword(field)) {
            return 'password';
        }
        return 'input';
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isCheckboxGroup(field) {
        const { optionsService, optionsMulti, options } = field;
        return !optionsService && optionsMulti && !!options && options.length <= 3;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isCombo(field) {
        const { optionsService } = field;
        return !!optionsService && isTypeof(optionsService, 'string');
    }
    /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    isCurrencyType(field, type) {
        const { mask, pattern } = field;
        return this.compareTo(type, ThfDynamicFieldType.Currency) && (!mask && !pattern);
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isLookup(field) {
        const { searchService } = field;
        return !!searchService && isTypeof(searchService, 'string');
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isMultiselect(field) {
        const { optionsService, optionsMulti, options } = field;
        return !optionsService && optionsMulti && !!options && options.length > 3;
    }
    /**
     * @private
     * @param {?} field
     * @param {?} type
     * @return {?}
     */
    isNumberType(field, type) {
        const { mask, pattern } = field;
        return this.compareTo(type, ThfDynamicFieldType.Number) && (!mask && !pattern);
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isPassword(field) {
        const { secret } = field;
        return secret;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isRadioGroup(field) {
        const { optionsMulti, options } = field;
        return !optionsMulti && !!options && options.length <= 3;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isSelect(field) {
        const { optionsMulti, options } = field;
        return !optionsMulti && !!options && options.length > 3;
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    isTextarea(field) {
        const { rows } = field;
        return rows && rows >= 3;
    }
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    printError(error) {
        console.error(error);
    }
}
ThfDynamicFormFieldsBaseComponent.propDecorators = {
    fields: [{ type: Input, args: ['t-fields',] }],
    value: [{ type: Input, args: ['t-value',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype._fields;
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype._value;
    /** @type {?} */
    ThfDynamicFormFieldsBaseComponent.prototype.visibleFields;
    /**
     * @type {?}
     * @private
     */
    ThfDynamicFormFieldsBaseComponent.prototype.titleCasePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWR5bmFtaWMtZm9ybS1maWVsZHMtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWR5bmFtaWMvdGhmLWR5bmFtaWMtZm9ybS90aGYtZHluYW1pYy1mb3JtLWZpZWxkcy90aGYtZHluYW1pYy1mb3JtLWZpZWxkcy1iYXNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUd0QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFbEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLGNBQWMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9FLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBSXhFLE1BQU0sT0FBTyxpQ0FBaUM7Ozs7SUF5QjVDLFlBQW9CLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBdEJ4QyxXQUFNLEdBQVMsRUFBRSxDQUFDO1FBRTFCLGtCQUFhLEdBQXVDLEVBQUUsQ0FBQztJQW9CSixDQUFDOzs7Ozs7SUFqQnBELElBQXVCLE1BQU0sQ0FBQyxLQUFpQztRQUM3RCxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ3hELENBQUM7Ozs7SUFFRCxJQUFJLE1BQU07UUFDUixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDdEIsQ0FBQzs7Ozs7O0lBR0QsSUFBc0IsS0FBSyxDQUFDLEtBQVU7UUFDcEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLElBQUksUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENB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LEtBQUssU0FBQyxVQUFVO29CQVNoQixLQUFLLFNBQUMsU0FBUzs7Ozs7OztJQWZoQixvREFBNEM7Ozs7O0lBQzVDLG1EQUEwQjs7SUFFMUIsMERBQXVEOzs7OztJQW9CM0MsMERBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRpdGxlQ2FzZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5pbXBvcnQgeyBpc1R5cGVvZiB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBnZXRHcmlkQ29sdW1uc0NsYXNzZXMsIGlzVmlzaWJsZUZpZWxkIH0gZnJvbSAnLi4vLi4vdGhmLWR5bmFtaWMudXRpbCc7XG5pbXBvcnQgeyBUaGZEeW5hbWljRmllbGRUeXBlIH0gZnJvbSAnLi4vLi4vdGhmLWR5bmFtaWMtZmllbGQtdHlwZS5lbnVtJztcbmltcG9ydCB7IFRoZkR5bmFtaWNGb3JtRmllbGQgfSBmcm9tICcuLi90aGYtZHluYW1pYy1mb3JtLWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBUaGZEeW5hbWljRm9ybUZpZWxkSW50ZXJuYWwgfSBmcm9tICcuL3RoZi1keW5hbWljLWZvcm0tZmllbGQtaW50ZXJuYWwuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNsYXNzIFRoZkR5bmFtaWNGb3JtRmllbGRzQmFzZUNvbXBvbmVudCB7XG5cbiAgcHJpdmF0ZSBfZmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkPjtcbiAgcHJpdmF0ZSBfdmFsdWU/OiBhbnkgPSB7fTtcblxuICB2aXNpYmxlRmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkSW50ZXJuYWw+ID0gW107XG5cbiAgLy8gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgVGhmRHluYW1pY0Zvcm1GaWVsZCwgcXVlIHNlcsOjbyBleGliaWRvcyBubyBjb21wb25lbnRlLlxuICBASW5wdXQoJ3QtZmllbGRzJykgc2V0IGZpZWxkcyh2YWx1ZTogQXJyYXk8VGhmRHluYW1pY0Zvcm1GaWVsZD4pIHtcbiAgICB0aGlzLl9maWVsZHMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IFsuLi52YWx1ZV0gOiBbXTtcbiAgfVxuXG4gIGdldCBmaWVsZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpZWxkcztcbiAgfVxuXG4gIC8vIHZhbG9yIHF1ZSBzZXLDoSB1dGlsaXphZG8gcGFyYSBpbmljaWFyIHZhbG9yIG5vIGNvbXBvbmVudGUuXG4gIEBJbnB1dCgndC12YWx1ZScpIHNldCB2YWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZSAmJiBpc1R5cGVvZih2YWx1ZSwgJ29iamVjdCcpID8gdmFsdWUgOiB7fTtcbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRpdGxlQ2FzZVBpcGU6IFRpdGxlQ2FzZVBpcGUpIHt9XG5cbiAgY29tcGFyZVRvKHZhbHVlLCBjb21wYXJlVG8pIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IGNvbXBhcmVUbztcbiAgfVxuXG4gIC8vIHJldG9ybmEgdW0gYXJyYXkgY29tIG9zIG9iamV0b3MgY29uZmlndXJhZG9zIGUgdmlzaXZlaXMuXG4gIHByb3RlY3RlZCBnZXRWaXNpYmxlRmllbGRzKCkge1xuICAgIGNvbnN0IHZpc2libGVGaWVsZHMgPSBbXTtcblxuICAgIHRoaXMuZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgaWYgKHRoaXMuZXhpc3RzUHJvcGVydHkodmlzaWJsZUZpZWxkcywgZmllbGQucHJvcGVydHkpKSB7XG4gICAgICAgIHRoaXMucHJpbnRFcnJvcihgXCJ0aGYtZHluYW1pYy1mb3JtXCIgcHJvcGVydHkgXCIke2ZpZWxkLnByb3BlcnR5fVwiIGVzdMOhIGR1cGxpY2Fkby4gSW50ZXJmYWNlOiBUaGZEeW5hbWljRm9ybUZpZWxkLmApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghZmllbGRbJ3Byb3BlcnR5J10pIHtcbiAgICAgICAgdGhpcy5wcmludEVycm9yKCdcInRoZi1keW5hbWljLWZvcm1cIiDDiSBvYnJpZ2F0w7NyaW8gc2VyIGVzcGVjaWZpY2FkbyB1bSBwcm9wZXJ0eS4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNWaXNpYmxlRmllbGQoZmllbGQpKSB7XG4gICAgICAgIHZpc2libGVGaWVsZHMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkKGZpZWxkKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdmlzaWJsZUZpZWxkcztcbiAgfVxuXG4gIC8vIGNvbnZlcnRlIHVtIGFycmF5IGVtIHN0cmluZyBwYXJhIHVtIGFycmF5IGRlIG9iamV0b3MgcXVlIGNvbnRlbSBsYWJlbCBlIHZhbHVlLlxuICBwcml2YXRlIGNvbnZlcnRPcHRpb25zKG9wdGlvbnM6IEFycmF5PGFueT4pOiBBcnJheTx7IGxhYmVsOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IGV2ZXJ5T3B0aW9uU3RyaW5nID0gb3B0aW9ucy5ldmVyeShvcHRpb24gPT4gdHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpO1xuXG4gICAgaWYgKGV2ZXJ5T3B0aW9uU3RyaW5nKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5tYXAodmFsdWUgPT4gKHtsYWJlbDogdmFsdWUsIHZhbHVlfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgLy8gY3JpYSB1bSBub3ZvIG9iamV0byBjb20gYXMgY2xhc3NlcyBkZSBncmlkIHN5c3RlbSwgY29tIGNvbnRyb2wgKHRpcG8gZG8gY29tcG9uZW50ZSkgZSBsYWJlbCBkZWZhdWx0LlxuICBwcml2YXRlIGNyZWF0ZUZpZWxkKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKTogVGhmRHluYW1pY0Zvcm1GaWVsZEludGVybmFsIHtcbiAgICBjb25zdCBjb250cm9sID0gdGhpcy5nZXRDb21wb25lbnRDb250cm9sKGZpZWxkKTtcbiAgICBjb25zdCBvcHRpb25zID0gISFmaWVsZC5vcHRpb25zID8gdGhpcy5jb252ZXJ0T3B0aW9ucyhmaWVsZC5vcHRpb25zKSA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IGNvbXBvbmVudENsYXNzID0gZ2V0R3JpZENvbHVtbnNDbGFzc2VzKGZpZWxkLmdyaWRTbUNvbHVtbnMsXG4gICAgICBmaWVsZC5ncmlkTWRDb2x1bW5zLFxuICAgICAgZmllbGQuZ3JpZExnQ29sdW1ucyxcbiAgICAgIGZpZWxkLmdyaWRYbENvbHVtbnMsXG4gICAgICBmaWVsZC5ncmlkQ29sdW1ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6IHRoaXMudGl0bGVDYXNlUGlwZS50cmFuc2Zvcm0oZmllbGQucHJvcGVydHkpLFxuICAgICAgLi4uZmllbGQsXG4gICAgICBjb21wb25lbnRDbGFzcyxcbiAgICAgIGNvbnRyb2wsXG4gICAgICBvcHRpb25zXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZXhpc3RzUHJvcGVydHkoZmllbGRzOiBBcnJheTxUaGZEeW5hbWljRm9ybUZpZWxkPiwgcHJvcGVydHk6IHN0cmluZykge1xuICAgIHJldHVybiBmaWVsZHMuc29tZShmaWVsZCA9PiB7XG4gICAgICByZXR1cm4gZmllbGQucHJvcGVydHkgPT09IHByb3BlcnR5O1xuICAgIH0pO1xuICB9XG5cbiAgLy8gcmVjdXBlcmEgbyBjb21wb25lbnRlIGRlIGFjb3JkbyBjb20gYWxndW1hcyByZWdyYXMgZG8gZmllbGQuXG4gIHByaXZhdGUgZ2V0Q29tcG9uZW50Q29udHJvbChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCA9IDxhbnk+IHt9KSB7XG4gICAgY29uc3QgdHlwZSA9IGZpZWxkICYmIGZpZWxkLnR5cGUgPyBmaWVsZC50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgOiAnc3RyaW5nJztcblxuICAgIGlmICh0aGlzLmlzTnVtYmVyVHlwZShmaWVsZCwgdHlwZSkpIHtcbiAgICAgIHJldHVybiAnbnVtYmVyJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDdXJyZW5jeVR5cGUoZmllbGQsIHR5cGUpKSB7XG4gICAgICByZXR1cm4gJ2RlY2ltYWwnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlbGVjdChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnc2VsZWN0JztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNSYWRpb0dyb3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdyYWRpb0dyb3VwJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDaGVja2JveEdyb3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdjaGVja2JveEdyb3VwJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNdWx0aXNlbGVjdChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnbXVsdGlzZWxlY3QnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5Cb29sZWFuKSkge1xuICAgICAgcmV0dXJuICdzd2l0Y2gnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5EYXRlKSB8fCB0aGlzLmNvbXBhcmVUbyh0eXBlLCBUaGZEeW5hbWljRmllbGRUeXBlLkRhdGVUaW1lKSkge1xuICAgICAgcmV0dXJuICdkYXRlcGlja2VyJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29tcGFyZVRvKHR5cGUsIFRoZkR5bmFtaWNGaWVsZFR5cGUuVGltZSkpIHtcbiAgICAgIGZpZWxkLm1hc2sgPSBmaWVsZC5tYXNrIHx8ICc5OTo5OSc7XG5cbiAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc0NvbWJvKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdjb21ibyc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTG9va3VwKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdsb29rdXAnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1RleHRhcmVhKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICd0ZXh0YXJlYSc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzUGFzc3dvcmQoZmllbGQpKSB7XG4gICAgICByZXR1cm4gJ3Bhc3N3b3JkJztcbiAgICB9XG5cbiAgICByZXR1cm4gJ2lucHV0JztcbiAgfVxuXG4gIHByaXZhdGUgaXNDaGVja2JveEdyb3VwKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBvcHRpb25zU2VydmljZSwgb3B0aW9uc011bHRpLCBvcHRpb25zIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiAhb3B0aW9uc1NlcnZpY2UgJiYgb3B0aW9uc011bHRpICYmICEhb3B0aW9ucyAmJiBvcHRpb25zLmxlbmd0aCA8PSAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbWJvKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBvcHRpb25zU2VydmljZSB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gISFvcHRpb25zU2VydmljZSAmJiBpc1R5cGVvZihvcHRpb25zU2VydmljZSwgJ3N0cmluZycpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0N1cnJlbmN5VHlwZShmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCwgdHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBtYXNrLCBwYXR0ZXJuIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh0eXBlLCBUaGZEeW5hbWljRmllbGRUeXBlLkN1cnJlbmN5KSAmJiAoIW1hc2sgJiYgIXBhdHRlcm4pO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvb2t1cChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgc2VhcmNoU2VydmljZSB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gISFzZWFyY2hTZXJ2aWNlICYmIGlzVHlwZW9mKHNlYXJjaFNlcnZpY2UsICdzdHJpbmcnKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNNdWx0aXNlbGVjdChmaWVsZDogVGhmRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgb3B0aW9uc1NlcnZpY2UsIG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNTZXJ2aWNlICYmIG9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc051bWJlclR5cGUoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQsIHR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IHsgbWFzaywgcGF0dGVybiB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gdGhpcy5jb21wYXJlVG8odHlwZSwgVGhmRHluYW1pY0ZpZWxkVHlwZS5OdW1iZXIpICYmICghbWFzayAmJiAhcGF0dGVybik7XG4gIH1cblxuICBwcml2YXRlIGlzUGFzc3dvcmQoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IHNlY3JldCB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gc2VjcmV0O1xuICB9XG5cbiAgcHJpdmF0ZSBpc1JhZGlvR3JvdXAoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPD0gMztcbiAgfVxuXG4gIHByaXZhdGUgaXNTZWxlY3QoZmllbGQ6IFRoZkR5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1RleHRhcmVhKGZpZWxkOiBUaGZEeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyByb3dzIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiByb3dzICYmIHJvd3MgPj0gMztcbiAgfVxuXG4gIHByaXZhdGUgcHJpbnRFcnJvcihlcnJvcjogc3RyaW5nKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gIH1cblxufVxuIl19