/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input, Output } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, isKeyCodeEnter, thfLocaleDefault } from '../../utils/util';
/** @type {?} */
export const thfDisclaimerGroupLiteralsDefault = {
    en: { removeAll: 'Remove all' },
    es: { removeAll: 'Eliminar todos' },
    pt: { removeAll: 'Remover todos' }
};
/**
 * \@description
 *
 * O componente `thf-disclaimer-group` é recomendado para manipular palavras-chave de filtros aplicados em uma pesquisa.
 *
 * À partir de dois *disclaimers* com o botão **fechar** habilitado, o componente renderiza de forma automática um novo e destacado
 * *disclaimer* que possibilita **remover todos**, mas que também pode ser desabilitado.
 *
 * Também é possível navegar entre os *disclaimers* através do teclado utilizando a tecla *tab* e, para remoção do *disclaimer* selecionado,
 * basta pressionar a tecla *enter*. Esta funcionalidade não se aplica caso a propriedade `hideClose` estiver habilitada.
 *
 * > Veja a integração destas funcionalidade no componente [thf-page-list](/documentation/thf-page-list).
 */
export class ThfDisclaimerGroupBaseComponent {
    /**
     * @param {?} differs
     */
    constructor(differs) {
        this._disclaimers = [];
        this._hideRemoveAll = false;
        this.previousDisclaimers = [];
        this.literals = Object.assign({}, thfDisclaimerGroupLiteralsDefault[thfLocaleDefault], thfDisclaimerGroupLiteralsDefault[browserLanguage()]);
        /**
         * Função que será disparada quando a lista de *disclaimers* for modificada.
         */
        this.change = new EventEmitter();
        this.differ = differs.find([]).create(null);
    }
    /** Lista de *disclaimers*. */
    /**
     * \@description
     *
     * Lista de *disclaimers*.
     *
     * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `ThfDisclaimer`.
     *
     * Exemplo adicionando um *disclaimer* no array:
     *
     * ```
     * this.disclaimers = [...this.disclaimers, disclaimer];
     * ```
     *
     * ou
     *
     * ```
     * this.disclaimers = this.disclaimers.concat(disclaimer);
     * ```
     * @param {?} value
     * @return {?}
     */
    set disclaimers(value) {
        this.previousDisclaimers = [...this.disclaimers];
        this._disclaimers = this.checkDisclaimers(value);
    }
    /**
     * @return {?}
     */
    get disclaimers() {
        return this._disclaimers;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Oculta o botão para remover todos os *disclaimers* do grupo.
     *
     * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
     *
     * \@default `false`
     * @param {?} value
     * @return {?}
     */
    set hideRemoveAll(value) {
        this._hideRemoveAll = (/** @type {?} */ (value)) === '' ? true : convertToBoolean(value);
    }
    /**
     * @return {?}
     */
    get hideRemoveAll() {
        return this._hideRemoveAll;
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        this.checkChanges();
    }
    /**
     * @param {?} disclaimer
     * @param {?=} emitChange
     * @return {?}
     */
    closeItem(disclaimer, emitChange = true) {
        /** @type {?} */
        const itemIndex = this.disclaimers.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d['$id'] === disclaimer['$id']));
        this.disclaimers.splice(itemIndex, 1);
        if (emitChange) {
            this.emitChangeDisclaimers();
        }
    }
    /**
     * @return {?}
     */
    isRemoveAll() {
        return !this.hideRemoveAll && this.disclaimers.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => !c.hideClose)).length > 1;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onKeyPress(event) {
        if (isKeyCodeEnter(event)) {
            this.removeAllItems();
        }
    }
    /**
     * @return {?}
     */
    removeAllItems() {
        /** @type {?} */
        const removeItems = [];
        this.disclaimers.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        disclaimer => {
            if (!disclaimer.hideClose) {
                removeItems.push(disclaimer);
            }
        }));
        removeItems.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        disclaimer => this.closeItem(disclaimer, false)));
        this.emitChangeDisclaimers();
    }
    /**
     * @private
     * @return {?}
     */
    checkChanges() {
        if (this.differ) {
            /** @type {?} */
            const changes = this.differ.diff(this.disclaimers);
            if (changes && this.disclaimersAreChanged(this.disclaimers)) {
                this.emitChangeDisclaimers();
            }
        }
    }
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    checkDisclaimers(disclaimers) {
        if (Array.isArray(disclaimers)) {
            for (let i = 0; i < disclaimers.length; i++) {
                /** @type {?} */
                const disclaimer = disclaimers[i];
                if (disclaimer.value || disclaimer.value === 0 || disclaimer.value === false) {
                    disclaimer['$id'] = uuid();
                }
                else {
                    disclaimers.splice(i, 1);
                    i--;
                }
            }
            return disclaimers;
        }
        return [];
    }
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    disclaimersAreChanged(disclaimers) {
        /** @type {?} */
        const currentValues = disclaimers;
        if (currentValues.length !== this.previousDisclaimers.length) {
            return true;
        }
        return currentValues.some((/**
         * @param {?} disclaimer
         * @param {?} index
         * @return {?}
         */
        (disclaimer, index) => disclaimer.value !== this.previousDisclaimers[index].value
            || disclaimer.property !== this.previousDisclaimers[index].property));
    }
    /**
     * @private
     * @return {?}
     */
    emitChangeDisclaimers() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.change.emit(this.disclaimers);
        }));
        this.previousDisclaimers = [...this._disclaimers];
    }
}
ThfDisclaimerGroupBaseComponent.propDecorators = {
    disclaimers: [{ type: Input, args: ['t-disclaimers',] }],
    hideRemoveAll: [{ type: Input, args: ['t-hide-remove-all',] }],
    title: [{ type: Input, args: ['t-title',] }],
    change: [{ type: Output, args: ['t-change',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype._disclaimers;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype._hideRemoveAll;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfDisclaimerGroupBaseComponent.prototype.previousDisclaimers;
    /** @type {?} */
    ThfDisclaimerGroupBaseComponent.prototype.literals;
    /**
     * Título do grupo de *disclaimers*.
     * @type {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.title;
    /**
     * Função que será disparada quando a lista de *disclaimers* for modificada.
     * @type {?}
     */
    ThfDisclaimerGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWRpc2NsYWltZXItZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdG90dnMvdGhmLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGhmLWRpc2NsYWltZXItZ3JvdXAvdGhmLWRpc2NsYWltZXItZ3JvdXAtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBVyxZQUFZLEVBQUUsS0FBSyxFQUFtQixNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdEYsT0FBTyxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7QUFJdkcsTUFBTSxPQUFPLGlDQUFpQyxHQUFHO0lBQy9DLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUU7SUFDL0IsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO0lBQ25DLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUU7Q0FDbkM7Ozs7Ozs7Ozs7Ozs7O0FBZUQsTUFBTSxPQUFPLCtCQUErQjs7OztJQXVFMUMsWUFBWSxPQUF3QjtRQXJFNUIsaUJBQVksR0FBeUIsRUFBRSxDQUFDO1FBQ3hDLG1CQUFjLEdBQVksS0FBSyxDQUFDO1FBR2hDLHdCQUFtQixHQUF5QixFQUFFLENBQUM7UUFFOUMsYUFBUSxxQkFDVixpQ0FBaUMsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUNuRCxpQ0FBaUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUN6RDs7OztRQTBEa0IsV0FBTSxHQUF1QixJQUFJLFlBQVksRUFBTyxDQUFDO1FBR3ZFLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxD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QUM7SUFDcEQsQ0FBQzs7OzBCQXBJQSxLQUFLLFNBQUMsZUFBZTs0QkFzQnJCLEtBQUssU0FBQyxtQkFBbUI7b0JBVXpCLEtBQUssU0FBQyxTQUFTO3FCQUdmLE1BQU0sU0FBQyxVQUFVOzs7Ozs7O0lBbkVsQix1REFBZ0Q7Ozs7O0lBQ2hELHlEQUF3Qzs7Ozs7SUFFeEMsaURBQWU7Ozs7O0lBQ2YsOERBQXVEOztJQUV2RCxtREFHRTs7Ozs7SUF1REYsZ0RBQWlDOzs7OztJQUdqQyxpREFBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb0NoZWNrLCBFdmVudEVtaXR0ZXIsIElucHV0LCBJdGVyYWJsZURpZmZlcnMsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSAndXVpZCc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgaXNLZXlDb2RlRW50ZXIsIHRoZkxvY2FsZURlZmF1bHQgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgVGhmRGlzY2xhaW1lciB9IGZyb20gJy4uL3RoZi1kaXNjbGFpbWVyL3RoZi1kaXNjbGFpbWVyLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjb25zdCB0aGZEaXNjbGFpbWVyR3JvdXBMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiB7IHJlbW92ZUFsbDogJ1JlbW92ZSBhbGwnIH0sXG4gIGVzOiB7IHJlbW92ZUFsbDogJ0VsaW1pbmFyIHRvZG9zJyB9LFxuICBwdDogeyByZW1vdmVBbGw6ICdSZW1vdmVyIHRvZG9zJyB9XG59O1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gY29tcG9uZW50ZSBgdGhmLWRpc2NsYWltZXItZ3JvdXBgIMOpIHJlY29tZW5kYWRvIHBhcmEgbWFuaXB1bGFyIHBhbGF2cmFzLWNoYXZlIGRlIGZpbHRyb3MgYXBsaWNhZG9zIGVtIHVtYSBwZXNxdWlzYS5cbiAqXG4gKiDDgCBwYXJ0aXIgZGUgZG9pcyAqZGlzY2xhaW1lcnMqIGNvbSBvIGJvdMOjbyAqKmZlY2hhcioqIGhhYmlsaXRhZG8sIG8gY29tcG9uZW50ZSByZW5kZXJpemEgZGUgZm9ybWEgYXV0b23DoXRpY2EgdW0gbm92byBlIGRlc3RhY2Fkb1xuICogKmRpc2NsYWltZXIqIHF1ZSBwb3NzaWJpbGl0YSAqKnJlbW92ZXIgdG9kb3MqKiwgbWFzIHF1ZSB0YW1iw6ltIHBvZGUgc2VyIGRlc2FiaWxpdGFkby5cbiAqXG4gKiBUYW1iw6ltIMOpIHBvc3PDrXZlbCBuYXZlZ2FyIGVudHJlIG9zICpkaXNjbGFpbWVycyogYXRyYXbDqXMgZG8gdGVjbGFkbyB1dGlsaXphbmRvIGEgdGVjbGEgKnRhYiogZSwgcGFyYSByZW1vw6fDo28gZG8gKmRpc2NsYWltZXIqIHNlbGVjaW9uYWRvLFxuICogYmFzdGEgcHJlc3Npb25hciBhIHRlY2xhICplbnRlciouIEVzdGEgZnVuY2lvbmFsaWRhZGUgbsOjbyBzZSBhcGxpY2EgY2FzbyBhIHByb3ByaWVkYWRlIGBoaWRlQ2xvc2VgIGVzdGl2ZXIgaGFiaWxpdGFkYS5cbiAqXG4gKiA+IFZlamEgYSBpbnRlZ3Jhw6fDo28gZGVzdGFzIGZ1bmNpb25hbGlkYWRlIG5vIGNvbXBvbmVudGUgW3RoZi1wYWdlLWxpc3RdKC9kb2N1bWVudGF0aW9uL3RoZi1wYWdlLWxpc3QpLlxuICovXG5leHBvcnQgY2xhc3MgVGhmRGlzY2xhaW1lckdyb3VwQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHByaXZhdGUgX2Rpc2NsYWltZXJzOiBBcnJheTxUaGZEaXNjbGFpbWVyPiA9IFtdO1xuICBwcml2YXRlIF9oaWRlUmVtb3ZlQWxsOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBkaWZmZXI7XG4gIHByaXZhdGUgcHJldmlvdXNEaXNjbGFpbWVyczogQXJyYXk8VGhmRGlzY2xhaW1lcj4gPSBbXTtcblxuICByZWFkb25seSBsaXRlcmFscyA9IHtcbiAgICAgIC4uLnRoZkRpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFt0aGZMb2NhbGVEZWZhdWx0XSxcbiAgICAgIC4uLnRoZkRpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFticm93c2VyTGFuZ3VhZ2UoKV1cbiAgfTtcblxuICAvKiogTGlzdGEgZGUgKmRpc2NsYWltZXJzKi4gKi9cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIExpc3RhIGRlICpkaXNjbGFpbWVycyouXG4gICAqXG4gICAqIFBhcmEgcXVlIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBzZWphIGF0dWFsaXphZGEgZGluYW1pY2FtZW50ZSBkZXZlLXNlIHBhc3NhciB1bWEgbm92YSByZWZlcsOqbmNpYSBkbyBhcnJheSBkZSBgVGhmRGlzY2xhaW1lcmAuXG4gICAqXG4gICAqIEV4ZW1wbG8gYWRpY2lvbmFuZG8gdW0gKmRpc2NsYWltZXIqIG5vIGFycmF5OlxuICAgKlxuICAgKiBgYGBcbiAgICogdGhpcy5kaXNjbGFpbWVycyA9IFsuLi50aGlzLmRpc2NsYWltZXJzLCBkaXNjbGFpbWVyXTtcbiAgICogYGBgXG4gICAqXG4gICAqIG91XG4gICAqXG4gICAqIGBgYFxuICAgKiB0aGlzLmRpc2NsYWltZXJzID0gdGhpcy5kaXNjbGFpbWVycy5jb25jYXQoZGlzY2xhaW1lcik7XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KCd0LWRpc2NsYWltZXJzJykgc2V0IGRpc2NsYWltZXJzKHZhbHVlOiBBcnJheTxUaGZEaXNjbGFpbWVyPikge1xuXG4gICAgdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzID0gWy4uLnRoaXMuZGlzY2xhaW1lcnNdO1xuICAgIHRoaXMuX2Rpc2NsYWltZXJzID0gdGhpcy5jaGVja0Rpc2NsYWltZXJzKHZhbHVlKTtcblxuICB9XG5cbiAgZ2V0IGRpc2NsYWltZXJzKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNjbGFpbWVycztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE9jdWx0YSBvIGJvdMOjbyBwYXJhIHJlbW92ZXIgdG9kb3Mgb3MgKmRpc2NsYWltZXJzKiBkbyBncnVwby5cbiAgICpcbiAgICogPiBQb3IgcGFkcsOjbywgbyBtZXNtbyDDqSBleGliaWRvIMOgIHBhcnRpciBkZSBkb2lzIG91IG1haXMgKmRpc2NsYWltZXJzKiBjb20gYSBvcMOnw6NvIGBoaWRlQ2xvc2VgIGhhYmlsaXRhZGEuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgndC1oaWRlLXJlbW92ZS1hbGwnKVxuICBzZXQgaGlkZVJlbW92ZUFsbCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVSZW1vdmVBbGwgPSA8YW55PnZhbHVlID09PSAnJyA/IHRydWUgOiBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIGdldCBoaWRlUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiB0aGlzLl9oaWRlUmVtb3ZlQWxsO1xuICB9XG5cbiAgLyoqIFTDrXR1bG8gZG8gZ3J1cG8gZGUgKmRpc2NsYWltZXJzKi4gKi9cbiAgQElucHV0KCd0LXRpdGxlJykgdGl0bGU/OiBzdHJpbmc7XG5cbiAgLyoqIEZ1bsOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgcXVhbmRvIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBmb3IgbW9kaWZpY2FkYS4gKi9cbiAgQE91dHB1dCgndC1jaGFuZ2UnKSBjaGFuZ2U/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGNvbnN0cnVjdG9yKGRpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycykge1xuICAgIHRoaXMuZGlmZmVyID0gZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7XG4gICAgdGhpcy5jaGVja0NoYW5nZXMoKTtcbiAgfVxuXG4gIGNsb3NlSXRlbShkaXNjbGFpbWVyOiBhbnksIGVtaXRDaGFuZ2U6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5kaXNjbGFpbWVycy5maW5kSW5kZXgoZCA9PiBkWyckaWQnXSA9PT0gZGlzY2xhaW1lclsnJGlkJ10pO1xuICAgIHRoaXMuZGlzY2xhaW1lcnMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG5cbiAgICBpZiAoZW1pdENoYW5nZSkge1xuICAgICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgICB9XG4gIH1cblxuICBpc1JlbW92ZUFsbCgpIHtcbiAgICByZXR1cm4gIXRoaXMuaGlkZVJlbW92ZUFsbCAmJiB0aGlzLmRpc2NsYWltZXJzLmZpbHRlcihjID0+ICFjLmhpZGVDbG9zZSkubGVuZ3RoID4gMTtcbiAgfVxuXG4gIG9uS2V5UHJlc3MoZXZlbnQ6IGFueSkge1xuXG4gICAgaWYgKGlzS2V5Q29kZUVudGVyKGV2ZW50KSkge1xuICAgICAgdGhpcy5yZW1vdmVBbGxJdGVtcygpO1xuICAgIH1cblxuICB9XG5cbiAgcmVtb3ZlQWxsSXRlbXMoKSB7XG4gICAgY29uc3QgcmVtb3ZlSXRlbXMgPSBbXTtcblxuICAgIHRoaXMuZGlzY2xhaW1lcnMuZm9yRWFjaChkaXNjbGFpbWVyID0+IHtcbiAgICAgIGlmICghZGlzY2xhaW1lci5oaWRlQ2xvc2UpIHtcbiAgICAgICAgcmVtb3ZlSXRlbXMucHVzaChkaXNjbGFpbWVyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJlbW92ZUl0ZW1zLmZvckVhY2goZGlzY2xhaW1lciA9PiB0aGlzLmNsb3NlSXRlbShkaXNjbGFpbWVyLCBmYWxzZSkpO1xuXG4gICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDaGFuZ2VzKCkge1xuXG4gICAgaWYgKHRoaXMuZGlmZmVyKSB7XG4gICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5kaWZmZXIuZGlmZih0aGlzLmRpc2NsYWltZXJzKTtcblxuICAgICAgaWYgKGNoYW5nZXMgJiYgdGhpcy5kaXNjbGFpbWVyc0FyZUNoYW5nZWQodGhpcy5kaXNjbGFpbWVycykpIHtcbiAgICAgICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgICAgIH1cblxuICAgIH1cblxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0Rpc2NsYWltZXJzKGRpc2NsYWltZXJzOiBBcnJheTxUaGZEaXNjbGFpbWVyPikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGRpc2NsYWltZXJzKSkge1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpc2NsYWltZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGRpc2NsYWltZXIgPSBkaXNjbGFpbWVyc1tpXTtcblxuICAgICAgICBpZiAoZGlzY2xhaW1lci52YWx1ZSB8fCBkaXNjbGFpbWVyLnZhbHVlID09PSAwIHx8IGRpc2NsYWltZXIudmFsdWUgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICBkaXNjbGFpbWVyWyckaWQnXSA9IHV1aWQoKTtcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgZGlzY2xhaW1lcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGktLTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGlzY2xhaW1lcnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNjbGFpbWVyc0FyZUNoYW5nZWQoZGlzY2xhaW1lcnM6IEFycmF5PFRoZkRpc2NsYWltZXI+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlczogQXJyYXk8VGhmRGlzY2xhaW1lcj4gPSBkaXNjbGFpbWVycztcblxuICAgIGlmIChjdXJyZW50VmFsdWVzLmxlbmd0aCAhPT0gdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZXMuc29tZSgoZGlzY2xhaW1lciwgaW5kZXgpID0+IGRpc2NsYWltZXIudmFsdWUgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0udmFsdWVcbiAgICAgIHx8IGRpc2NsYWltZXIucHJvcGVydHkgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0ucHJvcGVydHkpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMuZGlzY2xhaW1lcnMpO1xuICAgIH0pO1xuICAgIHRoaXMucHJldmlvdXNEaXNjbGFpbWVycyA9IFsuLi50aGlzLl9kaXNjbGFpbWVyc107XG4gIH1cblxufVxuIl19