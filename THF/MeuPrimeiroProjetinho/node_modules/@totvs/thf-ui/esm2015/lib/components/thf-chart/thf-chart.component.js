/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ComponentFactoryResolver, ElementRef, HostListener, IterableDiffers, ViewChild, ViewContainerRef } from '@angular/core';
import { Subject } from 'rxjs';
import { ThfChartBaseComponent } from './thf-chart-base.component';
import { ThfChartColors } from './thf-chart-colors.constant';
import { ThfChartPieComponent } from './thf-chart-types/thf-chart-pie/thf-chart-pie.component';
import { ThfChartType } from './enums/thf-chart-type.enum';
/**
 * \@docsExtends ThfChartBaseComponent
 *
 * \@example
 *
 * <example name="thf-chart-basic" title="Totvs Chart Basic">
 *  <file name="sample-thf-chart-basic/sample-thf-chart-basic.component.html"> </file>
 *  <file name="sample-thf-chart-basic/sample-thf-chart-basic.component.ts"> </file>
 * </example>
 *
 * <example name="thf-chart-labs" title="Totvs Chart Labs">
 *  <file name="sample-thf-chart-labs/sample-thf-chart-labs.component.html"> </file>
 *  <file name="sample-thf-chart-labs/sample-thf-chart-labs.component.ts"> </file>
 * </example>
 *
 * <example name="thf-chart-coffee-ranking" title="Totvs Chart - Coffee Ranking">
 *  <file name="sample-thf-chart-coffee-ranking/sample-thf-chart-coffee-ranking.component.html"> </file>
 *  <file name="sample-thf-chart-coffee-ranking/sample-thf-chart-coffee-ranking.component.ts"> </file>
 * </example>
 */
export class ThfChartComponent extends ThfChartBaseComponent {
    /**
     * @param {?} changeDetector
     * @param {?} componentFactoryResolver
     * @param {?} differs
     */
    constructor(changeDetector, componentFactoryResolver, differs) {
        super();
        this.changeDetector = changeDetector;
        this.componentFactoryResolver = componentFactoryResolver;
        this.differs = differs;
        this.calculatedElement = false;
        this.initialized = false;
        this.windowResizeListener = new Subject();
        this.mappings = {
            [ThfChartType.Pie]: ThfChartPieComponent,
        };
        this.onResize = (/**
         * @return {?}
         */
        () => this.windowResizeListener.next());
        this.differ = this.differs.find([]).create(null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initialized = true;
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        /** @type {?} */
        const charWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        // Permite que o chart seja calculado na primeira vez que o componente torna-se visÃ­vel,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        if (charWrapperWidth && !this.calculatedElement && this.initialized) {
            this.calculatedElement = true;
            this.getSeriesColor();
            this.dynamicComponentSetting();
        }
        this.checkingForSerieChanges();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.removeWindowResizeListener();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getSeriesColor();
    }
    /**
     * @return {?}
     */
    rebuildComponent() {
        if (this.componentRef) {
            this.componentRef.destroy();
            this.dynamicComponentSetting();
        }
    }
    /**
     * @private
     * @return {?}
     */
    checkingForSerieChanges() {
        if (this.componentRef && this.differ) {
            /** @type {?} */
            const changeSeries = this.differ.diff(this.series);
            if (changeSeries) {
                this.getSeriesColor();
                this.rebuildComponent();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    createComponent() {
        /** @type {?} */
        const componentType = this.getComponentType(this.type);
        /** @type {?} */
        const factory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        this.componentRef = this.chartContainer.createComponent(factory);
        /** @type {?} */
        const instance = (/** @type {?} */ (this.componentRef.instance));
        this.setChartProperties(instance);
        return instance;
    }
    /**
     * @private
     * @return {?}
     */
    dynamicComponentSetting() {
        /** @type {?} */
        const instance = this.createComponent();
        this.setResizeListenerSubscribe(instance);
        this.changeDetector.detectChanges();
        this.setClickSubscribe(instance);
        this.setHoverSubscribe(instance);
    }
    /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    getComponentType(typeName) {
        return this.mappings[typeName];
    }
    /**
     * @private
     * @return {?}
     */
    getSeriesColor() {
        /** @type {?} */
        const colorsLength = ThfChartColors.length - 1;
        if (!this.series) {
            return this.colors = ThfChartColors[colorsLength];
        }
        /** @type {?} */
        const seriesLength = this.series.length - 1;
        if (seriesLength > colorsLength) {
            /** @type {?} */
            let colors = ThfChartColors[colorsLength];
            // recupera o resultado da divisao entre tamanho das series e o numero de cores disponiveis
            /** @type {?} */
            const quantityDuplicates = seriesLength / colorsLength;
            for (let i = 1; i <= quantityDuplicates; i++) {
                colors = colors.concat(ThfChartColors[colorsLength]);
            }
            return this.colors = colors;
        }
        return this.colors = ThfChartColors[seriesLength];
    }
    /**
     * @private
     * @return {?}
     */
    removeWindowResizeListener() {
        if (this.onResize) {
            this.onResize = (/**
             * @return {?}
             */
            () => { });
        }
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setChartProperties(instance) {
        instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
        instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
        instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        instance.colors = this.colors;
        instance.height = this.height;
        instance.series = this.series || [];
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setClickSubscribe(instance) {
        instance.onSerieClick.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            this.onSeriesClick(event);
        }));
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setHoverSubscribe(instance) {
        instance.onSerieHover.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            this.onSeriesHover(event);
        }));
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setResizeListenerSubscribe(instance) {
        this.windowResizeListener.subscribe((/**
         * @return {?}
         */
        () => {
            instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
            instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
            instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        }));
    }
}
ThfChartComponent.decorators = [
    { type: Component, args: [{
                selector: 'thf-chart',
                template: "<div #chartWrapper class=\"thf-chart-wrapper\">\n  <div #chartHeader class=\"thf-chart-header\">\n    <div class=\"thf-chart-title\">{{ title }}</div>\n  </div>\n  <ng-template #chartContainer></ng-template>\n  <div #chartLegend class=\"thf-chart-legend\">\n    <div class=\"thf-chart-legend-container\">\n      <div class=\"thf-chart-legend-item\" *ngFor=\"let serie of series; let i = index\">\n        <div class=\"thf-chart-legend-square\" [style.background]=\"colors[i]\"></div>\n        <span class=\"thf-chart-legend-text\">{{ serie.category }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n"
            }] }
];
/** @nocollapse */
ThfChartComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ComponentFactoryResolver },
    { type: IterableDiffers }
];
ThfChartComponent.propDecorators = {
    chartContainer: [{ type: ViewChild, args: ['chartContainer', { read: ViewContainerRef, static: true },] }],
    chartHeader: [{ type: ViewChild, args: ['chartHeader', { static: true },] }],
    chartLegend: [{ type: ViewChild, args: ['chartLegend', { static: true },] }],
    chartWrapper: [{ type: ViewChild, args: ['chartWrapper', { static: true },] }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.calculatedElement;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.windowResizeListener;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.mappings;
    /** @type {?} */
    ThfChartComponent.prototype.colors;
    /** @type {?} */
    ThfChartComponent.prototype.chartContainer;
    /** @type {?} */
    ThfChartComponent.prototype.chartHeader;
    /** @type {?} */
    ThfChartComponent.prototype.chartLegend;
    /** @type {?} */
    ThfChartComponent.prototype.chartWrapper;
    /** @type {?} */
    ThfChartComponent.prototype.onResize;
    /** @type {?} */
    ThfChartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    ThfChartComponent.prototype.differs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhmLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0b3R2cy90aGYtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGYtY2hhcnQvdGhmLWNoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFpQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQXlCLFVBQVUsRUFBRSxZQUFZLEVBQzdILGVBQWUsRUFBK0MsU0FBUyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRW5ILE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRTdELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQy9GLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEIzRCxNQUFNLE9BQU8saUJBQWtCLFNBQVEscUJBQXFCOzs7Ozs7SUF3QjFELFlBQ1MsY0FBaUMsRUFDaEMsd0JBQWtELEVBQ2xELE9BQXdCO1FBQzlCLEtBQUssRUFBRSxDQUFDO1FBSEgsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBQ2hDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUF6QjFCLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUduQyxnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUM3Qix5QkFBb0IsR0FBaUIsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUVuRCxhQUFRLEdBQUc7WUFDakIsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsb0JBQW9CO1NBQ3pDLENBQUM7UUFZRixhQUFROzs7UUFBRyxH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QUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBQ3pDLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO3VCQUUxQyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOzs7Ozs7O0lBbkJ6Qyw4Q0FBMkM7Ozs7O0lBQzNDLHlDQUF1Qzs7Ozs7SUFDdkMsbUNBQW9COzs7OztJQUNwQix3Q0FBcUM7Ozs7O0lBQ3JDLGlEQUEyRDs7Ozs7SUFFM0QscUNBRUU7O0lBRUYsbUNBQXNCOztJQUV0QiwyQ0FDaUM7O0lBRWpDLHdDQUFvRTs7SUFDcEUsd0NBQW9FOztJQUNwRSx5Q0FBc0U7O0lBRXRFLHFDQUNpRDs7SUFHL0MsMkNBQXdDOzs7OztJQUN4QyxxREFBMEQ7Ozs7O0lBQzFELG9DQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ29tcG9uZW50UmVmLCBEb0NoZWNrLCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsXG4gIEl0ZXJhYmxlRGlmZmVycywgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE9uSW5pdCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgVGhmQ2hhcnRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtY2hhcnQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgVGhmQ2hhcnRDb2xvcnMgfSBmcm9tICcuL3RoZi1jaGFydC1jb2xvcnMuY29uc3RhbnQnO1xuaW1wb3J0IHsgVGhmQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4vdGhmLWNoYXJ0LXR5cGVzL3RoZi1jaGFydC1keW5hbWljLXR5cGUuY29tcG9uZW50JztcbmltcG9ydCB7IFRoZkNoYXJ0UGllQ29tcG9uZW50IH0gZnJvbSAnLi90aGYtY2hhcnQtdHlwZXMvdGhmLWNoYXJ0LXBpZS90aGYtY2hhcnQtcGllLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUaGZDaGFydFR5cGUgfSBmcm9tICcuL2VudW1zL3RoZi1jaGFydC10eXBlLmVudW0nO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBUaGZDaGFydEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtY2hhcnQtYmFzaWNcIiB0aXRsZT1cIlRvdHZzIENoYXJ0IEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtY2hhcnQtYmFzaWMvc2FtcGxlLXRoZi1jaGFydC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS10aGYtY2hhcnQtYmFzaWMvc2FtcGxlLXRoZi1jaGFydC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtY2hhcnQtbGFic1wiIHRpdGxlPVwiVG90dnMgQ2hhcnQgTGFic1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtdGhmLWNoYXJ0LWxhYnMvc2FtcGxlLXRoZi1jaGFydC1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1jaGFydC1sYWJzL3NhbXBsZS10aGYtY2hhcnQtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJ0aGYtY2hhcnQtY29mZmVlLXJhbmtpbmdcIiB0aXRsZT1cIlRvdHZzIENoYXJ0IC0gQ29mZmVlIFJhbmtpbmdcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1jaGFydC1jb2ZmZWUtcmFua2luZy9zYW1wbGUtdGhmLWNoYXJ0LWNvZmZlZS1yYW5raW5nLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXRoZi1jaGFydC1jb2ZmZWUtcmFua2luZy9zYW1wbGUtdGhmLWNoYXJ0LWNvZmZlZS1yYW5raW5nLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoZi1jaGFydCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGYtY2hhcnQuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFRoZkNoYXJ0Q29tcG9uZW50IGV4dGVuZHMgVGhmQ2hhcnRCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgRG9DaGVjaywgT25EZXN0cm95LCBPbkluaXQge1xuXG4gIHByaXZhdGUgY2FsY3VsYXRlZEVsZW1lbnQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjx7fT47XG4gIHByaXZhdGUgZGlmZmVyOiBhbnk7XG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSB3aW5kb3dSZXNpemVMaXN0ZW5lcjogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwcml2YXRlIG1hcHBpbmdzID0ge1xuICAgIFtUaGZDaGFydFR5cGUuUGllXTogVGhmQ2hhcnRQaWVDb21wb25lbnQsXG4gIH07XG5cbiAgY29sb3JzOiBBcnJheTxzdHJpbmc+O1xuXG4gIEBWaWV3Q2hpbGQoJ2NoYXJ0Q29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgY2hhcnRDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgQFZpZXdDaGlsZCgnY2hhcnRIZWFkZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydEhlYWRlcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnY2hhcnRMZWdlbmQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydExlZ2VuZDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnY2hhcnRXcmFwcGVyJywgeyBzdGF0aWM6IHRydWUgfSkgY2hhcnRXcmFwcGVyOiBFbGVtZW50UmVmO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbJyRldmVudCddKVxuICBvblJlc2l6ZSA9ICgpID0+IHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIubmV4dCgpXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgZGlmZmVyczogSXRlcmFibGVEaWZmZXJzKSB7XG4gICAgICBzdXBlcigpO1xuXG4gICAgICB0aGlzLmRpZmZlciA9IHRoaXMuZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7XG4gICAgY29uc3QgY2hhcldyYXBwZXJXaWR0aCA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cbiAgICAvLyBQZXJtaXRlIHF1ZSBvIGNoYXJ0IHNlamEgY2FsY3VsYWRvIG5hIHByaW1laXJhIHZleiBxdWUgbyBjb21wb25lbnRlIHRvcm5hLXNlIHZpc8OtdmVsLFxuICAgIC8vIGV2aXRhbmRvIGNvbSBpc3NvLCBwcm9ibGVtYXMgY29tIFRhYnMgb3UgRGl2cyBxdWUgaW5pY2llbSBlc2NvbmRpZGFzLlxuICAgIGlmIChjaGFyV3JhcHBlcldpZHRoICYmICF0aGlzLmNhbGN1bGF0ZWRFbGVtZW50ICYmIHRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHRoaXMuY2FsY3VsYXRlZEVsZW1lbnQgPSB0cnVlO1xuICAgICAgdGhpcy5nZXRTZXJpZXNDb2xvcigpO1xuICAgICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2V0dGluZygpO1xuICAgIH1cblxuICAgIHRoaXMuY2hlY2tpbmdGb3JTZXJpZUNoYW5nZXMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZ2V0U2VyaWVzQ29sb3IoKTtcbiAgfVxuXG4gIHJlYnVpbGRDb21wb25lbnQoKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgICB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja2luZ0ZvclNlcmllQ2hhbmdlcygpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYgJiYgdGhpcy5kaWZmZXIpIHtcbiAgICAgIGNvbnN0IGNoYW5nZVNlcmllcyA9IHRoaXMuZGlmZmVyLmRpZmYodGhpcy5zZXJpZXMpO1xuICAgICAgaWYgKGNoYW5nZVNlcmllcykge1xuICAgICAgICB0aGlzLmdldFNlcmllc0NvbG9yKCk7XG4gICAgICAgIHRoaXMucmVidWlsZENvbXBvbmVudCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ29tcG9uZW50KCkge1xuICAgIGNvbnN0IGNvbXBvbmVudFR5cGUgPSB0aGlzLmdldENvbXBvbmVudFR5cGUodGhpcy50eXBlKTtcbiAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50VHlwZSk7XG5cbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHRoaXMuY2hhcnRDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnkpO1xuXG4gICAgY29uc3QgaW5zdGFuY2UgPSA8VGhmQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudD50aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcblxuICAgIHRoaXMuc2V0Q2hhcnRQcm9wZXJ0aWVzKGluc3RhbmNlKTtcblxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgZHluYW1pY0NvbXBvbmVudFNldHRpbmcoKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNyZWF0ZUNvbXBvbmVudCgpO1xuXG4gICAgdGhpcy5zZXRSZXNpemVMaXN0ZW5lclN1YnNjcmliZShpbnN0YW5jZSk7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy5zZXRDbGlja1N1YnNjcmliZShpbnN0YW5jZSk7XG4gICAgdGhpcy5zZXRIb3ZlclN1YnNjcmliZShpbnN0YW5jZSk7XG4gIH1cblxuICBwcml2YXRlIGdldENvbXBvbmVudFR5cGUodHlwZU5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5tYXBwaW5nc1t0eXBlTmFtZV07XG4gIH1cblxuICBwcml2YXRlIGdldFNlcmllc0NvbG9yKCkge1xuICAgIGNvbnN0IGNvbG9yc0xlbmd0aCA9IFRoZkNoYXJ0Q29sb3JzLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoIXRoaXMuc2VyaWVzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBUaGZDaGFydENvbG9yc1tjb2xvcnNMZW5ndGhdO1xuICAgIH1cblxuICAgIGNvbnN0IHNlcmllc0xlbmd0aCA9IHRoaXMuc2VyaWVzLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoc2VyaWVzTGVuZ3RoID4gY29sb3JzTGVuZ3RoKSB7XG4gICAgICBsZXQgY29sb3JzID0gVGhmQ2hhcnRDb2xvcnNbY29sb3JzTGVuZ3RoXTtcblxuICAgICAgLy8gcmVjdXBlcmEgbyByZXN1bHRhZG8gZGEgZGl2aXNhbyBlbnRyZSB0YW1hbmhvIGRhcyBzZXJpZXMgZSBvIG51bWVybyBkZSBjb3JlcyBkaXNwb25pdmVpc1xuICAgICAgY29uc3QgcXVhbnRpdHlEdXBsaWNhdGVzID0gc2VyaWVzTGVuZ3RoIC8gY29sb3JzTGVuZ3RoO1xuXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBxdWFudGl0eUR1cGxpY2F0ZXM7IGkrKykge1xuICAgICAgICBjb2xvcnMgPSBjb2xvcnMuY29uY2F0KFRoZkNoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBjb2xvcnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY29sb3JzID0gVGhmQ2hhcnRDb2xvcnNbc2VyaWVzTGVuZ3RoXTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMub25SZXNpemUpIHtcbiAgICAgIHRoaXMub25SZXNpemUgPSAoKSA9PiB7fTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldENoYXJ0UHJvcGVydGllcyhpbnN0YW5jZTogVGhmQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLmNoYXJ0SGVhZGVyID0gdGhpcy5jaGFydEhlYWRlci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICBpbnN0YW5jZS5jaGFydExlZ2VuZCA9IHRoaXMuY2hhcnRMZWdlbmQubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaW5zdGFuY2UuY2hhcnRXcmFwcGVyID0gdGhpcy5jaGFydFdyYXBwZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICBpbnN0YW5jZS5jb2xvcnMgPSB0aGlzLmNvbG9ycztcbiAgICBpbnN0YW5jZS5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICBpbnN0YW5jZS5zZXJpZXMgPSB0aGlzLnNlcmllcyB8fCBbXTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2U6IFRoZkNoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICBpbnN0YW5jZS5vblNlcmllQ2xpY2suc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgIHRoaXMub25TZXJpZXNDbGljayhldmVudCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldEhvdmVyU3Vic2NyaWJlKGluc3RhbmNlOiBUaGZDaGFydER5bmFtaWNUeXBlQ29tcG9uZW50KSB7XG4gICAgaW5zdGFuY2Uub25TZXJpZUhvdmVyLnN1YnNjcmliZShldmVudCA9PiB7XG4gICAgICB0aGlzLm9uU2VyaWVzSG92ZXIoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXNpemVMaXN0ZW5lclN1YnNjcmliZShpbnN0YW5jZTogVGhmQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGluc3RhbmNlLmNoYXJ0SGVhZGVyID0gdGhpcy5jaGFydEhlYWRlci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0TGVnZW5kID0gdGhpcy5jaGFydExlZ2VuZC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgfSk7XG4gIH1cblxufVxuIl19